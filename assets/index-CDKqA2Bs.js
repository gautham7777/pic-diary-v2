(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function sS(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Jv={exports:{}},xu={},Qv={exports:{}},re={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fl=Symbol.for("react.element"),lS=Symbol.for("react.portal"),aS=Symbol.for("react.fragment"),uS=Symbol.for("react.strict_mode"),cS=Symbol.for("react.profiler"),dS=Symbol.for("react.provider"),fS=Symbol.for("react.context"),hS=Symbol.for("react.forward_ref"),pS=Symbol.for("react.suspense"),mS=Symbol.for("react.memo"),gS=Symbol.for("react.lazy"),Jm=Symbol.iterator;function yS(t){return t===null||typeof t!="object"?null:(t=Jm&&t[Jm]||t["@@iterator"],typeof t=="function"?t:null)}var Yv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Xv=Object.assign,Zv={};function Io(t,e,n){this.props=t,this.context=e,this.refs=Zv,this.updater=n||Yv}Io.prototype.isReactComponent={};Io.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Io.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function jv(){}jv.prototype=Io.prototype;function Xf(t,e,n){this.props=t,this.context=e,this.refs=Zv,this.updater=n||Yv}var Zf=Xf.prototype=new jv;Zf.constructor=Xf;Xv(Zf,Io.prototype);Zf.isPureReactComponent=!0;var Qm=Array.isArray,eT=Object.prototype.hasOwnProperty,jf={current:null},tT={key:!0,ref:!0,__self:!0,__source:!0};function nT(t,e,n){var r,i={},o=null,s=null;if(e!=null)for(r in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(o=""+e.key),e)eT.call(e,r)&&!tT.hasOwnProperty(r)&&(i[r]=e[r]);var u=arguments.length-2;if(u===1)i.children=n;else if(1<u){for(var c=Array(u),d=0;d<u;d++)c[d]=arguments[d+2];i.children=c}if(t&&t.defaultProps)for(r in u=t.defaultProps,u)i[r]===void 0&&(i[r]=u[r]);return{$$typeof:fl,type:t,key:o,ref:s,props:i,_owner:jf.current}}function _S(t,e){return{$$typeof:fl,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function eh(t){return typeof t=="object"&&t!==null&&t.$$typeof===fl}function vS(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Ym=/\/+/g;function Vc(t,e){return typeof t=="object"&&t!==null&&t.key!=null?vS(""+t.key):e.toString(36)}function va(t,e,n,r,i){var o=typeof t;(o==="undefined"||o==="boolean")&&(t=null);var s=!1;if(t===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(t.$$typeof){case fl:case lS:s=!0}}if(s)return s=t,i=i(s),t=r===""?"."+Vc(s,0):r,Qm(i)?(n="",t!=null&&(n=t.replace(Ym,"$&/")+"/"),va(i,e,n,"",function(d){return d})):i!=null&&(eh(i)&&(i=_S(i,n+(!i.key||s&&s.key===i.key?"":(""+i.key).replace(Ym,"$&/")+"/")+t)),e.push(i)),1;if(s=0,r=r===""?".":r+":",Qm(t))for(var u=0;u<t.length;u++){o=t[u];var c=r+Vc(o,u);s+=va(o,e,n,c,i)}else if(c=yS(t),typeof c=="function")for(t=c.call(t),u=0;!(o=t.next()).done;)o=o.value,c=r+Vc(o,u++),s+=va(o,e,n,c,i);else if(o==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return s}function Kl(t,e,n){if(t==null)return t;var r=[],i=0;return va(t,r,"","",function(o){return e.call(n,o,i++)}),r}function TS(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Et={current:null},Ta={transition:null},ES={ReactCurrentDispatcher:Et,ReactCurrentBatchConfig:Ta,ReactCurrentOwner:jf};function rT(){throw Error("act(...) is not supported in production builds of React.")}re.Children={map:Kl,forEach:function(t,e,n){Kl(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Kl(t,function(){e++}),e},toArray:function(t){return Kl(t,function(e){return e})||[]},only:function(t){if(!eh(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};re.Component=Io;re.Fragment=aS;re.Profiler=cS;re.PureComponent=Xf;re.StrictMode=uS;re.Suspense=pS;re.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ES;re.act=rT;re.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=Xv({},t.props),i=t.key,o=t.ref,s=t._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,s=jf.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var u=t.type.defaultProps;for(c in e)eT.call(e,c)&&!tT.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&u!==void 0?u[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){u=Array(c);for(var d=0;d<c;d++)u[d]=arguments[d+2];r.children=u}return{$$typeof:fl,type:t.type,key:i,ref:o,props:r,_owner:s}};re.createContext=function(t){return t={$$typeof:fS,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:dS,_context:t},t.Consumer=t};re.createElement=nT;re.createFactory=function(t){var e=nT.bind(null,t);return e.type=t,e};re.createRef=function(){return{current:null}};re.forwardRef=function(t){return{$$typeof:hS,render:t}};re.isValidElement=eh;re.lazy=function(t){return{$$typeof:gS,_payload:{_status:-1,_result:t},_init:TS}};re.memo=function(t,e){return{$$typeof:mS,type:t,compare:e===void 0?null:e}};re.startTransition=function(t){var e=Ta.transition;Ta.transition={};try{t()}finally{Ta.transition=e}};re.unstable_act=rT;re.useCallback=function(t,e){return Et.current.useCallback(t,e)};re.useContext=function(t){return Et.current.useContext(t)};re.useDebugValue=function(){};re.useDeferredValue=function(t){return Et.current.useDeferredValue(t)};re.useEffect=function(t,e){return Et.current.useEffect(t,e)};re.useId=function(){return Et.current.useId()};re.useImperativeHandle=function(t,e,n){return Et.current.useImperativeHandle(t,e,n)};re.useInsertionEffect=function(t,e){return Et.current.useInsertionEffect(t,e)};re.useLayoutEffect=function(t,e){return Et.current.useLayoutEffect(t,e)};re.useMemo=function(t,e){return Et.current.useMemo(t,e)};re.useReducer=function(t,e,n){return Et.current.useReducer(t,e,n)};re.useRef=function(t){return Et.current.useRef(t)};re.useState=function(t){return Et.current.useState(t)};re.useSyncExternalStore=function(t,e,n){return Et.current.useSyncExternalStore(t,e,n)};re.useTransition=function(){return Et.current.useTransition()};re.version="18.3.1";Qv.exports=re;var oe=Qv.exports;const IS=sS(oe);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var CS=oe,wS=Symbol.for("react.element"),SS=Symbol.for("react.fragment"),AS=Object.prototype.hasOwnProperty,RS=CS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,xS={key:!0,ref:!0,__self:!0,__source:!0};function iT(t,e,n){var r,i={},o=null,s=null;n!==void 0&&(o=""+n),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(s=e.ref);for(r in e)AS.call(e,r)&&!xS.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:wS,type:t,key:o,ref:s,props:i,_owner:RS.current}}xu.Fragment=SS;xu.jsx=iT;xu.jsxs=iT;Jv.exports=xu;var B=Jv.exports,vd={},oT={exports:{}},Bt={},sT={exports:{}},lT={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(K,j){var te=K.length;K.push(j);e:for(;0<te;){var Re=te-1>>>1,me=K[Re];if(0<i(me,j))K[Re]=j,K[te]=me,te=Re;else break e}}function n(K){return K.length===0?null:K[0]}function r(K){if(K.length===0)return null;var j=K[0],te=K.pop();if(te!==j){K[0]=te;e:for(var Re=0,me=K.length,Ue=me>>>1;Re<Ue;){var _n=2*(Re+1)-1,vn=K[_n],Tn=_n+1,En=K[Tn];if(0>i(vn,te))Tn<me&&0>i(En,vn)?(K[Re]=En,K[Tn]=te,Re=Tn):(K[Re]=vn,K[_n]=te,Re=_n);else if(Tn<me&&0>i(En,te))K[Re]=En,K[Tn]=te,Re=Tn;else break e}}return j}function i(K,j){var te=K.sortIndex-j.sortIndex;return te!==0?te:K.id-j.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var c=[],d=[],h=1,p=null,m=3,_=!1,S=!1,R=!1,M=typeof setTimeout=="function"?setTimeout:null,I=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(K){for(var j=n(d);j!==null;){if(j.callback===null)r(d);else if(j.startTime<=K)r(d),j.sortIndex=j.expirationTime,e(c,j);else break;j=n(d)}}function k(K){if(R=!1,C(K),!S)if(n(c)!==null)S=!0,gn(F);else{var j=n(d);j!==null&&yn(k,j.startTime-K)}}function F(K,j){S=!1,R&&(R=!1,I(v),v=-1),_=!0;var te=m;try{for(C(j),p=n(c);p!==null&&(!(p.expirationTime>j)||K&&!D());){var Re=p.callback;if(typeof Re=="function"){p.callback=null,m=p.priorityLevel;var me=Re(p.expirationTime<=j);j=t.unstable_now(),typeof me=="function"?p.callback=me:p===n(c)&&r(c),C(j)}else r(c);p=n(c)}if(p!==null)var Ue=!0;else{var _n=n(d);_n!==null&&yn(k,_n.startTime-j),Ue=!1}return Ue}finally{p=null,m=te,_=!1}}var b=!1,A=null,v=-1,w=5,x=-1;function D(){return!(t.unstable_now()-x<w)}function N(){if(A!==null){var K=t.unstable_now();x=K;var j=!0;try{j=A(!0,K)}finally{j?P():(b=!1,A=null)}}else b=!1}var P;if(typeof T=="function")P=function(){T(N)};else if(typeof MessageChannel<"u"){var Ae=new MessageChannel,Ye=Ae.port2;Ae.port1.onmessage=N,P=function(){Ye.postMessage(null)}}else P=function(){M(N,0)};function gn(K){A=K,b||(b=!0,P())}function yn(K,j){v=M(function(){K(t.unstable_now())},j)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(K){K.callback=null},t.unstable_continueExecution=function(){S||_||(S=!0,gn(F))},t.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):w=0<K?Math.floor(1e3/K):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(K){switch(m){case 1:case 2:case 3:var j=3;break;default:j=m}var te=m;m=j;try{return K()}finally{m=te}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(K,j){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var te=m;m=K;try{return j()}finally{m=te}},t.unstable_scheduleCallback=function(K,j,te){var Re=t.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?Re+te:Re):te=Re,K){case 1:var me=-1;break;case 2:me=250;break;case 5:me=1073741823;break;case 4:me=1e4;break;default:me=5e3}return me=te+me,K={id:h++,callback:j,priorityLevel:K,startTime:te,expirationTime:me,sortIndex:-1},te>Re?(K.sortIndex=te,e(d,K),n(c)===null&&K===n(d)&&(R?(I(v),v=-1):R=!0,yn(k,te-Re))):(K.sortIndex=me,e(c,K),S||_||(S=!0,gn(F))),K},t.unstable_shouldYield=D,t.unstable_wrapCallback=function(K){var j=m;return function(){var te=m;m=j;try{return K.apply(this,arguments)}finally{m=te}}}})(lT);sT.exports=lT;var PS=sT.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DS=oe,Ut=PS;function G(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var aT=new Set,Ns={};function ci(t,e){io(t,e),io(t+"Capture",e)}function io(t,e){for(Ns[t]=e,t=0;t<e.length;t++)aT.add(e[t])}var Mn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Td=Object.prototype.hasOwnProperty,MS=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Xm={},Zm={};function kS(t){return Td.call(Zm,t)?!0:Td.call(Xm,t)?!1:MS.test(t)?Zm[t]=!0:(Xm[t]=!0,!1)}function NS(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function VS(t,e,n,r){if(e===null||typeof e>"u"||NS(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function It(t,e,n,r,i,o,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=o,this.removeEmptyString=s}var rt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){rt[t]=new It(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];rt[e]=new It(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){rt[t]=new It(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){rt[t]=new It(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){rt[t]=new It(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){rt[t]=new It(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){rt[t]=new It(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){rt[t]=new It(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){rt[t]=new It(t,5,!1,t.toLowerCase(),null,!1,!1)});var th=/[\-:]([a-z])/g;function nh(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(th,nh);rt[e]=new It(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(th,nh);rt[e]=new It(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(th,nh);rt[e]=new It(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){rt[t]=new It(t,1,!1,t.toLowerCase(),null,!1,!1)});rt.xlinkHref=new It("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){rt[t]=new It(t,1,!1,t.toLowerCase(),null,!0,!0)});function rh(t,e,n,r){var i=rt.hasOwnProperty(e)?rt[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(VS(e,n,i,r)&&(n=null),r||i===null?kS(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var bn=DS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Wl=Symbol.for("react.element"),Li=Symbol.for("react.portal"),Fi=Symbol.for("react.fragment"),ih=Symbol.for("react.strict_mode"),Ed=Symbol.for("react.profiler"),uT=Symbol.for("react.provider"),cT=Symbol.for("react.context"),oh=Symbol.for("react.forward_ref"),Id=Symbol.for("react.suspense"),Cd=Symbol.for("react.suspense_list"),sh=Symbol.for("react.memo"),Wn=Symbol.for("react.lazy"),dT=Symbol.for("react.offscreen"),jm=Symbol.iterator;function Ko(t){return t===null||typeof t!="object"?null:(t=jm&&t[jm]||t["@@iterator"],typeof t=="function"?t:null)}var ke=Object.assign,Lc;function as(t){if(Lc===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Lc=e&&e[1]||""}return`
`+Lc+t}var Fc=!1;function Uc(t,e){if(!t||Fc)return"";Fc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var i=d.stack.split(`
`),o=r.stack.split(`
`),s=i.length-1,u=o.length-1;1<=s&&0<=u&&i[s]!==o[u];)u--;for(;1<=s&&0<=u;s--,u--)if(i[s]!==o[u]){if(s!==1||u!==1)do if(s--,u--,0>u||i[s]!==o[u]){var c=`
`+i[s].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=s&&0<=u);break}}}finally{Fc=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?as(t):""}function LS(t){switch(t.tag){case 5:return as(t.type);case 16:return as("Lazy");case 13:return as("Suspense");case 19:return as("SuspenseList");case 0:case 2:case 15:return t=Uc(t.type,!1),t;case 11:return t=Uc(t.type.render,!1),t;case 1:return t=Uc(t.type,!0),t;default:return""}}function wd(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Fi:return"Fragment";case Li:return"Portal";case Ed:return"Profiler";case ih:return"StrictMode";case Id:return"Suspense";case Cd:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case cT:return(t.displayName||"Context")+".Consumer";case uT:return(t._context.displayName||"Context")+".Provider";case oh:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case sh:return e=t.displayName||null,e!==null?e:wd(t.type)||"Memo";case Wn:e=t._payload,t=t._init;try{return wd(t(e))}catch{}}return null}function FS(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return wd(e);case 8:return e===ih?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function gr(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function fT(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function US(t){var e=fT(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,o=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(s){r=""+s,o.call(this,s)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Jl(t){t._valueTracker||(t._valueTracker=US(t))}function hT(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=fT(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Ga(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Sd(t,e){var n=e.checked;return ke({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function eg(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=gr(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function pT(t,e){e=e.checked,e!=null&&rh(t,"checked",e,!1)}function Ad(t,e){pT(t,e);var n=gr(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Rd(t,e.type,n):e.hasOwnProperty("defaultValue")&&Rd(t,e.type,gr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function tg(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Rd(t,e,n){(e!=="number"||Ga(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var us=Array.isArray;function Ji(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+gr(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function xd(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(G(91));return ke({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function ng(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(G(92));if(us(n)){if(1<n.length)throw Error(G(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:gr(n)}}function mT(t,e){var n=gr(e.value),r=gr(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function rg(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function gT(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Pd(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?gT(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ql,yT=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Ql=Ql||document.createElement("div"),Ql.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ql.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Vs(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var ys={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},bS=["Webkit","ms","Moz","O"];Object.keys(ys).forEach(function(t){bS.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ys[e]=ys[t]})});function _T(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||ys.hasOwnProperty(t)&&ys[t]?(""+e).trim():e+"px"}function vT(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=_T(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var BS=ke({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Dd(t,e){if(e){if(BS[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(G(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(G(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(G(61))}if(e.style!=null&&typeof e.style!="object")throw Error(G(62))}}function Md(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var kd=null;function lh(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Nd=null,Qi=null,Yi=null;function ig(t){if(t=ml(t)){if(typeof Nd!="function")throw Error(G(280));var e=t.stateNode;e&&(e=Nu(e),Nd(t.stateNode,t.type,e))}}function TT(t){Qi?Yi?Yi.push(t):Yi=[t]:Qi=t}function ET(){if(Qi){var t=Qi,e=Yi;if(Yi=Qi=null,ig(t),e)for(t=0;t<e.length;t++)ig(e[t])}}function IT(t,e){return t(e)}function CT(){}var bc=!1;function wT(t,e,n){if(bc)return t(e,n);bc=!0;try{return IT(t,e,n)}finally{bc=!1,(Qi!==null||Yi!==null)&&(CT(),ET())}}function Ls(t,e){var n=t.stateNode;if(n===null)return null;var r=Nu(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(G(231,e,typeof n));return n}var Vd=!1;if(Mn)try{var Wo={};Object.defineProperty(Wo,"passive",{get:function(){Vd=!0}}),window.addEventListener("test",Wo,Wo),window.removeEventListener("test",Wo,Wo)}catch{Vd=!1}function OS(t,e,n,r,i,o,s,u,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(h){this.onError(h)}}var _s=!1,$a=null,za=!1,Ld=null,qS={onError:function(t){_s=!0,$a=t}};function GS(t,e,n,r,i,o,s,u,c){_s=!1,$a=null,OS.apply(qS,arguments)}function $S(t,e,n,r,i,o,s,u,c){if(GS.apply(this,arguments),_s){if(_s){var d=$a;_s=!1,$a=null}else throw Error(G(198));za||(za=!0,Ld=d)}}function di(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function ST(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function og(t){if(di(t)!==t)throw Error(G(188))}function zS(t){var e=t.alternate;if(!e){if(e=di(t),e===null)throw Error(G(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return og(i),t;if(o===r)return og(i),e;o=o.sibling}throw Error(G(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,u=i.child;u;){if(u===n){s=!0,n=i,r=o;break}if(u===r){s=!0,r=i,n=o;break}u=u.sibling}if(!s){for(u=o.child;u;){if(u===n){s=!0,n=o,r=i;break}if(u===r){s=!0,r=o,n=i;break}u=u.sibling}if(!s)throw Error(G(189))}}if(n.alternate!==r)throw Error(G(190))}if(n.tag!==3)throw Error(G(188));return n.stateNode.current===n?t:e}function AT(t){return t=zS(t),t!==null?RT(t):null}function RT(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=RT(t);if(e!==null)return e;t=t.sibling}return null}var xT=Ut.unstable_scheduleCallback,sg=Ut.unstable_cancelCallback,HS=Ut.unstable_shouldYield,KS=Ut.unstable_requestPaint,be=Ut.unstable_now,WS=Ut.unstable_getCurrentPriorityLevel,ah=Ut.unstable_ImmediatePriority,PT=Ut.unstable_UserBlockingPriority,Ha=Ut.unstable_NormalPriority,JS=Ut.unstable_LowPriority,DT=Ut.unstable_IdlePriority,Pu=null,fn=null;function QS(t){if(fn&&typeof fn.onCommitFiberRoot=="function")try{fn.onCommitFiberRoot(Pu,t,void 0,(t.current.flags&128)===128)}catch{}}var tn=Math.clz32?Math.clz32:ZS,YS=Math.log,XS=Math.LN2;function ZS(t){return t>>>=0,t===0?32:31-(YS(t)/XS|0)|0}var Yl=64,Xl=4194304;function cs(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Ka(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,o=t.pingedLanes,s=n&268435455;if(s!==0){var u=s&~i;u!==0?r=cs(u):(o&=s,o!==0&&(r=cs(o)))}else s=n&~i,s!==0?r=cs(s):o!==0&&(r=cs(o));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,o=e&-e,i>=o||i===16&&(o&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-tn(e),i=1<<n,r|=t[n],e&=~i;return r}function jS(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function eA(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,o=t.pendingLanes;0<o;){var s=31-tn(o),u=1<<s,c=i[s];c===-1?(!(u&n)||u&r)&&(i[s]=jS(u,e)):c<=e&&(t.expiredLanes|=u),o&=~u}}function Fd(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function MT(){var t=Yl;return Yl<<=1,!(Yl&4194240)&&(Yl=64),t}function Bc(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function hl(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-tn(e),t[e]=n}function tA(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-tn(n),o=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~o}}function uh(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-tn(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var he=0;function kT(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var NT,ch,VT,LT,FT,Ud=!1,Zl=[],rr=null,ir=null,or=null,Fs=new Map,Us=new Map,Qn=[],nA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function lg(t,e){switch(t){case"focusin":case"focusout":rr=null;break;case"dragenter":case"dragleave":ir=null;break;case"mouseover":case"mouseout":or=null;break;case"pointerover":case"pointerout":Fs.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Us.delete(e.pointerId)}}function Jo(t,e,n,r,i,o){return t===null||t.nativeEvent!==o?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},e!==null&&(e=ml(e),e!==null&&ch(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function rA(t,e,n,r,i){switch(e){case"focusin":return rr=Jo(rr,t,e,n,r,i),!0;case"dragenter":return ir=Jo(ir,t,e,n,r,i),!0;case"mouseover":return or=Jo(or,t,e,n,r,i),!0;case"pointerover":var o=i.pointerId;return Fs.set(o,Jo(Fs.get(o)||null,t,e,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Us.set(o,Jo(Us.get(o)||null,t,e,n,r,i)),!0}return!1}function UT(t){var e=Or(t.target);if(e!==null){var n=di(e);if(n!==null){if(e=n.tag,e===13){if(e=ST(n),e!==null){t.blockedOn=e,FT(t.priority,function(){VT(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Ea(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=bd(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);kd=r,n.target.dispatchEvent(r),kd=null}else return e=ml(n),e!==null&&ch(e),t.blockedOn=n,!1;e.shift()}return!0}function ag(t,e,n){Ea(t)&&n.delete(e)}function iA(){Ud=!1,rr!==null&&Ea(rr)&&(rr=null),ir!==null&&Ea(ir)&&(ir=null),or!==null&&Ea(or)&&(or=null),Fs.forEach(ag),Us.forEach(ag)}function Qo(t,e){t.blockedOn===e&&(t.blockedOn=null,Ud||(Ud=!0,Ut.unstable_scheduleCallback(Ut.unstable_NormalPriority,iA)))}function bs(t){function e(i){return Qo(i,t)}if(0<Zl.length){Qo(Zl[0],t);for(var n=1;n<Zl.length;n++){var r=Zl[n];r.blockedOn===t&&(r.blockedOn=null)}}for(rr!==null&&Qo(rr,t),ir!==null&&Qo(ir,t),or!==null&&Qo(or,t),Fs.forEach(e),Us.forEach(e),n=0;n<Qn.length;n++)r=Qn[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Qn.length&&(n=Qn[0],n.blockedOn===null);)UT(n),n.blockedOn===null&&Qn.shift()}var Xi=bn.ReactCurrentBatchConfig,Wa=!0;function oA(t,e,n,r){var i=he,o=Xi.transition;Xi.transition=null;try{he=1,dh(t,e,n,r)}finally{he=i,Xi.transition=o}}function sA(t,e,n,r){var i=he,o=Xi.transition;Xi.transition=null;try{he=4,dh(t,e,n,r)}finally{he=i,Xi.transition=o}}function dh(t,e,n,r){if(Wa){var i=bd(t,e,n,r);if(i===null)Qc(t,e,r,Ja,n),lg(t,r);else if(rA(i,t,e,n,r))r.stopPropagation();else if(lg(t,r),e&4&&-1<nA.indexOf(t)){for(;i!==null;){var o=ml(i);if(o!==null&&NT(o),o=bd(t,e,n,r),o===null&&Qc(t,e,r,Ja,n),o===i)break;i=o}i!==null&&r.stopPropagation()}else Qc(t,e,r,null,n)}}var Ja=null;function bd(t,e,n,r){if(Ja=null,t=lh(r),t=Or(t),t!==null)if(e=di(t),e===null)t=null;else if(n=e.tag,n===13){if(t=ST(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ja=t,null}function bT(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(WS()){case ah:return 1;case PT:return 4;case Ha:case JS:return 16;case DT:return 536870912;default:return 16}default:return 16}}var jn=null,fh=null,Ia=null;function BT(){if(Ia)return Ia;var t,e=fh,n=e.length,r,i="value"in jn?jn.value:jn.textContent,o=i.length;for(t=0;t<n&&e[t]===i[t];t++);var s=n-t;for(r=1;r<=s&&e[n-r]===i[o-r];r++);return Ia=i.slice(t,1<r?1-r:void 0)}function Ca(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function jl(){return!0}function ug(){return!1}function Ot(t){function e(n,r,i,o,s){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var u in t)t.hasOwnProperty(u)&&(n=t[u],this[u]=n?n(o):o[u]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?jl:ug,this.isPropagationStopped=ug,this}return ke(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=jl)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=jl)},persist:function(){},isPersistent:jl}),e}var Co={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hh=Ot(Co),pl=ke({},Co,{view:0,detail:0}),lA=Ot(pl),Oc,qc,Yo,Du=ke({},pl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ph,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Yo&&(Yo&&t.type==="mousemove"?(Oc=t.screenX-Yo.screenX,qc=t.screenY-Yo.screenY):qc=Oc=0,Yo=t),Oc)},movementY:function(t){return"movementY"in t?t.movementY:qc}}),cg=Ot(Du),aA=ke({},Du,{dataTransfer:0}),uA=Ot(aA),cA=ke({},pl,{relatedTarget:0}),Gc=Ot(cA),dA=ke({},Co,{animationName:0,elapsedTime:0,pseudoElement:0}),fA=Ot(dA),hA=ke({},Co,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),pA=Ot(hA),mA=ke({},Co,{data:0}),dg=Ot(mA),gA={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_A={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vA(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=_A[t])?!!e[t]:!1}function ph(){return vA}var TA=ke({},pl,{key:function(t){if(t.key){var e=gA[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Ca(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?yA[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ph,charCode:function(t){return t.type==="keypress"?Ca(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Ca(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),EA=Ot(TA),IA=ke({},Du,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),fg=Ot(IA),CA=ke({},pl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ph}),wA=Ot(CA),SA=ke({},Co,{propertyName:0,elapsedTime:0,pseudoElement:0}),AA=Ot(SA),RA=ke({},Du,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),xA=Ot(RA),PA=[9,13,27,32],mh=Mn&&"CompositionEvent"in window,vs=null;Mn&&"documentMode"in document&&(vs=document.documentMode);var DA=Mn&&"TextEvent"in window&&!vs,OT=Mn&&(!mh||vs&&8<vs&&11>=vs),hg=" ",pg=!1;function qT(t,e){switch(t){case"keyup":return PA.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function GT(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ui=!1;function MA(t,e){switch(t){case"compositionend":return GT(e);case"keypress":return e.which!==32?null:(pg=!0,hg);case"textInput":return t=e.data,t===hg&&pg?null:t;default:return null}}function kA(t,e){if(Ui)return t==="compositionend"||!mh&&qT(t,e)?(t=BT(),Ia=fh=jn=null,Ui=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return OT&&e.locale!=="ko"?null:e.data;default:return null}}var NA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!NA[t.type]:e==="textarea"}function $T(t,e,n,r){TT(r),e=Qa(e,"onChange"),0<e.length&&(n=new hh("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Ts=null,Bs=null;function VA(t){eE(t,0)}function Mu(t){var e=Oi(t);if(hT(e))return t}function LA(t,e){if(t==="change")return e}var zT=!1;if(Mn){var $c;if(Mn){var zc="oninput"in document;if(!zc){var gg=document.createElement("div");gg.setAttribute("oninput","return;"),zc=typeof gg.oninput=="function"}$c=zc}else $c=!1;zT=$c&&(!document.documentMode||9<document.documentMode)}function yg(){Ts&&(Ts.detachEvent("onpropertychange",HT),Bs=Ts=null)}function HT(t){if(t.propertyName==="value"&&Mu(Bs)){var e=[];$T(e,Bs,t,lh(t)),wT(VA,e)}}function FA(t,e,n){t==="focusin"?(yg(),Ts=e,Bs=n,Ts.attachEvent("onpropertychange",HT)):t==="focusout"&&yg()}function UA(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Mu(Bs)}function bA(t,e){if(t==="click")return Mu(e)}function BA(t,e){if(t==="input"||t==="change")return Mu(e)}function OA(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var rn=typeof Object.is=="function"?Object.is:OA;function Os(t,e){if(rn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!Td.call(e,i)||!rn(t[i],e[i]))return!1}return!0}function _g(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function vg(t,e){var n=_g(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=_g(n)}}function KT(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?KT(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function WT(){for(var t=window,e=Ga();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Ga(t.document)}return e}function gh(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function qA(t){var e=WT(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&KT(n.ownerDocument.documentElement,n)){if(r!==null&&gh(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=r.end===void 0?o:Math.min(r.end,i),!t.extend&&o>r&&(i=r,r=o,o=i),i=vg(n,o);var s=vg(n,r);i&&s&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==s.node||t.focusOffset!==s.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),o>r?(t.addRange(e),t.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var GA=Mn&&"documentMode"in document&&11>=document.documentMode,bi=null,Bd=null,Es=null,Od=!1;function Tg(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Od||bi==null||bi!==Ga(r)||(r=bi,"selectionStart"in r&&gh(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Es&&Os(Es,r)||(Es=r,r=Qa(Bd,"onSelect"),0<r.length&&(e=new hh("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=bi)))}function ea(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Bi={animationend:ea("Animation","AnimationEnd"),animationiteration:ea("Animation","AnimationIteration"),animationstart:ea("Animation","AnimationStart"),transitionend:ea("Transition","TransitionEnd")},Hc={},JT={};Mn&&(JT=document.createElement("div").style,"AnimationEvent"in window||(delete Bi.animationend.animation,delete Bi.animationiteration.animation,delete Bi.animationstart.animation),"TransitionEvent"in window||delete Bi.transitionend.transition);function ku(t){if(Hc[t])return Hc[t];if(!Bi[t])return t;var e=Bi[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in JT)return Hc[t]=e[n];return t}var QT=ku("animationend"),YT=ku("animationiteration"),XT=ku("animationstart"),ZT=ku("transitionend"),jT=new Map,Eg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ir(t,e){jT.set(t,e),ci(e,[t])}for(var Kc=0;Kc<Eg.length;Kc++){var Wc=Eg[Kc],$A=Wc.toLowerCase(),zA=Wc[0].toUpperCase()+Wc.slice(1);Ir($A,"on"+zA)}Ir(QT,"onAnimationEnd");Ir(YT,"onAnimationIteration");Ir(XT,"onAnimationStart");Ir("dblclick","onDoubleClick");Ir("focusin","onFocus");Ir("focusout","onBlur");Ir(ZT,"onTransitionEnd");io("onMouseEnter",["mouseout","mouseover"]);io("onMouseLeave",["mouseout","mouseover"]);io("onPointerEnter",["pointerout","pointerover"]);io("onPointerLeave",["pointerout","pointerover"]);ci("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ci("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ci("onBeforeInput",["compositionend","keypress","textInput","paste"]);ci("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ci("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ci("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ds="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),HA=new Set("cancel close invalid load scroll toggle".split(" ").concat(ds));function Ig(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,$S(r,e,void 0,t),t.currentTarget=null}function eE(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var o=void 0;if(e)for(var s=r.length-1;0<=s;s--){var u=r[s],c=u.instance,d=u.currentTarget;if(u=u.listener,c!==o&&i.isPropagationStopped())break e;Ig(i,u,d),o=c}else for(s=0;s<r.length;s++){if(u=r[s],c=u.instance,d=u.currentTarget,u=u.listener,c!==o&&i.isPropagationStopped())break e;Ig(i,u,d),o=c}}}if(za)throw t=Ld,za=!1,Ld=null,t}function ve(t,e){var n=e[Hd];n===void 0&&(n=e[Hd]=new Set);var r=t+"__bubble";n.has(r)||(tE(e,t,2,!1),n.add(r))}function Jc(t,e,n){var r=0;e&&(r|=4),tE(n,t,r,e)}var ta="_reactListening"+Math.random().toString(36).slice(2);function qs(t){if(!t[ta]){t[ta]=!0,aT.forEach(function(n){n!=="selectionchange"&&(HA.has(n)||Jc(n,!1,t),Jc(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[ta]||(e[ta]=!0,Jc("selectionchange",!1,e))}}function tE(t,e,n,r){switch(bT(e)){case 1:var i=oA;break;case 4:i=sA;break;default:i=dh}n=i.bind(null,e,n,t),i=void 0,!Vd||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function Qc(t,e,n,r,i){var o=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var u=r.stateNode.containerInfo;if(u===i||u.nodeType===8&&u.parentNode===i)break;if(s===4)for(s=r.return;s!==null;){var c=s.tag;if((c===3||c===4)&&(c=s.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;s=s.return}for(;u!==null;){if(s=Or(u),s===null)return;if(c=s.tag,c===5||c===6){r=o=s;continue e}u=u.parentNode}}r=r.return}wT(function(){var d=o,h=lh(n),p=[];e:{var m=jT.get(t);if(m!==void 0){var _=hh,S=t;switch(t){case"keypress":if(Ca(n)===0)break e;case"keydown":case"keyup":_=EA;break;case"focusin":S="focus",_=Gc;break;case"focusout":S="blur",_=Gc;break;case"beforeblur":case"afterblur":_=Gc;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_=cg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_=uA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_=wA;break;case QT:case YT:case XT:_=fA;break;case ZT:_=AA;break;case"scroll":_=lA;break;case"wheel":_=xA;break;case"copy":case"cut":case"paste":_=pA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_=fg}var R=(e&4)!==0,M=!R&&t==="scroll",I=R?m!==null?m+"Capture":null:m;R=[];for(var T=d,C;T!==null;){C=T;var k=C.stateNode;if(C.tag===5&&k!==null&&(C=k,I!==null&&(k=Ls(T,I),k!=null&&R.push(Gs(T,k,C)))),M)break;T=T.return}0<R.length&&(m=new _(m,S,null,n,h),p.push({event:m,listeners:R}))}}if(!(e&7)){e:{if(m=t==="mouseover"||t==="pointerover",_=t==="mouseout"||t==="pointerout",m&&n!==kd&&(S=n.relatedTarget||n.fromElement)&&(Or(S)||S[kn]))break e;if((_||m)&&(m=h.window===h?h:(m=h.ownerDocument)?m.defaultView||m.parentWindow:window,_?(S=n.relatedTarget||n.toElement,_=d,S=S?Or(S):null,S!==null&&(M=di(S),S!==M||S.tag!==5&&S.tag!==6)&&(S=null)):(_=null,S=d),_!==S)){if(R=cg,k="onMouseLeave",I="onMouseEnter",T="mouse",(t==="pointerout"||t==="pointerover")&&(R=fg,k="onPointerLeave",I="onPointerEnter",T="pointer"),M=_==null?m:Oi(_),C=S==null?m:Oi(S),m=new R(k,T+"leave",_,n,h),m.target=M,m.relatedTarget=C,k=null,Or(h)===d&&(R=new R(I,T+"enter",S,n,h),R.target=C,R.relatedTarget=M,k=R),M=k,_&&S)t:{for(R=_,I=S,T=0,C=R;C;C=wi(C))T++;for(C=0,k=I;k;k=wi(k))C++;for(;0<T-C;)R=wi(R),T--;for(;0<C-T;)I=wi(I),C--;for(;T--;){if(R===I||I!==null&&R===I.alternate)break t;R=wi(R),I=wi(I)}R=null}else R=null;_!==null&&Cg(p,m,_,R,!1),S!==null&&M!==null&&Cg(p,M,S,R,!0)}}e:{if(m=d?Oi(d):window,_=m.nodeName&&m.nodeName.toLowerCase(),_==="select"||_==="input"&&m.type==="file")var F=LA;else if(mg(m))if(zT)F=BA;else{F=UA;var b=FA}else(_=m.nodeName)&&_.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(F=bA);if(F&&(F=F(t,d))){$T(p,F,n,h);break e}b&&b(t,m,d),t==="focusout"&&(b=m._wrapperState)&&b.controlled&&m.type==="number"&&Rd(m,"number",m.value)}switch(b=d?Oi(d):window,t){case"focusin":(mg(b)||b.contentEditable==="true")&&(bi=b,Bd=d,Es=null);break;case"focusout":Es=Bd=bi=null;break;case"mousedown":Od=!0;break;case"contextmenu":case"mouseup":case"dragend":Od=!1,Tg(p,n,h);break;case"selectionchange":if(GA)break;case"keydown":case"keyup":Tg(p,n,h)}var A;if(mh)e:{switch(t){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else Ui?qT(t,n)&&(v="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(v="onCompositionStart");v&&(OT&&n.locale!=="ko"&&(Ui||v!=="onCompositionStart"?v==="onCompositionEnd"&&Ui&&(A=BT()):(jn=h,fh="value"in jn?jn.value:jn.textContent,Ui=!0)),b=Qa(d,v),0<b.length&&(v=new dg(v,t,null,n,h),p.push({event:v,listeners:b}),A?v.data=A:(A=GT(n),A!==null&&(v.data=A)))),(A=DA?MA(t,n):kA(t,n))&&(d=Qa(d,"onBeforeInput"),0<d.length&&(h=new dg("onBeforeInput","beforeinput",null,n,h),p.push({event:h,listeners:d}),h.data=A))}eE(p,e)})}function Gs(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Qa(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=Ls(t,n),o!=null&&r.unshift(Gs(t,o,i)),o=Ls(t,e),o!=null&&r.push(Gs(t,o,i))),t=t.return}return r}function wi(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Cg(t,e,n,r,i){for(var o=e._reactName,s=[];n!==null&&n!==r;){var u=n,c=u.alternate,d=u.stateNode;if(c!==null&&c===r)break;u.tag===5&&d!==null&&(u=d,i?(c=Ls(n,o),c!=null&&s.unshift(Gs(n,c,u))):i||(c=Ls(n,o),c!=null&&s.push(Gs(n,c,u)))),n=n.return}s.length!==0&&t.push({event:e,listeners:s})}var KA=/\r\n?/g,WA=/\u0000|\uFFFD/g;function wg(t){return(typeof t=="string"?t:""+t).replace(KA,`
`).replace(WA,"")}function na(t,e,n){if(e=wg(e),wg(t)!==e&&n)throw Error(G(425))}function Ya(){}var qd=null,Gd=null;function $d(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var zd=typeof setTimeout=="function"?setTimeout:void 0,JA=typeof clearTimeout=="function"?clearTimeout:void 0,Sg=typeof Promise=="function"?Promise:void 0,QA=typeof queueMicrotask=="function"?queueMicrotask:typeof Sg<"u"?function(t){return Sg.resolve(null).then(t).catch(YA)}:zd;function YA(t){setTimeout(function(){throw t})}function Yc(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),bs(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);bs(e)}function sr(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Ag(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var wo=Math.random().toString(36).slice(2),an="__reactFiber$"+wo,$s="__reactProps$"+wo,kn="__reactContainer$"+wo,Hd="__reactEvents$"+wo,XA="__reactListeners$"+wo,ZA="__reactHandles$"+wo;function Or(t){var e=t[an];if(e)return e;for(var n=t.parentNode;n;){if(e=n[kn]||n[an]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Ag(t);t!==null;){if(n=t[an])return n;t=Ag(t)}return e}t=n,n=t.parentNode}return null}function ml(t){return t=t[an]||t[kn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Oi(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(G(33))}function Nu(t){return t[$s]||null}var Kd=[],qi=-1;function Cr(t){return{current:t}}function Ee(t){0>qi||(t.current=Kd[qi],Kd[qi]=null,qi--)}function ye(t,e){qi++,Kd[qi]=t.current,t.current=e}var yr={},ft=Cr(yr),Rt=Cr(!1),Wr=yr;function oo(t,e){var n=t.type.contextTypes;if(!n)return yr;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in n)i[o]=e[o];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function xt(t){return t=t.childContextTypes,t!=null}function Xa(){Ee(Rt),Ee(ft)}function Rg(t,e,n){if(ft.current!==yr)throw Error(G(168));ye(ft,e),ye(Rt,n)}function nE(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(G(108,FS(t)||"Unknown",i));return ke({},n,r)}function Za(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||yr,Wr=ft.current,ye(ft,t),ye(Rt,Rt.current),!0}function xg(t,e,n){var r=t.stateNode;if(!r)throw Error(G(169));n?(t=nE(t,e,Wr),r.__reactInternalMemoizedMergedChildContext=t,Ee(Rt),Ee(ft),ye(ft,t)):Ee(Rt),ye(Rt,n)}var Sn=null,Vu=!1,Xc=!1;function rE(t){Sn===null?Sn=[t]:Sn.push(t)}function jA(t){Vu=!0,rE(t)}function wr(){if(!Xc&&Sn!==null){Xc=!0;var t=0,e=he;try{var n=Sn;for(he=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Sn=null,Vu=!1}catch(i){throw Sn!==null&&(Sn=Sn.slice(t+1)),xT(ah,wr),i}finally{he=e,Xc=!1}}return null}var Gi=[],$i=0,ja=null,eu=0,qt=[],Gt=0,Jr=null,An=1,Rn="";function kr(t,e){Gi[$i++]=eu,Gi[$i++]=ja,ja=t,eu=e}function iE(t,e,n){qt[Gt++]=An,qt[Gt++]=Rn,qt[Gt++]=Jr,Jr=t;var r=An;t=Rn;var i=32-tn(r)-1;r&=~(1<<i),n+=1;var o=32-tn(e)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,An=1<<32-tn(e)+i|n<<i|r,Rn=o+t}else An=1<<o|n<<i|r,Rn=t}function yh(t){t.return!==null&&(kr(t,1),iE(t,1,0))}function _h(t){for(;t===ja;)ja=Gi[--$i],Gi[$i]=null,eu=Gi[--$i],Gi[$i]=null;for(;t===Jr;)Jr=qt[--Gt],qt[Gt]=null,Rn=qt[--Gt],qt[Gt]=null,An=qt[--Gt],qt[Gt]=null}var Ft=null,Nt=null,Ce=!1,en=null;function oE(t,e){var n=$t(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Pg(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Ft=t,Nt=sr(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Ft=t,Nt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Jr!==null?{id:An,overflow:Rn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=$t(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Ft=t,Nt=null,!0):!1;default:return!1}}function Wd(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Jd(t){if(Ce){var e=Nt;if(e){var n=e;if(!Pg(t,e)){if(Wd(t))throw Error(G(418));e=sr(n.nextSibling);var r=Ft;e&&Pg(t,e)?oE(r,n):(t.flags=t.flags&-4097|2,Ce=!1,Ft=t)}}else{if(Wd(t))throw Error(G(418));t.flags=t.flags&-4097|2,Ce=!1,Ft=t}}}function Dg(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Ft=t}function ra(t){if(t!==Ft)return!1;if(!Ce)return Dg(t),Ce=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!$d(t.type,t.memoizedProps)),e&&(e=Nt)){if(Wd(t))throw sE(),Error(G(418));for(;e;)oE(t,e),e=sr(e.nextSibling)}if(Dg(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(G(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Nt=sr(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Nt=null}}else Nt=Ft?sr(t.stateNode.nextSibling):null;return!0}function sE(){for(var t=Nt;t;)t=sr(t.nextSibling)}function so(){Nt=Ft=null,Ce=!1}function vh(t){en===null?en=[t]:en.push(t)}var eR=bn.ReactCurrentBatchConfig;function Xo(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(G(309));var r=n.stateNode}if(!r)throw Error(G(147,t));var i=r,o=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(s){var u=i.refs;s===null?delete u[o]:u[o]=s},e._stringRef=o,e)}if(typeof t!="string")throw Error(G(284));if(!n._owner)throw Error(G(290,t))}return t}function ia(t,e){throw t=Object.prototype.toString.call(e),Error(G(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Mg(t){var e=t._init;return e(t._payload)}function lE(t){function e(I,T){if(t){var C=I.deletions;C===null?(I.deletions=[T],I.flags|=16):C.push(T)}}function n(I,T){if(!t)return null;for(;T!==null;)e(I,T),T=T.sibling;return null}function r(I,T){for(I=new Map;T!==null;)T.key!==null?I.set(T.key,T):I.set(T.index,T),T=T.sibling;return I}function i(I,T){return I=cr(I,T),I.index=0,I.sibling=null,I}function o(I,T,C){return I.index=C,t?(C=I.alternate,C!==null?(C=C.index,C<T?(I.flags|=2,T):C):(I.flags|=2,T)):(I.flags|=1048576,T)}function s(I){return t&&I.alternate===null&&(I.flags|=2),I}function u(I,T,C,k){return T===null||T.tag!==6?(T=id(C,I.mode,k),T.return=I,T):(T=i(T,C),T.return=I,T)}function c(I,T,C,k){var F=C.type;return F===Fi?h(I,T,C.props.children,k,C.key):T!==null&&(T.elementType===F||typeof F=="object"&&F!==null&&F.$$typeof===Wn&&Mg(F)===T.type)?(k=i(T,C.props),k.ref=Xo(I,T,C),k.return=I,k):(k=Da(C.type,C.key,C.props,null,I.mode,k),k.ref=Xo(I,T,C),k.return=I,k)}function d(I,T,C,k){return T===null||T.tag!==4||T.stateNode.containerInfo!==C.containerInfo||T.stateNode.implementation!==C.implementation?(T=od(C,I.mode,k),T.return=I,T):(T=i(T,C.children||[]),T.return=I,T)}function h(I,T,C,k,F){return T===null||T.tag!==7?(T=zr(C,I.mode,k,F),T.return=I,T):(T=i(T,C),T.return=I,T)}function p(I,T,C){if(typeof T=="string"&&T!==""||typeof T=="number")return T=id(""+T,I.mode,C),T.return=I,T;if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Wl:return C=Da(T.type,T.key,T.props,null,I.mode,C),C.ref=Xo(I,null,T),C.return=I,C;case Li:return T=od(T,I.mode,C),T.return=I,T;case Wn:var k=T._init;return p(I,k(T._payload),C)}if(us(T)||Ko(T))return T=zr(T,I.mode,C,null),T.return=I,T;ia(I,T)}return null}function m(I,T,C,k){var F=T!==null?T.key:null;if(typeof C=="string"&&C!==""||typeof C=="number")return F!==null?null:u(I,T,""+C,k);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case Wl:return C.key===F?c(I,T,C,k):null;case Li:return C.key===F?d(I,T,C,k):null;case Wn:return F=C._init,m(I,T,F(C._payload),k)}if(us(C)||Ko(C))return F!==null?null:h(I,T,C,k,null);ia(I,C)}return null}function _(I,T,C,k,F){if(typeof k=="string"&&k!==""||typeof k=="number")return I=I.get(C)||null,u(T,I,""+k,F);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case Wl:return I=I.get(k.key===null?C:k.key)||null,c(T,I,k,F);case Li:return I=I.get(k.key===null?C:k.key)||null,d(T,I,k,F);case Wn:var b=k._init;return _(I,T,C,b(k._payload),F)}if(us(k)||Ko(k))return I=I.get(C)||null,h(T,I,k,F,null);ia(T,k)}return null}function S(I,T,C,k){for(var F=null,b=null,A=T,v=T=0,w=null;A!==null&&v<C.length;v++){A.index>v?(w=A,A=null):w=A.sibling;var x=m(I,A,C[v],k);if(x===null){A===null&&(A=w);break}t&&A&&x.alternate===null&&e(I,A),T=o(x,T,v),b===null?F=x:b.sibling=x,b=x,A=w}if(v===C.length)return n(I,A),Ce&&kr(I,v),F;if(A===null){for(;v<C.length;v++)A=p(I,C[v],k),A!==null&&(T=o(A,T,v),b===null?F=A:b.sibling=A,b=A);return Ce&&kr(I,v),F}for(A=r(I,A);v<C.length;v++)w=_(A,I,v,C[v],k),w!==null&&(t&&w.alternate!==null&&A.delete(w.key===null?v:w.key),T=o(w,T,v),b===null?F=w:b.sibling=w,b=w);return t&&A.forEach(function(D){return e(I,D)}),Ce&&kr(I,v),F}function R(I,T,C,k){var F=Ko(C);if(typeof F!="function")throw Error(G(150));if(C=F.call(C),C==null)throw Error(G(151));for(var b=F=null,A=T,v=T=0,w=null,x=C.next();A!==null&&!x.done;v++,x=C.next()){A.index>v?(w=A,A=null):w=A.sibling;var D=m(I,A,x.value,k);if(D===null){A===null&&(A=w);break}t&&A&&D.alternate===null&&e(I,A),T=o(D,T,v),b===null?F=D:b.sibling=D,b=D,A=w}if(x.done)return n(I,A),Ce&&kr(I,v),F;if(A===null){for(;!x.done;v++,x=C.next())x=p(I,x.value,k),x!==null&&(T=o(x,T,v),b===null?F=x:b.sibling=x,b=x);return Ce&&kr(I,v),F}for(A=r(I,A);!x.done;v++,x=C.next())x=_(A,I,v,x.value,k),x!==null&&(t&&x.alternate!==null&&A.delete(x.key===null?v:x.key),T=o(x,T,v),b===null?F=x:b.sibling=x,b=x);return t&&A.forEach(function(N){return e(I,N)}),Ce&&kr(I,v),F}function M(I,T,C,k){if(typeof C=="object"&&C!==null&&C.type===Fi&&C.key===null&&(C=C.props.children),typeof C=="object"&&C!==null){switch(C.$$typeof){case Wl:e:{for(var F=C.key,b=T;b!==null;){if(b.key===F){if(F=C.type,F===Fi){if(b.tag===7){n(I,b.sibling),T=i(b,C.props.children),T.return=I,I=T;break e}}else if(b.elementType===F||typeof F=="object"&&F!==null&&F.$$typeof===Wn&&Mg(F)===b.type){n(I,b.sibling),T=i(b,C.props),T.ref=Xo(I,b,C),T.return=I,I=T;break e}n(I,b);break}else e(I,b);b=b.sibling}C.type===Fi?(T=zr(C.props.children,I.mode,k,C.key),T.return=I,I=T):(k=Da(C.type,C.key,C.props,null,I.mode,k),k.ref=Xo(I,T,C),k.return=I,I=k)}return s(I);case Li:e:{for(b=C.key;T!==null;){if(T.key===b)if(T.tag===4&&T.stateNode.containerInfo===C.containerInfo&&T.stateNode.implementation===C.implementation){n(I,T.sibling),T=i(T,C.children||[]),T.return=I,I=T;break e}else{n(I,T);break}else e(I,T);T=T.sibling}T=od(C,I.mode,k),T.return=I,I=T}return s(I);case Wn:return b=C._init,M(I,T,b(C._payload),k)}if(us(C))return S(I,T,C,k);if(Ko(C))return R(I,T,C,k);ia(I,C)}return typeof C=="string"&&C!==""||typeof C=="number"?(C=""+C,T!==null&&T.tag===6?(n(I,T.sibling),T=i(T,C),T.return=I,I=T):(n(I,T),T=id(C,I.mode,k),T.return=I,I=T),s(I)):n(I,T)}return M}var lo=lE(!0),aE=lE(!1),tu=Cr(null),nu=null,zi=null,Th=null;function Eh(){Th=zi=nu=null}function Ih(t){var e=tu.current;Ee(tu),t._currentValue=e}function Qd(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Zi(t,e){nu=t,Th=zi=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(St=!0),t.firstContext=null)}function Jt(t){var e=t._currentValue;if(Th!==t)if(t={context:t,memoizedValue:e,next:null},zi===null){if(nu===null)throw Error(G(308));zi=t,nu.dependencies={lanes:0,firstContext:t}}else zi=zi.next=t;return e}var qr=null;function Ch(t){qr===null?qr=[t]:qr.push(t)}function uE(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,Ch(e)):(n.next=i.next,i.next=n),e.interleaved=n,Nn(t,r)}function Nn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Jn=!1;function wh(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function cE(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Pn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function lr(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,ae&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Nn(t,n)}return i=r.interleaved,i===null?(e.next=e,Ch(r)):(e.next=i.next,i.next=e),r.interleaved=e,Nn(t,n)}function wa(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,uh(t,n)}}function kg(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?i=o=s:o=o.next=s,n=n.next}while(n!==null);o===null?i=o=e:o=o.next=e}else i=o=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function ru(t,e,n,r){var i=t.updateQueue;Jn=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,u=i.shared.pending;if(u!==null){i.shared.pending=null;var c=u,d=c.next;c.next=null,s===null?o=d:s.next=d,s=c;var h=t.alternate;h!==null&&(h=h.updateQueue,u=h.lastBaseUpdate,u!==s&&(u===null?h.firstBaseUpdate=d:u.next=d,h.lastBaseUpdate=c))}if(o!==null){var p=i.baseState;s=0,h=d=c=null,u=o;do{var m=u.lane,_=u.eventTime;if((r&m)===m){h!==null&&(h=h.next={eventTime:_,lane:0,tag:u.tag,payload:u.payload,callback:u.callback,next:null});e:{var S=t,R=u;switch(m=e,_=n,R.tag){case 1:if(S=R.payload,typeof S=="function"){p=S.call(_,p,m);break e}p=S;break e;case 3:S.flags=S.flags&-65537|128;case 0:if(S=R.payload,m=typeof S=="function"?S.call(_,p,m):S,m==null)break e;p=ke({},p,m);break e;case 2:Jn=!0}}u.callback!==null&&u.lane!==0&&(t.flags|=64,m=i.effects,m===null?i.effects=[u]:m.push(u))}else _={eventTime:_,lane:m,tag:u.tag,payload:u.payload,callback:u.callback,next:null},h===null?(d=h=_,c=p):h=h.next=_,s|=m;if(u=u.next,u===null){if(u=i.shared.pending,u===null)break;m=u,u=m.next,m.next=null,i.lastBaseUpdate=m,i.shared.pending=null}}while(!0);if(h===null&&(c=p),i.baseState=c,i.firstBaseUpdate=d,i.lastBaseUpdate=h,e=i.shared.interleaved,e!==null){i=e;do s|=i.lane,i=i.next;while(i!==e)}else o===null&&(i.shared.lanes=0);Yr|=s,t.lanes=s,t.memoizedState=p}}function Ng(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(G(191,i));i.call(r)}}}var gl={},hn=Cr(gl),zs=Cr(gl),Hs=Cr(gl);function Gr(t){if(t===gl)throw Error(G(174));return t}function Sh(t,e){switch(ye(Hs,e),ye(zs,t),ye(hn,gl),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Pd(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Pd(e,t)}Ee(hn),ye(hn,e)}function ao(){Ee(hn),Ee(zs),Ee(Hs)}function dE(t){Gr(Hs.current);var e=Gr(hn.current),n=Pd(e,t.type);e!==n&&(ye(zs,t),ye(hn,n))}function Ah(t){zs.current===t&&(Ee(hn),Ee(zs))}var xe=Cr(0);function iu(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Zc=[];function Rh(){for(var t=0;t<Zc.length;t++)Zc[t]._workInProgressVersionPrimary=null;Zc.length=0}var Sa=bn.ReactCurrentDispatcher,jc=bn.ReactCurrentBatchConfig,Qr=0,De=null,$e=null,We=null,ou=!1,Is=!1,Ks=0,tR=0;function lt(){throw Error(G(321))}function xh(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!rn(t[n],e[n]))return!1;return!0}function Ph(t,e,n,r,i,o){if(Qr=o,De=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Sa.current=t===null||t.memoizedState===null?oR:sR,t=n(r,i),Is){o=0;do{if(Is=!1,Ks=0,25<=o)throw Error(G(301));o+=1,We=$e=null,e.updateQueue=null,Sa.current=lR,t=n(r,i)}while(Is)}if(Sa.current=su,e=$e!==null&&$e.next!==null,Qr=0,We=$e=De=null,ou=!1,e)throw Error(G(300));return t}function Dh(){var t=Ks!==0;return Ks=0,t}function ln(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return We===null?De.memoizedState=We=t:We=We.next=t,We}function Qt(){if($e===null){var t=De.alternate;t=t!==null?t.memoizedState:null}else t=$e.next;var e=We===null?De.memoizedState:We.next;if(e!==null)We=e,$e=t;else{if(t===null)throw Error(G(310));$e=t,t={memoizedState:$e.memoizedState,baseState:$e.baseState,baseQueue:$e.baseQueue,queue:$e.queue,next:null},We===null?De.memoizedState=We=t:We=We.next=t}return We}function Ws(t,e){return typeof e=="function"?e(t):e}function ed(t){var e=Qt(),n=e.queue;if(n===null)throw Error(G(311));n.lastRenderedReducer=t;var r=$e,i=r.baseQueue,o=n.pending;if(o!==null){if(i!==null){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,n.pending=null}if(i!==null){o=i.next,r=r.baseState;var u=s=null,c=null,d=o;do{var h=d.lane;if((Qr&h)===h)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var p={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(u=c=p,s=r):c=c.next=p,De.lanes|=h,Yr|=h}d=d.next}while(d!==null&&d!==o);c===null?s=r:c.next=u,rn(r,e.memoizedState)||(St=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do o=i.lane,De.lanes|=o,Yr|=o,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function td(t){var e=Qt(),n=e.queue;if(n===null)throw Error(G(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,o=e.memoizedState;if(i!==null){n.pending=null;var s=i=i.next;do o=t(o,s.action),s=s.next;while(s!==i);rn(o,e.memoizedState)||(St=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),n.lastRenderedState=o}return[o,r]}function fE(){}function hE(t,e){var n=De,r=Qt(),i=e(),o=!rn(r.memoizedState,i);if(o&&(r.memoizedState=i,St=!0),r=r.queue,Mh(gE.bind(null,n,r,t),[t]),r.getSnapshot!==e||o||We!==null&&We.memoizedState.tag&1){if(n.flags|=2048,Js(9,mE.bind(null,n,r,i,e),void 0,null),Je===null)throw Error(G(349));Qr&30||pE(n,e,i)}return i}function pE(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=De.updateQueue,e===null?(e={lastEffect:null,stores:null},De.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function mE(t,e,n,r){e.value=n,e.getSnapshot=r,yE(e)&&_E(t)}function gE(t,e,n){return n(function(){yE(e)&&_E(t)})}function yE(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!rn(t,n)}catch{return!0}}function _E(t){var e=Nn(t,1);e!==null&&nn(e,t,1,-1)}function Vg(t){var e=ln();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ws,lastRenderedState:t},e.queue=t,t=t.dispatch=iR.bind(null,De,t),[e.memoizedState,t]}function Js(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=De.updateQueue,e===null?(e={lastEffect:null,stores:null},De.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function vE(){return Qt().memoizedState}function Aa(t,e,n,r){var i=ln();De.flags|=t,i.memoizedState=Js(1|e,n,void 0,r===void 0?null:r)}function Lu(t,e,n,r){var i=Qt();r=r===void 0?null:r;var o=void 0;if($e!==null){var s=$e.memoizedState;if(o=s.destroy,r!==null&&xh(r,s.deps)){i.memoizedState=Js(e,n,o,r);return}}De.flags|=t,i.memoizedState=Js(1|e,n,o,r)}function Lg(t,e){return Aa(8390656,8,t,e)}function Mh(t,e){return Lu(2048,8,t,e)}function TE(t,e){return Lu(4,2,t,e)}function EE(t,e){return Lu(4,4,t,e)}function IE(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function CE(t,e,n){return n=n!=null?n.concat([t]):null,Lu(4,4,IE.bind(null,e,t),n)}function kh(){}function wE(t,e){var n=Qt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&xh(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function SE(t,e){var n=Qt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&xh(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function AE(t,e,n){return Qr&21?(rn(n,e)||(n=MT(),De.lanes|=n,Yr|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,St=!0),t.memoizedState=n)}function nR(t,e){var n=he;he=n!==0&&4>n?n:4,t(!0);var r=jc.transition;jc.transition={};try{t(!1),e()}finally{he=n,jc.transition=r}}function RE(){return Qt().memoizedState}function rR(t,e,n){var r=ur(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},xE(t))PE(e,n);else if(n=uE(t,e,n,r),n!==null){var i=vt();nn(n,t,r,i),DE(n,e,r)}}function iR(t,e,n){var r=ur(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(xE(t))PE(e,i);else{var o=t.alternate;if(t.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var s=e.lastRenderedState,u=o(s,n);if(i.hasEagerState=!0,i.eagerState=u,rn(u,s)){var c=e.interleaved;c===null?(i.next=i,Ch(e)):(i.next=c.next,c.next=i),e.interleaved=i;return}}catch{}finally{}n=uE(t,e,i,r),n!==null&&(i=vt(),nn(n,t,r,i),DE(n,e,r))}}function xE(t){var e=t.alternate;return t===De||e!==null&&e===De}function PE(t,e){Is=ou=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function DE(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,uh(t,n)}}var su={readContext:Jt,useCallback:lt,useContext:lt,useEffect:lt,useImperativeHandle:lt,useInsertionEffect:lt,useLayoutEffect:lt,useMemo:lt,useReducer:lt,useRef:lt,useState:lt,useDebugValue:lt,useDeferredValue:lt,useTransition:lt,useMutableSource:lt,useSyncExternalStore:lt,useId:lt,unstable_isNewReconciler:!1},oR={readContext:Jt,useCallback:function(t,e){return ln().memoizedState=[t,e===void 0?null:e],t},useContext:Jt,useEffect:Lg,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Aa(4194308,4,IE.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Aa(4194308,4,t,e)},useInsertionEffect:function(t,e){return Aa(4,2,t,e)},useMemo:function(t,e){var n=ln();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=ln();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=rR.bind(null,De,t),[r.memoizedState,t]},useRef:function(t){var e=ln();return t={current:t},e.memoizedState=t},useState:Vg,useDebugValue:kh,useDeferredValue:function(t){return ln().memoizedState=t},useTransition:function(){var t=Vg(!1),e=t[0];return t=nR.bind(null,t[1]),ln().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=De,i=ln();if(Ce){if(n===void 0)throw Error(G(407));n=n()}else{if(n=e(),Je===null)throw Error(G(349));Qr&30||pE(r,e,n)}i.memoizedState=n;var o={value:n,getSnapshot:e};return i.queue=o,Lg(gE.bind(null,r,o,t),[t]),r.flags|=2048,Js(9,mE.bind(null,r,o,n,e),void 0,null),n},useId:function(){var t=ln(),e=Je.identifierPrefix;if(Ce){var n=Rn,r=An;n=(r&~(1<<32-tn(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Ks++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=tR++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},sR={readContext:Jt,useCallback:wE,useContext:Jt,useEffect:Mh,useImperativeHandle:CE,useInsertionEffect:TE,useLayoutEffect:EE,useMemo:SE,useReducer:ed,useRef:vE,useState:function(){return ed(Ws)},useDebugValue:kh,useDeferredValue:function(t){var e=Qt();return AE(e,$e.memoizedState,t)},useTransition:function(){var t=ed(Ws)[0],e=Qt().memoizedState;return[t,e]},useMutableSource:fE,useSyncExternalStore:hE,useId:RE,unstable_isNewReconciler:!1},lR={readContext:Jt,useCallback:wE,useContext:Jt,useEffect:Mh,useImperativeHandle:CE,useInsertionEffect:TE,useLayoutEffect:EE,useMemo:SE,useReducer:td,useRef:vE,useState:function(){return td(Ws)},useDebugValue:kh,useDeferredValue:function(t){var e=Qt();return $e===null?e.memoizedState=t:AE(e,$e.memoizedState,t)},useTransition:function(){var t=td(Ws)[0],e=Qt().memoizedState;return[t,e]},useMutableSource:fE,useSyncExternalStore:hE,useId:RE,unstable_isNewReconciler:!1};function Zt(t,e){if(t&&t.defaultProps){e=ke({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Yd(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:ke({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Fu={isMounted:function(t){return(t=t._reactInternals)?di(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=vt(),i=ur(t),o=Pn(r,i);o.payload=e,n!=null&&(o.callback=n),e=lr(t,o,i),e!==null&&(nn(e,t,i,r),wa(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=vt(),i=ur(t),o=Pn(r,i);o.tag=1,o.payload=e,n!=null&&(o.callback=n),e=lr(t,o,i),e!==null&&(nn(e,t,i,r),wa(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=vt(),r=ur(t),i=Pn(n,r);i.tag=2,e!=null&&(i.callback=e),e=lr(t,i,r),e!==null&&(nn(e,t,r,n),wa(e,t,r))}};function Fg(t,e,n,r,i,o,s){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,o,s):e.prototype&&e.prototype.isPureReactComponent?!Os(n,r)||!Os(i,o):!0}function ME(t,e,n){var r=!1,i=yr,o=e.contextType;return typeof o=="object"&&o!==null?o=Jt(o):(i=xt(e)?Wr:ft.current,r=e.contextTypes,o=(r=r!=null)?oo(t,i):yr),e=new e(n,o),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Fu,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=o),e}function Ug(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Fu.enqueueReplaceState(e,e.state,null)}function Xd(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},wh(t);var o=e.contextType;typeof o=="object"&&o!==null?i.context=Jt(o):(o=xt(e)?Wr:ft.current,i.context=oo(t,o)),i.state=t.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(Yd(t,e,o,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Fu.enqueueReplaceState(i,i.state,null),ru(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function uo(t,e){try{var n="",r=e;do n+=LS(r),r=r.return;while(r);var i=n}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:t,source:e,stack:i,digest:null}}function nd(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Zd(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var aR=typeof WeakMap=="function"?WeakMap:Map;function kE(t,e,n){n=Pn(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){au||(au=!0,uf=r),Zd(t,e)},n}function NE(t,e,n){n=Pn(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){Zd(t,e)}}var o=t.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){Zd(t,e),typeof r!="function"&&(ar===null?ar=new Set([this]):ar.add(this));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),n}function bg(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new aR;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=IR.bind(null,t,e,n),e.then(t,t))}function Bg(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Og(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Pn(-1,1),e.tag=2,lr(n,e,1))),n.lanes|=1),t)}var uR=bn.ReactCurrentOwner,St=!1;function yt(t,e,n,r){e.child=t===null?aE(e,null,n,r):lo(e,t.child,n,r)}function qg(t,e,n,r,i){n=n.render;var o=e.ref;return Zi(e,i),r=Ph(t,e,n,r,o,i),n=Dh(),t!==null&&!St?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Vn(t,e,i)):(Ce&&n&&yh(e),e.flags|=1,yt(t,e,r,i),e.child)}function Gg(t,e,n,r,i){if(t===null){var o=n.type;return typeof o=="function"&&!Oh(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=o,VE(t,e,o,r,i)):(t=Da(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(o=t.child,!(t.lanes&i)){var s=o.memoizedProps;if(n=n.compare,n=n!==null?n:Os,n(s,r)&&t.ref===e.ref)return Vn(t,e,i)}return e.flags|=1,t=cr(o,r),t.ref=e.ref,t.return=e,e.child=t}function VE(t,e,n,r,i){if(t!==null){var o=t.memoizedProps;if(Os(o,r)&&t.ref===e.ref)if(St=!1,e.pendingProps=r=o,(t.lanes&i)!==0)t.flags&131072&&(St=!0);else return e.lanes=t.lanes,Vn(t,e,i)}return jd(t,e,n,r,i)}function LE(t,e,n){var r=e.pendingProps,i=r.children,o=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ye(Ki,kt),kt|=n;else{if(!(n&1073741824))return t=o!==null?o.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ye(Ki,kt),kt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:n,ye(Ki,kt),kt|=r}else o!==null?(r=o.baseLanes|n,e.memoizedState=null):r=n,ye(Ki,kt),kt|=r;return yt(t,e,i,n),e.child}function FE(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function jd(t,e,n,r,i){var o=xt(n)?Wr:ft.current;return o=oo(e,o),Zi(e,i),n=Ph(t,e,n,r,o,i),r=Dh(),t!==null&&!St?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Vn(t,e,i)):(Ce&&r&&yh(e),e.flags|=1,yt(t,e,n,i),e.child)}function $g(t,e,n,r,i){if(xt(n)){var o=!0;Za(e)}else o=!1;if(Zi(e,i),e.stateNode===null)Ra(t,e),ME(e,n,r),Xd(e,n,r,i),r=!0;else if(t===null){var s=e.stateNode,u=e.memoizedProps;s.props=u;var c=s.context,d=n.contextType;typeof d=="object"&&d!==null?d=Jt(d):(d=xt(n)?Wr:ft.current,d=oo(e,d));var h=n.getDerivedStateFromProps,p=typeof h=="function"||typeof s.getSnapshotBeforeUpdate=="function";p||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(u!==r||c!==d)&&Ug(e,s,r,d),Jn=!1;var m=e.memoizedState;s.state=m,ru(e,r,s,i),c=e.memoizedState,u!==r||m!==c||Rt.current||Jn?(typeof h=="function"&&(Yd(e,n,h,r),c=e.memoizedState),(u=Jn||Fg(e,n,u,r,m,c,d))?(p||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),s.props=r,s.state=c,s.context=d,r=u):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{s=e.stateNode,cE(t,e),u=e.memoizedProps,d=e.type===e.elementType?u:Zt(e.type,u),s.props=d,p=e.pendingProps,m=s.context,c=n.contextType,typeof c=="object"&&c!==null?c=Jt(c):(c=xt(n)?Wr:ft.current,c=oo(e,c));var _=n.getDerivedStateFromProps;(h=typeof _=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(u!==p||m!==c)&&Ug(e,s,r,c),Jn=!1,m=e.memoizedState,s.state=m,ru(e,r,s,i);var S=e.memoizedState;u!==p||m!==S||Rt.current||Jn?(typeof _=="function"&&(Yd(e,n,_,r),S=e.memoizedState),(d=Jn||Fg(e,n,d,r,m,S,c)||!1)?(h||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,S,c),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,S,c)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||u===t.memoizedProps&&m===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||u===t.memoizedProps&&m===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=S),s.props=r,s.state=S,s.context=c,r=d):(typeof s.componentDidUpdate!="function"||u===t.memoizedProps&&m===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||u===t.memoizedProps&&m===t.memoizedState||(e.flags|=1024),r=!1)}return ef(t,e,n,r,o,i)}function ef(t,e,n,r,i,o){FE(t,e);var s=(e.flags&128)!==0;if(!r&&!s)return i&&xg(e,n,!1),Vn(t,e,o);r=e.stateNode,uR.current=e;var u=s&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&s?(e.child=lo(e,t.child,null,o),e.child=lo(e,null,u,o)):yt(t,e,u,o),e.memoizedState=r.state,i&&xg(e,n,!0),e.child}function UE(t){var e=t.stateNode;e.pendingContext?Rg(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Rg(t,e.context,!1),Sh(t,e.containerInfo)}function zg(t,e,n,r,i){return so(),vh(i),e.flags|=256,yt(t,e,n,r),e.child}var tf={dehydrated:null,treeContext:null,retryLane:0};function nf(t){return{baseLanes:t,cachePool:null,transitions:null}}function bE(t,e,n){var r=e.pendingProps,i=xe.current,o=!1,s=(e.flags&128)!==0,u;if((u=s)||(u=t!==null&&t.memoizedState===null?!1:(i&2)!==0),u?(o=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),ye(xe,i&1),t===null)return Jd(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(s=r.children,t=r.fallback,o?(r=e.mode,o=e.child,s={mode:"hidden",children:s},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=s):o=Bu(s,r,0,null),t=zr(t,r,n,null),o.return=e,t.return=e,o.sibling=t,e.child=o,e.child.memoizedState=nf(n),e.memoizedState=tf,t):Nh(e,s));if(i=t.memoizedState,i!==null&&(u=i.dehydrated,u!==null))return cR(t,e,s,r,u,i,n);if(o){o=r.fallback,s=e.mode,i=t.child,u=i.sibling;var c={mode:"hidden",children:r.children};return!(s&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=cr(i,c),r.subtreeFlags=i.subtreeFlags&14680064),u!==null?o=cr(u,o):(o=zr(o,s,n,null),o.flags|=2),o.return=e,r.return=e,r.sibling=o,e.child=r,r=o,o=e.child,s=t.child.memoizedState,s=s===null?nf(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=t.childLanes&~n,e.memoizedState=tf,r}return o=t.child,t=o.sibling,r=cr(o,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Nh(t,e){return e=Bu({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function oa(t,e,n,r){return r!==null&&vh(r),lo(e,t.child,null,n),t=Nh(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function cR(t,e,n,r,i,o,s){if(n)return e.flags&256?(e.flags&=-257,r=nd(Error(G(422))),oa(t,e,s,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(o=r.fallback,i=e.mode,r=Bu({mode:"visible",children:r.children},i,0,null),o=zr(o,i,s,null),o.flags|=2,r.return=e,o.return=e,r.sibling=o,e.child=r,e.mode&1&&lo(e,t.child,null,s),e.child.memoizedState=nf(s),e.memoizedState=tf,o);if(!(e.mode&1))return oa(t,e,s,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var u=r.dgst;return r=u,o=Error(G(419)),r=nd(o,r,void 0),oa(t,e,s,r)}if(u=(s&t.childLanes)!==0,St||u){if(r=Je,r!==null){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|s)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,Nn(t,i),nn(r,t,i,-1))}return Bh(),r=nd(Error(G(421))),oa(t,e,s,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=CR.bind(null,t),i._reactRetry=e,null):(t=o.treeContext,Nt=sr(i.nextSibling),Ft=e,Ce=!0,en=null,t!==null&&(qt[Gt++]=An,qt[Gt++]=Rn,qt[Gt++]=Jr,An=t.id,Rn=t.overflow,Jr=e),e=Nh(e,r.children),e.flags|=4096,e)}function Hg(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Qd(t.return,e,n)}function rd(t,e,n,r,i){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function BE(t,e,n){var r=e.pendingProps,i=r.revealOrder,o=r.tail;if(yt(t,e,r.children,n),r=xe.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Hg(t,n,e);else if(t.tag===19)Hg(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(ye(xe,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&iu(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),rd(e,!1,i,n,o);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&iu(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}rd(e,!0,n,null,o);break;case"together":rd(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ra(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Vn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Yr|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(G(153));if(e.child!==null){for(t=e.child,n=cr(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=cr(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function dR(t,e,n){switch(e.tag){case 3:UE(e),so();break;case 5:dE(e);break;case 1:xt(e.type)&&Za(e);break;case 4:Sh(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;ye(tu,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ye(xe,xe.current&1),e.flags|=128,null):n&e.child.childLanes?bE(t,e,n):(ye(xe,xe.current&1),t=Vn(t,e,n),t!==null?t.sibling:null);ye(xe,xe.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return BE(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),ye(xe,xe.current),r)break;return null;case 22:case 23:return e.lanes=0,LE(t,e,n)}return Vn(t,e,n)}var OE,rf,qE,GE;OE=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};rf=function(){};qE=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,Gr(hn.current);var o=null;switch(n){case"input":i=Sd(t,i),r=Sd(t,r),o=[];break;case"select":i=ke({},i,{value:void 0}),r=ke({},r,{value:void 0}),o=[];break;case"textarea":i=xd(t,i),r=xd(t,r),o=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Ya)}Dd(n,r);var s;n=null;for(d in i)if(!r.hasOwnProperty(d)&&i.hasOwnProperty(d)&&i[d]!=null)if(d==="style"){var u=i[d];for(s in u)u.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Ns.hasOwnProperty(d)?o||(o=[]):(o=o||[]).push(d,null));for(d in r){var c=r[d];if(u=i!=null?i[d]:void 0,r.hasOwnProperty(d)&&c!==u&&(c!=null||u!=null))if(d==="style")if(u){for(s in u)!u.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&u[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(o||(o=[]),o.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,u=u?u.__html:void 0,c!=null&&u!==c&&(o=o||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Ns.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&ve("scroll",t),o||u===c||(o=[])):(o=o||[]).push(d,c))}n&&(o=o||[]).push("style",n);var d=o;(e.updateQueue=d)&&(e.flags|=4)}};GE=function(t,e,n,r){n!==r&&(e.flags|=4)};function Zo(t,e){if(!Ce)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function at(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function fR(t,e,n){var r=e.pendingProps;switch(_h(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return at(e),null;case 1:return xt(e.type)&&Xa(),at(e),null;case 3:return r=e.stateNode,ao(),Ee(Rt),Ee(ft),Rh(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(ra(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,en!==null&&(ff(en),en=null))),rf(t,e),at(e),null;case 5:Ah(e);var i=Gr(Hs.current);if(n=e.type,t!==null&&e.stateNode!=null)qE(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(G(166));return at(e),null}if(t=Gr(hn.current),ra(e)){r=e.stateNode,n=e.type;var o=e.memoizedProps;switch(r[an]=e,r[$s]=o,t=(e.mode&1)!==0,n){case"dialog":ve("cancel",r),ve("close",r);break;case"iframe":case"object":case"embed":ve("load",r);break;case"video":case"audio":for(i=0;i<ds.length;i++)ve(ds[i],r);break;case"source":ve("error",r);break;case"img":case"image":case"link":ve("error",r),ve("load",r);break;case"details":ve("toggle",r);break;case"input":eg(r,o),ve("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},ve("invalid",r);break;case"textarea":ng(r,o),ve("invalid",r)}Dd(n,o),i=null;for(var s in o)if(o.hasOwnProperty(s)){var u=o[s];s==="children"?typeof u=="string"?r.textContent!==u&&(o.suppressHydrationWarning!==!0&&na(r.textContent,u,t),i=["children",u]):typeof u=="number"&&r.textContent!==""+u&&(o.suppressHydrationWarning!==!0&&na(r.textContent,u,t),i=["children",""+u]):Ns.hasOwnProperty(s)&&u!=null&&s==="onScroll"&&ve("scroll",r)}switch(n){case"input":Jl(r),tg(r,o,!0);break;case"textarea":Jl(r),rg(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=Ya)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{s=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=gT(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=s.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=s.createElement(n,{is:r.is}):(t=s.createElement(n),n==="select"&&(s=t,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):t=s.createElementNS(t,n),t[an]=e,t[$s]=r,OE(t,e,!1,!1),e.stateNode=t;e:{switch(s=Md(n,r),n){case"dialog":ve("cancel",t),ve("close",t),i=r;break;case"iframe":case"object":case"embed":ve("load",t),i=r;break;case"video":case"audio":for(i=0;i<ds.length;i++)ve(ds[i],t);i=r;break;case"source":ve("error",t),i=r;break;case"img":case"image":case"link":ve("error",t),ve("load",t),i=r;break;case"details":ve("toggle",t),i=r;break;case"input":eg(t,r),i=Sd(t,r),ve("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=ke({},r,{value:void 0}),ve("invalid",t);break;case"textarea":ng(t,r),i=xd(t,r),ve("invalid",t);break;default:i=r}Dd(n,i),u=i;for(o in u)if(u.hasOwnProperty(o)){var c=u[o];o==="style"?vT(t,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&yT(t,c)):o==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Vs(t,c):typeof c=="number"&&Vs(t,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Ns.hasOwnProperty(o)?c!=null&&o==="onScroll"&&ve("scroll",t):c!=null&&rh(t,o,c,s))}switch(n){case"input":Jl(t),tg(t,r,!1);break;case"textarea":Jl(t),rg(t);break;case"option":r.value!=null&&t.setAttribute("value",""+gr(r.value));break;case"select":t.multiple=!!r.multiple,o=r.value,o!=null?Ji(t,!!r.multiple,o,!1):r.defaultValue!=null&&Ji(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Ya)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return at(e),null;case 6:if(t&&e.stateNode!=null)GE(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(G(166));if(n=Gr(Hs.current),Gr(hn.current),ra(e)){if(r=e.stateNode,n=e.memoizedProps,r[an]=e,(o=r.nodeValue!==n)&&(t=Ft,t!==null))switch(t.tag){case 3:na(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&na(r.nodeValue,n,(t.mode&1)!==0)}o&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[an]=e,e.stateNode=r}return at(e),null;case 13:if(Ee(xe),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ce&&Nt!==null&&e.mode&1&&!(e.flags&128))sE(),so(),e.flags|=98560,o=!1;else if(o=ra(e),r!==null&&r.dehydrated!==null){if(t===null){if(!o)throw Error(G(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(G(317));o[an]=e}else so(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;at(e),o=!1}else en!==null&&(ff(en),en=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||xe.current&1?ze===0&&(ze=3):Bh())),e.updateQueue!==null&&(e.flags|=4),at(e),null);case 4:return ao(),rf(t,e),t===null&&qs(e.stateNode.containerInfo),at(e),null;case 10:return Ih(e.type._context),at(e),null;case 17:return xt(e.type)&&Xa(),at(e),null;case 19:if(Ee(xe),o=e.memoizedState,o===null)return at(e),null;if(r=(e.flags&128)!==0,s=o.rendering,s===null)if(r)Zo(o,!1);else{if(ze!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(s=iu(t),s!==null){for(e.flags|=128,Zo(o,!1),r=s.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)o=n,t=r,o.flags&=14680066,s=o.alternate,s===null?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,t=s.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ye(xe,xe.current&1|2),e.child}t=t.sibling}o.tail!==null&&be()>co&&(e.flags|=128,r=!0,Zo(o,!1),e.lanes=4194304)}else{if(!r)if(t=iu(s),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Zo(o,!0),o.tail===null&&o.tailMode==="hidden"&&!s.alternate&&!Ce)return at(e),null}else 2*be()-o.renderingStartTime>co&&n!==1073741824&&(e.flags|=128,r=!0,Zo(o,!1),e.lanes=4194304);o.isBackwards?(s.sibling=e.child,e.child=s):(n=o.last,n!==null?n.sibling=s:e.child=s,o.last=s)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=be(),e.sibling=null,n=xe.current,ye(xe,r?n&1|2:n&1),e):(at(e),null);case 22:case 23:return bh(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?kt&1073741824&&(at(e),e.subtreeFlags&6&&(e.flags|=8192)):at(e),null;case 24:return null;case 25:return null}throw Error(G(156,e.tag))}function hR(t,e){switch(_h(e),e.tag){case 1:return xt(e.type)&&Xa(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return ao(),Ee(Rt),Ee(ft),Rh(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Ah(e),null;case 13:if(Ee(xe),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(G(340));so()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ee(xe),null;case 4:return ao(),null;case 10:return Ih(e.type._context),null;case 22:case 23:return bh(),null;case 24:return null;default:return null}}var sa=!1,ct=!1,pR=typeof WeakSet=="function"?WeakSet:Set,W=null;function Hi(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Ve(t,e,r)}else n.current=null}function of(t,e,n){try{n()}catch(r){Ve(t,e,r)}}var Kg=!1;function mR(t,e){if(qd=Wa,t=WT(),gh(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var s=0,u=-1,c=-1,d=0,h=0,p=t,m=null;t:for(;;){for(var _;p!==n||i!==0&&p.nodeType!==3||(u=s+i),p!==o||r!==0&&p.nodeType!==3||(c=s+r),p.nodeType===3&&(s+=p.nodeValue.length),(_=p.firstChild)!==null;)m=p,p=_;for(;;){if(p===t)break t;if(m===n&&++d===i&&(u=s),m===o&&++h===r&&(c=s),(_=p.nextSibling)!==null)break;p=m,m=p.parentNode}p=_}n=u===-1||c===-1?null:{start:u,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Gd={focusedElem:t,selectionRange:n},Wa=!1,W=e;W!==null;)if(e=W,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,W=t;else for(;W!==null;){e=W;try{var S=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(S!==null){var R=S.memoizedProps,M=S.memoizedState,I=e.stateNode,T=I.getSnapshotBeforeUpdate(e.elementType===e.type?R:Zt(e.type,R),M);I.__reactInternalSnapshotBeforeUpdate=T}break;case 3:var C=e.stateNode.containerInfo;C.nodeType===1?C.textContent="":C.nodeType===9&&C.documentElement&&C.removeChild(C.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(G(163))}}catch(k){Ve(e,e.return,k)}if(t=e.sibling,t!==null){t.return=e.return,W=t;break}W=e.return}return S=Kg,Kg=!1,S}function Cs(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var o=i.destroy;i.destroy=void 0,o!==void 0&&of(e,n,o)}i=i.next}while(i!==r)}}function Uu(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function sf(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function $E(t){var e=t.alternate;e!==null&&(t.alternate=null,$E(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[an],delete e[$s],delete e[Hd],delete e[XA],delete e[ZA])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function zE(t){return t.tag===5||t.tag===3||t.tag===4}function Wg(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||zE(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function lf(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Ya));else if(r!==4&&(t=t.child,t!==null))for(lf(t,e,n),t=t.sibling;t!==null;)lf(t,e,n),t=t.sibling}function af(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(af(t,e,n),t=t.sibling;t!==null;)af(t,e,n),t=t.sibling}var Ze=null,jt=!1;function zn(t,e,n){for(n=n.child;n!==null;)HE(t,e,n),n=n.sibling}function HE(t,e,n){if(fn&&typeof fn.onCommitFiberUnmount=="function")try{fn.onCommitFiberUnmount(Pu,n)}catch{}switch(n.tag){case 5:ct||Hi(n,e);case 6:var r=Ze,i=jt;Ze=null,zn(t,e,n),Ze=r,jt=i,Ze!==null&&(jt?(t=Ze,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ze.removeChild(n.stateNode));break;case 18:Ze!==null&&(jt?(t=Ze,n=n.stateNode,t.nodeType===8?Yc(t.parentNode,n):t.nodeType===1&&Yc(t,n),bs(t)):Yc(Ze,n.stateNode));break;case 4:r=Ze,i=jt,Ze=n.stateNode.containerInfo,jt=!0,zn(t,e,n),Ze=r,jt=i;break;case 0:case 11:case 14:case 15:if(!ct&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var o=i,s=o.destroy;o=o.tag,s!==void 0&&(o&2||o&4)&&of(n,e,s),i=i.next}while(i!==r)}zn(t,e,n);break;case 1:if(!ct&&(Hi(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(u){Ve(n,e,u)}zn(t,e,n);break;case 21:zn(t,e,n);break;case 22:n.mode&1?(ct=(r=ct)||n.memoizedState!==null,zn(t,e,n),ct=r):zn(t,e,n);break;default:zn(t,e,n)}}function Jg(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new pR),e.forEach(function(r){var i=wR.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Xt(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var o=t,s=e,u=s;e:for(;u!==null;){switch(u.tag){case 5:Ze=u.stateNode,jt=!1;break e;case 3:Ze=u.stateNode.containerInfo,jt=!0;break e;case 4:Ze=u.stateNode.containerInfo,jt=!0;break e}u=u.return}if(Ze===null)throw Error(G(160));HE(o,s,i),Ze=null,jt=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(d){Ve(i,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)KE(e,t),e=e.sibling}function KE(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Xt(e,t),sn(t),r&4){try{Cs(3,t,t.return),Uu(3,t)}catch(R){Ve(t,t.return,R)}try{Cs(5,t,t.return)}catch(R){Ve(t,t.return,R)}}break;case 1:Xt(e,t),sn(t),r&512&&n!==null&&Hi(n,n.return);break;case 5:if(Xt(e,t),sn(t),r&512&&n!==null&&Hi(n,n.return),t.flags&32){var i=t.stateNode;try{Vs(i,"")}catch(R){Ve(t,t.return,R)}}if(r&4&&(i=t.stateNode,i!=null)){var o=t.memoizedProps,s=n!==null?n.memoizedProps:o,u=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{u==="input"&&o.type==="radio"&&o.name!=null&&pT(i,o),Md(u,s);var d=Md(u,o);for(s=0;s<c.length;s+=2){var h=c[s],p=c[s+1];h==="style"?vT(i,p):h==="dangerouslySetInnerHTML"?yT(i,p):h==="children"?Vs(i,p):rh(i,h,p,d)}switch(u){case"input":Ad(i,o);break;case"textarea":mT(i,o);break;case"select":var m=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var _=o.value;_!=null?Ji(i,!!o.multiple,_,!1):m!==!!o.multiple&&(o.defaultValue!=null?Ji(i,!!o.multiple,o.defaultValue,!0):Ji(i,!!o.multiple,o.multiple?[]:"",!1))}i[$s]=o}catch(R){Ve(t,t.return,R)}}break;case 6:if(Xt(e,t),sn(t),r&4){if(t.stateNode===null)throw Error(G(162));i=t.stateNode,o=t.memoizedProps;try{i.nodeValue=o}catch(R){Ve(t,t.return,R)}}break;case 3:if(Xt(e,t),sn(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{bs(e.containerInfo)}catch(R){Ve(t,t.return,R)}break;case 4:Xt(e,t),sn(t);break;case 13:Xt(e,t),sn(t),i=t.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(Fh=be())),r&4&&Jg(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(ct=(d=ct)||h,Xt(e,t),ct=d):Xt(e,t),sn(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!h&&t.mode&1)for(W=t,h=t.child;h!==null;){for(p=W=h;W!==null;){switch(m=W,_=m.child,m.tag){case 0:case 11:case 14:case 15:Cs(4,m,m.return);break;case 1:Hi(m,m.return);var S=m.stateNode;if(typeof S.componentWillUnmount=="function"){r=m,n=m.return;try{e=r,S.props=e.memoizedProps,S.state=e.memoizedState,S.componentWillUnmount()}catch(R){Ve(r,n,R)}}break;case 5:Hi(m,m.return);break;case 22:if(m.memoizedState!==null){Yg(p);continue}}_!==null?(_.return=m,W=_):Yg(p)}h=h.sibling}e:for(h=null,p=t;;){if(p.tag===5){if(h===null){h=p;try{i=p.stateNode,d?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(u=p.stateNode,c=p.memoizedProps.style,s=c!=null&&c.hasOwnProperty("display")?c.display:null,u.style.display=_T("display",s))}catch(R){Ve(t,t.return,R)}}}else if(p.tag===6){if(h===null)try{p.stateNode.nodeValue=d?"":p.memoizedProps}catch(R){Ve(t,t.return,R)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===t)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===t)break e;for(;p.sibling===null;){if(p.return===null||p.return===t)break e;h===p&&(h=null),p=p.return}h===p&&(h=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:Xt(e,t),sn(t),r&4&&Jg(t);break;case 21:break;default:Xt(e,t),sn(t)}}function sn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(zE(n)){var r=n;break e}n=n.return}throw Error(G(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Vs(i,""),r.flags&=-33);var o=Wg(t);af(t,o,i);break;case 3:case 4:var s=r.stateNode.containerInfo,u=Wg(t);lf(t,u,s);break;default:throw Error(G(161))}}catch(c){Ve(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function gR(t,e,n){W=t,WE(t)}function WE(t,e,n){for(var r=(t.mode&1)!==0;W!==null;){var i=W,o=i.child;if(i.tag===22&&r){var s=i.memoizedState!==null||sa;if(!s){var u=i.alternate,c=u!==null&&u.memoizedState!==null||ct;u=sa;var d=ct;if(sa=s,(ct=c)&&!d)for(W=i;W!==null;)s=W,c=s.child,s.tag===22&&s.memoizedState!==null?Xg(i):c!==null?(c.return=s,W=c):Xg(i);for(;o!==null;)W=o,WE(o),o=o.sibling;W=i,sa=u,ct=d}Qg(t)}else i.subtreeFlags&8772&&o!==null?(o.return=i,W=o):Qg(t)}}function Qg(t){for(;W!==null;){var e=W;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ct||Uu(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!ct)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:Zt(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&Ng(e,o,r);break;case 3:var s=e.updateQueue;if(s!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Ng(e,s,n)}break;case 5:var u=e.stateNode;if(n===null&&e.flags&4){n=u;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var p=h.dehydrated;p!==null&&bs(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(G(163))}ct||e.flags&512&&sf(e)}catch(m){Ve(e,e.return,m)}}if(e===t){W=null;break}if(n=e.sibling,n!==null){n.return=e.return,W=n;break}W=e.return}}function Yg(t){for(;W!==null;){var e=W;if(e===t){W=null;break}var n=e.sibling;if(n!==null){n.return=e.return,W=n;break}W=e.return}}function Xg(t){for(;W!==null;){var e=W;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Uu(4,e)}catch(c){Ve(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(c){Ve(e,i,c)}}var o=e.return;try{sf(e)}catch(c){Ve(e,o,c)}break;case 5:var s=e.return;try{sf(e)}catch(c){Ve(e,s,c)}}}catch(c){Ve(e,e.return,c)}if(e===t){W=null;break}var u=e.sibling;if(u!==null){u.return=e.return,W=u;break}W=e.return}}var yR=Math.ceil,lu=bn.ReactCurrentDispatcher,Vh=bn.ReactCurrentOwner,Ht=bn.ReactCurrentBatchConfig,ae=0,Je=null,Oe=null,nt=0,kt=0,Ki=Cr(0),ze=0,Qs=null,Yr=0,bu=0,Lh=0,ws=null,wt=null,Fh=0,co=1/0,wn=null,au=!1,uf=null,ar=null,la=!1,er=null,uu=0,Ss=0,cf=null,xa=-1,Pa=0;function vt(){return ae&6?be():xa!==-1?xa:xa=be()}function ur(t){return t.mode&1?ae&2&&nt!==0?nt&-nt:eR.transition!==null?(Pa===0&&(Pa=MT()),Pa):(t=he,t!==0||(t=window.event,t=t===void 0?16:bT(t.type)),t):1}function nn(t,e,n,r){if(50<Ss)throw Ss=0,cf=null,Error(G(185));hl(t,n,r),(!(ae&2)||t!==Je)&&(t===Je&&(!(ae&2)&&(bu|=n),ze===4&&Yn(t,nt)),Pt(t,r),n===1&&ae===0&&!(e.mode&1)&&(co=be()+500,Vu&&wr()))}function Pt(t,e){var n=t.callbackNode;eA(t,e);var r=Ka(t,t===Je?nt:0);if(r===0)n!==null&&sg(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&sg(n),e===1)t.tag===0?jA(Zg.bind(null,t)):rE(Zg.bind(null,t)),QA(function(){!(ae&6)&&wr()}),n=null;else{switch(kT(r)){case 1:n=ah;break;case 4:n=PT;break;case 16:n=Ha;break;case 536870912:n=DT;break;default:n=Ha}n=tI(n,JE.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function JE(t,e){if(xa=-1,Pa=0,ae&6)throw Error(G(327));var n=t.callbackNode;if(ji()&&t.callbackNode!==n)return null;var r=Ka(t,t===Je?nt:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=cu(t,r);else{e=r;var i=ae;ae|=2;var o=YE();(Je!==t||nt!==e)&&(wn=null,co=be()+500,$r(t,e));do try{TR();break}catch(u){QE(t,u)}while(!0);Eh(),lu.current=o,ae=i,Oe!==null?e=0:(Je=null,nt=0,e=ze)}if(e!==0){if(e===2&&(i=Fd(t),i!==0&&(r=i,e=df(t,i))),e===1)throw n=Qs,$r(t,0),Yn(t,r),Pt(t,be()),n;if(e===6)Yn(t,r);else{if(i=t.current.alternate,!(r&30)&&!_R(i)&&(e=cu(t,r),e===2&&(o=Fd(t),o!==0&&(r=o,e=df(t,o))),e===1))throw n=Qs,$r(t,0),Yn(t,r),Pt(t,be()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(G(345));case 2:Nr(t,wt,wn);break;case 3:if(Yn(t,r),(r&130023424)===r&&(e=Fh+500-be(),10<e)){if(Ka(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){vt(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=zd(Nr.bind(null,t,wt,wn),e);break}Nr(t,wt,wn);break;case 4:if(Yn(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var s=31-tn(r);o=1<<s,s=e[s],s>i&&(i=s),r&=~o}if(r=i,r=be()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*yR(r/1960))-r,10<r){t.timeoutHandle=zd(Nr.bind(null,t,wt,wn),r);break}Nr(t,wt,wn);break;case 5:Nr(t,wt,wn);break;default:throw Error(G(329))}}}return Pt(t,be()),t.callbackNode===n?JE.bind(null,t):null}function df(t,e){var n=ws;return t.current.memoizedState.isDehydrated&&($r(t,e).flags|=256),t=cu(t,e),t!==2&&(e=wt,wt=n,e!==null&&ff(e)),t}function ff(t){wt===null?wt=t:wt.push.apply(wt,t)}function _R(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!rn(o(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Yn(t,e){for(e&=~Lh,e&=~bu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-tn(e),r=1<<n;t[n]=-1,e&=~r}}function Zg(t){if(ae&6)throw Error(G(327));ji();var e=Ka(t,0);if(!(e&1))return Pt(t,be()),null;var n=cu(t,e);if(t.tag!==0&&n===2){var r=Fd(t);r!==0&&(e=r,n=df(t,r))}if(n===1)throw n=Qs,$r(t,0),Yn(t,e),Pt(t,be()),n;if(n===6)throw Error(G(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Nr(t,wt,wn),Pt(t,be()),null}function Uh(t,e){var n=ae;ae|=1;try{return t(e)}finally{ae=n,ae===0&&(co=be()+500,Vu&&wr())}}function Xr(t){er!==null&&er.tag===0&&!(ae&6)&&ji();var e=ae;ae|=1;var n=Ht.transition,r=he;try{if(Ht.transition=null,he=1,t)return t()}finally{he=r,Ht.transition=n,ae=e,!(ae&6)&&wr()}}function bh(){kt=Ki.current,Ee(Ki)}function $r(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,JA(n)),Oe!==null)for(n=Oe.return;n!==null;){var r=n;switch(_h(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Xa();break;case 3:ao(),Ee(Rt),Ee(ft),Rh();break;case 5:Ah(r);break;case 4:ao();break;case 13:Ee(xe);break;case 19:Ee(xe);break;case 10:Ih(r.type._context);break;case 22:case 23:bh()}n=n.return}if(Je=t,Oe=t=cr(t.current,null),nt=kt=e,ze=0,Qs=null,Lh=bu=Yr=0,wt=ws=null,qr!==null){for(e=0;e<qr.length;e++)if(n=qr[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,o=n.pending;if(o!==null){var s=o.next;o.next=i,r.next=s}n.pending=r}qr=null}return t}function QE(t,e){do{var n=Oe;try{if(Eh(),Sa.current=su,ou){for(var r=De.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}ou=!1}if(Qr=0,We=$e=De=null,Is=!1,Ks=0,Vh.current=null,n===null||n.return===null){ze=1,Qs=e,Oe=null;break}e:{var o=t,s=n.return,u=n,c=e;if(e=nt,u.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,h=u,p=h.tag;if(!(h.mode&1)&&(p===0||p===11||p===15)){var m=h.alternate;m?(h.updateQueue=m.updateQueue,h.memoizedState=m.memoizedState,h.lanes=m.lanes):(h.updateQueue=null,h.memoizedState=null)}var _=Bg(s);if(_!==null){_.flags&=-257,Og(_,s,u,o,e),_.mode&1&&bg(o,d,e),e=_,c=d;var S=e.updateQueue;if(S===null){var R=new Set;R.add(c),e.updateQueue=R}else S.add(c);break e}else{if(!(e&1)){bg(o,d,e),Bh();break e}c=Error(G(426))}}else if(Ce&&u.mode&1){var M=Bg(s);if(M!==null){!(M.flags&65536)&&(M.flags|=256),Og(M,s,u,o,e),vh(uo(c,u));break e}}o=c=uo(c,u),ze!==4&&(ze=2),ws===null?ws=[o]:ws.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var I=kE(o,c,e);kg(o,I);break e;case 1:u=c;var T=o.type,C=o.stateNode;if(!(o.flags&128)&&(typeof T.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(ar===null||!ar.has(C)))){o.flags|=65536,e&=-e,o.lanes|=e;var k=NE(o,u,e);kg(o,k);break e}}o=o.return}while(o!==null)}ZE(n)}catch(F){e=F,Oe===n&&n!==null&&(Oe=n=n.return);continue}break}while(!0)}function YE(){var t=lu.current;return lu.current=su,t===null?su:t}function Bh(){(ze===0||ze===3||ze===2)&&(ze=4),Je===null||!(Yr&268435455)&&!(bu&268435455)||Yn(Je,nt)}function cu(t,e){var n=ae;ae|=2;var r=YE();(Je!==t||nt!==e)&&(wn=null,$r(t,e));do try{vR();break}catch(i){QE(t,i)}while(!0);if(Eh(),ae=n,lu.current=r,Oe!==null)throw Error(G(261));return Je=null,nt=0,ze}function vR(){for(;Oe!==null;)XE(Oe)}function TR(){for(;Oe!==null&&!HS();)XE(Oe)}function XE(t){var e=eI(t.alternate,t,kt);t.memoizedProps=t.pendingProps,e===null?ZE(t):Oe=e,Vh.current=null}function ZE(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=hR(n,e),n!==null){n.flags&=32767,Oe=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ze=6,Oe=null;return}}else if(n=fR(n,e,kt),n!==null){Oe=n;return}if(e=e.sibling,e!==null){Oe=e;return}Oe=e=t}while(e!==null);ze===0&&(ze=5)}function Nr(t,e,n){var r=he,i=Ht.transition;try{Ht.transition=null,he=1,ER(t,e,n,r)}finally{Ht.transition=i,he=r}return null}function ER(t,e,n,r){do ji();while(er!==null);if(ae&6)throw Error(G(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(G(177));t.callbackNode=null,t.callbackPriority=0;var o=n.lanes|n.childLanes;if(tA(t,o),t===Je&&(Oe=Je=null,nt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||la||(la=!0,tI(Ha,function(){return ji(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=Ht.transition,Ht.transition=null;var s=he;he=1;var u=ae;ae|=4,Vh.current=null,mR(t,n),KE(n,t),qA(Gd),Wa=!!qd,Gd=qd=null,t.current=n,gR(n),KS(),ae=u,he=s,Ht.transition=o}else t.current=n;if(la&&(la=!1,er=t,uu=i),o=t.pendingLanes,o===0&&(ar=null),QS(n.stateNode),Pt(t,be()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(au)throw au=!1,t=uf,uf=null,t;return uu&1&&t.tag!==0&&ji(),o=t.pendingLanes,o&1?t===cf?Ss++:(Ss=0,cf=t):Ss=0,wr(),null}function ji(){if(er!==null){var t=kT(uu),e=Ht.transition,n=he;try{if(Ht.transition=null,he=16>t?16:t,er===null)var r=!1;else{if(t=er,er=null,uu=0,ae&6)throw Error(G(331));var i=ae;for(ae|=4,W=t.current;W!==null;){var o=W,s=o.child;if(W.flags&16){var u=o.deletions;if(u!==null){for(var c=0;c<u.length;c++){var d=u[c];for(W=d;W!==null;){var h=W;switch(h.tag){case 0:case 11:case 15:Cs(8,h,o)}var p=h.child;if(p!==null)p.return=h,W=p;else for(;W!==null;){h=W;var m=h.sibling,_=h.return;if($E(h),h===d){W=null;break}if(m!==null){m.return=_,W=m;break}W=_}}}var S=o.alternate;if(S!==null){var R=S.child;if(R!==null){S.child=null;do{var M=R.sibling;R.sibling=null,R=M}while(R!==null)}}W=o}}if(o.subtreeFlags&2064&&s!==null)s.return=o,W=s;else e:for(;W!==null;){if(o=W,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Cs(9,o,o.return)}var I=o.sibling;if(I!==null){I.return=o.return,W=I;break e}W=o.return}}var T=t.current;for(W=T;W!==null;){s=W;var C=s.child;if(s.subtreeFlags&2064&&C!==null)C.return=s,W=C;else e:for(s=T;W!==null;){if(u=W,u.flags&2048)try{switch(u.tag){case 0:case 11:case 15:Uu(9,u)}}catch(F){Ve(u,u.return,F)}if(u===s){W=null;break e}var k=u.sibling;if(k!==null){k.return=u.return,W=k;break e}W=u.return}}if(ae=i,wr(),fn&&typeof fn.onPostCommitFiberRoot=="function")try{fn.onPostCommitFiberRoot(Pu,t)}catch{}r=!0}return r}finally{he=n,Ht.transition=e}}return!1}function jg(t,e,n){e=uo(n,e),e=kE(t,e,1),t=lr(t,e,1),e=vt(),t!==null&&(hl(t,1,e),Pt(t,e))}function Ve(t,e,n){if(t.tag===3)jg(t,t,n);else for(;e!==null;){if(e.tag===3){jg(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ar===null||!ar.has(r))){t=uo(n,t),t=NE(e,t,1),e=lr(e,t,1),t=vt(),e!==null&&(hl(e,1,t),Pt(e,t));break}}e=e.return}}function IR(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=vt(),t.pingedLanes|=t.suspendedLanes&n,Je===t&&(nt&n)===n&&(ze===4||ze===3&&(nt&130023424)===nt&&500>be()-Fh?$r(t,0):Lh|=n),Pt(t,e)}function jE(t,e){e===0&&(t.mode&1?(e=Xl,Xl<<=1,!(Xl&130023424)&&(Xl=4194304)):e=1);var n=vt();t=Nn(t,e),t!==null&&(hl(t,e,n),Pt(t,n))}function CR(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),jE(t,n)}function wR(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(G(314))}r!==null&&r.delete(e),jE(t,n)}var eI;eI=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Rt.current)St=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return St=!1,dR(t,e,n);St=!!(t.flags&131072)}else St=!1,Ce&&e.flags&1048576&&iE(e,eu,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Ra(t,e),t=e.pendingProps;var i=oo(e,ft.current);Zi(e,n),i=Ph(null,e,r,t,i,n);var o=Dh();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,xt(r)?(o=!0,Za(e)):o=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,wh(e),i.updater=Fu,e.stateNode=i,i._reactInternals=e,Xd(e,r,t,n),e=ef(null,e,r,!0,o,n)):(e.tag=0,Ce&&o&&yh(e),yt(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Ra(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=AR(r),t=Zt(r,t),i){case 0:e=jd(null,e,r,t,n);break e;case 1:e=$g(null,e,r,t,n);break e;case 11:e=qg(null,e,r,t,n);break e;case 14:e=Gg(null,e,r,Zt(r.type,t),n);break e}throw Error(G(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Zt(r,i),jd(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Zt(r,i),$g(t,e,r,i,n);case 3:e:{if(UE(e),t===null)throw Error(G(387));r=e.pendingProps,o=e.memoizedState,i=o.element,cE(t,e),ru(e,r,null,n);var s=e.memoizedState;if(r=s.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){i=uo(Error(G(423)),e),e=zg(t,e,r,n,i);break e}else if(r!==i){i=uo(Error(G(424)),e),e=zg(t,e,r,n,i);break e}else for(Nt=sr(e.stateNode.containerInfo.firstChild),Ft=e,Ce=!0,en=null,n=aE(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(so(),r===i){e=Vn(t,e,n);break e}yt(t,e,r,n)}e=e.child}return e;case 5:return dE(e),t===null&&Jd(e),r=e.type,i=e.pendingProps,o=t!==null?t.memoizedProps:null,s=i.children,$d(r,i)?s=null:o!==null&&$d(r,o)&&(e.flags|=32),FE(t,e),yt(t,e,s,n),e.child;case 6:return t===null&&Jd(e),null;case 13:return bE(t,e,n);case 4:return Sh(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=lo(e,null,r,n):yt(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Zt(r,i),qg(t,e,r,i,n);case 7:return yt(t,e,e.pendingProps,n),e.child;case 8:return yt(t,e,e.pendingProps.children,n),e.child;case 12:return yt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,o=e.memoizedProps,s=i.value,ye(tu,r._currentValue),r._currentValue=s,o!==null)if(rn(o.value,s)){if(o.children===i.children&&!Rt.current){e=Vn(t,e,n);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var u=o.dependencies;if(u!==null){s=o.child;for(var c=u.firstContext;c!==null;){if(c.context===r){if(o.tag===1){c=Pn(-1,n&-n),c.tag=2;var d=o.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?c.next=c:(c.next=h.next,h.next=c),d.pending=c}}o.lanes|=n,c=o.alternate,c!==null&&(c.lanes|=n),Qd(o.return,n,e),u.lanes|=n;break}c=c.next}}else if(o.tag===10)s=o.type===e.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(G(341));s.lanes|=n,u=s.alternate,u!==null&&(u.lanes|=n),Qd(s,n,e),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===e){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}yt(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,Zi(e,n),i=Jt(i),r=r(i),e.flags|=1,yt(t,e,r,n),e.child;case 14:return r=e.type,i=Zt(r,e.pendingProps),i=Zt(r.type,i),Gg(t,e,r,i,n);case 15:return VE(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Zt(r,i),Ra(t,e),e.tag=1,xt(r)?(t=!0,Za(e)):t=!1,Zi(e,n),ME(e,r,i),Xd(e,r,i,n),ef(null,e,r,!0,t,n);case 19:return BE(t,e,n);case 22:return LE(t,e,n)}throw Error(G(156,e.tag))};function tI(t,e){return xT(t,e)}function SR(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function $t(t,e,n,r){return new SR(t,e,n,r)}function Oh(t){return t=t.prototype,!(!t||!t.isReactComponent)}function AR(t){if(typeof t=="function")return Oh(t)?1:0;if(t!=null){if(t=t.$$typeof,t===oh)return 11;if(t===sh)return 14}return 2}function cr(t,e){var n=t.alternate;return n===null?(n=$t(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Da(t,e,n,r,i,o){var s=2;if(r=t,typeof t=="function")Oh(t)&&(s=1);else if(typeof t=="string")s=5;else e:switch(t){case Fi:return zr(n.children,i,o,e);case ih:s=8,i|=8;break;case Ed:return t=$t(12,n,e,i|2),t.elementType=Ed,t.lanes=o,t;case Id:return t=$t(13,n,e,i),t.elementType=Id,t.lanes=o,t;case Cd:return t=$t(19,n,e,i),t.elementType=Cd,t.lanes=o,t;case dT:return Bu(n,i,o,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case uT:s=10;break e;case cT:s=9;break e;case oh:s=11;break e;case sh:s=14;break e;case Wn:s=16,r=null;break e}throw Error(G(130,t==null?t:typeof t,""))}return e=$t(s,n,e,i),e.elementType=t,e.type=r,e.lanes=o,e}function zr(t,e,n,r){return t=$t(7,t,r,e),t.lanes=n,t}function Bu(t,e,n,r){return t=$t(22,t,r,e),t.elementType=dT,t.lanes=n,t.stateNode={isHidden:!1},t}function id(t,e,n){return t=$t(6,t,null,e),t.lanes=n,t}function od(t,e,n){return e=$t(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function RR(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Bc(0),this.expirationTimes=Bc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Bc(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function qh(t,e,n,r,i,o,s,u,c){return t=new RR(t,e,n,u,c),e===1?(e=1,o===!0&&(e|=8)):e=0,o=$t(3,null,null,e),t.current=o,o.stateNode=t,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},wh(o),t}function xR(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Li,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function nI(t){if(!t)return yr;t=t._reactInternals;e:{if(di(t)!==t||t.tag!==1)throw Error(G(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(xt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(G(171))}if(t.tag===1){var n=t.type;if(xt(n))return nE(t,n,e)}return e}function rI(t,e,n,r,i,o,s,u,c){return t=qh(n,r,!0,t,i,o,s,u,c),t.context=nI(null),n=t.current,r=vt(),i=ur(n),o=Pn(r,i),o.callback=e??null,lr(n,o,i),t.current.lanes=i,hl(t,i,r),Pt(t,r),t}function Ou(t,e,n,r){var i=e.current,o=vt(),s=ur(i);return n=nI(n),e.context===null?e.context=n:e.pendingContext=n,e=Pn(o,s),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=lr(i,e,s),t!==null&&(nn(t,i,s,o),wa(t,i,s)),s}function du(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function ey(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Gh(t,e){ey(t,e),(t=t.alternate)&&ey(t,e)}function PR(){return null}var iI=typeof reportError=="function"?reportError:function(t){console.error(t)};function $h(t){this._internalRoot=t}qu.prototype.render=$h.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(G(409));Ou(t,e,null,null)};qu.prototype.unmount=$h.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Xr(function(){Ou(null,t,null,null)}),e[kn]=null}};function qu(t){this._internalRoot=t}qu.prototype.unstable_scheduleHydration=function(t){if(t){var e=LT();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Qn.length&&e!==0&&e<Qn[n].priority;n++);Qn.splice(n,0,t),n===0&&UT(t)}};function zh(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Gu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function ty(){}function DR(t,e,n,r,i){if(i){if(typeof r=="function"){var o=r;r=function(){var d=du(s);o.call(d)}}var s=rI(e,r,t,0,null,!1,!1,"",ty);return t._reactRootContainer=s,t[kn]=s.current,qs(t.nodeType===8?t.parentNode:t),Xr(),s}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var u=r;r=function(){var d=du(c);u.call(d)}}var c=qh(t,0,!1,null,null,!1,!1,"",ty);return t._reactRootContainer=c,t[kn]=c.current,qs(t.nodeType===8?t.parentNode:t),Xr(function(){Ou(e,c,n,r)}),c}function $u(t,e,n,r,i){var o=n._reactRootContainer;if(o){var s=o;if(typeof i=="function"){var u=i;i=function(){var c=du(s);u.call(c)}}Ou(e,s,t,i)}else s=DR(n,e,t,i,r);return du(s)}NT=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=cs(e.pendingLanes);n!==0&&(uh(e,n|1),Pt(e,be()),!(ae&6)&&(co=be()+500,wr()))}break;case 13:Xr(function(){var r=Nn(t,1);if(r!==null){var i=vt();nn(r,t,1,i)}}),Gh(t,1)}};ch=function(t){if(t.tag===13){var e=Nn(t,134217728);if(e!==null){var n=vt();nn(e,t,134217728,n)}Gh(t,134217728)}};VT=function(t){if(t.tag===13){var e=ur(t),n=Nn(t,e);if(n!==null){var r=vt();nn(n,t,e,r)}Gh(t,e)}};LT=function(){return he};FT=function(t,e){var n=he;try{return he=t,e()}finally{he=n}};Nd=function(t,e,n){switch(e){case"input":if(Ad(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=Nu(r);if(!i)throw Error(G(90));hT(r),Ad(r,i)}}}break;case"textarea":mT(t,n);break;case"select":e=n.value,e!=null&&Ji(t,!!n.multiple,e,!1)}};IT=Uh;CT=Xr;var MR={usingClientEntryPoint:!1,Events:[ml,Oi,Nu,TT,ET,Uh]},jo={findFiberByHostInstance:Or,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},kR={bundleType:jo.bundleType,version:jo.version,rendererPackageName:jo.rendererPackageName,rendererConfig:jo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:bn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=AT(t),t===null?null:t.stateNode},findFiberByHostInstance:jo.findFiberByHostInstance||PR,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var aa=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!aa.isDisabled&&aa.supportsFiber)try{Pu=aa.inject(kR),fn=aa}catch{}}Bt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=MR;Bt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!zh(e))throw Error(G(200));return xR(t,e,null,n)};Bt.createRoot=function(t,e){if(!zh(t))throw Error(G(299));var n=!1,r="",i=iI;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=qh(t,1,!1,null,null,n,!1,r,i),t[kn]=e.current,qs(t.nodeType===8?t.parentNode:t),new $h(e)};Bt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(G(188)):(t=Object.keys(t).join(","),Error(G(268,t)));return t=AT(e),t=t===null?null:t.stateNode,t};Bt.flushSync=function(t){return Xr(t)};Bt.hydrate=function(t,e,n){if(!Gu(e))throw Error(G(200));return $u(null,t,e,!0,n)};Bt.hydrateRoot=function(t,e,n){if(!zh(t))throw Error(G(405));var r=n!=null&&n.hydratedSources||null,i=!1,o="",s=iI;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(s=n.onRecoverableError)),e=rI(e,null,t,1,n??null,i,!1,o,s),t[kn]=e.current,qs(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new qu(e)};Bt.render=function(t,e,n){if(!Gu(e))throw Error(G(200));return $u(null,t,e,!1,n)};Bt.unmountComponentAtNode=function(t){if(!Gu(t))throw Error(G(40));return t._reactRootContainer?(Xr(function(){$u(null,null,t,!1,function(){t._reactRootContainer=null,t[kn]=null})}),!0):!1};Bt.unstable_batchedUpdates=Uh;Bt.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Gu(n))throw Error(G(200));if(t==null||t._reactInternals===void 0)throw Error(G(38));return $u(t,e,n,!1,r)};Bt.version="18.3.1-next-f1338f8080-20240426";function oI(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(oI)}catch(t){console.error(t)}}oI(),oT.exports=Bt;var NR=oT.exports,ny=NR;vd.createRoot=ny.createRoot,vd.hydrateRoot=ny.hydrateRoot;const VR=({onAddPhotoClick:t,searchTerm:e,onSearchChange:n,isGridEmpty:r,onToggleFavorites:i,showFavorites:o})=>B.jsx("header",{className:"sticky top-0 z-20 p-4 bg-primary-bg/80 backdrop-blur-lg border-b border-accent-soft/50",children:B.jsxs("div",{className:"container mx-auto flex justify-between items-center gap-2 sm:gap-4",children:[B.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-7 w-7 text-accent",viewBox:"0 0 20 20",fill:"currentColor",children:B.jsx("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})}),B.jsx("h1",{className:"text-xl font-semibold text-primary-text hidden md:block",children:"Our Photo Diary"})]}),B.jsx("div",{className:"flex-1 w-full max-w-lg",children:B.jsx("input",{type:"text",placeholder:"Search memories...",value:e,onChange:s=>n(s.target.value),className:"w-full px-5 py-2 bg-secondary-bg/70 border border-accent-soft/60 rounded-full text-primary-text placeholder-secondary-text focus:outline-none focus:ring-2 focus:ring-accent transition-all duration-300 shadow-inner shadow-accent-soft/20 text-sm"})}),B.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[B.jsx("button",{onClick:i,className:`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 group ${o?"bg-accent/20":"hover:bg-accent/10"}`,"aria-label":"Show favorites",children:B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 transition-all duration-300 ${o?"text-accent":"text-accent/70 group-hover:text-accent"}`,viewBox:"0 0 20 20",fill:"currentColor",children:B.jsx("path",{fillRule:"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z",clipRule:"evenodd"})})}),B.jsx("button",{onClick:t,className:`bg-accent hover:bg-accent-hover text-white font-bold w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 shadow-lg shadow-accent/30 hover:shadow-accent/50 transform hover:scale-110 shrink-0 ${r?"animate-soft-pulse":""}`,"aria-label":"Add new memory",children:B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:B.jsx("path",{fillRule:"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z",clipRule:"evenodd"})})})]})]})}),LR=({photo:t,onDelete:e,onFavorite:n,onClick:r,index:i})=>{const o=u=>{u.stopPropagation(),window.confirm("Are you sure you want to delete this memory?")&&e(t)},s=u=>{u.stopPropagation(),n(t)};return B.jsxs("div",{className:"relative group overflow-hidden rounded-xl mb-4 break-inside-avoid shadow-gentle hover:shadow-gentle-lg transition-all duration-300 bg-secondary-bg cursor-pointer opacity-0 animate-fade-in-up",onClick:()=>r(t),style:{animationDelay:`${i*50}ms`},children:[B.jsx("img",{src:t.imageUrl,alt:t.description||"Photo entry",className:"w-full h-auto object-cover transition-transform duration-300 group-hover:scale-105",loading:"lazy"}),B.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-black/10 to-transparent"}),B.jsx("div",{className:"absolute bottom-0 left-0 p-4 w-full text-white",children:B.jsx("p",{className:"text-sm font-semibold transform transition-all duration-300 opacity-0 group-hover:opacity-100 group-hover:translate-y-0 translate-y-4",children:t.description})}),t.commentCount>0&&B.jsxs("div",{className:"absolute bottom-2 right-2 flex items-center gap-1 text-xs bg-black/40 backdrop-blur-sm px-2 py-1 rounded-full text-white/90",children:[B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:B.jsx("path",{fillRule:"evenodd",d:"M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z",clipRule:"evenodd"})}),B.jsx("span",{children:t.commentCount})]}),B.jsxs("div",{className:"absolute top-2 right-2 flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:[B.jsx("button",{onClick:s,"aria-label":"Favorite photo",className:"p-1.5 bg-white/40 backdrop-blur-sm rounded-full text-primary-text hover:text-accent focus:outline-none transition-colors duration-200",children:B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:B.jsx("path",{fillRule:"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z",className:`transition-opacity ${t.isFavorite?"opacity-100 text-accent":"opacity-60"}`,clipRule:"evenodd"})})}),B.jsx("button",{onClick:o,"aria-label":"Delete photo",className:"p-1.5 bg-white/40 backdrop-blur-sm rounded-full text-primary-text hover:text-white hover:bg-red-500 focus:outline-none transition-colors duration-200",children:B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:B.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]})},Ys=()=>B.jsxs("div",{className:"flex justify-center items-center h-full",children:[B.jsx("svg",{className:"h-10 w-10 text-accent",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",style:{animation:"pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite"},children:B.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"})}),B.jsx("style",{children:`
          @keyframes pulse {
            0%, 100% {
              opacity: 1;
              transform: scale(1);
            }
            50% {
              opacity: 0.7;
              transform: scale(0.9);
            }
          }
        `})]}),FR=t=>{const e=new Date(t),n=e.getTimezoneOffset()*6e4,r=new Date(e.getTime()+n);return new Intl.DateTimeFormat("en-US",{dateStyle:"full"}).format(r)},UR=({photos:t,loading:e,error:n,onDeletePhoto:r,onFavoritePhoto:i,onPhotoClick:o})=>{if(e)return B.jsx("div",{className:"mt-20",children:B.jsx(Ys,{})});if(n)return B.jsxs("div",{className:"text-center text-red-800 bg-red-100 border border-red-300 p-6 rounded-xl mt-10 max-w-2xl mx-auto shadow-gentle",children:[B.jsx("p",{className:"font-bold text-xl text-red-900",children:"Oh no, something went wrong!"}),B.jsx("p",{className:"text-sm mt-2",children:n})]});if(t.length===0)return B.jsxs("div",{className:"text-center text-secondary-text mt-20 bg-secondary-bg/50 p-10 rounded-xl max-w-md mx-auto border border-accent-soft/40 shadow-gentle flex flex-col items-center",children:[B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-20 w-20 text-accent-soft mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1,children:B.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),B.jsx("h2",{className:"text-2xl font-semibold text-transparent bg-clip-text bg-gradient-to-r from-accent to-pink-400",children:"No Memories Found"}),B.jsx("p",{className:"mt-2",children:"Try a different search, or click the '+' to add a photo."})]});const s=t.reduce((d,h)=>{if(!h.createdAt||!h.createdAt.toDate)return d;const p=h.createdAt.toDate().toLocaleDateString("en-CA");return d[p]||(d[p]=[]),d[p].push(h),d},{}),u=Object.keys(s).sort((d,h)=>new Date(h).getTime()-new Date(d).getTime());let c=0;return B.jsx("div",{className:"w-full mx-auto space-y-12",children:u.map(d=>B.jsxs("section",{children:[B.jsx("h2",{className:"text-xl font-semibold text-primary-text pb-2 mb-6 border-b border-accent-soft",children:FR(d)}),B.jsx("div",{className:"columns-2 sm:columns-3 md:columns-4 lg:columns-5 gap-4 md:gap-6",children:s[d].map(h=>B.jsx(LR,{photo:h,onDelete:r,onFavorite:i,onClick:o,index:c++},h.id))})]},d))})};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let bR,BR;function OR(){return{geminiUrl:bR,vertexUrl:BR}}function qR(t,e,n,r){var i,o;if(!(t!=null&&t.baseUrl)){const s=OR();return e?(i=s.vertexUrl)!==null&&i!==void 0?i:n:(o=s.geminiUrl)!==null&&o!==void 0?o:r}return t.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class fi{}function J(t,e){const n=/\{([^}]+)\}/g;return t.replace(n,(r,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){const o=e[i];return o!=null?String(o):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function a(t,e,n){for(let o=0;o<e.length-1;o++){const s=e[o];if(s.endsWith("[]")){const u=s.slice(0,-2);if(!(u in t))if(Array.isArray(n))t[u]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${s}`);if(Array.isArray(t[u])){const c=t[u];if(Array.isArray(n))for(let d=0;d<c.length;d++){const h=c[d];a(h,e.slice(o+1),n[d])}else for(const d of c)a(d,e.slice(o+1),n)}return}else if(s.endsWith("[0]")){const u=s.slice(0,-3);u in t||(t[u]=[{}]);const c=t[u];a(c[0],e.slice(o+1),n);return}(!t[s]||typeof t[s]!="object")&&(t[s]={}),t=t[s]}const r=e[e.length-1],i=t[r];if(i!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===i)return;if(typeof i=="object"&&typeof n=="object"&&i!==null&&n!==null)Object.assign(i,n);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else r==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(t,n):t[r]=n}function l(t,e){try{if(e.length===1&&e[0]==="_self")return t;for(let n=0;n<e.length;n++){if(typeof t!="object"||t===null)return;const r=e[n];if(r.endsWith("[]")){const i=r.slice(0,-2);if(i in t){const o=t[i];return Array.isArray(o)?o.map(s=>l(s,e.slice(n+1))):void 0}else return}else t=t[r]}return t}catch(n){if(n instanceof TypeError)return;throw n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Hh(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function GR(t){const e={},n=l(t,["operationName"]);n!=null&&a(e,["operationName"],n);const r=l(t,["resourceName"]);return r!=null&&a(e,["_url","resourceName"],r),e}function $R(t){const e={},n=l(t,["name"]);n!=null&&a(e,["name"],n);const r=l(t,["metadata"]);r!=null&&a(e,["metadata"],r);const i=l(t,["done"]);i!=null&&a(e,["done"],i);const o=l(t,["error"]);o!=null&&a(e,["error"],o);const s=l(t,["response","generateVideoResponse"]);return s!=null&&a(e,["response"],HR(s)),e}function zR(t){const e={},n=l(t,["name"]);n!=null&&a(e,["name"],n);const r=l(t,["metadata"]);r!=null&&a(e,["metadata"],r);const i=l(t,["done"]);i!=null&&a(e,["done"],i);const o=l(t,["error"]);o!=null&&a(e,["error"],o);const s=l(t,["response"]);return s!=null&&a(e,["response"],KR(s)),e}function HR(t){const e={},n=l(t,["generatedSamples"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(s=>WR(s))),a(e,["generatedVideos"],o)}const r=l(t,["raiMediaFilteredCount"]);r!=null&&a(e,["raiMediaFilteredCount"],r);const i=l(t,["raiMediaFilteredReasons"]);return i!=null&&a(e,["raiMediaFilteredReasons"],i),e}function KR(t){const e={},n=l(t,["videos"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(s=>JR(s))),a(e,["generatedVideos"],o)}const r=l(t,["raiMediaFilteredCount"]);r!=null&&a(e,["raiMediaFilteredCount"],r);const i=l(t,["raiMediaFilteredReasons"]);return i!=null&&a(e,["raiMediaFilteredReasons"],i),e}function WR(t){const e={},n=l(t,["_self"]);return n!=null&&a(e,["video"],XR(n)),e}function JR(t){const e={},n=l(t,["_self"]);return n!=null&&a(e,["video"],ZR(n)),e}function QR(t){const e={},n=l(t,["operationName"]);return n!=null&&a(e,["_url","operationName"],n),e}function YR(t){const e={},n=l(t,["operationName"]);return n!=null&&a(e,["_url","operationName"],n),e}function XR(t){const e={},n=l(t,["video","uri"]);n!=null&&a(e,["uri"],n);const r=l(t,["video","encodedVideo"]);r!=null&&a(e,["videoBytes"],Hh(r));const i=l(t,["encoding"]);return i!=null&&a(e,["mimeType"],i),e}function ZR(t){const e={},n=l(t,["gcsUri"]);n!=null&&a(e,["uri"],n);const r=l(t,["bytesBase64Encoded"]);r!=null&&a(e,["videoBytes"],Hh(r));const i=l(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var ry;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(ry||(ry={}));var iy;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(iy||(iy={}));var tr;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(tr||(tr={}));var oy;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT"})(oy||(oy={}));var sy;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(sy||(sy={}));var ly;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(ly||(ly={}));var ay;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(ay||(ay={}));var uy;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(uy||(uy={}));var cy;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(cy||(cy={}));var dy;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(dy||(dy={}));var fy;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL"})(fy||(fy={}));var hy;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(hy||(hy={}));var py;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(py||(py={}));var my;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY"})(my||(my={}));var gy;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(gy||(gy={}));var fu;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(fu||(fu={}));var yy;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(yy||(yy={}));var hf;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(hf||(hf={}));var _y;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(_y||(_y={}));var vy;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(vy||(vy={}));var Ty;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(Ty||(Ty={}));var Ey;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(Ey||(Ey={}));var Iy;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Iy||(Iy={}));var Cy;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Cy||(Cy={}));var wy;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(wy||(wy={}));var Sy;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(Sy||(Sy={}));var Ay;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(Ay||(Ay={}));var Ry;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(Ry||(Ry={}));var xy;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(xy||(xy={}));var Py;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Py||(Py={}));var Dy;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Dy||(Dy={}));var My;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(My||(My={}));var ky;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(ky||(ky={}));var Ny;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(Ny||(Ny={}));var Vy;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(Vy||(Vy={}));var Ly;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(Ly||(Ly={}));var Fy;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(Fy||(Fy={}));var Uy;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(Uy||(Uy={}));var by;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(by||(by={}));var By;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(By||(By={}));var Oy;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Oy||(Oy={}));var qy;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(qy||(qy={}));var Gy;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(Gy||(Gy={}));var $y;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})($y||($y={}));var zy;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(zy||(zy={}));var Hy;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Hy||(Hy={}));var Ky;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(Ky||(Ky={}));var Wi;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(Wi||(Wi={}));class pf{constructor(e){const n={};for(const r of e.headers.entries())n[r[0]]=r[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}}class es{get text(){var e,n,r,i,o,s,u,c;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",h=!1;const p=[];for(const m of(c=(u=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||u===void 0?void 0:u.parts)!==null&&c!==void 0?c:[]){for(const[_,S]of Object.entries(m))_!=="text"&&_!=="thought"&&(S!==null||S!==void 0)&&p.push(_);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;h=!0,d+=m.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),h?d:void 0}get data(){var e,n,r,i,o,s,u,c;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="";const h=[];for(const p of(c=(u=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||u===void 0?void 0:u.parts)!==null&&c!==void 0?c:[]){for(const[m,_]of Object.entries(p))m!=="inlineData"&&(_!==null||_!==void 0)&&h.push(m);p.inlineData&&typeof p.inlineData.data=="string"&&(d+=atob(p.inlineData.data))}return h.length>0&&console.warn(`there are non-data parts ${h} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var e,n,r,i,o,s,u,c;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(c=(u=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||u===void 0?void 0:u.parts)===null||c===void 0?void 0:c.filter(h=>h.functionCall).map(h=>h.functionCall).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var e,n,r,i,o,s,u,c,d;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const h=(c=(u=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||u===void 0?void 0:u.parts)===null||c===void 0?void 0:c.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var e,n,r,i,o,s,u,c,d;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const h=(c=(u=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||u===void 0?void 0:u.parts)===null||c===void 0?void 0:c.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.output}}class Wy{}class Jy{}class jR{}class ex{}class tx{}class nx{}class Qy{}class Yy{}class Xy{}class rx{}class hu{_fromAPIResponse({apiResponse:e,isVertexAI:n}){const r=new hu;let i;const o=e;return n?i=zR(o):i=$R(o),Object.assign(r,i),r}}class Zy{}class jy{}class e_{}class ix{}class ox{}class sx{}class t_{}class lx{get text(){var e,n,r;let i="",o=!1;const s=[];for(const u of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[c,d]of Object.entries(u))c!=="text"&&c!=="thought"&&d!==null&&s.push(c);if(typeof u.text=="string"){if(typeof u.thought=="boolean"&&u.thought)continue;o=!0,i+=u.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?i:void 0}get data(){var e,n,r;let i="";const o=[];for(const s of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[u,c]of Object.entries(s))u!=="inlineData"&&c!==null&&o.push(u);s.inlineData&&typeof s.inlineData.data=="string"&&(i+=atob(s.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class ax{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function de(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function sI(t,e){const n=de(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function lI(t){return Array.isArray(t)?t.map(e=>pu(e)):[pu(t)]}function pu(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function aI(t){const e=pu(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function uI(t){const e=pu(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function n_(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function cI(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>n_(e)):[n_(t)]}function mf(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function r_(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function i_(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function dt(t){if(t==null)throw new Error("ContentUnion is required");return mf(t)?t:{role:"user",parts:cI(t)}}function Kh(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{const r=dt(n);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(t.isVertexAI()){const n=dt(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>dt(n)):[dt(e)]}function Kt(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(r_(t)||i_(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[dt(t)]}const e=[],n=[],r=mf(t[0]);for(const i of t){const o=mf(i);if(o!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)e.push(i);else{if(r_(i)||i_(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(i)}}return r||e.push({role:"user",parts:cI(n)}),e}function ux(t,e){t.includes("null")&&(e.nullable=!0);const n=t.filter(r=>r!=="null");if(n.length===1)e.type=Object.values(tr).includes(n[0].toUpperCase())?n[0].toUpperCase():tr.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const r of n)e.anyOf.push({type:Object.values(tr).includes(r.toUpperCase())?r.toUpperCase():tr.TYPE_UNSPECIFIED})}}function eo(t){const e={},n=["items"],r=["anyOf"],i=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const o=t.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(e.nullable=!0,t=o[1]):o[1].type==="null"&&(e.nullable=!0,t=o[0])),t.type instanceof Array&&ux(t.type,e);for(const[s,u]of Object.entries(t))if(u!=null)if(s=="type"){if(u==="null")throw new Error("type: null can not be the only possible type for the field.");if(u instanceof Array)continue;e.type=Object.values(tr).includes(u.toUpperCase())?u.toUpperCase():tr.TYPE_UNSPECIFIED}else if(n.includes(s))e[s]=eo(u);else if(r.includes(s)){const c=[];for(const d of u){if(d.type=="null"){e.nullable=!0;continue}c.push(eo(d))}e[s]=c}else if(i.includes(s)){const c={};for(const[d,h]of Object.entries(u))c[d]=eo(h);e[s]=c}else{if(s==="additionalProperties")continue;e[s]=u}return e}function Wh(t){return eo(t)}function Jh(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function Qh(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function So(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=eo(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=eo(e.response));return t}function Ao(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const n of t)e.push(n);return e}function cx(t,e,n,r=1){const i=!e.startsWith(`${n}/`)&&e.split("/").length===r;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:i?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:i?`${n}/${e}`:e}function Bn(t,e){if(typeof e!="string")throw new Error("name must be a string");return cx(t,e,"cachedContents")}function dI(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function hi(t){return Hh(t)}function dx(t){return t!=null&&typeof t=="object"&&"name"in t}function fx(t){return t!=null&&typeof t=="object"&&"video"in t}function hx(t){return t!=null&&typeof t=="object"&&"uri"in t}function fI(t){var e;let n;if(dx(t)&&(n=t.name),!(hx(t)&&(n=t.uri,n===void 0))&&!(fx(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const i=n.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${n}`);n=i[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function hI(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function pI(t){for(const e of["models","tunedModels","publisherModels"])if(px(t,e))return t[e];return[]}function px(t,e){return t!==null&&typeof t=="object"&&e in t}function mx(t,e={}){const n=t,r={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(r.responseJsonSchema=n.outputSchema),e.behavior&&(r.behavior=e.behavior),{functionDeclarations:[r]}}function gx(t,e={}){const n=[],r=new Set;for(const i of t){const o=i.name;if(r.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);r.add(o);const s=mx(i,e);s.functionDeclarations&&n.push(...s.functionDeclarations)}return{functionDeclarations:n}}function mI(t,e){let n;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))n={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))n={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;const r=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,i=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(i>0||r!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||i!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function yx(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function gI(t){if(typeof t!="object"||t===null)return{};const e=t,n=e.inlinedResponses;if(typeof n!="object"||n===null)return t;const i=n.inlinedResponses;if(!Array.isArray(i)||i.length===0)return t;let o=!1;for(const s of i){if(typeof s!="object"||s===null)continue;const c=s.response;if(typeof c!="object"||c===null)continue;if(c.embedding!==void 0){o=!0;break}}return o&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function Ro(t,e){const n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function yI(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function _x(t){const e={},n=l(t,["responsesFile"]);n!=null&&a(e,["fileName"],n);const r=l(t,["inlinedResponses","inlinedResponses"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>iP(s))),a(e,["inlinedResponses"],o)}const i=l(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>nP(s))),a(e,["inlinedEmbedContentResponses"],o)}return e}function vx(t){const e={},n=l(t,["predictionsFormat"]);n!=null&&a(e,["format"],n);const r=l(t,["gcsDestination","outputUriPrefix"]);r!=null&&a(e,["gcsUri"],r);const i=l(t,["bigqueryDestination","outputUri"]);return i!=null&&a(e,["bigqueryUri"],i),e}function Tx(t){const e={},n=l(t,["format"]);n!=null&&a(e,["predictionsFormat"],n);const r=l(t,["gcsUri"]);r!=null&&a(e,["gcsDestination","outputUriPrefix"],r);const i=l(t,["bigqueryUri"]);if(i!=null&&a(e,["bigqueryDestination","outputUri"],i),l(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(l(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(l(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Pi(t){const e={},n=l(t,["name"]);n!=null&&a(e,["name"],n);const r=l(t,["metadata","displayName"]);r!=null&&a(e,["displayName"],r);const i=l(t,["metadata","state"]);i!=null&&a(e,["state"],yI(i));const o=l(t,["metadata","createTime"]);o!=null&&a(e,["createTime"],o);const s=l(t,["metadata","endTime"]);s!=null&&a(e,["endTime"],s);const u=l(t,["metadata","updateTime"]);u!=null&&a(e,["updateTime"],u);const c=l(t,["metadata","model"]);c!=null&&a(e,["model"],c);const d=l(t,["metadata","output"]);return d!=null&&a(e,["dest"],_x(gI(d))),e}function gf(t){const e={},n=l(t,["name"]);n!=null&&a(e,["name"],n);const r=l(t,["displayName"]);r!=null&&a(e,["displayName"],r);const i=l(t,["state"]);i!=null&&a(e,["state"],yI(i));const o=l(t,["error"]);o!=null&&a(e,["error"],vI(o));const s=l(t,["createTime"]);s!=null&&a(e,["createTime"],s);const u=l(t,["startTime"]);u!=null&&a(e,["startTime"],u);const c=l(t,["endTime"]);c!=null&&a(e,["endTime"],c);const d=l(t,["updateTime"]);d!=null&&a(e,["updateTime"],d);const h=l(t,["model"]);h!=null&&a(e,["model"],h);const p=l(t,["inputConfig"]);p!=null&&a(e,["src"],Ex(p));const m=l(t,["outputConfig"]);return m!=null&&a(e,["dest"],vx(gI(m))),e}function Ex(t){const e={},n=l(t,["instancesFormat"]);n!=null&&a(e,["format"],n);const r=l(t,["gcsSource","uris"]);r!=null&&a(e,["gcsUri"],r);const i=l(t,["bigquerySource","inputUri"]);return i!=null&&a(e,["bigqueryUri"],i),e}function Ix(t,e){const n={};if(l(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(l(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(l(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const r=l(e,["fileName"]);r!=null&&a(n,["fileName"],r);const i=l(e,["inlinedRequests"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>rP(t,s))),a(n,["requests","requests"],o)}return n}function Cx(t){const e={},n=l(t,["format"]);n!=null&&a(e,["instancesFormat"],n);const r=l(t,["gcsUri"]);r!=null&&a(e,["gcsSource","uris"],r);const i=l(t,["bigqueryUri"]);if(i!=null&&a(e,["bigquerySource","inputUri"],i),l(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(l(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function wx(t){const e={},n=l(t,["data"]);n!=null&&a(e,["data"],n);const r=l(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function Sx(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["data"]);n!=null&&a(e,["data"],n);const r=l(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function Ax(t,e){const n={},r=l(e,["name"]);return r!=null&&a(n,["_url","name"],Ro(t,r)),n}function Rx(t,e){const n={},r=l(e,["name"]);return r!=null&&a(n,["_url","name"],Ro(t,r)),n}function xx(t){const e={},n=l(t,["content"]);n!=null&&a(e,["content"],Mx(n));const r=l(t,["citationMetadata"]);r!=null&&a(e,["citationMetadata"],Px(r));const i=l(t,["tokenCount"]);i!=null&&a(e,["tokenCount"],i);const o=l(t,["finishReason"]);o!=null&&a(e,["finishReason"],o);const s=l(t,["urlContextMetadata"]);s!=null&&a(e,["urlContextMetadata"],RP(s));const u=l(t,["avgLogprobs"]);u!=null&&a(e,["avgLogprobs"],u);const c=l(t,["groundingMetadata"]);c!=null&&a(e,["groundingMetadata"],c);const d=l(t,["index"]);d!=null&&a(e,["index"],d);const h=l(t,["logprobsResult"]);h!=null&&a(e,["logprobsResult"],h);const p=l(t,["safetyRatings"]);return p!=null&&a(e,["safetyRatings"],p),e}function Px(t){const e={},n=l(t,["citationSources"]);return n!=null&&a(e,["citations"],n),e}function Dx(t){const e={},n=l(t,["values"]);return n!=null&&a(e,["values"],n),e}function Mx(t){const e={},n=l(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>pP(o))),a(e,["parts"],i)}const r=l(t,["role"]);return r!=null&&a(e,["role"],r),e}function _I(t){const e={},n=l(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>mP(o))),a(e,["parts"],i)}const r=l(t,["role"]);return r!=null&&a(e,["role"],r),e}function kx(t,e){const n={},r=l(t,["displayName"]);if(e!==void 0&&r!=null&&a(e,["batch","displayName"],r),l(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function Nx(t,e){const n={},r=l(t,["displayName"]);e!==void 0&&r!=null&&a(e,["displayName"],r);const i=l(t,["dest"]);return e!==void 0&&i!=null&&a(e,["outputConfig"],Tx(yx(i))),n}function sd(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["_url","model"],de(t,r));const i=l(e,["src"]);i!=null&&a(n,["batch","inputConfig"],Ix(t,mI(t,i)));const o=l(e,["config"]);return o!=null&&kx(o,n),n}function Vx(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["model"],de(t,r));const i=l(e,["src"]);i!=null&&a(n,["inputConfig"],Cx(mI(t,i)));const o=l(e,["config"]);return o!=null&&Nx(o,n),n}function Lx(t,e){const n={},r=l(t,["displayName"]);return e!==void 0&&r!=null&&a(e,["batch","displayName"],r),n}function ld(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["_url","model"],de(t,r));const i=l(e,["src"]);i!=null&&a(n,["batch","inputConfig"],$x(t,i));const o=l(e,["config"]);return o!=null&&Lx(o,n),n}function Fx(t,e){const n={},r=l(e,["name"]);return r!=null&&a(n,["_url","name"],Ro(t,r)),n}function Ux(t,e){const n={},r=l(e,["name"]);return r!=null&&a(n,["_url","name"],Ro(t,r)),n}function bx(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["name"]);r!=null&&a(e,["name"],r);const i=l(t,["done"]);i!=null&&a(e,["done"],i);const o=l(t,["error"]);return o!=null&&a(e,["error"],Yh(o)),e}function Bx(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["name"]);r!=null&&a(e,["name"],r);const i=l(t,["done"]);i!=null&&a(e,["done"],i);const o=l(t,["error"]);return o!=null&&a(e,["error"],vI(o)),e}function Ox(t){const e={},n=l(t,["mode"]);n!=null&&a(e,["mode"],n);const r=l(t,["dynamicThreshold"]);return r!=null&&a(e,["dynamicThreshold"],r),e}function qx(t,e){const n={},r=l(e,["contents"]);r!=null&&a(n,["requests[]","request","content"],Kh(t,r));const i=l(e,["config"]);return i!=null&&a(n,["config"],Gx(i,n)),n}function Gx(t,e){const n={},r=l(t,["taskType"]);e!==void 0&&r!=null&&a(e,["requests[]","taskType"],r);const i=l(t,["title"]);e!==void 0&&i!=null&&a(e,["requests[]","title"],i);const o=l(t,["outputDimensionality"]);if(e!==void 0&&o!=null&&a(e,["requests[]","outputDimensionality"],o),l(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(l(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function $x(t,e){const n={},r=l(e,["fileName"]);r!=null&&a(n,["file_name"],r);const i=l(e,["inlinedRequests"]);return i!=null&&a(n,["requests"],qx(t,i)),n}function zx(t){const e={},n=l(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function Hx(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function Kx(t){const e={},n=l(t,["id"]);n!=null&&a(e,["id"],n);const r=l(t,["args"]);r!=null&&a(e,["args"],r);const i=l(t,["name"]);return i!=null&&a(e,["name"],i),e}function Wx(t){const e={},n=l(t,["id"]);n!=null&&a(e,["id"],n);const r=l(t,["args"]);r!=null&&a(e,["args"],r);const i=l(t,["name"]);return i!=null&&a(e,["name"],i),e}function Jx(t){const e={},n=l(t,["mode"]);n!=null&&a(e,["mode"],n);const r=l(t,["allowedFunctionNames"]);return r!=null&&a(e,["allowedFunctionNames"],r),e}function Qx(t){const e={},n=l(t,["behavior"]);n!=null&&a(e,["behavior"],n);const r=l(t,["description"]);r!=null&&a(e,["description"],r);const i=l(t,["name"]);i!=null&&a(e,["name"],i);const o=l(t,["parameters"]);o!=null&&a(e,["parameters"],o);const s=l(t,["parametersJsonSchema"]);s!=null&&a(e,["parametersJsonSchema"],s);const u=l(t,["response"]);u!=null&&a(e,["response"],u);const c=l(t,["responseJsonSchema"]);return c!=null&&a(e,["responseJsonSchema"],c),e}function Yx(t,e,n){const r={},i=l(e,["systemInstruction"]);n!==void 0&&i!=null&&a(n,["systemInstruction"],_I(dt(i)));const o=l(e,["temperature"]);o!=null&&a(r,["temperature"],o);const s=l(e,["topP"]);s!=null&&a(r,["topP"],s);const u=l(e,["topK"]);u!=null&&a(r,["topK"],u);const c=l(e,["candidateCount"]);c!=null&&a(r,["candidateCount"],c);const d=l(e,["maxOutputTokens"]);d!=null&&a(r,["maxOutputTokens"],d);const h=l(e,["stopSequences"]);h!=null&&a(r,["stopSequences"],h);const p=l(e,["responseLogprobs"]);p!=null&&a(r,["responseLogprobs"],p);const m=l(e,["logprobs"]);m!=null&&a(r,["logprobs"],m);const _=l(e,["presencePenalty"]);_!=null&&a(r,["presencePenalty"],_);const S=l(e,["frequencyPenalty"]);S!=null&&a(r,["frequencyPenalty"],S);const R=l(e,["seed"]);R!=null&&a(r,["seed"],R);const M=l(e,["responseMimeType"]);M!=null&&a(r,["responseMimeType"],M);const I=l(e,["responseSchema"]);I!=null&&a(r,["responseSchema"],vP(Wh(I)));const T=l(e,["responseJsonSchema"]);if(T!=null&&a(r,["responseJsonSchema"],T),l(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(l(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const C=l(e,["safetySettings"]);if(n!==void 0&&C!=null){let D=C;Array.isArray(D)&&(D=D.map(N=>_P(N))),a(n,["safetySettings"],D)}const k=l(e,["tools"]);if(n!==void 0&&k!=null){let D=Ao(k);Array.isArray(D)&&(D=D.map(N=>AP(So(N)))),a(n,["tools"],D)}const F=l(e,["toolConfig"]);if(n!==void 0&&F!=null&&a(n,["toolConfig"],SP(F)),l(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const b=l(e,["cachedContent"]);n!==void 0&&b!=null&&a(n,["cachedContent"],Bn(t,b));const A=l(e,["responseModalities"]);A!=null&&a(r,["responseModalities"],A);const v=l(e,["mediaResolution"]);v!=null&&a(r,["mediaResolution"],v);const w=l(e,["speechConfig"]);if(w!=null&&a(r,["speechConfig"],IP(Jh(w))),l(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const x=l(e,["thinkingConfig"]);return x!=null&&a(r,["thinkingConfig"],CP(x)),r}function Xx(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["candidates"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(d=>xx(d))),a(e,["candidates"],c)}const i=l(t,["modelVersion"]);i!=null&&a(e,["modelVersion"],i);const o=l(t,["promptFeedback"]);o!=null&&a(e,["promptFeedback"],o);const s=l(t,["responseId"]);s!=null&&a(e,["responseId"],s);const u=l(t,["usageMetadata"]);return u!=null&&a(e,["usageMetadata"],u),e}function Zx(t,e){const n={},r=l(e,["name"]);return r!=null&&a(n,["_url","name"],Ro(t,r)),n}function jx(t,e){const n={},r=l(e,["name"]);return r!=null&&a(n,["_url","name"],Ro(t,r)),n}function eP(t){const e={},n=l(t,["dynamicRetrievalConfig"]);return n!=null&&a(e,["dynamicRetrievalConfig"],Ox(n)),e}function tP(t){const e={},n=l(t,["timeRangeFilter"]);if(n!=null&&a(e,["timeRangeFilter"],oP(n)),l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function nP(t){const e={},n=l(t,["response"]);n!=null&&a(e,["response"],TP(n));const r=l(t,["error"]);return r!=null&&a(e,["error"],Yh(r)),e}function rP(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["request","model"],de(t,r));const i=l(e,["contents"]);if(i!=null){let s=Kt(i);Array.isArray(s)&&(s=s.map(u=>_I(u))),a(n,["request","contents"],s)}const o=l(e,["config"]);return o!=null&&a(n,["request","generationConfig"],Yx(t,o,n)),n}function iP(t){const e={},n=l(t,["response"]);n!=null&&a(e,["response"],Xx(n));const r=l(t,["error"]);return r!=null&&a(e,["error"],Yh(r)),e}function oP(t){const e={},n=l(t,["startTime"]);n!=null&&a(e,["startTime"],n);const r=l(t,["endTime"]);return r!=null&&a(e,["endTime"],r),e}function Yh(t){const e={},n=l(t,["details"]);n!=null&&a(e,["details"],n);const r=l(t,["code"]);r!=null&&a(e,["code"],r);const i=l(t,["message"]);return i!=null&&a(e,["message"],i),e}function vI(t){const e={},n=l(t,["details"]);n!=null&&a(e,["details"],n);const r=l(t,["code"]);r!=null&&a(e,["code"],r);const i=l(t,["message"]);return i!=null&&a(e,["message"],i),e}function sP(t){const e={},n=l(t,["latitude"]);n!=null&&a(e,["latitude"],n);const r=l(t,["longitude"]);return r!=null&&a(e,["longitude"],r),e}function lP(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&a(e,["_query","pageSize"],r);const i=l(t,["pageToken"]);if(e!==void 0&&i!=null&&a(e,["_query","pageToken"],i),l(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function aP(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&a(e,["_query","pageSize"],r);const i=l(t,["pageToken"]);e!==void 0&&i!=null&&a(e,["_query","pageToken"],i);const o=l(t,["filter"]);return e!==void 0&&o!=null&&a(e,["_query","filter"],o),n}function uP(t){const e={},n=l(t,["config"]);return n!=null&&lP(n,e),e}function cP(t){const e={},n=l(t,["config"]);return n!=null&&aP(n,e),e}function dP(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&a(e,["nextPageToken"],r);const i=l(t,["operations"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>Pi(s))),a(e,["batchJobs"],o)}return e}function fP(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&a(e,["nextPageToken"],r);const i=l(t,["batchPredictionJobs"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>gf(s))),a(e,["batchJobs"],o)}return e}function hP(t){const e={},n=l(t,["speakerVoiceConfigs"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>EP(i))),a(e,["speakerVoiceConfigs"],r)}return e}function pP(t){const e={},n=l(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],DP(n));const r=l(t,["thought"]);r!=null&&a(e,["thought"],r);const i=l(t,["inlineData"]);i!=null&&a(e,["inlineData"],wx(i));const o=l(t,["fileData"]);o!=null&&a(e,["fileData"],zx(o));const s=l(t,["thoughtSignature"]);s!=null&&a(e,["thoughtSignature"],s);const u=l(t,["functionCall"]);u!=null&&a(e,["functionCall"],Kx(u));const c=l(t,["codeExecutionResult"]);c!=null&&a(e,["codeExecutionResult"],c);const d=l(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=l(t,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const p=l(t,["text"]);return p!=null&&a(e,["text"],p),e}function mP(t){const e={},n=l(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],MP(n));const r=l(t,["thought"]);r!=null&&a(e,["thought"],r);const i=l(t,["inlineData"]);i!=null&&a(e,["inlineData"],Sx(i));const o=l(t,["fileData"]);o!=null&&a(e,["fileData"],Hx(o));const s=l(t,["thoughtSignature"]);s!=null&&a(e,["thoughtSignature"],s);const u=l(t,["functionCall"]);u!=null&&a(e,["functionCall"],Wx(u));const c=l(t,["codeExecutionResult"]);c!=null&&a(e,["codeExecutionResult"],c);const d=l(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=l(t,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const p=l(t,["text"]);return p!=null&&a(e,["text"],p),e}function gP(t){const e={},n=l(t,["voiceName"]);return n!=null&&a(e,["voiceName"],n),e}function yP(t){const e={},n=l(t,["latLng"]);n!=null&&a(e,["latLng"],sP(n));const r=l(t,["languageCode"]);return r!=null&&a(e,["languageCode"],r),e}function _P(t){const e={};if(l(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=l(t,["category"]);n!=null&&a(e,["category"],n);const r=l(t,["threshold"]);return r!=null&&a(e,["threshold"],r),e}function vP(t){const e={},n=l(t,["anyOf"]);n!=null&&a(e,["anyOf"],n);const r=l(t,["default"]);r!=null&&a(e,["default"],r);const i=l(t,["description"]);i!=null&&a(e,["description"],i);const o=l(t,["enum"]);o!=null&&a(e,["enum"],o);const s=l(t,["example"]);s!=null&&a(e,["example"],s);const u=l(t,["format"]);u!=null&&a(e,["format"],u);const c=l(t,["items"]);c!=null&&a(e,["items"],c);const d=l(t,["maxItems"]);d!=null&&a(e,["maxItems"],d);const h=l(t,["maxLength"]);h!=null&&a(e,["maxLength"],h);const p=l(t,["maxProperties"]);p!=null&&a(e,["maxProperties"],p);const m=l(t,["maximum"]);m!=null&&a(e,["maximum"],m);const _=l(t,["minItems"]);_!=null&&a(e,["minItems"],_);const S=l(t,["minLength"]);S!=null&&a(e,["minLength"],S);const R=l(t,["minProperties"]);R!=null&&a(e,["minProperties"],R);const M=l(t,["minimum"]);M!=null&&a(e,["minimum"],M);const I=l(t,["nullable"]);I!=null&&a(e,["nullable"],I);const T=l(t,["pattern"]);T!=null&&a(e,["pattern"],T);const C=l(t,["properties"]);C!=null&&a(e,["properties"],C);const k=l(t,["propertyOrdering"]);k!=null&&a(e,["propertyOrdering"],k);const F=l(t,["required"]);F!=null&&a(e,["required"],F);const b=l(t,["title"]);b!=null&&a(e,["title"],b);const A=l(t,["type"]);return A!=null&&a(e,["type"],A),e}function TP(t){const e={},n=l(t,["embedding"]);n!=null&&a(e,["embedding"],Dx(n));const r=l(t,["tokenCount"]);return r!=null&&a(e,["tokenCount"],r),e}function EP(t){const e={},n=l(t,["speaker"]);n!=null&&a(e,["speaker"],n);const r=l(t,["voiceConfig"]);return r!=null&&a(e,["voiceConfig"],TI(r)),e}function IP(t){const e={},n=l(t,["voiceConfig"]);n!=null&&a(e,["voiceConfig"],TI(n));const r=l(t,["multiSpeakerVoiceConfig"]);r!=null&&a(e,["multiSpeakerVoiceConfig"],hP(r));const i=l(t,["languageCode"]);return i!=null&&a(e,["languageCode"],i),e}function CP(t){const e={},n=l(t,["includeThoughts"]);n!=null&&a(e,["includeThoughts"],n);const r=l(t,["thinkingBudget"]);return r!=null&&a(e,["thinkingBudget"],r),e}function wP(t){const e={},n=l(t,["environment"]);n!=null&&a(e,["environment"],n);const r=l(t,["excludedPredefinedFunctions"]);return r!=null&&a(e,["excludedPredefinedFunctions"],r),e}function SP(t){const e={},n=l(t,["functionCallingConfig"]);n!=null&&a(e,["functionCallingConfig"],Jx(n));const r=l(t,["retrievalConfig"]);return r!=null&&a(e,["retrievalConfig"],yP(r)),e}function AP(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let c=n;Array.isArray(c)&&(c=c.map(d=>Qx(d))),a(e,["functionDeclarations"],c)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearch"]);r!=null&&a(e,["googleSearch"],tP(r));const i=l(t,["googleSearchRetrieval"]);if(i!=null&&a(e,["googleSearchRetrieval"],eP(i)),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(l(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");l(t,["urlContext"])!=null&&a(e,["urlContext"],xP());const s=l(t,["computerUse"]);s!=null&&a(e,["computerUse"],wP(s));const u=l(t,["codeExecution"]);return u!=null&&a(e,["codeExecution"],u),e}function RP(t){const e={},n=l(t,["urlMetadata"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>PP(i))),a(e,["urlMetadata"],r)}return e}function xP(){return{}}function PP(t){const e={},n=l(t,["retrievedUrl"]);n!=null&&a(e,["retrievedUrl"],n);const r=l(t,["urlRetrievalStatus"]);return r!=null&&a(e,["urlRetrievalStatus"],r),e}function DP(t){const e={},n=l(t,["fps"]);n!=null&&a(e,["fps"],n);const r=l(t,["endOffset"]);r!=null&&a(e,["endOffset"],r);const i=l(t,["startOffset"]);return i!=null&&a(e,["startOffset"],i),e}function MP(t){const e={},n=l(t,["fps"]);n!=null&&a(e,["fps"],n);const r=l(t,["endOffset"]);r!=null&&a(e,["endOffset"],r);const i=l(t,["startOffset"]);return i!=null&&a(e,["startOffset"],i),e}function TI(t){const e={},n=l(t,["prebuiltVoiceConfig"]);return n!=null&&a(e,["prebuiltVoiceConfig"],gP(n)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Zr;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(Zr||(Zr={}));class yl{constructor(e,n,r,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,r,i)}init(e,n,r){var i,o;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let s={config:{}};!r||Object.keys(r).length===0?s={config:{}}:typeof r=="object"?s=Object.assign({},r):s=r,s.config&&(s.config.pageToken=n.nextPageToken),this.paramsInternal=s,this.pageInternalSize=(o=(i=s.config)===null||i===void 0?void 0:i.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class kP extends fi{constructor(e){super(),this.apiClient=e,this.create=async n=>{var r,i;if(this.apiClient.isVertexAI())return n.config=this.formatDestination(n.src,n.config),this.createInternal(n);const o=n.src;if(!(Array.isArray(n.src)||o.inlinedRequests!==void 0))return this.createInternal(n);const u=this.createInlinedGenerateContentRequest(n),c=u.path,d=u.body,h=sd(this.apiClient,n)._query||{};return this.apiClient.request({path:c,queryParams:h,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=n.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=n.config)===null||i===void 0?void 0:i.abortSignal}).then(m=>m.json()).then(m=>Pi(m))},this.createEmbeddings=async n=>{var r,i;if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");if(!(n.src.inlinedRequests!==void 0))return this.createEmbeddingsInternal(n);const u=this.createInlinedEmbedContentRequest(n),c=u.path,d=u.body,h=ld(this.apiClient,n)._query||{};return this.apiClient.request({path:c,queryParams:h,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=n.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(i=n.config)===null||i===void 0?void 0:i.abortSignal}).then(m=>m.json()).then(m=>Pi(m))},this.list=async(n={})=>new yl(Zr.PAGED_ITEM_BATCH_JOBS,r=>this.listInternal(r),await this.listInternal(n),n)}createInlinedGenerateContentRequest(e){const n=sd(this.apiClient,e),r=n._url,i=J("{model}:batchGenerateContent",r),u=n.batch.inputConfig.requests,c=u.requests,d=[];for(const h of c){const p=Object.assign({},h);if(p.systemInstruction){const m=p.systemInstruction;delete p.systemInstruction;const _=p.request;_.systemInstruction=m,p.request=_}d.push(p)}return u.requests=d,delete n.config,delete n._url,delete n._query,{path:i,body:n}}createInlinedEmbedContentRequest(e){const n=ld(this.apiClient,e),r=n._url,i=J("{model}:asyncBatchEmbedContent",r),u=n.batch.inputConfig.requests,c=u.requests,d=[];delete u.config;for(const h of c){const p=Object.assign({},h),m=p.request;for(const _ in p)_!=="request"&&(m[_]=p[_],delete p[_]);d.push(p)}return u.requests=d,delete n.config,delete n._url,delete n._query,{path:i,body:n}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,n){const r=n?Object.assign({},n):{},i=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${i}`),r.dest===void 0){const o=this.getGcsUri(e),s=this.getBigqueryUri(e);if(o)o.endsWith(".jsonl")?r.dest=`${o.slice(0,-6)}/dest`:r.dest=`${o}_dest_${i}`;else if(s)r.dest=`${s}_dest_${i}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=Vx(this.apiClient,e);return u=J("batchPredictionJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>gf(h))}else{const d=sd(this.apiClient,e);return u=J("{model}:batchGenerateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>Pi(h))}}async createEmbeddingsInternal(e){var n,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=ld(this.apiClient,e);return o=J("{model}:asyncBatchEmbedContent",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),i.then(c=>Pi(c))}}async get(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=jx(this.apiClient,e);return u=J("batchPredictionJobs/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>gf(h))}else{const d=Zx(this.apiClient,e);return u=J("batches/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>Pi(h))}}async cancel(e){var n,r,i,o;let s="",u={};if(this.apiClient.isVertexAI()){const c=Rx(this.apiClient,e);s=J("batchPredictionJobs/{name}:cancel",c._url),u=c._query,delete c._url,delete c._query,await this.apiClient.request({path:s,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{const c=Ax(this.apiClient,e);s=J("batches/{name}:cancel",c._url),u=c._query,delete c._url,delete c._query,await this.apiClient.request({path:s,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=cP(e);return u=J("batchPredictionJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=fP(h),m=new t_;return Object.assign(m,p),m})}else{const d=uP(e);return u=J("batches",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=dP(h),m=new t_;return Object.assign(m,p),m})}}async delete(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=Ux(this.apiClient,e);return u=J("batchPredictionJobs/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>Bx(h))}else{const d=Fx(this.apiClient,e);return u=J("batches/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>bx(h))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function NP(t){const e={},n=l(t,["apiKeyString"]);return n!=null&&a(e,["apiKeyString"],n),e}function VP(t){const e={},n=l(t,["apiKeyConfig"]);n!=null&&a(e,["apiKeyConfig"],NP(n));const r=l(t,["authType"]);r!=null&&a(e,["authType"],r);const i=l(t,["googleServiceAccountConfig"]);i!=null&&a(e,["googleServiceAccountConfig"],i);const o=l(t,["httpBasicAuthConfig"]);o!=null&&a(e,["httpBasicAuthConfig"],o);const s=l(t,["oauthConfig"]);s!=null&&a(e,["oauthConfig"],s);const u=l(t,["oidcConfig"]);return u!=null&&a(e,["oidcConfig"],u),e}function LP(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["data"]);n!=null&&a(e,["data"],n);const r=l(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function FP(t){const e={},n=l(t,["displayName"]);n!=null&&a(e,["displayName"],n);const r=l(t,["data"]);r!=null&&a(e,["data"],r);const i=l(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function Ma(t){const e={},n=l(t,["name"]);n!=null&&a(e,["name"],n);const r=l(t,["displayName"]);r!=null&&a(e,["displayName"],r);const i=l(t,["model"]);i!=null&&a(e,["model"],i);const o=l(t,["createTime"]);o!=null&&a(e,["createTime"],o);const s=l(t,["updateTime"]);s!=null&&a(e,["updateTime"],s);const u=l(t,["expireTime"]);u!=null&&a(e,["expireTime"],u);const c=l(t,["usageMetadata"]);return c!=null&&a(e,["usageMetadata"],c),e}function ka(t){const e={},n=l(t,["name"]);n!=null&&a(e,["name"],n);const r=l(t,["displayName"]);r!=null&&a(e,["displayName"],r);const i=l(t,["model"]);i!=null&&a(e,["model"],i);const o=l(t,["createTime"]);o!=null&&a(e,["createTime"],o);const s=l(t,["updateTime"]);s!=null&&a(e,["updateTime"],s);const u=l(t,["expireTime"]);u!=null&&a(e,["expireTime"],u);const c=l(t,["usageMetadata"]);return c!=null&&a(e,["usageMetadata"],c),e}function o_(t){const e={},n=l(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>vD(o))),a(e,["parts"],i)}const r=l(t,["role"]);return r!=null&&a(e,["role"],r),e}function s_(t){const e={},n=l(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>TD(o))),a(e,["parts"],i)}const r=l(t,["role"]);return r!=null&&a(e,["role"],r),e}function UP(t,e){const n={},r=l(t,["ttl"]);e!==void 0&&r!=null&&a(e,["ttl"],r);const i=l(t,["expireTime"]);e!==void 0&&i!=null&&a(e,["expireTime"],i);const o=l(t,["displayName"]);e!==void 0&&o!=null&&a(e,["displayName"],o);const s=l(t,["contents"]);if(e!==void 0&&s!=null){let h=Kt(s);Array.isArray(h)&&(h=h.map(p=>o_(p))),a(e,["contents"],h)}const u=l(t,["systemInstruction"]);e!==void 0&&u!=null&&a(e,["systemInstruction"],o_(dt(u)));const c=l(t,["tools"]);if(e!==void 0&&c!=null){let h=c;Array.isArray(h)&&(h=h.map(p=>RD(p))),a(e,["tools"],h)}const d=l(t,["toolConfig"]);if(e!==void 0&&d!=null&&a(e,["toolConfig"],SD(d)),l(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function bP(t,e){const n={},r=l(t,["ttl"]);e!==void 0&&r!=null&&a(e,["ttl"],r);const i=l(t,["expireTime"]);e!==void 0&&i!=null&&a(e,["expireTime"],i);const o=l(t,["displayName"]);e!==void 0&&o!=null&&a(e,["displayName"],o);const s=l(t,["contents"]);if(e!==void 0&&s!=null){let p=Kt(s);Array.isArray(p)&&(p=p.map(m=>s_(m))),a(e,["contents"],p)}const u=l(t,["systemInstruction"]);e!==void 0&&u!=null&&a(e,["systemInstruction"],s_(dt(u)));const c=l(t,["tools"]);if(e!==void 0&&c!=null){let p=c;Array.isArray(p)&&(p=p.map(m=>xD(m))),a(e,["tools"],p)}const d=l(t,["toolConfig"]);e!==void 0&&d!=null&&a(e,["toolConfig"],AD(d));const h=l(t,["kmsKeyName"]);return e!==void 0&&h!=null&&a(e,["encryption_spec","kmsKeyName"],h),n}function BP(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["model"],sI(t,r));const i=l(e,["config"]);return i!=null&&UP(i,n),n}function OP(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["model"],sI(t,r));const i=l(e,["config"]);return i!=null&&bP(i,n),n}function qP(t,e){const n={},r=l(e,["name"]);return r!=null&&a(n,["_url","name"],Bn(t,r)),n}function GP(t,e){const n={},r=l(e,["name"]);return r!=null&&a(n,["_url","name"],Bn(t,r)),n}function $P(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&a(e,["sdkHttpResponse"],n),e}function zP(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&a(e,["sdkHttpResponse"],n),e}function HP(t){const e={},n=l(t,["mode"]);n!=null&&a(e,["mode"],n);const r=l(t,["dynamicThreshold"]);return r!=null&&a(e,["dynamicThreshold"],r),e}function KP(t){const e={},n=l(t,["mode"]);n!=null&&a(e,["mode"],n);const r=l(t,["dynamicThreshold"]);return r!=null&&a(e,["dynamicThreshold"],r),e}function WP(t){const e={},n=l(t,["excludeDomains"]);return n!=null&&a(e,["excludeDomains"],n),e}function JP(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function QP(t){const e={},n=l(t,["displayName"]);n!=null&&a(e,["displayName"],n);const r=l(t,["fileUri"]);r!=null&&a(e,["fileUri"],r);const i=l(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function YP(t){const e={},n=l(t,["id"]);n!=null&&a(e,["id"],n);const r=l(t,["args"]);r!=null&&a(e,["args"],r);const i=l(t,["name"]);return i!=null&&a(e,["name"],i),e}function XP(t){const e={},n=l(t,["id"]);n!=null&&a(e,["id"],n);const r=l(t,["args"]);r!=null&&a(e,["args"],r);const i=l(t,["name"]);return i!=null&&a(e,["name"],i),e}function ZP(t){const e={},n=l(t,["mode"]);n!=null&&a(e,["mode"],n);const r=l(t,["allowedFunctionNames"]);return r!=null&&a(e,["allowedFunctionNames"],r),e}function jP(t){const e={},n=l(t,["mode"]);n!=null&&a(e,["mode"],n);const r=l(t,["allowedFunctionNames"]);return r!=null&&a(e,["allowedFunctionNames"],r),e}function eD(t){const e={},n=l(t,["behavior"]);n!=null&&a(e,["behavior"],n);const r=l(t,["description"]);r!=null&&a(e,["description"],r);const i=l(t,["name"]);i!=null&&a(e,["name"],i);const o=l(t,["parameters"]);o!=null&&a(e,["parameters"],o);const s=l(t,["parametersJsonSchema"]);s!=null&&a(e,["parametersJsonSchema"],s);const u=l(t,["response"]);u!=null&&a(e,["response"],u);const c=l(t,["responseJsonSchema"]);return c!=null&&a(e,["responseJsonSchema"],c),e}function tD(t){const e={};if(l(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=l(t,["description"]);n!=null&&a(e,["description"],n);const r=l(t,["name"]);r!=null&&a(e,["name"],r);const i=l(t,["parameters"]);i!=null&&a(e,["parameters"],i);const o=l(t,["parametersJsonSchema"]);o!=null&&a(e,["parametersJsonSchema"],o);const s=l(t,["response"]);s!=null&&a(e,["response"],s);const u=l(t,["responseJsonSchema"]);return u!=null&&a(e,["responseJsonSchema"],u),e}function nD(t,e){const n={},r=l(e,["name"]);return r!=null&&a(n,["_url","name"],Bn(t,r)),n}function rD(t,e){const n={},r=l(e,["name"]);return r!=null&&a(n,["_url","name"],Bn(t,r)),n}function iD(t){const e={},n=l(t,["authConfig"]);return n!=null&&a(e,["authConfig"],VP(n)),e}function oD(t){const e={},n=l(t,["dynamicRetrievalConfig"]);return n!=null&&a(e,["dynamicRetrievalConfig"],HP(n)),e}function sD(t){const e={},n=l(t,["dynamicRetrievalConfig"]);return n!=null&&a(e,["dynamicRetrievalConfig"],KP(n)),e}function lD(t){const e={},n=l(t,["timeRangeFilter"]);if(n!=null&&a(e,["timeRangeFilter"],uD(n)),l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function aD(t){const e={},n=l(t,["timeRangeFilter"]);n!=null&&a(e,["timeRangeFilter"],cD(n));const r=l(t,["excludeDomains"]);return r!=null&&a(e,["excludeDomains"],r),e}function uD(t){const e={},n=l(t,["startTime"]);n!=null&&a(e,["startTime"],n);const r=l(t,["endTime"]);return r!=null&&a(e,["endTime"],r),e}function cD(t){const e={},n=l(t,["startTime"]);n!=null&&a(e,["startTime"],n);const r=l(t,["endTime"]);return r!=null&&a(e,["endTime"],r),e}function dD(t){const e={},n=l(t,["latitude"]);n!=null&&a(e,["latitude"],n);const r=l(t,["longitude"]);return r!=null&&a(e,["longitude"],r),e}function fD(t){const e={},n=l(t,["latitude"]);n!=null&&a(e,["latitude"],n);const r=l(t,["longitude"]);return r!=null&&a(e,["longitude"],r),e}function hD(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&a(e,["_query","pageSize"],r);const i=l(t,["pageToken"]);return e!==void 0&&i!=null&&a(e,["_query","pageToken"],i),n}function pD(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&a(e,["_query","pageSize"],r);const i=l(t,["pageToken"]);return e!==void 0&&i!=null&&a(e,["_query","pageToken"],i),n}function mD(t){const e={},n=l(t,["config"]);return n!=null&&hD(n,e),e}function gD(t){const e={},n=l(t,["config"]);return n!=null&&pD(n,e),e}function yD(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&a(e,["nextPageToken"],r);const i=l(t,["cachedContents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>Ma(s))),a(e,["cachedContents"],o)}return e}function _D(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&a(e,["nextPageToken"],r);const i=l(t,["cachedContents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>ka(s))),a(e,["cachedContents"],o)}return e}function vD(t){const e={},n=l(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],LD(n));const r=l(t,["thought"]);r!=null&&a(e,["thought"],r);const i=l(t,["inlineData"]);i!=null&&a(e,["inlineData"],LP(i));const o=l(t,["fileData"]);o!=null&&a(e,["fileData"],JP(o));const s=l(t,["thoughtSignature"]);s!=null&&a(e,["thoughtSignature"],s);const u=l(t,["functionCall"]);u!=null&&a(e,["functionCall"],YP(u));const c=l(t,["codeExecutionResult"]);c!=null&&a(e,["codeExecutionResult"],c);const d=l(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=l(t,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const p=l(t,["text"]);return p!=null&&a(e,["text"],p),e}function TD(t){const e={},n=l(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],FD(n));const r=l(t,["thought"]);r!=null&&a(e,["thought"],r);const i=l(t,["inlineData"]);i!=null&&a(e,["inlineData"],FP(i));const o=l(t,["fileData"]);o!=null&&a(e,["fileData"],QP(o));const s=l(t,["thoughtSignature"]);s!=null&&a(e,["thoughtSignature"],s);const u=l(t,["functionCall"]);u!=null&&a(e,["functionCall"],XP(u));const c=l(t,["codeExecutionResult"]);c!=null&&a(e,["codeExecutionResult"],c);const d=l(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=l(t,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const p=l(t,["text"]);return p!=null&&a(e,["text"],p),e}function ED(t){const e={},n=l(t,["latLng"]);n!=null&&a(e,["latLng"],dD(n));const r=l(t,["languageCode"]);return r!=null&&a(e,["languageCode"],r),e}function ID(t){const e={},n=l(t,["latLng"]);n!=null&&a(e,["latLng"],fD(n));const r=l(t,["languageCode"]);return r!=null&&a(e,["languageCode"],r),e}function CD(t){const e={},n=l(t,["environment"]);n!=null&&a(e,["environment"],n);const r=l(t,["excludedPredefinedFunctions"]);return r!=null&&a(e,["excludedPredefinedFunctions"],r),e}function wD(t){const e={},n=l(t,["environment"]);n!=null&&a(e,["environment"],n);const r=l(t,["excludedPredefinedFunctions"]);return r!=null&&a(e,["excludedPredefinedFunctions"],r),e}function SD(t){const e={},n=l(t,["functionCallingConfig"]);n!=null&&a(e,["functionCallingConfig"],ZP(n));const r=l(t,["retrievalConfig"]);return r!=null&&a(e,["retrievalConfig"],ED(r)),e}function AD(t){const e={},n=l(t,["functionCallingConfig"]);n!=null&&a(e,["functionCallingConfig"],jP(n));const r=l(t,["retrievalConfig"]);return r!=null&&a(e,["retrievalConfig"],ID(r)),e}function RD(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let c=n;Array.isArray(c)&&(c=c.map(d=>eD(d))),a(e,["functionDeclarations"],c)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearch"]);r!=null&&a(e,["googleSearch"],lD(r));const i=l(t,["googleSearchRetrieval"]);if(i!=null&&a(e,["googleSearchRetrieval"],oD(i)),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(l(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");l(t,["urlContext"])!=null&&a(e,["urlContext"],ND());const s=l(t,["computerUse"]);s!=null&&a(e,["computerUse"],CD(s));const u=l(t,["codeExecution"]);return u!=null&&a(e,["codeExecution"],u),e}function xD(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(m=>tD(m))),a(e,["functionDeclarations"],p)}const r=l(t,["retrieval"]);r!=null&&a(e,["retrieval"],r);const i=l(t,["googleSearch"]);i!=null&&a(e,["googleSearch"],aD(i));const o=l(t,["googleSearchRetrieval"]);o!=null&&a(e,["googleSearchRetrieval"],sD(o));const s=l(t,["enterpriseWebSearch"]);s!=null&&a(e,["enterpriseWebSearch"],WP(s));const u=l(t,["googleMaps"]);u!=null&&a(e,["googleMaps"],iD(u)),l(t,["urlContext"])!=null&&a(e,["urlContext"],VD());const d=l(t,["computerUse"]);d!=null&&a(e,["computerUse"],wD(d));const h=l(t,["codeExecution"]);return h!=null&&a(e,["codeExecution"],h),e}function PD(t,e){const n={},r=l(t,["ttl"]);e!==void 0&&r!=null&&a(e,["ttl"],r);const i=l(t,["expireTime"]);return e!==void 0&&i!=null&&a(e,["expireTime"],i),n}function DD(t,e){const n={},r=l(t,["ttl"]);e!==void 0&&r!=null&&a(e,["ttl"],r);const i=l(t,["expireTime"]);return e!==void 0&&i!=null&&a(e,["expireTime"],i),n}function MD(t,e){const n={},r=l(e,["name"]);r!=null&&a(n,["_url","name"],Bn(t,r));const i=l(e,["config"]);return i!=null&&PD(i,n),n}function kD(t,e){const n={},r=l(e,["name"]);r!=null&&a(n,["_url","name"],Bn(t,r));const i=l(e,["config"]);return i!=null&&DD(i,n),n}function ND(){return{}}function VD(){return{}}function LD(t){const e={},n=l(t,["fps"]);n!=null&&a(e,["fps"],n);const r=l(t,["endOffset"]);r!=null&&a(e,["endOffset"],r);const i=l(t,["startOffset"]);return i!=null&&a(e,["startOffset"],i),e}function FD(t){const e={},n=l(t,["fps"]);n!=null&&a(e,["fps"],n);const r=l(t,["endOffset"]);r!=null&&a(e,["endOffset"],r);const i=l(t,["startOffset"]);return i!=null&&a(e,["startOffset"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class UD extends fi{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new yl(Zr.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(n),n)}async create(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=OP(this.apiClient,e);return u=J("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>ka(h))}else{const d=BP(this.apiClient,e);return u=J("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>Ma(h))}}async get(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=rD(this.apiClient,e);return u=J("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>ka(h))}else{const d=nD(this.apiClient,e);return u=J("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>Ma(h))}}async delete(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=GP(this.apiClient,e);return u=J("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=zP(h),m=new jy;return Object.assign(m,p),m})}else{const d=qP(this.apiClient,e);return u=J("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=$P(h),m=new jy;return Object.assign(m,p),m})}}async update(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=kD(this.apiClient,e);return u=J("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>ka(h))}else{const d=MD(this.apiClient,e);return u=J("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>Ma(h))}}async listInternal(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=gD(e);return u=J("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=_D(h),m=new e_;return Object.assign(m,p),m})}else{const d=mD(e);return u=J("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=yD(h),m=new e_;return Object.assign(m,p),m})}}}function l_(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Te(t){return this instanceof Te?(this.v=t,this):new Te(t)}function to(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,o=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",s),i[Symbol.asyncIterator]=function(){return this},i;function s(_){return function(S){return Promise.resolve(S).then(_,p)}}function u(_,S){r[_]&&(i[_]=function(R){return new Promise(function(M,I){o.push([_,R,M,I])>1||c(_,R)})},S&&(i[_]=S(i[_])))}function c(_,S){try{d(r[_](S))}catch(R){m(o[0][3],R)}}function d(_){_.value instanceof Te?Promise.resolve(_.value.v).then(h,p):m(o[0][2],_)}function h(_){c("next",_)}function p(_){c("throw",_)}function m(_,S){_(S),o.shift(),o.length&&c(o[0][0],o[0][1])}}function As(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof l_=="function"?l_(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=t[o]&&function(s){return new Promise(function(u,c){s=t[o](s),i(u,c,s.done,s.value)})}}function i(o,s,u,c){Promise.resolve(c).then(function(d){o({value:d,done:u})},s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function bD(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:EI(n)}function EI(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function BD(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function a_(t){if(t===void 0||t.length===0)return[];const e=[],n=t.length;let r=0;for(;r<n;)if(t[r].role==="user")e.push(t[r]),r++;else{const i=[];let o=!0;for(;r<n&&t[r].role==="model";)i.push(t[r]),o&&!EI(t[r])&&(o=!1),r++;o?e.push(...i):e.pop()}return e}class OD{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new qD(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class qD{constructor(e,n,r,i={},o=[]){this.apiClient=e,this.modelsModule=n,this.model=r,this.config=i,this.history=o,this.sendPromise=Promise.resolve(),BD(o)}async sendMessage(e){var n;await this.sendPromise;const r=dt(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var o,s,u;const c=await i,d=(s=(o=c.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content,h=c.automaticFunctionCallingHistory,p=this.getHistory(!0).length;let m=[];h!=null&&(m=(u=h.slice(p))!==null&&u!==void 0?u:[]);const _=d?[d]:[];this.recordHistory(r,_,m)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var n;await this.sendPromise;const r=dt(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const o=await i;return this.processStreamResponse(o,r)}getHistory(e=!1){const n=e?a_(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){var r,i;return to(this,arguments,function*(){var s,u,c,d;const h=[];try{for(var p=!0,m=As(e),_;_=yield Te(m.next()),s=_.done,!s;p=!0){d=_.value,p=!1;const S=d;if(bD(S)){const R=(i=(r=S.candidates)===null||r===void 0?void 0:r[0])===null||i===void 0?void 0:i.content;R!==void 0&&h.push(R)}yield yield Te(S)}}catch(S){u={error:S}}finally{try{!p&&!s&&(c=m.return)&&(yield Te(c.call(m)))}finally{if(u)throw u.error}}this.recordHistory(n,h)})}recordHistory(e,n,r){let i=[];n.length>0&&n.every(o=>o.role!==void 0)?i=n:i.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...a_(r)):this.history.push(e),this.history.push(...i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class zu extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,zu.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function GD(t){const e={},n=l(t,["file"]);return n!=null&&a(e,["file"],JD(n)),e}function $D(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&a(e,["sdkHttpResponse"],n),e}function zD(t){const e={},n=l(t,["name"]);return n!=null&&a(e,["_url","file"],fI(n)),e}function HD(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&a(e,["sdkHttpResponse"],n),e}function yf(t){const e={},n=l(t,["name"]);n!=null&&a(e,["name"],n);const r=l(t,["displayName"]);r!=null&&a(e,["displayName"],r);const i=l(t,["mimeType"]);i!=null&&a(e,["mimeType"],i);const o=l(t,["sizeBytes"]);o!=null&&a(e,["sizeBytes"],o);const s=l(t,["createTime"]);s!=null&&a(e,["createTime"],s);const u=l(t,["expirationTime"]);u!=null&&a(e,["expirationTime"],u);const c=l(t,["updateTime"]);c!=null&&a(e,["updateTime"],c);const d=l(t,["sha256Hash"]);d!=null&&a(e,["sha256Hash"],d);const h=l(t,["uri"]);h!=null&&a(e,["uri"],h);const p=l(t,["downloadUri"]);p!=null&&a(e,["downloadUri"],p);const m=l(t,["state"]);m!=null&&a(e,["state"],m);const _=l(t,["source"]);_!=null&&a(e,["source"],_);const S=l(t,["videoMetadata"]);S!=null&&a(e,["videoMetadata"],S);const R=l(t,["error"]);return R!=null&&a(e,["error"],KD(R)),e}function KD(t){const e={},n=l(t,["details"]);n!=null&&a(e,["details"],n);const r=l(t,["message"]);r!=null&&a(e,["message"],r);const i=l(t,["code"]);return i!=null&&a(e,["code"],i),e}function WD(t){const e={},n=l(t,["details"]);n!=null&&a(e,["details"],n);const r=l(t,["message"]);r!=null&&a(e,["message"],r);const i=l(t,["code"]);return i!=null&&a(e,["code"],i),e}function JD(t){const e={},n=l(t,["name"]);n!=null&&a(e,["name"],n);const r=l(t,["displayName"]);r!=null&&a(e,["displayName"],r);const i=l(t,["mimeType"]);i!=null&&a(e,["mimeType"],i);const o=l(t,["sizeBytes"]);o!=null&&a(e,["sizeBytes"],o);const s=l(t,["createTime"]);s!=null&&a(e,["createTime"],s);const u=l(t,["expirationTime"]);u!=null&&a(e,["expirationTime"],u);const c=l(t,["updateTime"]);c!=null&&a(e,["updateTime"],c);const d=l(t,["sha256Hash"]);d!=null&&a(e,["sha256Hash"],d);const h=l(t,["uri"]);h!=null&&a(e,["uri"],h);const p=l(t,["downloadUri"]);p!=null&&a(e,["downloadUri"],p);const m=l(t,["state"]);m!=null&&a(e,["state"],m);const _=l(t,["source"]);_!=null&&a(e,["source"],_);const S=l(t,["videoMetadata"]);S!=null&&a(e,["videoMetadata"],S);const R=l(t,["error"]);return R!=null&&a(e,["error"],WD(R)),e}function QD(t){const e={},n=l(t,["name"]);return n!=null&&a(e,["_url","file"],fI(n)),e}function YD(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&a(e,["_query","pageSize"],r);const i=l(t,["pageToken"]);return e!==void 0&&i!=null&&a(e,["_query","pageToken"],i),n}function XD(t){const e={},n=l(t,["config"]);return n!=null&&YD(n,e),e}function ZD(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&a(e,["nextPageToken"],r);const i=l(t,["files"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>yf(s))),a(e,["files"],o)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class jD extends fi{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new yl(Zr.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>yf(n))}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var n,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=XD(e);return o=J("files",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),i.then(c=>{const d=ZD(c),h=new ix;return Object.assign(h,d),h})}}async createInternal(e){var n,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=GD(e);return o=J("upload/v1beta/files",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),i.then(c=>{const d=$D(c),h=new ox;return Object.assign(h,d),h})}}async get(e){var n,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=QD(e);return o=J("files/{file}",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),i.then(c=>yf(c))}}async delete(e){var n,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=zD(e);return o=J("files/{file}",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),i.then(c=>{const d=HD(c),h=new sx;return Object.assign(h,d),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function eM(){return{}}function tM(){return{}}function nM(){return{}}function rM(){return{}}function iM(t){const e={},n=l(t,["apiKeyString"]);return n!=null&&a(e,["apiKeyString"],n),e}function oM(t){const e={},n=l(t,["data"]);n!=null&&a(e,["data"],n);const r=l(t,["mimeType"]);r!=null&&a(e,["mimeType"],r);const i=l(t,["sourceMetadata"]);return i!=null&&a(e,["sourceMetadata"],QM(i)),e}function u_(){return{}}function c_(){return{}}function sM(t){const e={},n=l(t,["apiKeyConfig"]);n!=null&&a(e,["apiKeyConfig"],iM(n));const r=l(t,["authType"]);r!=null&&a(e,["authType"],r);const i=l(t,["googleServiceAccountConfig"]);i!=null&&a(e,["googleServiceAccountConfig"],i);const o=l(t,["httpBasicAuthConfig"]);o!=null&&a(e,["httpBasicAuthConfig"],o);const s=l(t,["oauthConfig"]);s!=null&&a(e,["oauthConfig"],s);const u=l(t,["oidcConfig"]);return u!=null&&a(e,["oidcConfig"],u),e}function lM(t){const e={},n=l(t,["disabled"]);n!=null&&a(e,["disabled"],n);const r=l(t,["startOfSpeechSensitivity"]);r!=null&&a(e,["startOfSpeechSensitivity"],r);const i=l(t,["endOfSpeechSensitivity"]);i!=null&&a(e,["endOfSpeechSensitivity"],i);const o=l(t,["prefixPaddingMs"]);o!=null&&a(e,["prefixPaddingMs"],o);const s=l(t,["silenceDurationMs"]);return s!=null&&a(e,["silenceDurationMs"],s),e}function aM(t){const e={},n=l(t,["disabled"]);n!=null&&a(e,["disabled"],n);const r=l(t,["startOfSpeechSensitivity"]);r!=null&&a(e,["startOfSpeechSensitivity"],r);const i=l(t,["endOfSpeechSensitivity"]);i!=null&&a(e,["endOfSpeechSensitivity"],i);const o=l(t,["prefixPaddingMs"]);o!=null&&a(e,["prefixPaddingMs"],o);const s=l(t,["silenceDurationMs"]);return s!=null&&a(e,["silenceDurationMs"],s),e}function uM(t){const e={},n=l(t,["data"]);n!=null&&a(e,["data"],n);const r=l(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function cM(t){const e={},n=l(t,["displayName"]);n!=null&&a(e,["displayName"],n);const r=l(t,["data"]);r!=null&&a(e,["data"],r);const i=l(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function dM(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["data"]);n!=null&&a(e,["data"],n);const r=l(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function fM(t){const e={},n=l(t,["displayName"]);n!=null&&a(e,["displayName"],n);const r=l(t,["data"]);r!=null&&a(e,["data"],r);const i=l(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function hM(t){const e={},n=l(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>hk(o))),a(e,["parts"],i)}const r=l(t,["role"]);return r!=null&&a(e,["role"],r),e}function pM(t){const e={},n=l(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>pk(o))),a(e,["parts"],i)}const r=l(t,["role"]);return r!=null&&a(e,["role"],r),e}function mM(t){const e={},n=l(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>mk(o))),a(e,["parts"],i)}const r=l(t,["role"]);return r!=null&&a(e,["role"],r),e}function gM(t){const e={},n=l(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>gk(o))),a(e,["parts"],i)}const r=l(t,["role"]);return r!=null&&a(e,["role"],r),e}function yM(t){const e={},n=l(t,["triggerTokens"]);n!=null&&a(e,["triggerTokens"],n);const r=l(t,["slidingWindow"]);return r!=null&&a(e,["slidingWindow"],Sk(r)),e}function _M(t){const e={},n=l(t,["triggerTokens"]);n!=null&&a(e,["triggerTokens"],n);const r=l(t,["slidingWindow"]);return r!=null&&a(e,["slidingWindow"],Ak(r)),e}function vM(t){const e={},n=l(t,["mode"]);n!=null&&a(e,["mode"],n);const r=l(t,["dynamicThreshold"]);return r!=null&&a(e,["dynamicThreshold"],r),e}function TM(t){const e={},n=l(t,["mode"]);n!=null&&a(e,["mode"],n);const r=l(t,["dynamicThreshold"]);return r!=null&&a(e,["dynamicThreshold"],r),e}function EM(t){const e={},n=l(t,["excludeDomains"]);return n!=null&&a(e,["excludeDomains"],n),e}function IM(t){const e={},n=l(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function CM(t){const e={},n=l(t,["displayName"]);n!=null&&a(e,["displayName"],n);const r=l(t,["fileUri"]);r!=null&&a(e,["fileUri"],r);const i=l(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function wM(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function SM(t){const e={},n=l(t,["displayName"]);n!=null&&a(e,["displayName"],n);const r=l(t,["fileUri"]);r!=null&&a(e,["fileUri"],r);const i=l(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function II(t){const e={},n=l(t,["id"]);n!=null&&a(e,["id"],n);const r=l(t,["args"]);r!=null&&a(e,["args"],r);const i=l(t,["name"]);return i!=null&&a(e,["name"],i),e}function CI(t){const e={},n=l(t,["id"]);n!=null&&a(e,["id"],n);const r=l(t,["args"]);r!=null&&a(e,["args"],r);const i=l(t,["name"]);return i!=null&&a(e,["name"],i),e}function AM(t){const e={},n=l(t,["id"]);n!=null&&a(e,["id"],n);const r=l(t,["args"]);r!=null&&a(e,["args"],r);const i=l(t,["name"]);return i!=null&&a(e,["name"],i),e}function RM(t){const e={},n=l(t,["id"]);n!=null&&a(e,["id"],n);const r=l(t,["args"]);r!=null&&a(e,["args"],r);const i=l(t,["name"]);return i!=null&&a(e,["name"],i),e}function xM(t){const e={},n=l(t,["behavior"]);n!=null&&a(e,["behavior"],n);const r=l(t,["description"]);r!=null&&a(e,["description"],r);const i=l(t,["name"]);i!=null&&a(e,["name"],i);const o=l(t,["parameters"]);o!=null&&a(e,["parameters"],o);const s=l(t,["parametersJsonSchema"]);s!=null&&a(e,["parametersJsonSchema"],s);const u=l(t,["response"]);u!=null&&a(e,["response"],u);const c=l(t,["responseJsonSchema"]);return c!=null&&a(e,["responseJsonSchema"],c),e}function PM(t){const e={};if(l(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=l(t,["description"]);n!=null&&a(e,["description"],n);const r=l(t,["name"]);r!=null&&a(e,["name"],r);const i=l(t,["parameters"]);i!=null&&a(e,["parameters"],i);const o=l(t,["parametersJsonSchema"]);o!=null&&a(e,["parametersJsonSchema"],o);const s=l(t,["response"]);s!=null&&a(e,["response"],s);const u=l(t,["responseJsonSchema"]);return u!=null&&a(e,["responseJsonSchema"],u),e}function DM(t){const e={},n=l(t,["authConfig"]);return n!=null&&a(e,["authConfig"],sM(n)),e}function MM(t){const e={},n=l(t,["dynamicRetrievalConfig"]);return n!=null&&a(e,["dynamicRetrievalConfig"],vM(n)),e}function kM(t){const e={},n=l(t,["dynamicRetrievalConfig"]);return n!=null&&a(e,["dynamicRetrievalConfig"],TM(n)),e}function NM(t){const e={},n=l(t,["timeRangeFilter"]);if(n!=null&&a(e,["timeRangeFilter"],LM(n)),l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function VM(t){const e={},n=l(t,["timeRangeFilter"]);n!=null&&a(e,["timeRangeFilter"],FM(n));const r=l(t,["excludeDomains"]);return r!=null&&a(e,["excludeDomains"],r),e}function LM(t){const e={},n=l(t,["startTime"]);n!=null&&a(e,["startTime"],n);const r=l(t,["endTime"]);return r!=null&&a(e,["endTime"],r),e}function FM(t){const e={},n=l(t,["startTime"]);n!=null&&a(e,["startTime"],n);const r=l(t,["endTime"]);return r!=null&&a(e,["endTime"],r),e}function UM(t,e){const n={},r=l(t,["generationConfig"]);e!==void 0&&r!=null&&a(e,["setup","generationConfig"],r);const i=l(t,["responseModalities"]);e!==void 0&&i!=null&&a(e,["setup","generationConfig","responseModalities"],i);const o=l(t,["temperature"]);e!==void 0&&o!=null&&a(e,["setup","generationConfig","temperature"],o);const s=l(t,["topP"]);e!==void 0&&s!=null&&a(e,["setup","generationConfig","topP"],s);const u=l(t,["topK"]);e!==void 0&&u!=null&&a(e,["setup","generationConfig","topK"],u);const c=l(t,["maxOutputTokens"]);e!==void 0&&c!=null&&a(e,["setup","generationConfig","maxOutputTokens"],c);const d=l(t,["mediaResolution"]);e!==void 0&&d!=null&&a(e,["setup","generationConfig","mediaResolution"],d);const h=l(t,["seed"]);e!==void 0&&h!=null&&a(e,["setup","generationConfig","seed"],h);const p=l(t,["speechConfig"]);e!==void 0&&p!=null&&a(e,["setup","generationConfig","speechConfig"],xk(Qh(p)));const m=l(t,["enableAffectiveDialog"]);e!==void 0&&m!=null&&a(e,["setup","generationConfig","enableAffectiveDialog"],m);const _=l(t,["systemInstruction"]);e!==void 0&&_!=null&&a(e,["setup","systemInstruction"],mM(dt(_)));const S=l(t,["tools"]);if(e!==void 0&&S!=null){let F=Ao(S);Array.isArray(F)&&(F=F.map(b=>kk(So(b)))),a(e,["setup","tools"],F)}const R=l(t,["sessionResumption"]);e!==void 0&&R!=null&&a(e,["setup","sessionResumption"],Ck(R));const M=l(t,["inputAudioTranscription"]);e!==void 0&&M!=null&&a(e,["setup","inputAudioTranscription"],u_());const I=l(t,["outputAudioTranscription"]);e!==void 0&&I!=null&&a(e,["setup","outputAudioTranscription"],u_());const T=l(t,["realtimeInputConfig"]);e!==void 0&&T!=null&&a(e,["setup","realtimeInputConfig"],Ek(T));const C=l(t,["contextWindowCompression"]);e!==void 0&&C!=null&&a(e,["setup","contextWindowCompression"],yM(C));const k=l(t,["proactivity"]);return e!==void 0&&k!=null&&a(e,["setup","proactivity"],vk(k)),n}function bM(t,e){const n={},r=l(t,["generationConfig"]);e!==void 0&&r!=null&&a(e,["setup","generationConfig"],r);const i=l(t,["responseModalities"]);e!==void 0&&i!=null&&a(e,["setup","generationConfig","responseModalities"],i);const o=l(t,["temperature"]);e!==void 0&&o!=null&&a(e,["setup","generationConfig","temperature"],o);const s=l(t,["topP"]);e!==void 0&&s!=null&&a(e,["setup","generationConfig","topP"],s);const u=l(t,["topK"]);e!==void 0&&u!=null&&a(e,["setup","generationConfig","topK"],u);const c=l(t,["maxOutputTokens"]);e!==void 0&&c!=null&&a(e,["setup","generationConfig","maxOutputTokens"],c);const d=l(t,["mediaResolution"]);e!==void 0&&d!=null&&a(e,["setup","generationConfig","mediaResolution"],d);const h=l(t,["seed"]);e!==void 0&&h!=null&&a(e,["setup","generationConfig","seed"],h);const p=l(t,["speechConfig"]);e!==void 0&&p!=null&&a(e,["setup","generationConfig","speechConfig"],Pk(Qh(p)));const m=l(t,["enableAffectiveDialog"]);e!==void 0&&m!=null&&a(e,["setup","generationConfig","enableAffectiveDialog"],m);const _=l(t,["systemInstruction"]);e!==void 0&&_!=null&&a(e,["setup","systemInstruction"],gM(dt(_)));const S=l(t,["tools"]);if(e!==void 0&&S!=null){let F=Ao(S);Array.isArray(F)&&(F=F.map(b=>Nk(So(b)))),a(e,["setup","tools"],F)}const R=l(t,["sessionResumption"]);e!==void 0&&R!=null&&a(e,["setup","sessionResumption"],wk(R));const M=l(t,["inputAudioTranscription"]);e!==void 0&&M!=null&&a(e,["setup","inputAudioTranscription"],c_());const I=l(t,["outputAudioTranscription"]);e!==void 0&&I!=null&&a(e,["setup","outputAudioTranscription"],c_());const T=l(t,["realtimeInputConfig"]);e!==void 0&&T!=null&&a(e,["setup","realtimeInputConfig"],Ik(T));const C=l(t,["contextWindowCompression"]);e!==void 0&&C!=null&&a(e,["setup","contextWindowCompression"],_M(C));const k=l(t,["proactivity"]);return e!==void 0&&k!=null&&a(e,["setup","proactivity"],Tk(k)),n}function BM(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["setup","model"],de(t,r));const i=l(e,["config"]);return i!=null&&a(n,["config"],UM(i,n)),n}function OM(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["setup","model"],de(t,r));const i=l(e,["config"]);return i!=null&&a(n,["config"],bM(i,n)),n}function qM(t){const e={},n=l(t,["weightedPrompts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>Hk(i))),a(e,["weightedPrompts"],r)}return e}function wI(t){const e={},n=l(t,["weightedPrompts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>xI(i))),a(e,["weightedPrompts"],r)}return e}function _f(t){const e={},n=l(t,["setup"]);n!=null&&a(e,["setup"],SI(n));const r=l(t,["clientContent"]);r!=null&&a(e,["clientContent"],wI(r));const i=l(t,["musicGenerationConfig"]);i!=null&&a(e,["musicGenerationConfig"],AI(i));const o=l(t,["playbackControl"]);return o!=null&&a(e,["playbackControl"],o),e}function SI(t){const e={},n=l(t,["model"]);return n!=null&&a(e,["model"],n),e}function GM(t){const e={},n=l(t,["text"]);n!=null&&a(e,["text"],n);const r=l(t,["filteredReason"]);return r!=null&&a(e,["filteredReason"],r),e}function $M(t){const e={},n=l(t,["temperature"]);n!=null&&a(e,["temperature"],n);const r=l(t,["topK"]);r!=null&&a(e,["topK"],r);const i=l(t,["seed"]);i!=null&&a(e,["seed"],i);const o=l(t,["guidance"]);o!=null&&a(e,["guidance"],o);const s=l(t,["bpm"]);s!=null&&a(e,["bpm"],s);const u=l(t,["density"]);u!=null&&a(e,["density"],u);const c=l(t,["brightness"]);c!=null&&a(e,["brightness"],c);const d=l(t,["scale"]);d!=null&&a(e,["scale"],d);const h=l(t,["muteBass"]);h!=null&&a(e,["muteBass"],h);const p=l(t,["muteDrums"]);p!=null&&a(e,["muteDrums"],p);const m=l(t,["onlyBassAndDrums"]);m!=null&&a(e,["onlyBassAndDrums"],m);const _=l(t,["musicGenerationMode"]);return _!=null&&a(e,["musicGenerationMode"],_),e}function AI(t){const e={},n=l(t,["temperature"]);n!=null&&a(e,["temperature"],n);const r=l(t,["topK"]);r!=null&&a(e,["topK"],r);const i=l(t,["seed"]);i!=null&&a(e,["seed"],i);const o=l(t,["guidance"]);o!=null&&a(e,["guidance"],o);const s=l(t,["bpm"]);s!=null&&a(e,["bpm"],s);const u=l(t,["density"]);u!=null&&a(e,["density"],u);const c=l(t,["brightness"]);c!=null&&a(e,["brightness"],c);const d=l(t,["scale"]);d!=null&&a(e,["scale"],d);const h=l(t,["muteBass"]);h!=null&&a(e,["muteBass"],h);const p=l(t,["muteDrums"]);p!=null&&a(e,["muteDrums"],p);const m=l(t,["onlyBassAndDrums"]);m!=null&&a(e,["onlyBassAndDrums"],m);const _=l(t,["musicGenerationMode"]);return _!=null&&a(e,["musicGenerationMode"],_),e}function zM(t){const e={},n=l(t,["audioChunks"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>oM(i))),a(e,["audioChunks"],r)}return e}function HM(t){const e={};l(t,["setupComplete"])!=null&&a(e,["setupComplete"],KM());const r=l(t,["serverContent"]);r!=null&&a(e,["serverContent"],zM(r));const i=l(t,["filteredPrompt"]);return i!=null&&a(e,["filteredPrompt"],GM(i)),e}function KM(){return{}}function WM(t){const e={},n=l(t,["musicGenerationConfig"]);return n!=null&&a(e,["musicGenerationConfig"],AI(n)),e}function JM(t){const e={},n=l(t,["weightedPrompts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>xI(i))),a(e,["weightedPrompts"],r)}return e}function QM(t){const e={},n=l(t,["clientContent"]);n!=null&&a(e,["clientContent"],qM(n));const r=l(t,["musicGenerationConfig"]);return r!=null&&a(e,["musicGenerationConfig"],$M(r)),e}function YM(t){const e={},n=l(t,["media"]);if(n!=null){let d=lI(n);Array.isArray(d)&&(d=d.map(h=>h)),a(e,["mediaChunks"],d)}const r=l(t,["audio"]);r!=null&&a(e,["audio"],uI(r));const i=l(t,["audioStreamEnd"]);i!=null&&a(e,["audioStreamEnd"],i);const o=l(t,["video"]);o!=null&&a(e,["video"],aI(o));const s=l(t,["text"]);return s!=null&&a(e,["text"],s),l(t,["activityStart"])!=null&&a(e,["activityStart"],nM()),l(t,["activityEnd"])!=null&&a(e,["activityEnd"],eM()),e}function XM(t){const e={},n=l(t,["media"]);if(n!=null){let d=lI(n);Array.isArray(d)&&(d=d.map(h=>h)),a(e,["mediaChunks"],d)}const r=l(t,["audio"]);r!=null&&a(e,["audio"],uI(r));const i=l(t,["audioStreamEnd"]);i!=null&&a(e,["audioStreamEnd"],i);const o=l(t,["video"]);o!=null&&a(e,["video"],aI(o));const s=l(t,["text"]);return s!=null&&a(e,["text"],s),l(t,["activityStart"])!=null&&a(e,["activityStart"],rM()),l(t,["activityEnd"])!=null&&a(e,["activityEnd"],tM()),e}function ZM(t){const e={},n=l(t,["modelTurn"]);n!=null&&a(e,["modelTurn"],hM(n));const r=l(t,["turnComplete"]);r!=null&&a(e,["turnComplete"],r);const i=l(t,["interrupted"]);i!=null&&a(e,["interrupted"],i);const o=l(t,["groundingMetadata"]);o!=null&&a(e,["groundingMetadata"],o);const s=l(t,["generationComplete"]);s!=null&&a(e,["generationComplete"],s);const u=l(t,["inputTranscription"]);u!=null&&a(e,["inputTranscription"],d_(u));const c=l(t,["outputTranscription"]);c!=null&&a(e,["outputTranscription"],d_(c));const d=l(t,["urlContextMetadata"]);d!=null&&a(e,["urlContextMetadata"],Vk(d));const h=l(t,["turnCompleteReason"]);h!=null&&a(e,["turnCompleteReason"],h);const p=l(t,["waitingForInput"]);return p!=null&&a(e,["waitingForInput"],p),e}function jM(t){const e={},n=l(t,["modelTurn"]);n!=null&&a(e,["modelTurn"],pM(n));const r=l(t,["turnComplete"]);r!=null&&a(e,["turnComplete"],r);const i=l(t,["interrupted"]);i!=null&&a(e,["interrupted"],i);const o=l(t,["groundingMetadata"]);o!=null&&a(e,["groundingMetadata"],o);const s=l(t,["generationComplete"]);s!=null&&a(e,["generationComplete"],s);const u=l(t,["inputTranscription"]);u!=null&&a(e,["inputTranscription"],f_(u));const c=l(t,["outputTranscription"]);c!=null&&a(e,["outputTranscription"],f_(c));const d=l(t,["turnCompleteReason"]);d!=null&&a(e,["turnCompleteReason"],d);const h=l(t,["waitingForInput"]);return h!=null&&a(e,["waitingForInput"],h),e}function ek(t){const e={},n=l(t,["timeLeft"]);return n!=null&&a(e,["timeLeft"],n),e}function tk(t){const e={},n=l(t,["timeLeft"]);return n!=null&&a(e,["timeLeft"],n),e}function nk(t){const e={};l(t,["setupComplete"])!=null&&a(e,["setupComplete"],sk());const r=l(t,["serverContent"]);r!=null&&a(e,["serverContent"],ZM(r));const i=l(t,["toolCall"]);i!=null&&a(e,["toolCall"],ck(i));const o=l(t,["toolCallCancellation"]);o!=null&&a(e,["toolCallCancellation"],ak(o));const s=l(t,["usageMetadata"]);s!=null&&a(e,["usageMetadata"],bk(s));const u=l(t,["goAway"]);u!=null&&a(e,["goAway"],ek(u));const c=l(t,["sessionResumptionUpdate"]);return c!=null&&a(e,["sessionResumptionUpdate"],ik(c)),e}function rk(t){const e={},n=l(t,["setupComplete"]);n!=null&&a(e,["setupComplete"],lk(n));const r=l(t,["serverContent"]);r!=null&&a(e,["serverContent"],jM(r));const i=l(t,["toolCall"]);i!=null&&a(e,["toolCall"],dk(i));const o=l(t,["toolCallCancellation"]);o!=null&&a(e,["toolCallCancellation"],uk(o));const s=l(t,["usageMetadata"]);s!=null&&a(e,["usageMetadata"],Bk(s));const u=l(t,["goAway"]);u!=null&&a(e,["goAway"],tk(u));const c=l(t,["sessionResumptionUpdate"]);return c!=null&&a(e,["sessionResumptionUpdate"],ok(c)),e}function ik(t){const e={},n=l(t,["newHandle"]);n!=null&&a(e,["newHandle"],n);const r=l(t,["resumable"]);r!=null&&a(e,["resumable"],r);const i=l(t,["lastConsumedClientMessageIndex"]);return i!=null&&a(e,["lastConsumedClientMessageIndex"],i),e}function ok(t){const e={},n=l(t,["newHandle"]);n!=null&&a(e,["newHandle"],n);const r=l(t,["resumable"]);r!=null&&a(e,["resumable"],r);const i=l(t,["lastConsumedClientMessageIndex"]);return i!=null&&a(e,["lastConsumedClientMessageIndex"],i),e}function sk(){return{}}function lk(t){const e={},n=l(t,["sessionId"]);return n!=null&&a(e,["sessionId"],n),e}function ak(t){const e={},n=l(t,["ids"]);return n!=null&&a(e,["ids"],n),e}function uk(t){const e={},n=l(t,["ids"]);return n!=null&&a(e,["ids"],n),e}function ck(t){const e={},n=l(t,["functionCalls"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>II(i))),a(e,["functionCalls"],r)}return e}function dk(t){const e={},n=l(t,["functionCalls"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>CI(i))),a(e,["functionCalls"],r)}return e}function ua(t){const e={},n=l(t,["modality"]);n!=null&&a(e,["modality"],n);const r=l(t,["tokenCount"]);return r!=null&&a(e,["tokenCount"],r),e}function ca(t){const e={},n=l(t,["modality"]);n!=null&&a(e,["modality"],n);const r=l(t,["tokenCount"]);return r!=null&&a(e,["tokenCount"],r),e}function fk(t){const e={},n=l(t,["speakerVoiceConfigs"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>Rk(i))),a(e,["speakerVoiceConfigs"],r)}return e}function hk(t){const e={},n=l(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],Ok(n));const r=l(t,["thought"]);r!=null&&a(e,["thought"],r);const i=l(t,["inlineData"]);i!=null&&a(e,["inlineData"],uM(i));const o=l(t,["fileData"]);o!=null&&a(e,["fileData"],IM(o));const s=l(t,["thoughtSignature"]);s!=null&&a(e,["thoughtSignature"],s);const u=l(t,["functionCall"]);u!=null&&a(e,["functionCall"],II(u));const c=l(t,["codeExecutionResult"]);c!=null&&a(e,["codeExecutionResult"],c);const d=l(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=l(t,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const p=l(t,["text"]);return p!=null&&a(e,["text"],p),e}function pk(t){const e={},n=l(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],qk(n));const r=l(t,["thought"]);r!=null&&a(e,["thought"],r);const i=l(t,["inlineData"]);i!=null&&a(e,["inlineData"],cM(i));const o=l(t,["fileData"]);o!=null&&a(e,["fileData"],CM(o));const s=l(t,["thoughtSignature"]);s!=null&&a(e,["thoughtSignature"],s);const u=l(t,["functionCall"]);u!=null&&a(e,["functionCall"],CI(u));const c=l(t,["codeExecutionResult"]);c!=null&&a(e,["codeExecutionResult"],c);const d=l(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=l(t,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const p=l(t,["text"]);return p!=null&&a(e,["text"],p),e}function mk(t){const e={},n=l(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],Gk(n));const r=l(t,["thought"]);r!=null&&a(e,["thought"],r);const i=l(t,["inlineData"]);i!=null&&a(e,["inlineData"],dM(i));const o=l(t,["fileData"]);o!=null&&a(e,["fileData"],wM(o));const s=l(t,["thoughtSignature"]);s!=null&&a(e,["thoughtSignature"],s);const u=l(t,["functionCall"]);u!=null&&a(e,["functionCall"],AM(u));const c=l(t,["codeExecutionResult"]);c!=null&&a(e,["codeExecutionResult"],c);const d=l(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=l(t,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const p=l(t,["text"]);return p!=null&&a(e,["text"],p),e}function gk(t){const e={},n=l(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],$k(n));const r=l(t,["thought"]);r!=null&&a(e,["thought"],r);const i=l(t,["inlineData"]);i!=null&&a(e,["inlineData"],fM(i));const o=l(t,["fileData"]);o!=null&&a(e,["fileData"],SM(o));const s=l(t,["thoughtSignature"]);s!=null&&a(e,["thoughtSignature"],s);const u=l(t,["functionCall"]);u!=null&&a(e,["functionCall"],RM(u));const c=l(t,["codeExecutionResult"]);c!=null&&a(e,["codeExecutionResult"],c);const d=l(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=l(t,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const p=l(t,["text"]);return p!=null&&a(e,["text"],p),e}function yk(t){const e={},n=l(t,["voiceName"]);return n!=null&&a(e,["voiceName"],n),e}function _k(t){const e={},n=l(t,["voiceName"]);return n!=null&&a(e,["voiceName"],n),e}function vk(t){const e={},n=l(t,["proactiveAudio"]);return n!=null&&a(e,["proactiveAudio"],n),e}function Tk(t){const e={},n=l(t,["proactiveAudio"]);return n!=null&&a(e,["proactiveAudio"],n),e}function Ek(t){const e={},n=l(t,["automaticActivityDetection"]);n!=null&&a(e,["automaticActivityDetection"],lM(n));const r=l(t,["activityHandling"]);r!=null&&a(e,["activityHandling"],r);const i=l(t,["turnCoverage"]);return i!=null&&a(e,["turnCoverage"],i),e}function Ik(t){const e={},n=l(t,["automaticActivityDetection"]);n!=null&&a(e,["automaticActivityDetection"],aM(n));const r=l(t,["activityHandling"]);r!=null&&a(e,["activityHandling"],r);const i=l(t,["turnCoverage"]);return i!=null&&a(e,["turnCoverage"],i),e}function Ck(t){const e={},n=l(t,["handle"]);if(n!=null&&a(e,["handle"],n),l(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function wk(t){const e={},n=l(t,["handle"]);n!=null&&a(e,["handle"],n);const r=l(t,["transparent"]);return r!=null&&a(e,["transparent"],r),e}function Sk(t){const e={},n=l(t,["targetTokens"]);return n!=null&&a(e,["targetTokens"],n),e}function Ak(t){const e={},n=l(t,["targetTokens"]);return n!=null&&a(e,["targetTokens"],n),e}function Rk(t){const e={},n=l(t,["speaker"]);n!=null&&a(e,["speaker"],n);const r=l(t,["voiceConfig"]);return r!=null&&a(e,["voiceConfig"],RI(r)),e}function xk(t){const e={},n=l(t,["voiceConfig"]);n!=null&&a(e,["voiceConfig"],RI(n));const r=l(t,["multiSpeakerVoiceConfig"]);r!=null&&a(e,["multiSpeakerVoiceConfig"],fk(r));const i=l(t,["languageCode"]);return i!=null&&a(e,["languageCode"],i),e}function Pk(t){const e={},n=l(t,["voiceConfig"]);if(n!=null&&a(e,["voiceConfig"],zk(n)),l(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const r=l(t,["languageCode"]);return r!=null&&a(e,["languageCode"],r),e}function Dk(t){const e={},n=l(t,["environment"]);n!=null&&a(e,["environment"],n);const r=l(t,["excludedPredefinedFunctions"]);return r!=null&&a(e,["excludedPredefinedFunctions"],r),e}function Mk(t){const e={},n=l(t,["environment"]);n!=null&&a(e,["environment"],n);const r=l(t,["excludedPredefinedFunctions"]);return r!=null&&a(e,["excludedPredefinedFunctions"],r),e}function kk(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let c=n;Array.isArray(c)&&(c=c.map(d=>xM(d))),a(e,["functionDeclarations"],c)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearch"]);r!=null&&a(e,["googleSearch"],NM(r));const i=l(t,["googleSearchRetrieval"]);if(i!=null&&a(e,["googleSearchRetrieval"],MM(i)),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(l(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");l(t,["urlContext"])!=null&&a(e,["urlContext"],Lk());const s=l(t,["computerUse"]);s!=null&&a(e,["computerUse"],Dk(s));const u=l(t,["codeExecution"]);return u!=null&&a(e,["codeExecution"],u),e}function Nk(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(m=>PM(m))),a(e,["functionDeclarations"],p)}const r=l(t,["retrieval"]);r!=null&&a(e,["retrieval"],r);const i=l(t,["googleSearch"]);i!=null&&a(e,["googleSearch"],VM(i));const o=l(t,["googleSearchRetrieval"]);o!=null&&a(e,["googleSearchRetrieval"],kM(o));const s=l(t,["enterpriseWebSearch"]);s!=null&&a(e,["enterpriseWebSearch"],EM(s));const u=l(t,["googleMaps"]);u!=null&&a(e,["googleMaps"],DM(u)),l(t,["urlContext"])!=null&&a(e,["urlContext"],Fk());const d=l(t,["computerUse"]);d!=null&&a(e,["computerUse"],Mk(d));const h=l(t,["codeExecution"]);return h!=null&&a(e,["codeExecution"],h),e}function d_(t){const e={},n=l(t,["text"]);n!=null&&a(e,["text"],n);const r=l(t,["finished"]);return r!=null&&a(e,["finished"],r),e}function f_(t){const e={},n=l(t,["text"]);n!=null&&a(e,["text"],n);const r=l(t,["finished"]);return r!=null&&a(e,["finished"],r),e}function Vk(t){const e={},n=l(t,["urlMetadata"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>Uk(i))),a(e,["urlMetadata"],r)}return e}function Lk(){return{}}function Fk(){return{}}function Uk(t){const e={},n=l(t,["retrievedUrl"]);n!=null&&a(e,["retrievedUrl"],n);const r=l(t,["urlRetrievalStatus"]);return r!=null&&a(e,["urlRetrievalStatus"],r),e}function bk(t){const e={},n=l(t,["promptTokenCount"]);n!=null&&a(e,["promptTokenCount"],n);const r=l(t,["cachedContentTokenCount"]);r!=null&&a(e,["cachedContentTokenCount"],r);const i=l(t,["responseTokenCount"]);i!=null&&a(e,["responseTokenCount"],i);const o=l(t,["toolUsePromptTokenCount"]);o!=null&&a(e,["toolUsePromptTokenCount"],o);const s=l(t,["thoughtsTokenCount"]);s!=null&&a(e,["thoughtsTokenCount"],s);const u=l(t,["totalTokenCount"]);u!=null&&a(e,["totalTokenCount"],u);const c=l(t,["promptTokensDetails"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(_=>ua(_))),a(e,["promptTokensDetails"],m)}const d=l(t,["cacheTokensDetails"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(_=>ua(_))),a(e,["cacheTokensDetails"],m)}const h=l(t,["responseTokensDetails"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(_=>ua(_))),a(e,["responseTokensDetails"],m)}const p=l(t,["toolUsePromptTokensDetails"]);if(p!=null){let m=p;Array.isArray(m)&&(m=m.map(_=>ua(_))),a(e,["toolUsePromptTokensDetails"],m)}return e}function Bk(t){const e={},n=l(t,["promptTokenCount"]);n!=null&&a(e,["promptTokenCount"],n);const r=l(t,["cachedContentTokenCount"]);r!=null&&a(e,["cachedContentTokenCount"],r);const i=l(t,["candidatesTokenCount"]);i!=null&&a(e,["responseTokenCount"],i);const o=l(t,["toolUsePromptTokenCount"]);o!=null&&a(e,["toolUsePromptTokenCount"],o);const s=l(t,["thoughtsTokenCount"]);s!=null&&a(e,["thoughtsTokenCount"],s);const u=l(t,["totalTokenCount"]);u!=null&&a(e,["totalTokenCount"],u);const c=l(t,["promptTokensDetails"]);if(c!=null){let _=c;Array.isArray(_)&&(_=_.map(S=>ca(S))),a(e,["promptTokensDetails"],_)}const d=l(t,["cacheTokensDetails"]);if(d!=null){let _=d;Array.isArray(_)&&(_=_.map(S=>ca(S))),a(e,["cacheTokensDetails"],_)}const h=l(t,["candidatesTokensDetails"]);if(h!=null){let _=h;Array.isArray(_)&&(_=_.map(S=>ca(S))),a(e,["responseTokensDetails"],_)}const p=l(t,["toolUsePromptTokensDetails"]);if(p!=null){let _=p;Array.isArray(_)&&(_=_.map(S=>ca(S))),a(e,["toolUsePromptTokensDetails"],_)}const m=l(t,["trafficType"]);return m!=null&&a(e,["trafficType"],m),e}function Ok(t){const e={},n=l(t,["fps"]);n!=null&&a(e,["fps"],n);const r=l(t,["endOffset"]);r!=null&&a(e,["endOffset"],r);const i=l(t,["startOffset"]);return i!=null&&a(e,["startOffset"],i),e}function qk(t){const e={},n=l(t,["fps"]);n!=null&&a(e,["fps"],n);const r=l(t,["endOffset"]);r!=null&&a(e,["endOffset"],r);const i=l(t,["startOffset"]);return i!=null&&a(e,["startOffset"],i),e}function Gk(t){const e={},n=l(t,["fps"]);n!=null&&a(e,["fps"],n);const r=l(t,["endOffset"]);r!=null&&a(e,["endOffset"],r);const i=l(t,["startOffset"]);return i!=null&&a(e,["startOffset"],i),e}function $k(t){const e={},n=l(t,["fps"]);n!=null&&a(e,["fps"],n);const r=l(t,["endOffset"]);r!=null&&a(e,["endOffset"],r);const i=l(t,["startOffset"]);return i!=null&&a(e,["startOffset"],i),e}function RI(t){const e={},n=l(t,["prebuiltVoiceConfig"]);return n!=null&&a(e,["prebuiltVoiceConfig"],yk(n)),e}function zk(t){const e={},n=l(t,["prebuiltVoiceConfig"]);return n!=null&&a(e,["prebuiltVoiceConfig"],_k(n)),e}function Hk(t){const e={},n=l(t,["text"]);n!=null&&a(e,["text"],n);const r=l(t,["weight"]);return r!=null&&a(e,["weight"],r),e}function xI(t){const e={},n=l(t,["text"]);n!=null&&a(e,["text"],n);const r=l(t,["weight"]);return r!=null&&a(e,["weight"],r),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Kk(t){const e={},n=l(t,["apiKeyString"]);return n!=null&&a(e,["apiKeyString"],n),e}function Wk(t){const e={},n=l(t,["apiKeyConfig"]);n!=null&&a(e,["apiKeyConfig"],Kk(n));const r=l(t,["authType"]);r!=null&&a(e,["authType"],r);const i=l(t,["googleServiceAccountConfig"]);i!=null&&a(e,["googleServiceAccountConfig"],i);const o=l(t,["httpBasicAuthConfig"]);o!=null&&a(e,["httpBasicAuthConfig"],o);const s=l(t,["oauthConfig"]);s!=null&&a(e,["oauthConfig"],s);const u=l(t,["oidcConfig"]);return u!=null&&a(e,["oidcConfig"],u),e}function Jk(t){const e={},n=l(t,["data"]);n!=null&&a(e,["data"],n);const r=l(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function Qk(t){const e={},n=l(t,["displayName"]);n!=null&&a(e,["displayName"],n);const r=l(t,["data"]);r!=null&&a(e,["data"],r);const i=l(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function Yk(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["data"]);n!=null&&a(e,["data"],n);const r=l(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function Xk(t){const e={},n=l(t,["displayName"]);n!=null&&a(e,["displayName"],n);const r=l(t,["data"]);r!=null&&a(e,["data"],r);const i=l(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function Zk(t){const e={},n=l(t,["content"]);n!=null&&a(e,["content"],aN(n));const r=l(t,["citationMetadata"]);r!=null&&a(e,["citationMetadata"],tN(r));const i=l(t,["tokenCount"]);i!=null&&a(e,["tokenCount"],i);const o=l(t,["finishReason"]);o!=null&&a(e,["finishReason"],o);const s=l(t,["urlContextMetadata"]);s!=null&&a(e,["urlContextMetadata"],xV(s));const u=l(t,["avgLogprobs"]);u!=null&&a(e,["avgLogprobs"],u);const c=l(t,["groundingMetadata"]);c!=null&&a(e,["groundingMetadata"],c);const d=l(t,["index"]);d!=null&&a(e,["index"],d);const h=l(t,["logprobsResult"]);h!=null&&a(e,["logprobsResult"],h);const p=l(t,["safetyRatings"]);return p!=null&&a(e,["safetyRatings"],p),e}function jk(t){const e={},n=l(t,["content"]);n!=null&&a(e,["content"],uN(n));const r=l(t,["citationMetadata"]);r!=null&&a(e,["citationMetadata"],nN(r));const i=l(t,["finishMessage"]);i!=null&&a(e,["finishMessage"],i);const o=l(t,["finishReason"]);o!=null&&a(e,["finishReason"],o);const s=l(t,["urlContextMetadata"]);s!=null&&a(e,["urlContextMetadata"],PV(s));const u=l(t,["avgLogprobs"]);u!=null&&a(e,["avgLogprobs"],u);const c=l(t,["groundingMetadata"]);c!=null&&a(e,["groundingMetadata"],c);const d=l(t,["index"]);d!=null&&a(e,["index"],d);const h=l(t,["logprobsResult"]);h!=null&&a(e,["logprobsResult"],h);const p=l(t,["safetyRatings"]);return p!=null&&a(e,["safetyRatings"],p),e}function eN(t){const e={},n=l(t,["checkpointId"]);n!=null&&a(e,["checkpointId"],n);const r=l(t,["epoch"]);r!=null&&a(e,["epoch"],r);const i=l(t,["step"]);return i!=null&&a(e,["step"],i),e}function tN(t){const e={},n=l(t,["citationSources"]);return n!=null&&a(e,["citations"],n),e}function nN(t){const e={},n=l(t,["citations"]);return n!=null&&a(e,["citations"],n),e}function rN(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["_url","model"],de(t,r));const i=l(e,["contents"]);if(i!=null){let o=Kt(i);Array.isArray(o)&&(o=o.map(s=>xo(s))),a(n,["contents"],o)}return n}function iN(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["tokensInfo"]);return r!=null&&a(e,["tokensInfo"],r),e}function oN(t){const e={},n=l(t,["values"]);return n!=null&&a(e,["values"],n),e}function sN(t){const e={},n=l(t,["values"]);n!=null&&a(e,["values"],n);const r=l(t,["statistics"]);return r!=null&&a(e,["statistics"],lN(r)),e}function lN(t){const e={},n=l(t,["truncated"]);n!=null&&a(e,["truncated"],n);const r=l(t,["token_count"]);return r!=null&&a(e,["tokenCount"],r),e}function aN(t){const e={},n=l(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>b1(o))),a(e,["parts"],i)}const r=l(t,["role"]);return r!=null&&a(e,["role"],r),e}function uN(t){const e={},n=l(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>B1(o))),a(e,["parts"],i)}const r=l(t,["role"]);return r!=null&&a(e,["role"],r),e}function Hu(t){const e={},n=l(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>O1(o))),a(e,["parts"],i)}const r=l(t,["role"]);return r!=null&&a(e,["role"],r),e}function xo(t){const e={},n=l(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>q1(o))),a(e,["parts"],i)}const r=l(t,["role"]);return r!=null&&a(e,["role"],r),e}function cN(t){const e={},n=l(t,["controlType"]);n!=null&&a(e,["controlType"],n);const r=l(t,["enableControlImageComputation"]);return r!=null&&a(e,["computeControl"],r),e}function dN(t){const e={};if(l(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(l(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(l(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function fN(t,e){const n={},r=l(t,["systemInstruction"]);e!==void 0&&r!=null&&a(e,["systemInstruction"],xo(dt(r)));const i=l(t,["tools"]);if(e!==void 0&&i!=null){let s=i;Array.isArray(s)&&(s=s.map(u=>NI(u))),a(e,["tools"],s)}const o=l(t,["generationConfig"]);return e!==void 0&&o!=null&&a(e,["generationConfig"],o),n}function hN(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["_url","model"],de(t,r));const i=l(e,["contents"]);if(i!=null){let s=Kt(i);Array.isArray(s)&&(s=s.map(u=>Hu(u))),a(n,["contents"],s)}const o=l(e,["config"]);return o!=null&&dN(o),n}function pN(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["_url","model"],de(t,r));const i=l(e,["contents"]);if(i!=null){let s=Kt(i);Array.isArray(s)&&(s=s.map(u=>xo(u))),a(n,["contents"],s)}const o=l(e,["config"]);return o!=null&&fN(o,n),n}function mN(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["totalTokens"]);r!=null&&a(e,["totalTokens"],r);const i=l(t,["cachedContentTokenCount"]);return i!=null&&a(e,["cachedContentTokenCount"],i),e}function gN(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["totalTokens"]);return r!=null&&a(e,["totalTokens"],r),e}function yN(t,e){const n={},r=l(e,["model"]);return r!=null&&a(n,["_url","name"],de(t,r)),n}function _N(t,e){const n={},r=l(e,["model"]);return r!=null&&a(n,["_url","name"],de(t,r)),n}function vN(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&a(e,["sdkHttpResponse"],n),e}function TN(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&a(e,["sdkHttpResponse"],n),e}function EN(t){const e={},n=l(t,["mode"]);n!=null&&a(e,["mode"],n);const r=l(t,["dynamicThreshold"]);return r!=null&&a(e,["dynamicThreshold"],r),e}function IN(t){const e={},n=l(t,["mode"]);n!=null&&a(e,["mode"],n);const r=l(t,["dynamicThreshold"]);return r!=null&&a(e,["dynamicThreshold"],r),e}function CN(t,e){const n={},r=l(t,["outputGcsUri"]);e!==void 0&&r!=null&&a(e,["parameters","storageUri"],r);const i=l(t,["negativePrompt"]);e!==void 0&&i!=null&&a(e,["parameters","negativePrompt"],i);const o=l(t,["numberOfImages"]);e!==void 0&&o!=null&&a(e,["parameters","sampleCount"],o);const s=l(t,["aspectRatio"]);e!==void 0&&s!=null&&a(e,["parameters","aspectRatio"],s);const u=l(t,["guidanceScale"]);e!==void 0&&u!=null&&a(e,["parameters","guidanceScale"],u);const c=l(t,["seed"]);e!==void 0&&c!=null&&a(e,["parameters","seed"],c);const d=l(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&a(e,["parameters","safetySetting"],d);const h=l(t,["personGeneration"]);e!==void 0&&h!=null&&a(e,["parameters","personGeneration"],h);const p=l(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&a(e,["parameters","includeSafetyAttributes"],p);const m=l(t,["includeRaiReason"]);e!==void 0&&m!=null&&a(e,["parameters","includeRaiReason"],m);const _=l(t,["language"]);e!==void 0&&_!=null&&a(e,["parameters","language"],_);const S=l(t,["outputMimeType"]);e!==void 0&&S!=null&&a(e,["parameters","outputOptions","mimeType"],S);const R=l(t,["outputCompressionQuality"]);e!==void 0&&R!=null&&a(e,["parameters","outputOptions","compressionQuality"],R);const M=l(t,["addWatermark"]);e!==void 0&&M!=null&&a(e,["parameters","addWatermark"],M);const I=l(t,["editMode"]);e!==void 0&&I!=null&&a(e,["parameters","editMode"],I);const T=l(t,["baseSteps"]);return e!==void 0&&T!=null&&a(e,["parameters","editConfig","baseSteps"],T),n}function wN(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["_url","model"],de(t,r));const i=l(e,["prompt"]);i!=null&&a(n,["instances[0]","prompt"],i);const o=l(e,["referenceImages"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(c=>Q1(c))),a(n,["instances[0]","referenceImages"],u)}const s=l(e,["config"]);return s!=null&&CN(s,n),n}function SN(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>Ku(o))),a(e,["generatedImages"],i)}return e}function AN(t,e){const n={},r=l(t,["taskType"]);e!==void 0&&r!=null&&a(e,["requests[]","taskType"],r);const i=l(t,["title"]);e!==void 0&&i!=null&&a(e,["requests[]","title"],i);const o=l(t,["outputDimensionality"]);if(e!==void 0&&o!=null&&a(e,["requests[]","outputDimensionality"],o),l(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(l(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function RN(t,e){const n={},r=l(t,["taskType"]);e!==void 0&&r!=null&&a(e,["instances[]","task_type"],r);const i=l(t,["title"]);e!==void 0&&i!=null&&a(e,["instances[]","title"],i);const o=l(t,["outputDimensionality"]);e!==void 0&&o!=null&&a(e,["parameters","outputDimensionality"],o);const s=l(t,["mimeType"]);e!==void 0&&s!=null&&a(e,["instances[]","mimeType"],s);const u=l(t,["autoTruncate"]);return e!==void 0&&u!=null&&a(e,["parameters","autoTruncate"],u),n}function xN(){return{}}function PN(t){const e={},n=l(t,["billableCharacterCount"]);return n!=null&&a(e,["billableCharacterCount"],n),e}function DN(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["_url","model"],de(t,r));const i=l(e,["contents"]);i!=null&&a(n,["requests[]","content"],Kh(t,i));const o=l(e,["config"]);o!=null&&AN(o,n);const s=l(e,["model"]);return s!==void 0&&a(n,["requests[]","model"],de(t,s)),n}function MN(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["_url","model"],de(t,r));const i=l(e,["contents"]);i!=null&&a(n,["instances[]","content"],Kh(t,i));const o=l(e,["config"]);return o!=null&&RN(o,n),n}function kN(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["embeddings"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>oN(s))),a(e,["embeddings"],o)}return l(t,["metadata"])!=null&&a(e,["metadata"],xN()),e}function NN(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["predictions[]","embeddings"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>sN(s))),a(e,["embeddings"],o)}const i=l(t,["metadata"]);return i!=null&&a(e,["metadata"],PN(i)),e}function VN(t){const e={},n=l(t,["endpoint"]);n!=null&&a(e,["name"],n);const r=l(t,["deployedModelId"]);return r!=null&&a(e,["deployedModelId"],r),e}function LN(t){const e={},n=l(t,["excludeDomains"]);return n!=null&&a(e,["excludeDomains"],n),e}function FN(t){const e={},n=l(t,["label"]);n!=null&&a(e,["label"],n);const r=l(t,["score"]);return r!=null&&a(e,["score"],r),e}function UN(t){const e={},n=l(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function bN(t){const e={},n=l(t,["displayName"]);n!=null&&a(e,["displayName"],n);const r=l(t,["fileUri"]);r!=null&&a(e,["fileUri"],r);const i=l(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function BN(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function ON(t){const e={},n=l(t,["displayName"]);n!=null&&a(e,["displayName"],n);const r=l(t,["fileUri"]);r!=null&&a(e,["fileUri"],r);const i=l(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function qN(t){const e={},n=l(t,["id"]);n!=null&&a(e,["id"],n);const r=l(t,["args"]);r!=null&&a(e,["args"],r);const i=l(t,["name"]);return i!=null&&a(e,["name"],i),e}function GN(t){const e={},n=l(t,["id"]);n!=null&&a(e,["id"],n);const r=l(t,["args"]);r!=null&&a(e,["args"],r);const i=l(t,["name"]);return i!=null&&a(e,["name"],i),e}function $N(t){const e={},n=l(t,["id"]);n!=null&&a(e,["id"],n);const r=l(t,["args"]);r!=null&&a(e,["args"],r);const i=l(t,["name"]);return i!=null&&a(e,["name"],i),e}function zN(t){const e={},n=l(t,["id"]);n!=null&&a(e,["id"],n);const r=l(t,["args"]);r!=null&&a(e,["args"],r);const i=l(t,["name"]);return i!=null&&a(e,["name"],i),e}function HN(t){const e={},n=l(t,["mode"]);n!=null&&a(e,["mode"],n);const r=l(t,["allowedFunctionNames"]);return r!=null&&a(e,["allowedFunctionNames"],r),e}function KN(t){const e={},n=l(t,["mode"]);n!=null&&a(e,["mode"],n);const r=l(t,["allowedFunctionNames"]);return r!=null&&a(e,["allowedFunctionNames"],r),e}function WN(t){const e={},n=l(t,["behavior"]);n!=null&&a(e,["behavior"],n);const r=l(t,["description"]);r!=null&&a(e,["description"],r);const i=l(t,["name"]);i!=null&&a(e,["name"],i);const o=l(t,["parameters"]);o!=null&&a(e,["parameters"],o);const s=l(t,["parametersJsonSchema"]);s!=null&&a(e,["parametersJsonSchema"],s);const u=l(t,["response"]);u!=null&&a(e,["response"],u);const c=l(t,["responseJsonSchema"]);return c!=null&&a(e,["responseJsonSchema"],c),e}function JN(t){const e={};if(l(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=l(t,["description"]);n!=null&&a(e,["description"],n);const r=l(t,["name"]);r!=null&&a(e,["name"],r);const i=l(t,["parameters"]);i!=null&&a(e,["parameters"],i);const o=l(t,["parametersJsonSchema"]);o!=null&&a(e,["parametersJsonSchema"],o);const s=l(t,["response"]);s!=null&&a(e,["response"],s);const u=l(t,["responseJsonSchema"]);return u!=null&&a(e,["responseJsonSchema"],u),e}function QN(t,e,n){const r={},i=l(e,["systemInstruction"]);n!==void 0&&i!=null&&a(n,["systemInstruction"],Hu(dt(i)));const o=l(e,["temperature"]);o!=null&&a(r,["temperature"],o);const s=l(e,["topP"]);s!=null&&a(r,["topP"],s);const u=l(e,["topK"]);u!=null&&a(r,["topK"],u);const c=l(e,["candidateCount"]);c!=null&&a(r,["candidateCount"],c);const d=l(e,["maxOutputTokens"]);d!=null&&a(r,["maxOutputTokens"],d);const h=l(e,["stopSequences"]);h!=null&&a(r,["stopSequences"],h);const p=l(e,["responseLogprobs"]);p!=null&&a(r,["responseLogprobs"],p);const m=l(e,["logprobs"]);m!=null&&a(r,["logprobs"],m);const _=l(e,["presencePenalty"]);_!=null&&a(r,["presencePenalty"],_);const S=l(e,["frequencyPenalty"]);S!=null&&a(r,["frequencyPenalty"],S);const R=l(e,["seed"]);R!=null&&a(r,["seed"],R);const M=l(e,["responseMimeType"]);M!=null&&a(r,["responseMimeType"],M);const I=l(e,["responseSchema"]);I!=null&&a(r,["responseSchema"],eV(Wh(I)));const T=l(e,["responseJsonSchema"]);if(T!=null&&a(r,["responseJsonSchema"],T),l(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(l(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const C=l(e,["safetySettings"]);if(n!==void 0&&C!=null){let D=C;Array.isArray(D)&&(D=D.map(N=>Z1(N))),a(n,["safetySettings"],D)}const k=l(e,["tools"]);if(n!==void 0&&k!=null){let D=Ao(k);Array.isArray(D)&&(D=D.map(N=>_V(So(N)))),a(n,["tools"],D)}const F=l(e,["toolConfig"]);if(n!==void 0&&F!=null&&a(n,["toolConfig"],gV(F)),l(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const b=l(e,["cachedContent"]);n!==void 0&&b!=null&&a(n,["cachedContent"],Bn(t,b));const A=l(e,["responseModalities"]);A!=null&&a(r,["responseModalities"],A);const v=l(e,["mediaResolution"]);v!=null&&a(r,["mediaResolution"],v);const w=l(e,["speechConfig"]);if(w!=null&&a(r,["speechConfig"],aV(Jh(w))),l(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const x=l(e,["thinkingConfig"]);return x!=null&&a(r,["thinkingConfig"],fV(x)),r}function YN(t,e,n){const r={},i=l(e,["systemInstruction"]);n!==void 0&&i!=null&&a(n,["systemInstruction"],xo(dt(i)));const o=l(e,["temperature"]);o!=null&&a(r,["temperature"],o);const s=l(e,["topP"]);s!=null&&a(r,["topP"],s);const u=l(e,["topK"]);u!=null&&a(r,["topK"],u);const c=l(e,["candidateCount"]);c!=null&&a(r,["candidateCount"],c);const d=l(e,["maxOutputTokens"]);d!=null&&a(r,["maxOutputTokens"],d);const h=l(e,["stopSequences"]);h!=null&&a(r,["stopSequences"],h);const p=l(e,["responseLogprobs"]);p!=null&&a(r,["responseLogprobs"],p);const m=l(e,["logprobs"]);m!=null&&a(r,["logprobs"],m);const _=l(e,["presencePenalty"]);_!=null&&a(r,["presencePenalty"],_);const S=l(e,["frequencyPenalty"]);S!=null&&a(r,["frequencyPenalty"],S);const R=l(e,["seed"]);R!=null&&a(r,["seed"],R);const M=l(e,["responseMimeType"]);M!=null&&a(r,["responseMimeType"],M);const I=l(e,["responseSchema"]);I!=null&&a(r,["responseSchema"],tV(Wh(I)));const T=l(e,["responseJsonSchema"]);T!=null&&a(r,["responseJsonSchema"],T);const C=l(e,["routingConfig"]);C!=null&&a(r,["routingConfig"],C);const k=l(e,["modelSelectionConfig"]);k!=null&&a(r,["modelConfig"],F1(k));const F=l(e,["safetySettings"]);if(n!==void 0&&F!=null){let Ye=F;Array.isArray(Ye)&&(Ye=Ye.map(gn=>j1(gn))),a(n,["safetySettings"],Ye)}const b=l(e,["tools"]);if(n!==void 0&&b!=null){let Ye=Ao(b);Array.isArray(Ye)&&(Ye=Ye.map(gn=>NI(So(gn)))),a(n,["tools"],Ye)}const A=l(e,["toolConfig"]);n!==void 0&&A!=null&&a(n,["toolConfig"],yV(A));const v=l(e,["labels"]);n!==void 0&&v!=null&&a(n,["labels"],v);const w=l(e,["cachedContent"]);n!==void 0&&w!=null&&a(n,["cachedContent"],Bn(t,w));const x=l(e,["responseModalities"]);x!=null&&a(r,["responseModalities"],x);const D=l(e,["mediaResolution"]);D!=null&&a(r,["mediaResolution"],D);const N=l(e,["speechConfig"]);N!=null&&a(r,["speechConfig"],uV(Jh(N)));const P=l(e,["audioTimestamp"]);P!=null&&a(r,["audioTimestamp"],P);const Ae=l(e,["thinkingConfig"]);return Ae!=null&&a(r,["thinkingConfig"],hV(Ae)),r}function h_(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["_url","model"],de(t,r));const i=l(e,["contents"]);if(i!=null){let s=Kt(i);Array.isArray(s)&&(s=s.map(u=>Hu(u))),a(n,["contents"],s)}const o=l(e,["config"]);return o!=null&&a(n,["generationConfig"],QN(t,o,n)),n}function p_(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["_url","model"],de(t,r));const i=l(e,["contents"]);if(i!=null){let s=Kt(i);Array.isArray(s)&&(s=s.map(u=>xo(u))),a(n,["contents"],s)}const o=l(e,["config"]);return o!=null&&a(n,["generationConfig"],YN(t,o,n)),n}function m_(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["candidates"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(d=>Zk(d))),a(e,["candidates"],c)}const i=l(t,["modelVersion"]);i!=null&&a(e,["modelVersion"],i);const o=l(t,["promptFeedback"]);o!=null&&a(e,["promptFeedback"],o);const s=l(t,["responseId"]);s!=null&&a(e,["responseId"],s);const u=l(t,["usageMetadata"]);return u!=null&&a(e,["usageMetadata"],u),e}function g_(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["candidates"]);if(r!=null){let d=r;Array.isArray(d)&&(d=d.map(h=>jk(h))),a(e,["candidates"],d)}const i=l(t,["createTime"]);i!=null&&a(e,["createTime"],i);const o=l(t,["modelVersion"]);o!=null&&a(e,["modelVersion"],o);const s=l(t,["promptFeedback"]);s!=null&&a(e,["promptFeedback"],s);const u=l(t,["responseId"]);u!=null&&a(e,["responseId"],u);const c=l(t,["usageMetadata"]);return c!=null&&a(e,["usageMetadata"],c),e}function XN(t,e){const n={};if(l(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(l(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const r=l(t,["numberOfImages"]);e!==void 0&&r!=null&&a(e,["parameters","sampleCount"],r);const i=l(t,["aspectRatio"]);e!==void 0&&i!=null&&a(e,["parameters","aspectRatio"],i);const o=l(t,["guidanceScale"]);if(e!==void 0&&o!=null&&a(e,["parameters","guidanceScale"],o),l(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const s=l(t,["safetyFilterLevel"]);e!==void 0&&s!=null&&a(e,["parameters","safetySetting"],s);const u=l(t,["personGeneration"]);e!==void 0&&u!=null&&a(e,["parameters","personGeneration"],u);const c=l(t,["includeSafetyAttributes"]);e!==void 0&&c!=null&&a(e,["parameters","includeSafetyAttributes"],c);const d=l(t,["includeRaiReason"]);e!==void 0&&d!=null&&a(e,["parameters","includeRaiReason"],d);const h=l(t,["language"]);e!==void 0&&h!=null&&a(e,["parameters","language"],h);const p=l(t,["outputMimeType"]);e!==void 0&&p!=null&&a(e,["parameters","outputOptions","mimeType"],p);const m=l(t,["outputCompressionQuality"]);if(e!==void 0&&m!=null&&a(e,["parameters","outputOptions","compressionQuality"],m),l(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");const _=l(t,["imageSize"]);if(e!==void 0&&_!=null&&a(e,["parameters","sampleImageSize"],_),l(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function ZN(t,e){const n={},r=l(t,["outputGcsUri"]);e!==void 0&&r!=null&&a(e,["parameters","storageUri"],r);const i=l(t,["negativePrompt"]);e!==void 0&&i!=null&&a(e,["parameters","negativePrompt"],i);const o=l(t,["numberOfImages"]);e!==void 0&&o!=null&&a(e,["parameters","sampleCount"],o);const s=l(t,["aspectRatio"]);e!==void 0&&s!=null&&a(e,["parameters","aspectRatio"],s);const u=l(t,["guidanceScale"]);e!==void 0&&u!=null&&a(e,["parameters","guidanceScale"],u);const c=l(t,["seed"]);e!==void 0&&c!=null&&a(e,["parameters","seed"],c);const d=l(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&a(e,["parameters","safetySetting"],d);const h=l(t,["personGeneration"]);e!==void 0&&h!=null&&a(e,["parameters","personGeneration"],h);const p=l(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&a(e,["parameters","includeSafetyAttributes"],p);const m=l(t,["includeRaiReason"]);e!==void 0&&m!=null&&a(e,["parameters","includeRaiReason"],m);const _=l(t,["language"]);e!==void 0&&_!=null&&a(e,["parameters","language"],_);const S=l(t,["outputMimeType"]);e!==void 0&&S!=null&&a(e,["parameters","outputOptions","mimeType"],S);const R=l(t,["outputCompressionQuality"]);e!==void 0&&R!=null&&a(e,["parameters","outputOptions","compressionQuality"],R);const M=l(t,["addWatermark"]);e!==void 0&&M!=null&&a(e,["parameters","addWatermark"],M);const I=l(t,["imageSize"]);e!==void 0&&I!=null&&a(e,["parameters","sampleImageSize"],I);const T=l(t,["enhancePrompt"]);return e!==void 0&&T!=null&&a(e,["parameters","enhancePrompt"],T),n}function jN(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["_url","model"],de(t,r));const i=l(e,["prompt"]);i!=null&&a(n,["instances[0]","prompt"],i);const o=l(e,["config"]);return o!=null&&XN(o,n),n}function e1(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["_url","model"],de(t,r));const i=l(e,["prompt"]);i!=null&&a(n,["instances[0]","prompt"],i);const o=l(e,["config"]);return o!=null&&ZN(o,n),n}function t1(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>h1(s))),a(e,["generatedImages"],o)}const i=l(t,["positivePromptSafetyAttributes"]);return i!=null&&a(e,["positivePromptSafetyAttributes"],MI(i)),e}function n1(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>Ku(s))),a(e,["generatedImages"],o)}const i=l(t,["positivePromptSafetyAttributes"]);return i!=null&&a(e,["positivePromptSafetyAttributes"],kI(i)),e}function r1(t,e){const n={},r=l(t,["numberOfVideos"]);if(e!==void 0&&r!=null&&a(e,["parameters","sampleCount"],r),l(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(l(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const i=l(t,["durationSeconds"]);if(e!==void 0&&i!=null&&a(e,["parameters","durationSeconds"],i),l(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const o=l(t,["aspectRatio"]);e!==void 0&&o!=null&&a(e,["parameters","aspectRatio"],o);const s=l(t,["resolution"]);e!==void 0&&s!=null&&a(e,["parameters","resolution"],s);const u=l(t,["personGeneration"]);if(e!==void 0&&u!=null&&a(e,["parameters","personGeneration"],u),l(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const c=l(t,["negativePrompt"]);e!==void 0&&c!=null&&a(e,["parameters","negativePrompt"],c);const d=l(t,["enhancePrompt"]);if(e!==void 0&&d!=null&&a(e,["parameters","enhancePrompt"],d),l(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");if(l(t,["lastFrame"])!==void 0)throw new Error("lastFrame parameter is not supported in Gemini API.");if(l(t,["referenceImages"])!==void 0)throw new Error("referenceImages parameter is not supported in Gemini API.");if(l(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(l(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function i1(t,e){const n={},r=l(t,["numberOfVideos"]);e!==void 0&&r!=null&&a(e,["parameters","sampleCount"],r);const i=l(t,["outputGcsUri"]);e!==void 0&&i!=null&&a(e,["parameters","storageUri"],i);const o=l(t,["fps"]);e!==void 0&&o!=null&&a(e,["parameters","fps"],o);const s=l(t,["durationSeconds"]);e!==void 0&&s!=null&&a(e,["parameters","durationSeconds"],s);const u=l(t,["seed"]);e!==void 0&&u!=null&&a(e,["parameters","seed"],u);const c=l(t,["aspectRatio"]);e!==void 0&&c!=null&&a(e,["parameters","aspectRatio"],c);const d=l(t,["resolution"]);e!==void 0&&d!=null&&a(e,["parameters","resolution"],d);const h=l(t,["personGeneration"]);e!==void 0&&h!=null&&a(e,["parameters","personGeneration"],h);const p=l(t,["pubsubTopic"]);e!==void 0&&p!=null&&a(e,["parameters","pubsubTopic"],p);const m=l(t,["negativePrompt"]);e!==void 0&&m!=null&&a(e,["parameters","negativePrompt"],m);const _=l(t,["enhancePrompt"]);e!==void 0&&_!=null&&a(e,["parameters","enhancePrompt"],_);const S=l(t,["generateAudio"]);e!==void 0&&S!=null&&a(e,["parameters","generateAudio"],S);const R=l(t,["lastFrame"]);e!==void 0&&R!=null&&a(e,["instances[0]","lastFrame"],on(R));const M=l(t,["referenceImages"]);if(e!==void 0&&M!=null){let C=M;Array.isArray(C)&&(C=C.map(k=>UV(k))),a(e,["instances[0]","referenceImages"],C)}const I=l(t,["mask"]);e!==void 0&&I!=null&&a(e,["instances[0]","mask"],FV(I));const T=l(t,["compressionQuality"]);return e!==void 0&&T!=null&&a(e,["parameters","compressionQuality"],T),n}function o1(t){const e={},n=l(t,["name"]);n!=null&&a(e,["name"],n);const r=l(t,["metadata"]);r!=null&&a(e,["metadata"],r);const i=l(t,["done"]);i!=null&&a(e,["done"],i);const o=l(t,["error"]);o!=null&&a(e,["error"],o);const s=l(t,["response","generateVideoResponse"]);return s!=null&&a(e,["response"],u1(s)),e}function s1(t){const e={},n=l(t,["name"]);n!=null&&a(e,["name"],n);const r=l(t,["metadata"]);r!=null&&a(e,["metadata"],r);const i=l(t,["done"]);i!=null&&a(e,["done"],i);const o=l(t,["error"]);o!=null&&a(e,["error"],o);const s=l(t,["response"]);return s!=null&&a(e,["response"],c1(s)),e}function l1(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["_url","model"],de(t,r));const i=l(e,["prompt"]);i!=null&&a(n,["instances[0]","prompt"],i);const o=l(e,["image"]);if(o!=null&&a(n,["instances[0]","image"],DI(o)),l(e,["video"])!==void 0)throw new Error("video parameter is not supported in Gemini API.");const s=l(e,["source"]);s!=null&&d1(s,n);const u=l(e,["config"]);return u!=null&&r1(u,n),n}function a1(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["_url","model"],de(t,r));const i=l(e,["prompt"]);i!=null&&a(n,["instances[0]","prompt"],i);const o=l(e,["image"]);o!=null&&a(n,["instances[0]","image"],on(o));const s=l(e,["video"]);s!=null&&a(n,["instances[0]","video"],VI(s));const u=l(e,["source"]);u!=null&&f1(u,n);const c=l(e,["config"]);return c!=null&&i1(c,n),n}function u1(t){const e={},n=l(t,["generatedSamples"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(s=>m1(s))),a(e,["generatedVideos"],o)}const r=l(t,["raiMediaFilteredCount"]);r!=null&&a(e,["raiMediaFilteredCount"],r);const i=l(t,["raiMediaFilteredReasons"]);return i!=null&&a(e,["raiMediaFilteredReasons"],i),e}function c1(t){const e={},n=l(t,["videos"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(s=>g1(s))),a(e,["generatedVideos"],o)}const r=l(t,["raiMediaFilteredCount"]);r!=null&&a(e,["raiMediaFilteredCount"],r);const i=l(t,["raiMediaFilteredReasons"]);return i!=null&&a(e,["raiMediaFilteredReasons"],i),e}function d1(t,e){const n={},r=l(t,["prompt"]);e!==void 0&&r!=null&&a(e,["instances[0]","prompt"],r);const i=l(t,["image"]);if(e!==void 0&&i!=null&&a(e,["instances[0]","image"],DI(i)),l(t,["video"])!==void 0)throw new Error("video parameter is not supported in Gemini API.");return n}function f1(t,e){const n={},r=l(t,["prompt"]);e!==void 0&&r!=null&&a(e,["instances[0]","prompt"],r);const i=l(t,["image"]);e!==void 0&&i!=null&&a(e,["instances[0]","image"],on(i));const o=l(t,["video"]);return e!==void 0&&o!=null&&a(e,["instances[0]","video"],VI(o)),n}function h1(t){const e={},n=l(t,["_self"]);n!=null&&a(e,["image"],w1(n));const r=l(t,["raiFilteredReason"]);r!=null&&a(e,["raiFilteredReason"],r);const i=l(t,["_self"]);return i!=null&&a(e,["safetyAttributes"],MI(i)),e}function Ku(t){const e={},n=l(t,["_self"]);n!=null&&a(e,["image"],PI(n));const r=l(t,["raiFilteredReason"]);r!=null&&a(e,["raiFilteredReason"],r);const i=l(t,["_self"]);i!=null&&a(e,["safetyAttributes"],kI(i));const o=l(t,["prompt"]);return o!=null&&a(e,["enhancedPrompt"],o),e}function p1(t){const e={},n=l(t,["_self"]);n!=null&&a(e,["mask"],PI(n));const r=l(t,["labels"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>FN(o))),a(e,["labels"],i)}return e}function m1(t){const e={},n=l(t,["_self"]);return n!=null&&a(e,["video"],VV(n)),e}function g1(t){const e={},n=l(t,["_self"]);return n!=null&&a(e,["video"],LV(n)),e}function y1(t,e){const n={},r=l(e,["model"]);return r!=null&&a(n,["_url","name"],de(t,r)),n}function _1(t,e){const n={},r=l(e,["model"]);return r!=null&&a(n,["_url","name"],de(t,r)),n}function v1(t){const e={},n=l(t,["authConfig"]);return n!=null&&a(e,["authConfig"],Wk(n)),e}function T1(t){const e={},n=l(t,["dynamicRetrievalConfig"]);return n!=null&&a(e,["dynamicRetrievalConfig"],EN(n)),e}function E1(t){const e={},n=l(t,["dynamicRetrievalConfig"]);return n!=null&&a(e,["dynamicRetrievalConfig"],IN(n)),e}function I1(t){const e={},n=l(t,["timeRangeFilter"]);if(n!=null&&a(e,["timeRangeFilter"],S1(n)),l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function C1(t){const e={},n=l(t,["timeRangeFilter"]);n!=null&&a(e,["timeRangeFilter"],A1(n));const r=l(t,["excludeDomains"]);return r!=null&&a(e,["excludeDomains"],r),e}function w1(t){const e={},n=l(t,["bytesBase64Encoded"]);n!=null&&a(e,["imageBytes"],hi(n));const r=l(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function PI(t){const e={},n=l(t,["gcsUri"]);n!=null&&a(e,["gcsUri"],n);const r=l(t,["bytesBase64Encoded"]);r!=null&&a(e,["imageBytes"],hi(r));const i=l(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function DI(t){const e={};if(l(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=l(t,["imageBytes"]);n!=null&&a(e,["bytesBase64Encoded"],hi(n));const r=l(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function on(t){const e={},n=l(t,["gcsUri"]);n!=null&&a(e,["gcsUri"],n);const r=l(t,["imageBytes"]);r!=null&&a(e,["bytesBase64Encoded"],hi(r));const i=l(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function S1(t){const e={},n=l(t,["startTime"]);n!=null&&a(e,["startTime"],n);const r=l(t,["endTime"]);return r!=null&&a(e,["endTime"],r),e}function A1(t){const e={},n=l(t,["startTime"]);n!=null&&a(e,["startTime"],n);const r=l(t,["endTime"]);return r!=null&&a(e,["endTime"],r),e}function R1(t){const e={},n=l(t,["latitude"]);n!=null&&a(e,["latitude"],n);const r=l(t,["longitude"]);return r!=null&&a(e,["longitude"],r),e}function x1(t){const e={},n=l(t,["latitude"]);n!=null&&a(e,["latitude"],n);const r=l(t,["longitude"]);return r!=null&&a(e,["longitude"],r),e}function P1(t,e,n){const r={},i=l(e,["pageSize"]);n!==void 0&&i!=null&&a(n,["_query","pageSize"],i);const o=l(e,["pageToken"]);n!==void 0&&o!=null&&a(n,["_query","pageToken"],o);const s=l(e,["filter"]);n!==void 0&&s!=null&&a(n,["_query","filter"],s);const u=l(e,["queryBase"]);return n!==void 0&&u!=null&&a(n,["_url","models_url"],hI(t,u)),r}function D1(t,e,n){const r={},i=l(e,["pageSize"]);n!==void 0&&i!=null&&a(n,["_query","pageSize"],i);const o=l(e,["pageToken"]);n!==void 0&&o!=null&&a(n,["_query","pageToken"],o);const s=l(e,["filter"]);n!==void 0&&s!=null&&a(n,["_query","filter"],s);const u=l(e,["queryBase"]);return n!==void 0&&u!=null&&a(n,["_url","models_url"],hI(t,u)),r}function M1(t,e){const n={},r=l(e,["config"]);return r!=null&&P1(t,r,n),n}function k1(t,e){const n={},r=l(e,["config"]);return r!=null&&D1(t,r,n),n}function N1(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&a(e,["nextPageToken"],r);const i=l(t,["_self"]);if(i!=null){let o=pI(i);Array.isArray(o)&&(o=o.map(s=>vf(s))),a(e,["models"],o)}return e}function V1(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&a(e,["nextPageToken"],r);const i=l(t,["_self"]);if(i!=null){let o=pI(i);Array.isArray(o)&&(o=o.map(s=>Tf(s))),a(e,["models"],o)}return e}function L1(t){const e={},n=l(t,["maskMode"]);n!=null&&a(e,["maskMode"],n);const r=l(t,["segmentationClasses"]);r!=null&&a(e,["maskClasses"],r);const i=l(t,["maskDilation"]);return i!=null&&a(e,["dilation"],i),e}function vf(t){const e={},n=l(t,["name"]);n!=null&&a(e,["name"],n);const r=l(t,["displayName"]);r!=null&&a(e,["displayName"],r);const i=l(t,["description"]);i!=null&&a(e,["description"],i);const o=l(t,["version"]);o!=null&&a(e,["version"],o);const s=l(t,["_self"]);s!=null&&a(e,["tunedModelInfo"],vV(s));const u=l(t,["inputTokenLimit"]);u!=null&&a(e,["inputTokenLimit"],u);const c=l(t,["outputTokenLimit"]);c!=null&&a(e,["outputTokenLimit"],c);const d=l(t,["supportedGenerationMethods"]);return d!=null&&a(e,["supportedActions"],d),e}function Tf(t){const e={},n=l(t,["name"]);n!=null&&a(e,["name"],n);const r=l(t,["displayName"]);r!=null&&a(e,["displayName"],r);const i=l(t,["description"]);i!=null&&a(e,["description"],i);const o=l(t,["versionId"]);o!=null&&a(e,["version"],o);const s=l(t,["deployedModels"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(m=>VN(m))),a(e,["endpoints"],p)}const u=l(t,["labels"]);u!=null&&a(e,["labels"],u);const c=l(t,["_self"]);c!=null&&a(e,["tunedModelInfo"],TV(c));const d=l(t,["defaultCheckpointId"]);d!=null&&a(e,["defaultCheckpointId"],d);const h=l(t,["checkpoints"]);if(h!=null){let p=h;Array.isArray(p)&&(p=p.map(m=>eN(m))),a(e,["checkpoints"],p)}return e}function F1(t){const e={},n=l(t,["featureSelectionPreference"]);return n!=null&&a(e,["featureSelectionPreference"],n),e}function U1(t){const e={},n=l(t,["speakerVoiceConfigs"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>lV(i))),a(e,["speakerVoiceConfigs"],r)}return e}function b1(t){const e={},n=l(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],bV(n));const r=l(t,["thought"]);r!=null&&a(e,["thought"],r);const i=l(t,["inlineData"]);i!=null&&a(e,["inlineData"],Jk(i));const o=l(t,["fileData"]);o!=null&&a(e,["fileData"],UN(o));const s=l(t,["thoughtSignature"]);s!=null&&a(e,["thoughtSignature"],s);const u=l(t,["functionCall"]);u!=null&&a(e,["functionCall"],qN(u));const c=l(t,["codeExecutionResult"]);c!=null&&a(e,["codeExecutionResult"],c);const d=l(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=l(t,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const p=l(t,["text"]);return p!=null&&a(e,["text"],p),e}function B1(t){const e={},n=l(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],BV(n));const r=l(t,["thought"]);r!=null&&a(e,["thought"],r);const i=l(t,["inlineData"]);i!=null&&a(e,["inlineData"],Qk(i));const o=l(t,["fileData"]);o!=null&&a(e,["fileData"],bN(o));const s=l(t,["thoughtSignature"]);s!=null&&a(e,["thoughtSignature"],s);const u=l(t,["functionCall"]);u!=null&&a(e,["functionCall"],GN(u));const c=l(t,["codeExecutionResult"]);c!=null&&a(e,["codeExecutionResult"],c);const d=l(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=l(t,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const p=l(t,["text"]);return p!=null&&a(e,["text"],p),e}function O1(t){const e={},n=l(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],OV(n));const r=l(t,["thought"]);r!=null&&a(e,["thought"],r);const i=l(t,["inlineData"]);i!=null&&a(e,["inlineData"],Yk(i));const o=l(t,["fileData"]);o!=null&&a(e,["fileData"],BN(o));const s=l(t,["thoughtSignature"]);s!=null&&a(e,["thoughtSignature"],s);const u=l(t,["functionCall"]);u!=null&&a(e,["functionCall"],$N(u));const c=l(t,["codeExecutionResult"]);c!=null&&a(e,["codeExecutionResult"],c);const d=l(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=l(t,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const p=l(t,["text"]);return p!=null&&a(e,["text"],p),e}function q1(t){const e={},n=l(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],qV(n));const r=l(t,["thought"]);r!=null&&a(e,["thought"],r);const i=l(t,["inlineData"]);i!=null&&a(e,["inlineData"],Xk(i));const o=l(t,["fileData"]);o!=null&&a(e,["fileData"],ON(o));const s=l(t,["thoughtSignature"]);s!=null&&a(e,["thoughtSignature"],s);const u=l(t,["functionCall"]);u!=null&&a(e,["functionCall"],zN(u));const c=l(t,["codeExecutionResult"]);c!=null&&a(e,["codeExecutionResult"],c);const d=l(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=l(t,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const p=l(t,["text"]);return p!=null&&a(e,["text"],p),e}function G1(t){const e={},n=l(t,["voiceName"]);return n!=null&&a(e,["voiceName"],n),e}function $1(t){const e={},n=l(t,["voiceName"]);return n!=null&&a(e,["voiceName"],n),e}function z1(t){const e={},n=l(t,["productImage"]);return n!=null&&a(e,["image"],on(n)),e}function H1(t,e){const n={},r=l(t,["numberOfImages"]);e!==void 0&&r!=null&&a(e,["parameters","sampleCount"],r);const i=l(t,["baseSteps"]);e!==void 0&&i!=null&&a(e,["parameters","editConfig","baseSteps"],i);const o=l(t,["outputGcsUri"]);e!==void 0&&o!=null&&a(e,["parameters","storageUri"],o);const s=l(t,["seed"]);e!==void 0&&s!=null&&a(e,["parameters","seed"],s);const u=l(t,["safetyFilterLevel"]);e!==void 0&&u!=null&&a(e,["parameters","safetySetting"],u);const c=l(t,["personGeneration"]);e!==void 0&&c!=null&&a(e,["parameters","personGeneration"],c);const d=l(t,["addWatermark"]);e!==void 0&&d!=null&&a(e,["parameters","addWatermark"],d);const h=l(t,["outputMimeType"]);e!==void 0&&h!=null&&a(e,["parameters","outputOptions","mimeType"],h);const p=l(t,["outputCompressionQuality"]);e!==void 0&&p!=null&&a(e,["parameters","outputOptions","compressionQuality"],p);const m=l(t,["enhancePrompt"]);return e!==void 0&&m!=null&&a(e,["parameters","enhancePrompt"],m),n}function K1(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["_url","model"],de(t,r));const i=l(e,["source"]);i!=null&&J1(i,n);const o=l(e,["config"]);return o!=null&&H1(o,n),n}function W1(t){const e={},n=l(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>Ku(i))),a(e,["generatedImages"],r)}return e}function J1(t,e){const n={},r=l(t,["prompt"]);e!==void 0&&r!=null&&a(e,["instances[0]","prompt"],r);const i=l(t,["personImage"]);e!==void 0&&i!=null&&a(e,["instances[0]","personImage","image"],on(i));const o=l(t,["productImages"]);if(e!==void 0&&o!=null){let s=o;Array.isArray(s)&&(s=s.map(u=>z1(u))),a(e,["instances[0]","productImages"],s)}return n}function Q1(t){const e={},n=l(t,["referenceImage"]);n!=null&&a(e,["referenceImage"],on(n));const r=l(t,["referenceId"]);r!=null&&a(e,["referenceId"],r);const i=l(t,["referenceType"]);i!=null&&a(e,["referenceType"],i);const o=l(t,["maskImageConfig"]);o!=null&&a(e,["maskImageConfig"],L1(o));const s=l(t,["controlImageConfig"]);s!=null&&a(e,["controlImageConfig"],cN(s));const u=l(t,["styleImageConfig"]);u!=null&&a(e,["styleImageConfig"],cV(u));const c=l(t,["subjectImageConfig"]);return c!=null&&a(e,["subjectImageConfig"],dV(c)),e}function Y1(t){const e={},n=l(t,["latLng"]);n!=null&&a(e,["latLng"],R1(n));const r=l(t,["languageCode"]);return r!=null&&a(e,["languageCode"],r),e}function X1(t){const e={},n=l(t,["latLng"]);n!=null&&a(e,["latLng"],x1(n));const r=l(t,["languageCode"]);return r!=null&&a(e,["languageCode"],r),e}function MI(t){const e={},n=l(t,["safetyAttributes","categories"]);n!=null&&a(e,["categories"],n);const r=l(t,["safetyAttributes","scores"]);r!=null&&a(e,["scores"],r);const i=l(t,["contentType"]);return i!=null&&a(e,["contentType"],i),e}function kI(t){const e={},n=l(t,["safetyAttributes","categories"]);n!=null&&a(e,["categories"],n);const r=l(t,["safetyAttributes","scores"]);r!=null&&a(e,["scores"],r);const i=l(t,["contentType"]);return i!=null&&a(e,["contentType"],i),e}function Z1(t){const e={};if(l(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=l(t,["category"]);n!=null&&a(e,["category"],n);const r=l(t,["threshold"]);return r!=null&&a(e,["threshold"],r),e}function j1(t){const e={},n=l(t,["method"]);n!=null&&a(e,["method"],n);const r=l(t,["category"]);r!=null&&a(e,["category"],r);const i=l(t,["threshold"]);return i!=null&&a(e,["threshold"],i),e}function eV(t){const e={},n=l(t,["anyOf"]);n!=null&&a(e,["anyOf"],n);const r=l(t,["default"]);r!=null&&a(e,["default"],r);const i=l(t,["description"]);i!=null&&a(e,["description"],i);const o=l(t,["enum"]);o!=null&&a(e,["enum"],o);const s=l(t,["example"]);s!=null&&a(e,["example"],s);const u=l(t,["format"]);u!=null&&a(e,["format"],u);const c=l(t,["items"]);c!=null&&a(e,["items"],c);const d=l(t,["maxItems"]);d!=null&&a(e,["maxItems"],d);const h=l(t,["maxLength"]);h!=null&&a(e,["maxLength"],h);const p=l(t,["maxProperties"]);p!=null&&a(e,["maxProperties"],p);const m=l(t,["maximum"]);m!=null&&a(e,["maximum"],m);const _=l(t,["minItems"]);_!=null&&a(e,["minItems"],_);const S=l(t,["minLength"]);S!=null&&a(e,["minLength"],S);const R=l(t,["minProperties"]);R!=null&&a(e,["minProperties"],R);const M=l(t,["minimum"]);M!=null&&a(e,["minimum"],M);const I=l(t,["nullable"]);I!=null&&a(e,["nullable"],I);const T=l(t,["pattern"]);T!=null&&a(e,["pattern"],T);const C=l(t,["properties"]);C!=null&&a(e,["properties"],C);const k=l(t,["propertyOrdering"]);k!=null&&a(e,["propertyOrdering"],k);const F=l(t,["required"]);F!=null&&a(e,["required"],F);const b=l(t,["title"]);b!=null&&a(e,["title"],b);const A=l(t,["type"]);return A!=null&&a(e,["type"],A),e}function tV(t){const e={},n=l(t,["anyOf"]);n!=null&&a(e,["anyOf"],n);const r=l(t,["default"]);r!=null&&a(e,["default"],r);const i=l(t,["description"]);i!=null&&a(e,["description"],i);const o=l(t,["enum"]);o!=null&&a(e,["enum"],o);const s=l(t,["example"]);s!=null&&a(e,["example"],s);const u=l(t,["format"]);u!=null&&a(e,["format"],u);const c=l(t,["items"]);c!=null&&a(e,["items"],c);const d=l(t,["maxItems"]);d!=null&&a(e,["maxItems"],d);const h=l(t,["maxLength"]);h!=null&&a(e,["maxLength"],h);const p=l(t,["maxProperties"]);p!=null&&a(e,["maxProperties"],p);const m=l(t,["maximum"]);m!=null&&a(e,["maximum"],m);const _=l(t,["minItems"]);_!=null&&a(e,["minItems"],_);const S=l(t,["minLength"]);S!=null&&a(e,["minLength"],S);const R=l(t,["minProperties"]);R!=null&&a(e,["minProperties"],R);const M=l(t,["minimum"]);M!=null&&a(e,["minimum"],M);const I=l(t,["nullable"]);I!=null&&a(e,["nullable"],I);const T=l(t,["pattern"]);T!=null&&a(e,["pattern"],T);const C=l(t,["properties"]);C!=null&&a(e,["properties"],C);const k=l(t,["propertyOrdering"]);k!=null&&a(e,["propertyOrdering"],k);const F=l(t,["required"]);F!=null&&a(e,["required"],F);const b=l(t,["title"]);b!=null&&a(e,["title"],b);const A=l(t,["type"]);return A!=null&&a(e,["type"],A),e}function nV(t){const e={},n=l(t,["image"]);return n!=null&&a(e,["image"],on(n)),e}function rV(t,e){const n={},r=l(t,["mode"]);e!==void 0&&r!=null&&a(e,["parameters","mode"],r);const i=l(t,["maxPredictions"]);e!==void 0&&i!=null&&a(e,["parameters","maxPredictions"],i);const o=l(t,["confidenceThreshold"]);e!==void 0&&o!=null&&a(e,["parameters","confidenceThreshold"],o);const s=l(t,["maskDilation"]);e!==void 0&&s!=null&&a(e,["parameters","maskDilation"],s);const u=l(t,["binaryColorThreshold"]);return e!==void 0&&u!=null&&a(e,["parameters","binaryColorThreshold"],u),n}function iV(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["_url","model"],de(t,r));const i=l(e,["source"]);i!=null&&sV(i,n);const o=l(e,["config"]);return o!=null&&rV(o,n),n}function oV(t){const e={},n=l(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>p1(i))),a(e,["generatedMasks"],r)}return e}function sV(t,e){const n={},r=l(t,["prompt"]);e!==void 0&&r!=null&&a(e,["instances[0]","prompt"],r);const i=l(t,["image"]);e!==void 0&&i!=null&&a(e,["instances[0]","image"],on(i));const o=l(t,["scribbleImage"]);return e!==void 0&&o!=null&&a(e,["instances[0]","scribble"],nV(o)),n}function lV(t){const e={},n=l(t,["speaker"]);n!=null&&a(e,["speaker"],n);const r=l(t,["voiceConfig"]);return r!=null&&a(e,["voiceConfig"],LI(r)),e}function aV(t){const e={},n=l(t,["voiceConfig"]);n!=null&&a(e,["voiceConfig"],LI(n));const r=l(t,["multiSpeakerVoiceConfig"]);r!=null&&a(e,["multiSpeakerVoiceConfig"],U1(r));const i=l(t,["languageCode"]);return i!=null&&a(e,["languageCode"],i),e}function uV(t){const e={},n=l(t,["voiceConfig"]);if(n!=null&&a(e,["voiceConfig"],GV(n)),l(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const r=l(t,["languageCode"]);return r!=null&&a(e,["languageCode"],r),e}function cV(t){const e={},n=l(t,["styleDescription"]);return n!=null&&a(e,["styleDescription"],n),e}function dV(t){const e={},n=l(t,["subjectType"]);n!=null&&a(e,["subjectType"],n);const r=l(t,["subjectDescription"]);return r!=null&&a(e,["subjectDescription"],r),e}function fV(t){const e={},n=l(t,["includeThoughts"]);n!=null&&a(e,["includeThoughts"],n);const r=l(t,["thinkingBudget"]);return r!=null&&a(e,["thinkingBudget"],r),e}function hV(t){const e={},n=l(t,["includeThoughts"]);n!=null&&a(e,["includeThoughts"],n);const r=l(t,["thinkingBudget"]);return r!=null&&a(e,["thinkingBudget"],r),e}function pV(t){const e={},n=l(t,["environment"]);n!=null&&a(e,["environment"],n);const r=l(t,["excludedPredefinedFunctions"]);return r!=null&&a(e,["excludedPredefinedFunctions"],r),e}function mV(t){const e={},n=l(t,["environment"]);n!=null&&a(e,["environment"],n);const r=l(t,["excludedPredefinedFunctions"]);return r!=null&&a(e,["excludedPredefinedFunctions"],r),e}function gV(t){const e={},n=l(t,["functionCallingConfig"]);n!=null&&a(e,["functionCallingConfig"],HN(n));const r=l(t,["retrievalConfig"]);return r!=null&&a(e,["retrievalConfig"],Y1(r)),e}function yV(t){const e={},n=l(t,["functionCallingConfig"]);n!=null&&a(e,["functionCallingConfig"],KN(n));const r=l(t,["retrievalConfig"]);return r!=null&&a(e,["retrievalConfig"],X1(r)),e}function _V(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let c=n;Array.isArray(c)&&(c=c.map(d=>WN(d))),a(e,["functionDeclarations"],c)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearch"]);r!=null&&a(e,["googleSearch"],I1(r));const i=l(t,["googleSearchRetrieval"]);if(i!=null&&a(e,["googleSearchRetrieval"],T1(i)),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(l(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");l(t,["urlContext"])!=null&&a(e,["urlContext"],DV());const s=l(t,["computerUse"]);s!=null&&a(e,["computerUse"],pV(s));const u=l(t,["codeExecution"]);return u!=null&&a(e,["codeExecution"],u),e}function NI(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(m=>JN(m))),a(e,["functionDeclarations"],p)}const r=l(t,["retrieval"]);r!=null&&a(e,["retrieval"],r);const i=l(t,["googleSearch"]);i!=null&&a(e,["googleSearch"],C1(i));const o=l(t,["googleSearchRetrieval"]);o!=null&&a(e,["googleSearchRetrieval"],E1(o));const s=l(t,["enterpriseWebSearch"]);s!=null&&a(e,["enterpriseWebSearch"],LN(s));const u=l(t,["googleMaps"]);u!=null&&a(e,["googleMaps"],v1(u)),l(t,["urlContext"])!=null&&a(e,["urlContext"],MV());const d=l(t,["computerUse"]);d!=null&&a(e,["computerUse"],mV(d));const h=l(t,["codeExecution"]);return h!=null&&a(e,["codeExecution"],h),e}function vV(t){const e={},n=l(t,["baseModel"]);n!=null&&a(e,["baseModel"],n);const r=l(t,["createTime"]);r!=null&&a(e,["createTime"],r);const i=l(t,["updateTime"]);return i!=null&&a(e,["updateTime"],i),e}function TV(t){const e={},n=l(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&a(e,["baseModel"],n);const r=l(t,["createTime"]);r!=null&&a(e,["createTime"],r);const i=l(t,["updateTime"]);return i!=null&&a(e,["updateTime"],i),e}function EV(t,e){const n={},r=l(t,["displayName"]);e!==void 0&&r!=null&&a(e,["displayName"],r);const i=l(t,["description"]);e!==void 0&&i!=null&&a(e,["description"],i);const o=l(t,["defaultCheckpointId"]);return e!==void 0&&o!=null&&a(e,["defaultCheckpointId"],o),n}function IV(t,e){const n={},r=l(t,["displayName"]);e!==void 0&&r!=null&&a(e,["displayName"],r);const i=l(t,["description"]);e!==void 0&&i!=null&&a(e,["description"],i);const o=l(t,["defaultCheckpointId"]);return e!==void 0&&o!=null&&a(e,["defaultCheckpointId"],o),n}function CV(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["_url","name"],de(t,r));const i=l(e,["config"]);return i!=null&&EV(i,n),n}function wV(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["_url","model"],de(t,r));const i=l(e,["config"]);return i!=null&&IV(i,n),n}function SV(t,e){const n={},r=l(t,["outputGcsUri"]);e!==void 0&&r!=null&&a(e,["parameters","storageUri"],r);const i=l(t,["includeRaiReason"]);e!==void 0&&i!=null&&a(e,["parameters","includeRaiReason"],i);const o=l(t,["outputMimeType"]);e!==void 0&&o!=null&&a(e,["parameters","outputOptions","mimeType"],o);const s=l(t,["outputCompressionQuality"]);e!==void 0&&s!=null&&a(e,["parameters","outputOptions","compressionQuality"],s);const u=l(t,["enhanceInputImage"]);e!==void 0&&u!=null&&a(e,["parameters","upscaleConfig","enhanceInputImage"],u);const c=l(t,["imagePreservationFactor"]);e!==void 0&&c!=null&&a(e,["parameters","upscaleConfig","imagePreservationFactor"],c);const d=l(t,["numberOfImages"]);e!==void 0&&d!=null&&a(e,["parameters","sampleCount"],d);const h=l(t,["mode"]);return e!==void 0&&h!=null&&a(e,["parameters","mode"],h),n}function AV(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["_url","model"],de(t,r));const i=l(e,["image"]);i!=null&&a(n,["instances[0]","image"],on(i));const o=l(e,["upscaleFactor"]);o!=null&&a(n,["parameters","upscaleConfig","upscaleFactor"],o);const s=l(e,["config"]);return s!=null&&SV(s,n),n}function RV(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>Ku(o))),a(e,["generatedImages"],i)}return e}function xV(t){const e={},n=l(t,["urlMetadata"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>kV(i))),a(e,["urlMetadata"],r)}return e}function PV(t){const e={},n=l(t,["urlMetadata"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>NV(i))),a(e,["urlMetadata"],r)}return e}function DV(){return{}}function MV(){return{}}function kV(t){const e={},n=l(t,["retrievedUrl"]);n!=null&&a(e,["retrievedUrl"],n);const r=l(t,["urlRetrievalStatus"]);return r!=null&&a(e,["urlRetrievalStatus"],r),e}function NV(t){const e={},n=l(t,["retrievedUrl"]);n!=null&&a(e,["retrievedUrl"],n);const r=l(t,["urlRetrievalStatus"]);return r!=null&&a(e,["urlRetrievalStatus"],r),e}function VV(t){const e={},n=l(t,["video","uri"]);n!=null&&a(e,["uri"],n);const r=l(t,["video","encodedVideo"]);r!=null&&a(e,["videoBytes"],hi(r));const i=l(t,["encoding"]);return i!=null&&a(e,["mimeType"],i),e}function LV(t){const e={},n=l(t,["gcsUri"]);n!=null&&a(e,["uri"],n);const r=l(t,["bytesBase64Encoded"]);r!=null&&a(e,["videoBytes"],hi(r));const i=l(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function FV(t){const e={},n=l(t,["image"]);n!=null&&a(e,["_self"],on(n));const r=l(t,["maskMode"]);return r!=null&&a(e,["maskMode"],r),e}function UV(t){const e={},n=l(t,["image"]);n!=null&&a(e,["image"],on(n));const r=l(t,["referenceType"]);return r!=null&&a(e,["referenceType"],r),e}function bV(t){const e={},n=l(t,["fps"]);n!=null&&a(e,["fps"],n);const r=l(t,["endOffset"]);r!=null&&a(e,["endOffset"],r);const i=l(t,["startOffset"]);return i!=null&&a(e,["startOffset"],i),e}function BV(t){const e={},n=l(t,["fps"]);n!=null&&a(e,["fps"],n);const r=l(t,["endOffset"]);r!=null&&a(e,["endOffset"],r);const i=l(t,["startOffset"]);return i!=null&&a(e,["startOffset"],i),e}function OV(t){const e={},n=l(t,["fps"]);n!=null&&a(e,["fps"],n);const r=l(t,["endOffset"]);r!=null&&a(e,["endOffset"],r);const i=l(t,["startOffset"]);return i!=null&&a(e,["startOffset"],i),e}function qV(t){const e={},n=l(t,["fps"]);n!=null&&a(e,["fps"],n);const r=l(t,["endOffset"]);r!=null&&a(e,["endOffset"],r);const i=l(t,["startOffset"]);return i!=null&&a(e,["startOffset"],i),e}function VI(t){const e={},n=l(t,["uri"]);n!=null&&a(e,["gcsUri"],n);const r=l(t,["videoBytes"]);r!=null&&a(e,["bytesBase64Encoded"],hi(r));const i=l(t,["mimeType"]);return i!=null&&a(e,["mimeType"],i),e}function LI(t){const e={},n=l(t,["prebuiltVoiceConfig"]);return n!=null&&a(e,["prebuiltVoiceConfig"],G1(n)),e}function GV(t){const e={},n=l(t,["prebuiltVoiceConfig"]);return n!=null&&a(e,["prebuiltVoiceConfig"],$1(n)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const $V="Content-Type",zV="X-Server-Timeout",HV="User-Agent",Ef="x-goog-api-client",KV="1.21.0",WV=`google-genai-sdk/${KV}`,JV="v1beta1",QV="v1beta",y_=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class YV{constructor(e){var n,r;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:JV,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:QV,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const r=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&r.push(e.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,r){const i=[this.getRequestUrlInternal(n)];return r&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,n,r);if(e.queryParams)for(const[s,u]of Object.entries(e.queryParams))i.searchParams.append(s,String(u));let o={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=e.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,n,e.abortSignal),this.unaryApiCall(i,o,e.httpMethod)}patchHttpOptions(e,n){const r=JSON.parse(JSON.stringify(e));for(const[i,o]of Object.entries(n))typeof o=="object"?r[i]=Object.assign(Object.assign({},r[i]),o):o!==void 0&&(r[i]=o);return r}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,n,r);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let o={};return o.body=e.body,o=await this.includeExtraHttpOptionsToRequestInit(o,n,e.abortSignal),this.streamApiCall(i,o,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,r){if(n&&n.timeout||r){const i=new AbortController,o=i.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const s=setTimeout(()=>i.abort(),n.timeout);s&&typeof s.unref=="function"&&s.unref()}r&&r.addEventListener("abort",()=>{i.abort()}),e.signal=o}return n&&n.extraBody!==null&&XV(e,n.extraBody),e.headers=await this.getHeadersInternal(n),e}async unaryApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async i=>(await __(i),new pf(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async i=>(await __(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){var n;return to(this,arguments,function*(){const i=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),o=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let s="";for(;;){const{done:u,value:c}=yield Te(i.read());if(u){if(s.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const d=o.decode(c,{stream:!0});try{const p=JSON.parse(d);if("error"in p){const m=JSON.parse(JSON.stringify(p.error)),_=m.status,S=m.code,R=`got status: ${_}. ${JSON.stringify(p)}`;if(S>=400&&S<600)throw new zu({message:R,status:S})}}catch(p){if(p.name==="ApiError")throw p}s+=d;let h=s.match(y_);for(;h;){const p=h[1];try{const m=new Response(p,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield Te(new pf(m)),s=s.slice(h[0].length),h=s.match(y_)}catch(m){throw new Error(`exception parsing stream chunk ${p}. ${m}`)}}}}finally{i.releaseLock()}})}async apiCall(e,n){return fetch(e,n).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){const e={},n=WV+" "+this.clientOptions.userAgentExtra;return e[HV]=n,e[Ef]=n,e[$V]="application/json",e}async getHeadersInternal(e){const n=new Headers;if(e&&e.headers){for(const[r,i]of Object.entries(e.headers))n.append(r,i);e.timeout&&e.timeout>0&&n.append(zV,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n),n}async uploadFile(e,n){var r;const i={};n!=null&&(i.mimeType=n.mimeType,i.name=n.name,i.displayName=n.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const o=this.clientOptions.uploader,s=await o.stat(e);i.sizeBytes=String(s.size);const u=(r=n==null?void 0:n.mimeType)!==null&&r!==void 0?r:s.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=u;const c=await this.fetchUploadUrl(i,n);return o.upload(e,c,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n){var r;let i={};n!=null&&n.httpOptions?i=n.httpOptions:i={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};const o={file:e},s=await this.request({path:J("upload/v1beta/files",o._url),body:JSON.stringify(o),httpMethod:"POST",httpOptions:i});if(!s||!(s!=null&&s.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const u=(r=s==null?void 0:s.headers)===null||r===void 0?void 0:r["x-goog-upload-url"];if(u===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return u}}async function __(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const n=t.status;let r;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?r=await t.json():r={error:{message:await t.text(),code:t.status,status:t.statusText}};const i=JSON.stringify(r);throw n>=400&&n<600?new zu({message:i,status:n}):new Error(i)}}function XV(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{const o=JSON.parse(t.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))n=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(o,s){const u=Object.assign({},o);for(const c in s)if(Object.prototype.hasOwnProperty.call(s,c)){const d=s[c],h=u[c];d&&typeof d=="object"&&!Array.isArray(d)&&h&&typeof h=="object"&&!Array.isArray(h)?u[c]=r(h,d):(h&&d&&typeof h!=typeof d&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${c}". Original type: ${typeof h}, New type: ${typeof d}. Overwriting.`),u[c]=d)}return u}const i=r(n,e);t.body=JSON.stringify(i)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ZV="mcp_used/unknown";let jV=!1;function FI(t){for(const e of t)if(eL(e)||typeof e=="object"&&"inputSchema"in e)return!0;return jV}function UI(t){var e;const n=(e=t[Ef])!==null&&e!==void 0?e:"";t[Ef]=(n+` ${ZV}`).trimStart()}function eL(t){return t!==null&&typeof t=="object"&&t instanceof Xh}function tL(t,e=100){return to(this,arguments,function*(){let r,i=0;for(;i<e;){const o=yield Te(t.listTools({cursor:r}));for(const s of o.tools)yield yield Te(s),i++;if(!o.nextCursor)break;r=o.nextCursor}})}class Xh{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new Xh(e,n)}async initialize(){var e,n,r,i;if(this.mcpTools.length>0)return;const o={},s=[];for(const h of this.mcpClients)try{for(var u=!0,c=(n=void 0,As(tL(h))),d;d=await c.next(),e=d.done,!e;u=!0){i=d.value,u=!1;const p=i;s.push(p);const m=p.name;if(o[m])throw new Error(`Duplicate function name ${m} found in MCP tools. Please ensure function names are unique.`);o[m]=h}}catch(p){n={error:p}}finally{try{!u&&!e&&(r=c.return)&&await r.call(c)}finally{if(n)throw n.error}}this.mcpTools=s,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),gx(this.mcpTools,this.config)}async callTool(e){await this.initialize();const n=[];for(const r of e)if(r.name in this.functionNameToMcpClient){const i=this.functionNameToMcpClient[r.name];let o;this.config.timeout&&(o={timeout:this.config.timeout});const s=await i.callTool({name:r.name,arguments:r.args},void 0,o);n.push({functionResponse:{name:r.name,response:s.isError?{error:s}:s}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function nL(t,e,n){const r=new ax;let i;n.data instanceof Blob?i=JSON.parse(await n.data.text()):i=JSON.parse(n.data);const o=HM(i);Object.assign(r,o),e(r)}class rL{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r}async connect(e){var n,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const i=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),s=sL(this.apiClient.getDefaultHeaders()),u=this.apiClient.getApiKey(),c=`${i}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${u}`;let d=()=>{};const h=new Promise(C=>{d=C}),p=e.callbacks,m=function(){d({})},_=this.apiClient,S={onopen:m,onmessage:C=>{nL(_,p.onmessage,C)},onerror:(n=p==null?void 0:p.onerror)!==null&&n!==void 0?n:function(C){},onclose:(r=p==null?void 0:p.onclose)!==null&&r!==void 0?r:function(C){}},R=this.webSocketFactory.create(c,oL(s),S);R.connect(),await h;const M=de(this.apiClient,e.model),I=SI({model:M}),T=_f({setup:I});return R.send(JSON.stringify(T)),new iL(R,this.apiClient)}}class iL{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=JM(e),r=wI(n);this.conn.send(JSON.stringify({clientContent:r}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const n=WM(e),r=_f(n);this.conn.send(JSON.stringify(r))}sendPlaybackControl(e){const n=_f({playbackControl:e});this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(Wi.PLAY)}pause(){this.sendPlaybackControl(Wi.PAUSE)}stop(){this.sendPlaybackControl(Wi.STOP)}resetContext(){this.sendPlaybackControl(Wi.RESET_CONTEXT)}close(){this.conn.close()}}function oL(t){const e={};return t.forEach((n,r)=>{e[r]=n}),e}function sL(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const lL="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function aL(t,e,n){const r=new lx;let i;n.data instanceof Blob?i=await n.data.text():n.data instanceof ArrayBuffer?i=new TextDecoder().decode(n.data):i=n.data;const o=JSON.parse(i);if(t.isVertexAI()){const s=rk(o);Object.assign(r,s)}else{const s=nk(o);Object.assign(r,s)}e(r)}class uL{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r,this.music=new rL(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,r,i,o,s,u;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const c=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion();let h;const p=this.apiClient.getHeaders();e.config&&e.config.tools&&FI(e.config.tools)&&UI(p);const m=hL(p);if(this.apiClient.isVertexAI())h=`${c}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(m);else{const w=this.apiClient.getApiKey();let x="BidiGenerateContent",D="key";w!=null&&w.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),d!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),x="BidiGenerateContentConstrained",D="access_token"),h=`${c}/ws/google.ai.generativelanguage.${d}.GenerativeService.${x}?${D}=${w}`}let _=()=>{};const S=new Promise(w=>{_=w}),R=e.callbacks,M=function(){var w;(w=R==null?void 0:R.onopen)===null||w===void 0||w.call(R),_({})},I=this.apiClient,T={onopen:M,onmessage:w=>{aL(I,R.onmessage,w)},onerror:(n=R==null?void 0:R.onerror)!==null&&n!==void 0?n:function(w){},onclose:(r=R==null?void 0:R.onclose)!==null&&r!==void 0?r:function(w){}},C=this.webSocketFactory.create(h,fL(m),T);C.connect(),await S;let k=de(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&k.startsWith("publishers/")){const w=this.apiClient.getProject(),x=this.apiClient.getLocation();k=`projects/${w}/locations/${x}/`+k}let F={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[fu.AUDIO]}:e.config.responseModalities=[fu.AUDIO]),!((o=e.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const b=(u=(s=e.config)===null||s===void 0?void 0:s.tools)!==null&&u!==void 0?u:[],A=[];for(const w of b)if(this.isCallableTool(w)){const x=w;A.push(await x.tool())}else A.push(w);A.length>0&&(e.config.tools=A);const v={model:k,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?F=OM(this.apiClient,v):F=BM(this.apiClient,v),delete F.config,C.send(JSON.stringify(F)),new dL(C,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const cL={turnComplete:!0};class dL{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let r=[];try{r=Kt(n.turns),e.isVertexAI()?r=r.map(i=>xo(i)):r=r.map(i=>Hu(i))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:r,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let r=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?r=n.functionResponses:r=[n.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(const o of r){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!e.isVertexAI()&&!("id"in o))throw new Error(lL)}return{toolResponse:{functionResponses:r}}}sendClientContent(e){e=Object.assign(Object.assign({},cL),e);const n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:XM(e)}:n={realtimeInput:YM(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function fL(t){const e={};return t.forEach((n,r)=>{e[r]=n}),e}function hL(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const v_=10;function T_(t){var e,n,r;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(const s of(n=t==null?void 0:t.tools)!==null&&n!==void 0?n:[])if(no(s)){i=!0;break}if(!i)return!0;const o=(r=t==null?void 0:t.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function no(t){return"callTool"in t&&typeof t.callTool=="function"}function pL(t){var e,n,r;return(r=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(i=>no(i)))!==null&&r!==void 0?r:!1}function mL(t){var e,n,r;return(r=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(i=>!no(i)))!==null&&r!==void 0?r:!1}function E_(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class gL extends fi{constructor(e){super(),this.apiClient=e,this.generateContent=async n=>{var r,i,o,s,u;const c=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!pL(n)||T_(n.config))return await this.generateContentInternal(c);if(mL(n))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");let d,h;const p=Kt(c.contents),m=(o=(i=(r=c.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&o!==void 0?o:v_;let _=0;for(;_<m&&(d=await this.generateContentInternal(c),!(!d.functionCalls||d.functionCalls.length===0));){const S=d.candidates[0].content,R=[];for(const M of(u=(s=n.config)===null||s===void 0?void 0:s.tools)!==null&&u!==void 0?u:[])if(no(M)){const T=await M.callTool(d.functionCalls);R.push(...T)}_++,h={role:"user",parts:R},c.contents=Kt(c.contents),c.contents.push(S),c.contents.push(h),E_(c.config)&&(p.push(S),p.push(h))}return E_(c.config)&&(d.automaticFunctionCallingHistory=p),d},this.generateContentStream=async n=>{if(this.maybeMoveToResponseJsonSchem(n),T_(n.config)){const r=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(r)}else return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(r=>{var i;let o;const s=[];if(r!=null&&r.generatedImages)for(const c of r.generatedImages)c&&(c!=null&&c.safetyAttributes)&&((i=c==null?void 0:c.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?o=c==null?void 0:c.safetyAttributes:s.push(c);let u;return o?u={generatedImages:s,positivePromptSafetyAttributes:o,sdkHttpResponse:r.sdkHttpResponse}:u={generatedImages:s,sdkHttpResponse:r.sdkHttpResponse},u}),this.list=async n=>{var r;const s={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!s.config.queryBase){if(!((r=s.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");s.config.filter="labels.tune-type:*"}return new yl(Zr.PAGED_ITEM_MODELS,u=>this.listInternal(u),await this.listInternal(s),s)},this.editImage=async n=>{const r={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(r.referenceImages=n.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async n=>{let r={numberOfImages:1,mode:"upscale"};n.config&&(r=Object.assign(Object.assign({},r),n.config));const i={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:r};return await this.upscaleImageInternal(i)},this.generateVideos=async n=>{if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var n,r,i;const o=(n=e.config)===null||n===void 0?void 0:n.tools;if(!o)return e;const s=await Promise.all(o.map(async c=>no(c)?await c.tool():c)),u={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:s})};if(u.config.tools=s,e.config&&e.config.tools&&FI(e.config.tools)){const c=(i=(r=e.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&i!==void 0?i:{};let d=Object.assign({},c);Object.keys(d).length===0&&(d=this.apiClient.getDefaultHeaders()),UI(d),u.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:d})}return u}async initAfcToolsMap(e){var n,r,i;const o=new Map;for(const s of(r=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&r!==void 0?r:[])if(no(s)){const u=s,c=await u.tool();for(const d of(i=c.functionDeclarations)!==null&&i!==void 0?i:[]){if(!d.name)throw new Error("Function declaration name is required.");if(o.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);o.set(d.name,u)}}return o}async processAfcStream(e){var n,r,i;const o=(i=(r=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&i!==void 0?i:v_;let s=!1,u=0;const c=await this.initAfcToolsMap(e);return function(d,h,p){var m,_;return to(this,arguments,function*(){for(var S,R,M,I;u<o;){s&&(u++,s=!1);const F=yield Te(d.processParamsMaybeAddMcpUsage(p)),b=yield Te(d.generateContentStreamInternal(F)),A=[],v=[];try{for(var T=!0,C=(R=void 0,As(b)),k;k=yield Te(C.next()),S=k.done,!S;T=!0){I=k.value,T=!1;const w=I;if(yield yield Te(w),w.candidates&&(!((m=w.candidates[0])===null||m===void 0)&&m.content)){v.push(w.candidates[0].content);for(const x of(_=w.candidates[0].content.parts)!==null&&_!==void 0?_:[])if(u<o&&x.functionCall){if(!x.functionCall.name)throw new Error("Function call name was not returned by the model.");if(h.has(x.functionCall.name)){const D=yield Te(h.get(x.functionCall.name).callTool([x.functionCall]));A.push(...D)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${h.keys()}, mising tool: ${x.functionCall.name}`)}}}}catch(w){R={error:w}}finally{try{!T&&!S&&(M=C.return)&&(yield Te(M.call(C)))}finally{if(R)throw R.error}}if(A.length>0){s=!0;const w=new es;w.candidates=[{content:{role:"user",parts:A}}],yield yield Te(w);const x=[];x.push(...v),x.push({role:"user",parts:A});const D=Kt(p.contents).concat(x);p.contents=D}else break}})}(this,c,e)}async generateContentInternal(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=p_(this.apiClient,e);return u=J("{model}:generateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=g_(h),m=new es;return Object.assign(m,p),m})}else{const d=h_(this.apiClient,e);return u=J("{model}:generateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=m_(h),m=new es;return Object.assign(m,p),m})}}async generateContentStreamInternal(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=p_(this.apiClient,e);return u=J("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.requestStream({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),s.then(function(p){return to(this,arguments,function*(){var m,_,S,R;try{for(var M=!0,I=As(p),T;T=yield Te(I.next()),m=T.done,!m;M=!0){R=T.value,M=!1;const C=R,k=g_(yield Te(C.json()));k.sdkHttpResponse={headers:C.headers};const F=new es;Object.assign(F,k),yield yield Te(F)}}catch(C){_={error:C}}finally{try{!M&&!m&&(S=I.return)&&(yield Te(S.call(I)))}finally{if(_)throw _.error}}})})}else{const d=h_(this.apiClient,e);return u=J("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.requestStream({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),s.then(function(p){return to(this,arguments,function*(){var m,_,S,R;try{for(var M=!0,I=As(p),T;T=yield Te(I.next()),m=T.done,!m;M=!0){R=T.value,M=!1;const C=R,k=m_(yield Te(C.json()));k.sdkHttpResponse={headers:C.headers};const F=new es;Object.assign(F,k),yield yield Te(F)}}catch(C){_={error:C}}finally{try{!M&&!m&&(S=I.return)&&(yield Te(S.call(I)))}finally{if(_)throw _.error}}})})}}async embedContent(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=MN(this.apiClient,e);return u=J("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=NN(h),m=new Wy;return Object.assign(m,p),m})}else{const d=DN(this.apiClient,e);return u=J("{model}:batchEmbedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=kN(h),m=new Wy;return Object.assign(m,p),m})}}async generateImagesInternal(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=e1(this.apiClient,e);return u=J("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=n1(h),m=new Jy;return Object.assign(m,p),m})}else{const d=jN(this.apiClient,e);return u=J("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=t1(h),m=new Jy;return Object.assign(m,p),m})}}async editImageInternal(e){var n,r;let i,o="",s={};if(this.apiClient.isVertexAI()){const u=wN(this.apiClient,e);return o=J("{model}:predict",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),i.then(c=>{const d=SN(c),h=new jR;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,r;let i,o="",s={};if(this.apiClient.isVertexAI()){const u=AV(this.apiClient,e);return o=J("{model}:predict",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),i.then(c=>{const d=RV(c),h=new ex;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var n,r;let i,o="",s={};if(this.apiClient.isVertexAI()){const u=K1(this.apiClient,e);return o=J("{model}:predict",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),i.then(c=>{const d=W1(c),h=new tx;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var n,r;let i,o="",s={};if(this.apiClient.isVertexAI()){const u=iV(this.apiClient,e);return o=J("{model}:predict",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),i.then(c=>{const d=oV(c),h=new nx;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=_1(this.apiClient,e);return u=J("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>Tf(h))}else{const d=y1(this.apiClient,e);return u=J("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>vf(h))}}async listInternal(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=k1(this.apiClient,e);return u=J("{models_url}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=V1(h),m=new Qy;return Object.assign(m,p),m})}else{const d=M1(this.apiClient,e);return u=J("{models_url}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=N1(h),m=new Qy;return Object.assign(m,p),m})}}async update(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=wV(this.apiClient,e);return u=J("{model}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>Tf(h))}else{const d=CV(this.apiClient,e);return u=J("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>vf(h))}}async delete(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=_N(this.apiClient,e);return u=J("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=TN(h),m=new Yy;return Object.assign(m,p),m})}else{const d=yN(this.apiClient,e);return u=J("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=vN(h),m=new Yy;return Object.assign(m,p),m})}}async countTokens(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=pN(this.apiClient,e);return u=J("{model}:countTokens",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=gN(h),m=new Xy;return Object.assign(m,p),m})}else{const d=hN(this.apiClient,e);return u=J("{model}:countTokens",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=mN(h),m=new Xy;return Object.assign(m,p),m})}}async computeTokens(e){var n,r;let i,o="",s={};if(this.apiClient.isVertexAI()){const u=rN(this.apiClient,e);return o=J("{model}:computeTokens",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),i.then(c=>{const d=iN(c),h=new rx;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=a1(this.apiClient,e);return u=J("{model}:predictLongRunning",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>{const p=s1(h),m=new hu;return Object.assign(m,p),m})}else{const d=l1(this.apiClient,e);return u=J("{model}:predictLongRunning",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>{const p=o1(h),m=new hu;return Object.assign(m,p),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class yL extends fi{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=n.name.split("/operations/")[0];let o;r&&"httpOptions"in r&&(o=r.httpOptions);const s=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:i,config:{httpOptions:o}});return n._fromAPIResponse({apiResponse:s,isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:i,isVertexAI:!1})}}async get(e){const n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=n.name.split("/operations/")[0];let o;r&&"httpOptions"in r&&(o=r.httpOptions);const s=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:i,config:{httpOptions:o}});return n._fromAPIResponse({apiResponse:s,isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:i,isVertexAI:!1})}}async getVideosOperationInternal(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=YR(e);return u=J("{operationName}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s}else{const d=QR(e);return u=J("{operationName}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s}}async fetchPredictVideosOperationInternal(e){var n,r;let i,o="",s={};if(this.apiClient.isVertexAI()){const u=GR(e);return o=J("{resourceName}:fetchPredictOperation",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function I_(){return{}}function _L(t){const e={},n=l(t,["name"]);return n!=null&&a(e,["name"],n),e}function vL(t){const e={},n=l(t,["disabled"]);n!=null&&a(e,["disabled"],n);const r=l(t,["startOfSpeechSensitivity"]);r!=null&&a(e,["startOfSpeechSensitivity"],r);const i=l(t,["endOfSpeechSensitivity"]);i!=null&&a(e,["endOfSpeechSensitivity"],i);const o=l(t,["prefixPaddingMs"]);o!=null&&a(e,["prefixPaddingMs"],o);const s=l(t,["silenceDurationMs"]);return s!=null&&a(e,["silenceDurationMs"],s),e}function TL(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["data"]);n!=null&&a(e,["data"],n);const r=l(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function EL(t){const e={},n=l(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>LL(o))),a(e,["parts"],i)}const r=l(t,["role"]);return r!=null&&a(e,["role"],r),e}function IL(t){const e={},n=l(t,["triggerTokens"]);n!=null&&a(e,["triggerTokens"],n);const r=l(t,["slidingWindow"]);return r!=null&&a(e,["slidingWindow"],OL(r)),e}function CL(t,e,n){const r={},i=l(e,["expireTime"]);n!==void 0&&i!=null&&a(n,["expireTime"],i);const o=l(e,["newSessionExpireTime"]);n!==void 0&&o!=null&&a(n,["newSessionExpireTime"],o);const s=l(e,["uses"]);n!==void 0&&s!=null&&a(n,["uses"],s);const u=l(e,["liveConnectConstraints"]);n!==void 0&&u!=null&&a(n,["bidiGenerateContentSetup"],NL(t,u));const c=l(e,["lockAdditionalFields"]);return n!==void 0&&c!=null&&a(n,["fieldMask"],c),r}function wL(t,e){const n={},r=l(e,["config"]);return r!=null&&a(n,["config"],CL(t,r,n)),n}function SL(t){const e={},n=l(t,["mode"]);n!=null&&a(e,["mode"],n);const r=l(t,["dynamicThreshold"]);return r!=null&&a(e,["dynamicThreshold"],r),e}function AL(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["fileUri"]);n!=null&&a(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&a(e,["mimeType"],r),e}function RL(t){const e={},n=l(t,["id"]);n!=null&&a(e,["id"],n);const r=l(t,["args"]);r!=null&&a(e,["args"],r);const i=l(t,["name"]);return i!=null&&a(e,["name"],i),e}function xL(t){const e={},n=l(t,["behavior"]);n!=null&&a(e,["behavior"],n);const r=l(t,["description"]);r!=null&&a(e,["description"],r);const i=l(t,["name"]);i!=null&&a(e,["name"],i);const o=l(t,["parameters"]);o!=null&&a(e,["parameters"],o);const s=l(t,["parametersJsonSchema"]);s!=null&&a(e,["parametersJsonSchema"],s);const u=l(t,["response"]);u!=null&&a(e,["response"],u);const c=l(t,["responseJsonSchema"]);return c!=null&&a(e,["responseJsonSchema"],c),e}function PL(t){const e={},n=l(t,["dynamicRetrievalConfig"]);return n!=null&&a(e,["dynamicRetrievalConfig"],SL(n)),e}function DL(t){const e={},n=l(t,["timeRangeFilter"]);if(n!=null&&a(e,["timeRangeFilter"],ML(n)),l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function ML(t){const e={},n=l(t,["startTime"]);n!=null&&a(e,["startTime"],n);const r=l(t,["endTime"]);return r!=null&&a(e,["endTime"],r),e}function kL(t,e){const n={},r=l(t,["generationConfig"]);e!==void 0&&r!=null&&a(e,["setup","generationConfig"],r);const i=l(t,["responseModalities"]);e!==void 0&&i!=null&&a(e,["setup","generationConfig","responseModalities"],i);const o=l(t,["temperature"]);e!==void 0&&o!=null&&a(e,["setup","generationConfig","temperature"],o);const s=l(t,["topP"]);e!==void 0&&s!=null&&a(e,["setup","generationConfig","topP"],s);const u=l(t,["topK"]);e!==void 0&&u!=null&&a(e,["setup","generationConfig","topK"],u);const c=l(t,["maxOutputTokens"]);e!==void 0&&c!=null&&a(e,["setup","generationConfig","maxOutputTokens"],c);const d=l(t,["mediaResolution"]);e!==void 0&&d!=null&&a(e,["setup","generationConfig","mediaResolution"],d);const h=l(t,["seed"]);e!==void 0&&h!=null&&a(e,["setup","generationConfig","seed"],h);const p=l(t,["speechConfig"]);e!==void 0&&p!=null&&a(e,["setup","generationConfig","speechConfig"],GL(Qh(p)));const m=l(t,["enableAffectiveDialog"]);e!==void 0&&m!=null&&a(e,["setup","generationConfig","enableAffectiveDialog"],m);const _=l(t,["systemInstruction"]);e!==void 0&&_!=null&&a(e,["setup","systemInstruction"],EL(dt(_)));const S=l(t,["tools"]);if(e!==void 0&&S!=null){let F=Ao(S);Array.isArray(F)&&(F=F.map(b=>zL(So(b)))),a(e,["setup","tools"],F)}const R=l(t,["sessionResumption"]);e!==void 0&&R!=null&&a(e,["setup","sessionResumption"],BL(R));const M=l(t,["inputAudioTranscription"]);e!==void 0&&M!=null&&a(e,["setup","inputAudioTranscription"],I_());const I=l(t,["outputAudioTranscription"]);e!==void 0&&I!=null&&a(e,["setup","outputAudioTranscription"],I_());const T=l(t,["realtimeInputConfig"]);e!==void 0&&T!=null&&a(e,["setup","realtimeInputConfig"],bL(T));const C=l(t,["contextWindowCompression"]);e!==void 0&&C!=null&&a(e,["setup","contextWindowCompression"],IL(C));const k=l(t,["proactivity"]);return e!==void 0&&k!=null&&a(e,["setup","proactivity"],UL(k)),n}function NL(t,e){const n={},r=l(e,["model"]);r!=null&&a(n,["setup","model"],de(t,r));const i=l(e,["config"]);return i!=null&&a(n,["config"],kL(i,n)),n}function VL(t){const e={},n=l(t,["speakerVoiceConfigs"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>qL(i))),a(e,["speakerVoiceConfigs"],r)}return e}function LL(t){const e={},n=l(t,["videoMetadata"]);n!=null&&a(e,["videoMetadata"],KL(n));const r=l(t,["thought"]);r!=null&&a(e,["thought"],r);const i=l(t,["inlineData"]);i!=null&&a(e,["inlineData"],TL(i));const o=l(t,["fileData"]);o!=null&&a(e,["fileData"],AL(o));const s=l(t,["thoughtSignature"]);s!=null&&a(e,["thoughtSignature"],s);const u=l(t,["functionCall"]);u!=null&&a(e,["functionCall"],RL(u));const c=l(t,["codeExecutionResult"]);c!=null&&a(e,["codeExecutionResult"],c);const d=l(t,["executableCode"]);d!=null&&a(e,["executableCode"],d);const h=l(t,["functionResponse"]);h!=null&&a(e,["functionResponse"],h);const p=l(t,["text"]);return p!=null&&a(e,["text"],p),e}function FL(t){const e={},n=l(t,["voiceName"]);return n!=null&&a(e,["voiceName"],n),e}function UL(t){const e={},n=l(t,["proactiveAudio"]);return n!=null&&a(e,["proactiveAudio"],n),e}function bL(t){const e={},n=l(t,["automaticActivityDetection"]);n!=null&&a(e,["automaticActivityDetection"],vL(n));const r=l(t,["activityHandling"]);r!=null&&a(e,["activityHandling"],r);const i=l(t,["turnCoverage"]);return i!=null&&a(e,["turnCoverage"],i),e}function BL(t){const e={},n=l(t,["handle"]);if(n!=null&&a(e,["handle"],n),l(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function OL(t){const e={},n=l(t,["targetTokens"]);return n!=null&&a(e,["targetTokens"],n),e}function qL(t){const e={},n=l(t,["speaker"]);n!=null&&a(e,["speaker"],n);const r=l(t,["voiceConfig"]);return r!=null&&a(e,["voiceConfig"],bI(r)),e}function GL(t){const e={},n=l(t,["voiceConfig"]);n!=null&&a(e,["voiceConfig"],bI(n));const r=l(t,["multiSpeakerVoiceConfig"]);r!=null&&a(e,["multiSpeakerVoiceConfig"],VL(r));const i=l(t,["languageCode"]);return i!=null&&a(e,["languageCode"],i),e}function $L(t){const e={},n=l(t,["environment"]);n!=null&&a(e,["environment"],n);const r=l(t,["excludedPredefinedFunctions"]);return r!=null&&a(e,["excludedPredefinedFunctions"],r),e}function zL(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let c=n;Array.isArray(c)&&(c=c.map(d=>xL(d))),a(e,["functionDeclarations"],c)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearch"]);r!=null&&a(e,["googleSearch"],DL(r));const i=l(t,["googleSearchRetrieval"]);if(i!=null&&a(e,["googleSearchRetrieval"],PL(i)),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(l(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");l(t,["urlContext"])!=null&&a(e,["urlContext"],HL());const s=l(t,["computerUse"]);s!=null&&a(e,["computerUse"],$L(s));const u=l(t,["codeExecution"]);return u!=null&&a(e,["codeExecution"],u),e}function HL(){return{}}function KL(t){const e={},n=l(t,["fps"]);n!=null&&a(e,["fps"],n);const r=l(t,["endOffset"]);r!=null&&a(e,["endOffset"],r);const i=l(t,["startOffset"]);return i!=null&&a(e,["startOffset"],i),e}function bI(t){const e={},n=l(t,["prebuiltVoiceConfig"]);return n!=null&&a(e,["prebuiltVoiceConfig"],FL(n)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function WL(t){const e=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const r=t[n];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){const i=Object.keys(r).map(o=>`${n}.${o}`);e.push(...i)}else e.push(n)}return e.join(",")}function JL(t,e){let n=null;const r=t.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){const o=r.setup;typeof o=="object"&&o!==null?(t.bidiGenerateContentSetup=o,n=o):delete t.bidiGenerateContentSetup}else r!==void 0&&delete t.bidiGenerateContentSetup;const i=t.fieldMask;if(n){const o=WL(n);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)o?t.fieldMask=o:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){const s=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let u=[];i.length>0&&(u=i.map(d=>s.includes(d)?`generationConfig.${d}`:d));const c=[];o&&c.push(o),u.length>0&&c.push(...u),c.length>0?t.fieldMask=c.join(","):delete t.fieldMask}else delete t.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?t.fieldMask=i.join(","):delete t.fieldMask;return t}class QL extends fi{constructor(e){super(),this.apiClient=e}async create(e){var n,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const u=wL(this.apiClient,e);o=J("auth_tokens",u._url),s=u._query,delete u.config,delete u._url,delete u._query;const c=JL(u,e.config);return i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>_L(d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function YL(t){const e={},n=l(t,["name"]);return n!=null&&a(e,["_url","name"],n),e}function XL(t){const e={},n=l(t,["name"]);return n!=null&&a(e,["_url","name"],n),e}function ZL(t,e){const n={};if(l(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const r=l(t,["tunedModelDisplayName"]);if(e!==void 0&&r!=null&&a(e,["displayName"],r),l(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const i=l(t,["epochCount"]);e!==void 0&&i!=null&&a(e,["tuningTask","hyperparameters","epochCount"],i);const o=l(t,["learningRateMultiplier"]);if(o!=null&&a(n,["tuningTask","hyperparameters","learningRateMultiplier"],o),l(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(l(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(l(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const s=l(t,["batchSize"]);e!==void 0&&s!=null&&a(e,["tuningTask","hyperparameters","batchSize"],s);const u=l(t,["learningRate"]);if(e!==void 0&&u!=null&&a(e,["tuningTask","hyperparameters","learningRate"],u),l(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");return n}function jL(t,e){const n={},r=l(t,["validationDataset"]);e!==void 0&&r!=null&&a(e,["supervisedTuningSpec"],yF(r,n));const i=l(t,["tunedModelDisplayName"]);e!==void 0&&i!=null&&a(e,["tunedModelDisplayName"],i);const o=l(t,["description"]);e!==void 0&&o!=null&&a(e,["description"],o);const s=l(t,["epochCount"]);e!==void 0&&s!=null&&a(e,["supervisedTuningSpec","hyperParameters","epochCount"],s);const u=l(t,["learningRateMultiplier"]);e!==void 0&&u!=null&&a(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],u);const c=l(t,["exportLastCheckpointOnly"]);e!==void 0&&c!=null&&a(e,["supervisedTuningSpec","exportLastCheckpointOnly"],c);const d=l(t,["adapterSize"]);if(e!==void 0&&d!=null&&a(e,["supervisedTuningSpec","hyperParameters","adapterSize"],d),l(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(l(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const h=l(t,["labels"]);return e!==void 0&&h!=null&&a(e,["labels"],h),n}function eF(t){const e={},n=l(t,["baseModel"]);n!=null&&a(e,["baseModel"],n);const r=l(t,["preTunedModel"]);r!=null&&a(e,["preTunedModel"],r);const i=l(t,["trainingDataset"]);i!=null&&a(e,["tuningTask","trainingData"],hF(i));const o=l(t,["config"]);return o!=null&&ZL(o,e),e}function tF(t){const e={},n=l(t,["baseModel"]);n!=null&&a(e,["baseModel"],n);const r=l(t,["preTunedModel"]);r!=null&&a(e,["preTunedModel"],r);const i=l(t,["trainingDataset"]);i!=null&&a(e,["supervisedTuningSpec","trainingDatasetUri"],pF(i,e));const o=l(t,["config"]);return o!=null&&jL(o,e),e}function nF(t){const e={},n=l(t,["name"]);return n!=null&&a(e,["_url","name"],n),e}function rF(t){const e={},n=l(t,["name"]);return n!=null&&a(e,["_url","name"],n),e}function iF(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&a(e,["_query","pageSize"],r);const i=l(t,["pageToken"]);e!==void 0&&i!=null&&a(e,["_query","pageToken"],i);const o=l(t,["filter"]);return e!==void 0&&o!=null&&a(e,["_query","filter"],o),n}function oF(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&a(e,["_query","pageSize"],r);const i=l(t,["pageToken"]);e!==void 0&&i!=null&&a(e,["_query","pageToken"],i);const o=l(t,["filter"]);return e!==void 0&&o!=null&&a(e,["_query","filter"],o),n}function sF(t){const e={},n=l(t,["config"]);return n!=null&&iF(n,e),e}function lF(t){const e={},n=l(t,["config"]);return n!=null&&oF(n,e),e}function aF(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&a(e,["nextPageToken"],r);const i=l(t,["tunedModels"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>BI(s))),a(e,["tuningJobs"],o)}return e}function uF(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&a(e,["nextPageToken"],r);const i=l(t,["tuningJobs"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>If(s))),a(e,["tuningJobs"],o)}return e}function cF(t){const e={},n=l(t,["checkpointId"]);n!=null&&a(e,["checkpointId"],n);const r=l(t,["epoch"]);r!=null&&a(e,["epoch"],r);const i=l(t,["step"]);i!=null&&a(e,["step"],i);const o=l(t,["endpoint"]);return o!=null&&a(e,["endpoint"],o),e}function dF(t){const e={},n=l(t,["name"]);n!=null&&a(e,["model"],n);const r=l(t,["name"]);return r!=null&&a(e,["endpoint"],r),e}function fF(t){const e={},n=l(t,["model"]);n!=null&&a(e,["model"],n);const r=l(t,["endpoint"]);r!=null&&a(e,["endpoint"],r);const i=l(t,["checkpoints"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>cF(s))),a(e,["checkpoints"],o)}return e}function hF(t){const e={};if(l(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(l(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const n=l(t,["examples"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>mF(i))),a(e,["examples","examples"],r)}return e}function pF(t,e){const n={},r=l(t,["gcsUri"]);e!==void 0&&r!=null&&a(e,["supervisedTuningSpec","trainingDatasetUri"],r);const i=l(t,["vertexDatasetResource"]);if(e!==void 0&&i!=null&&a(e,["supervisedTuningSpec","trainingDatasetUri"],i),l(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function mF(t){const e={},n=l(t,["textInput"]);n!=null&&a(e,["textInput"],n);const r=l(t,["output"]);return r!=null&&a(e,["output"],r),e}function BI(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["name"]);r!=null&&a(e,["name"],r);const i=l(t,["state"]);i!=null&&a(e,["state"],dI(i));const o=l(t,["createTime"]);o!=null&&a(e,["createTime"],o);const s=l(t,["tuningTask","startTime"]);s!=null&&a(e,["startTime"],s);const u=l(t,["tuningTask","completeTime"]);u!=null&&a(e,["endTime"],u);const c=l(t,["updateTime"]);c!=null&&a(e,["updateTime"],c);const d=l(t,["description"]);d!=null&&a(e,["description"],d);const h=l(t,["baseModel"]);h!=null&&a(e,["baseModel"],h);const p=l(t,["_self"]);p!=null&&a(e,["tunedModel"],dF(p));const m=l(t,["customBaseModel"]);m!=null&&a(e,["customBaseModel"],m);const _=l(t,["experiment"]);_!=null&&a(e,["experiment"],_);const S=l(t,["labels"]);S!=null&&a(e,["labels"],S);const R=l(t,["outputUri"]);R!=null&&a(e,["outputUri"],R);const M=l(t,["pipelineJob"]);M!=null&&a(e,["pipelineJob"],M);const I=l(t,["serviceAccount"]);I!=null&&a(e,["serviceAccount"],I);const T=l(t,["tunedModelDisplayName"]);return T!=null&&a(e,["tunedModelDisplayName"],T),e}function If(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["name"]);r!=null&&a(e,["name"],r);const i=l(t,["state"]);i!=null&&a(e,["state"],dI(i));const o=l(t,["createTime"]);o!=null&&a(e,["createTime"],o);const s=l(t,["startTime"]);s!=null&&a(e,["startTime"],s);const u=l(t,["endTime"]);u!=null&&a(e,["endTime"],u);const c=l(t,["updateTime"]);c!=null&&a(e,["updateTime"],c);const d=l(t,["error"]);d!=null&&a(e,["error"],d);const h=l(t,["description"]);h!=null&&a(e,["description"],h);const p=l(t,["baseModel"]);p!=null&&a(e,["baseModel"],p);const m=l(t,["tunedModel"]);m!=null&&a(e,["tunedModel"],fF(m));const _=l(t,["preTunedModel"]);_!=null&&a(e,["preTunedModel"],_);const S=l(t,["supervisedTuningSpec"]);S!=null&&a(e,["supervisedTuningSpec"],S);const R=l(t,["tuningDataStats"]);R!=null&&a(e,["tuningDataStats"],R);const M=l(t,["encryptionSpec"]);M!=null&&a(e,["encryptionSpec"],M);const I=l(t,["partnerModelTuningSpec"]);I!=null&&a(e,["partnerModelTuningSpec"],I);const T=l(t,["customBaseModel"]);T!=null&&a(e,["customBaseModel"],T);const C=l(t,["experiment"]);C!=null&&a(e,["experiment"],C);const k=l(t,["labels"]);k!=null&&a(e,["labels"],k);const F=l(t,["outputUri"]);F!=null&&a(e,["outputUri"],F);const b=l(t,["pipelineJob"]);b!=null&&a(e,["pipelineJob"],b);const A=l(t,["serviceAccount"]);A!=null&&a(e,["serviceAccount"],A);const v=l(t,["tunedModelDisplayName"]);return v!=null&&a(e,["tunedModelDisplayName"],v),e}function gF(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&a(e,["sdkHttpResponse"],n);const r=l(t,["name"]);r!=null&&a(e,["name"],r);const i=l(t,["metadata"]);i!=null&&a(e,["metadata"],i);const o=l(t,["done"]);o!=null&&a(e,["done"],o);const s=l(t,["error"]);return s!=null&&a(e,["error"],s),e}function yF(t,e){const n={},r=l(t,["gcsUri"]);r!=null&&a(n,["validationDatasetUri"],r);const i=l(t,["vertexDatasetResource"]);return e!==void 0&&i!=null&&a(e,["supervisedTuningSpec","trainingDatasetUri"],i),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class _F extends fi{constructor(e){super(),this.apiClient=e,this.get=async n=>await this.getInternal(n),this.list=async(n={})=>new yl(Zr.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.tune=async n=>{var r;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const i={tunedModelName:n.baseModel};!((r=n.config)===null||r===void 0)&&r.preTunedModelCheckpointId&&(i.checkpointId=n.config.preTunedModelCheckpointId);const o=Object.assign(Object.assign({},n),{preTunedModel:i});return o.baseModel=void 0,await this.tuneInternal(o)}else{const i=Object.assign({},n);return await this.tuneInternal(i)}else{const i=Object.assign({},n),o=await this.tuneMldevInternal(i);let s="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?s=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(s=o.name.split("/operations/")[0]),{name:s,state:hf.JOB_STATE_QUEUED}}}}async getInternal(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=rF(e);return u=J("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>If(h))}else{const d=nF(e);return u=J("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>BI(h))}}async listInternal(e){var n,r,i,o;let s,u="",c={};if(this.apiClient.isVertexAI()){const d=lF(e);return u=J("tuningJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=uF(h),m=new Zy;return Object.assign(m,p),m})}else{const d=sF(e);return u=J("tunedModels",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=aF(h),m=new Zy;return Object.assign(m,p),m})}}async cancel(e){var n,r,i,o;let s="",u={};if(this.apiClient.isVertexAI()){const c=XL(e);s=J("{name}:cancel",c._url),u=c._query,delete c._url,delete c._query,await this.apiClient.request({path:s,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{const c=YL(e);s=J("{name}:cancel",c._url),u=c._query,delete c._url,delete c._query,await this.apiClient.request({path:s,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async tuneInternal(e){var n,r;let i,o="",s={};if(this.apiClient.isVertexAI()){const u=tF(e);return o=J("tuningJobs",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),i.then(c=>If(c))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=eF(e);return o=J("tunedModels",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),i.then(c=>gF(c))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class vF{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const TF=1024*1024*8,EF=3,IF=1e3,CF=2,ad="x-goog-upload-status";async function wF(t,e,n){var r,i,o;let s=0,u=0,c=new pf(new Response),d="upload";for(s=t.size;u<s;){const p=Math.min(TF,s-u),m=t.slice(u,u+p);u+p>=s&&(d+=", finalize");let _=0,S=IF;for(;_<EF&&(c=await n.request({path:"",body:m,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(u),"Content-Length":String(p)}}}),!(!((r=c==null?void 0:c.headers)===null||r===void 0)&&r[ad]));)_++,await AF(S),S=S*CF;if(u+=p,((i=c==null?void 0:c.headers)===null||i===void 0?void 0:i[ad])!=="active")break;if(s<=u)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const h=await(c==null?void 0:c.json());if(((o=c==null?void 0:c.headers)===null||o===void 0?void 0:o[ad])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return h.file}async function SF(t){return{size:t.size,type:t.type}}function AF(t){return new Promise(e=>setTimeout(e,t))}class RF{async upload(e,n,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await wF(e,n,r)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await SF(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class xF{create(e,n,r){return new PF(e,n,r)}}class PF{constructor(e,n,r){this.url=e,this.headers=n,this.callbacks=r}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const C_="x-goog-api-key";class DF{constructor(e){this.apiKey=e}async addAuthHeaders(e){if(e.get(C_)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(C_,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const MF="gl-node/";class OI{constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;const r=qR(e.httpOptions,e.vertexai,void 0,void 0);r&&(e.httpOptions?e.httpOptions.baseUrl=r:e.httpOptions={baseUrl:r}),this.apiVersion=e.apiVersion;const i=new DF(this.apiKey);this.apiClient=new YV({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:MF+"web",uploader:new RF,downloader:new vF}),this.models=new gL(this.apiClient),this.live=new uL(this.apiClient,i,new xF),this.batches=new kP(this.apiClient),this.chats=new OD(this.models,this.apiClient),this.caches=new UD(this.apiClient),this.files=new jD(this.apiClient),this.operations=new yL(this.apiClient),this.authTokens=new QL(this.apiClient),this.tunings=new _F(this.apiClient)}}var w_={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qI=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},kF=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=t[n++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){const o=t[n++],s=t[n++],u=t[n++],c=((i&7)<<18|(o&63)<<12|(s&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const o=t[n++],s=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|s&63)}}return e.join("")},GI={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const o=t[i],s=i+1<t.length,u=s?t[i+1]:0,c=i+2<t.length,d=c?t[i+2]:0,h=o>>2,p=(o&3)<<4|u>>4;let m=(u&15)<<2|d>>6,_=d&63;c||(_=64,s||(m=64)),r.push(n[h],n[p],n[m],n[_])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(qI(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):kF(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const o=n[t.charAt(i++)],u=i<t.length?n[t.charAt(i)]:0;++i;const d=i<t.length?n[t.charAt(i)]:64;++i;const p=i<t.length?n[t.charAt(i)]:64;if(++i,o==null||u==null||d==null||p==null)throw new NF;const m=o<<2|u>>4;if(r.push(m),d!==64){const _=u<<4&240|d>>2;if(r.push(_),p!==64){const S=d<<6&192|p;r.push(S)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class NF extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const VF=function(t){const e=qI(t);return GI.encodeByteArray(e,!0)},mu=function(t){return VF(t).replace(/\./g,"")},LF=function(t){try{return GI.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FF(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UF=()=>FF().__FIREBASE_DEFAULTS__,bF=()=>{if(typeof process>"u"||typeof w_>"u")return;const t=w_.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},BF=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&LF(t[1]);return e&&JSON.parse(e)},Zh=()=>{try{return UF()||bF()||BF()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},OF=t=>{var e,n;return(n=(e=Zh())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},$I=t=>{const e=OF(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},zI=()=>{var t;return(t=Zh())===null||t===void 0?void 0:t.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qF{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HI(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},t);return[mu(JSON.stringify(n)),mu(JSON.stringify(s)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gu(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function GF(){var t;const e=(t=Zh())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function KI(){return!GF()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function WI(){try{return typeof indexedDB=="object"}catch{return!1}}function $F(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var o;e(((o=i.error)===null||o===void 0?void 0:o.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zF="FirebaseError";class pi extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=zF,Object.setPrototypeOf(this,pi.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,JI.prototype.create)}}class JI{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,o=this.errors[e],s=o?HF(o,r):"Error",u=`${this.serviceName}: ${s} (${i}).`;return new pi(i,u,r)}}function HF(t,e){return t.replace(KF,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const KF=/\{\$([^}]+)}/g;function Cf(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const o=t[i],s=e[i];if(S_(o)&&S_(s)){if(!Cf(o,s))return!1}else if(o!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function S_(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ht(t){return t&&t._delegate?t._delegate:t}class fo{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vr="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WF{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new qF;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(o){if(i)return null;throw o}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(QF(e))try{this.getOrInitializeService({instanceIdentifier:Vr})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=Vr){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Vr){return this.instances.has(e)}getOptions(e=Vr){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[o,s]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);r===u&&s.resolve(i)}return i}onInit(e,n){var r;const i=this.normalizeInstanceIdentifier(n),o=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;o.add(e),this.onInitCallbacks.set(i,o);const s=this.instances.get(i);return s&&e(s,i),()=>{o.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:JF(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Vr){return this.component?this.component.multipleInstances?e:Vr:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function JF(t){return t===Vr?void 0:t}function QF(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YF{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new WF(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var le;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(le||(le={}));const XF={debug:le.DEBUG,verbose:le.VERBOSE,info:le.INFO,warn:le.WARN,error:le.ERROR,silent:le.SILENT},ZF=le.INFO,jF={[le.DEBUG]:"log",[le.VERBOSE]:"log",[le.INFO]:"info",[le.WARN]:"warn",[le.ERROR]:"error"},e2=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=jF[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class QI{constructor(e){this.name=e,this._logLevel=ZF,this._logHandler=e2,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in le))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?XF[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,le.DEBUG,...e),this._logHandler(this,le.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,le.VERBOSE,...e),this._logHandler(this,le.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,le.INFO,...e),this._logHandler(this,le.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,le.WARN,...e),this._logHandler(this,le.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,le.ERROR,...e),this._logHandler(this,le.ERROR,...e)}}const t2=(t,e)=>e.some(n=>t instanceof n);let A_,R_;function n2(){return A_||(A_=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function r2(){return R_||(R_=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const YI=new WeakMap,wf=new WeakMap,XI=new WeakMap,ud=new WeakMap,jh=new WeakMap;function i2(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",s)},o=()=>{n(dr(t.result)),i()},s=()=>{r(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",s)});return e.then(n=>{n instanceof IDBCursor&&YI.set(n,t)}).catch(()=>{}),jh.set(e,t),e}function o2(t){if(wf.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",s),t.removeEventListener("abort",s)},o=()=>{n(),i()},s=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",s),t.addEventListener("abort",s)});wf.set(t,e)}let Sf={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return wf.get(t);if(e==="objectStoreNames")return t.objectStoreNames||XI.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return dr(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function s2(t){Sf=t(Sf)}function l2(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(cd(this),e,...n);return XI.set(r,e.sort?e.sort():[e]),dr(r)}:r2().includes(t)?function(...e){return t.apply(cd(this),e),dr(YI.get(this))}:function(...e){return dr(t.apply(cd(this),e))}}function a2(t){return typeof t=="function"?l2(t):(t instanceof IDBTransaction&&o2(t),t2(t,n2())?new Proxy(t,Sf):t)}function dr(t){if(t instanceof IDBRequest)return i2(t);if(ud.has(t))return ud.get(t);const e=a2(t);return e!==t&&(ud.set(t,e),jh.set(e,t)),e}const cd=t=>jh.get(t);function u2(t,e,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){const s=indexedDB.open(t,e),u=dr(s);return r&&s.addEventListener("upgradeneeded",c=>{r(dr(s.result),c.oldVersion,c.newVersion,dr(s.transaction),c)}),n&&s.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),u.then(c=>{o&&c.addEventListener("close",()=>o()),i&&c.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}const c2=["get","getKey","getAll","getAllKeys","count"],d2=["put","add","delete","clear"],dd=new Map;function x_(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(dd.get(e))return dd.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=d2.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||c2.includes(n)))return;const o=async function(s,...u){const c=this.transaction(s,i?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(u.shift())),(await Promise.all([d[n](...u),i&&c.done]))[0]};return dd.set(e,o),o}s2(t=>({...t,get:(e,n,r)=>x_(e,n)||t.get(e,n,r),has:(e,n)=>!!x_(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f2{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(h2(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function h2(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Af="@firebase/app",P_="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ln=new QI("@firebase/app"),p2="@firebase/app-compat",m2="@firebase/analytics-compat",g2="@firebase/analytics",y2="@firebase/app-check-compat",_2="@firebase/app-check",v2="@firebase/auth",T2="@firebase/auth-compat",E2="@firebase/database",I2="@firebase/data-connect",C2="@firebase/database-compat",w2="@firebase/functions",S2="@firebase/functions-compat",A2="@firebase/installations",R2="@firebase/installations-compat",x2="@firebase/messaging",P2="@firebase/messaging-compat",D2="@firebase/performance",M2="@firebase/performance-compat",k2="@firebase/remote-config",N2="@firebase/remote-config-compat",V2="@firebase/storage",L2="@firebase/storage-compat",F2="@firebase/firestore",U2="@firebase/vertexai-preview",b2="@firebase/firestore-compat",B2="firebase",O2="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rf="[DEFAULT]",q2={[Af]:"fire-core",[p2]:"fire-core-compat",[g2]:"fire-analytics",[m2]:"fire-analytics-compat",[_2]:"fire-app-check",[y2]:"fire-app-check-compat",[v2]:"fire-auth",[T2]:"fire-auth-compat",[E2]:"fire-rtdb",[I2]:"fire-data-connect",[C2]:"fire-rtdb-compat",[w2]:"fire-fn",[S2]:"fire-fn-compat",[A2]:"fire-iid",[R2]:"fire-iid-compat",[x2]:"fire-fcm",[P2]:"fire-fcm-compat",[D2]:"fire-perf",[M2]:"fire-perf-compat",[k2]:"fire-rc",[N2]:"fire-rc-compat",[V2]:"fire-gcs",[L2]:"fire-gcs-compat",[F2]:"fire-fst",[b2]:"fire-fst-compat",[U2]:"fire-vertex","fire-js":"fire-js",[B2]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yu=new Map,G2=new Map,xf=new Map;function D_(t,e){try{t.container.addComponent(e)}catch(n){Ln.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Xs(t){const e=t.name;if(xf.has(e))return Ln.debug(`There were multiple attempts to register component ${e}.`),!1;xf.set(e,t);for(const n of yu.values())D_(n,t);for(const n of G2.values())D_(n,t);return!0}function ZI(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $2={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},fr=new JI("app","Firebase",$2);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z2{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new fo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw fr.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jI=O2;function eC(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Rf,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw fr.create("bad-app-name",{appName:String(i)});if(n||(n=zI()),!n)throw fr.create("no-options");const o=yu.get(i);if(o){if(Cf(n,o.options)&&Cf(r,o.config))return o;throw fr.create("duplicate-app",{appName:i})}const s=new YF(i);for(const c of xf.values())s.addComponent(c);const u=new z2(n,r,s);return yu.set(i,u),u}function tC(t=Rf){const e=yu.get(t);if(!e&&t===Rf&&zI())return eC();if(!e)throw fr.create("no-app",{appName:t});return e}function hr(t,e,n){var r;let i=(r=q2[t])!==null&&r!==void 0?r:t;n&&(i+=`-${n}`);const o=i.match(/\s|\//),s=e.match(/\s|\//);if(o||s){const u=[`Unable to register library "${i}" with version "${e}":`];o&&u.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&s&&u.push("and"),s&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ln.warn(u.join(" "));return}Xs(new fo(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H2="firebase-heartbeat-database",K2=1,Zs="firebase-heartbeat-store";let fd=null;function nC(){return fd||(fd=u2(H2,K2,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Zs)}catch(n){console.warn(n)}}}}).catch(t=>{throw fr.create("idb-open",{originalErrorMessage:t.message})})),fd}async function W2(t){try{const n=(await nC()).transaction(Zs),r=await n.objectStore(Zs).get(rC(t));return await n.done,r}catch(e){if(e instanceof pi)Ln.warn(e.message);else{const n=fr.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Ln.warn(n.message)}}}async function M_(t,e){try{const r=(await nC()).transaction(Zs,"readwrite");await r.objectStore(Zs).put(e,rC(t)),await r.done}catch(n){if(n instanceof pi)Ln.warn(n.message);else{const r=fr.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Ln.warn(r.message)}}}function rC(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J2=1024,Q2=30*24*60*60*1e3;class Y2{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new Z2(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=k_();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(s=>s.date===o)?void 0:(this._heartbeatsCache.heartbeats.push({date:o,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(s=>{const u=new Date(s.date).valueOf();return Date.now()-u<=Q2}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Ln.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=k_(),{heartbeatsToSend:r,unsentEntries:i}=X2(this._heartbeatsCache.heartbeats),o=mu(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(n){return Ln.warn(n),""}}}function k_(){return new Date().toISOString().substring(0,10)}function X2(t,e=J2){const n=[];let r=t.slice();for(const i of t){const o=n.find(s=>s.agent===i.agent);if(o){if(o.dates.push(i.date),N_(n)>e){o.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),N_(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class Z2{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return WI()?$F().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await W2(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return M_(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return M_(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function N_(t){return mu(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j2(t){Xs(new fo("platform-logger",e=>new f2(e),"PRIVATE")),Xs(new fo("heartbeat",e=>new Y2(e),"PRIVATE")),hr(Af,P_,t),hr(Af,P_,"esm2017"),hr("fire-js","")}j2("");var V_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Hr,iC;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(A,v){function w(){}w.prototype=v.prototype,A.D=v.prototype,A.prototype=new w,A.prototype.constructor=A,A.C=function(x,D,N){for(var P=Array(arguments.length-2),Ae=2;Ae<arguments.length;Ae++)P[Ae-2]=arguments[Ae];return v.prototype[D].apply(x,P)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,n),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(A,v,w){w||(w=0);var x=Array(16);if(typeof v=="string")for(var D=0;16>D;++D)x[D]=v.charCodeAt(w++)|v.charCodeAt(w++)<<8|v.charCodeAt(w++)<<16|v.charCodeAt(w++)<<24;else for(D=0;16>D;++D)x[D]=v[w++]|v[w++]<<8|v[w++]<<16|v[w++]<<24;v=A.g[0],w=A.g[1],D=A.g[2];var N=A.g[3],P=v+(N^w&(D^N))+x[0]+3614090360&4294967295;v=w+(P<<7&4294967295|P>>>25),P=N+(D^v&(w^D))+x[1]+3905402710&4294967295,N=v+(P<<12&4294967295|P>>>20),P=D+(w^N&(v^w))+x[2]+606105819&4294967295,D=N+(P<<17&4294967295|P>>>15),P=w+(v^D&(N^v))+x[3]+3250441966&4294967295,w=D+(P<<22&4294967295|P>>>10),P=v+(N^w&(D^N))+x[4]+4118548399&4294967295,v=w+(P<<7&4294967295|P>>>25),P=N+(D^v&(w^D))+x[5]+1200080426&4294967295,N=v+(P<<12&4294967295|P>>>20),P=D+(w^N&(v^w))+x[6]+2821735955&4294967295,D=N+(P<<17&4294967295|P>>>15),P=w+(v^D&(N^v))+x[7]+4249261313&4294967295,w=D+(P<<22&4294967295|P>>>10),P=v+(N^w&(D^N))+x[8]+1770035416&4294967295,v=w+(P<<7&4294967295|P>>>25),P=N+(D^v&(w^D))+x[9]+2336552879&4294967295,N=v+(P<<12&4294967295|P>>>20),P=D+(w^N&(v^w))+x[10]+4294925233&4294967295,D=N+(P<<17&4294967295|P>>>15),P=w+(v^D&(N^v))+x[11]+2304563134&4294967295,w=D+(P<<22&4294967295|P>>>10),P=v+(N^w&(D^N))+x[12]+1804603682&4294967295,v=w+(P<<7&4294967295|P>>>25),P=N+(D^v&(w^D))+x[13]+4254626195&4294967295,N=v+(P<<12&4294967295|P>>>20),P=D+(w^N&(v^w))+x[14]+2792965006&4294967295,D=N+(P<<17&4294967295|P>>>15),P=w+(v^D&(N^v))+x[15]+1236535329&4294967295,w=D+(P<<22&4294967295|P>>>10),P=v+(D^N&(w^D))+x[1]+4129170786&4294967295,v=w+(P<<5&4294967295|P>>>27),P=N+(w^D&(v^w))+x[6]+3225465664&4294967295,N=v+(P<<9&4294967295|P>>>23),P=D+(v^w&(N^v))+x[11]+643717713&4294967295,D=N+(P<<14&4294967295|P>>>18),P=w+(N^v&(D^N))+x[0]+3921069994&4294967295,w=D+(P<<20&4294967295|P>>>12),P=v+(D^N&(w^D))+x[5]+3593408605&4294967295,v=w+(P<<5&4294967295|P>>>27),P=N+(w^D&(v^w))+x[10]+38016083&4294967295,N=v+(P<<9&4294967295|P>>>23),P=D+(v^w&(N^v))+x[15]+3634488961&4294967295,D=N+(P<<14&4294967295|P>>>18),P=w+(N^v&(D^N))+x[4]+3889429448&4294967295,w=D+(P<<20&4294967295|P>>>12),P=v+(D^N&(w^D))+x[9]+568446438&4294967295,v=w+(P<<5&4294967295|P>>>27),P=N+(w^D&(v^w))+x[14]+3275163606&4294967295,N=v+(P<<9&4294967295|P>>>23),P=D+(v^w&(N^v))+x[3]+4107603335&4294967295,D=N+(P<<14&4294967295|P>>>18),P=w+(N^v&(D^N))+x[8]+1163531501&4294967295,w=D+(P<<20&4294967295|P>>>12),P=v+(D^N&(w^D))+x[13]+2850285829&4294967295,v=w+(P<<5&4294967295|P>>>27),P=N+(w^D&(v^w))+x[2]+4243563512&4294967295,N=v+(P<<9&4294967295|P>>>23),P=D+(v^w&(N^v))+x[7]+1735328473&4294967295,D=N+(P<<14&4294967295|P>>>18),P=w+(N^v&(D^N))+x[12]+2368359562&4294967295,w=D+(P<<20&4294967295|P>>>12),P=v+(w^D^N)+x[5]+4294588738&4294967295,v=w+(P<<4&4294967295|P>>>28),P=N+(v^w^D)+x[8]+2272392833&4294967295,N=v+(P<<11&4294967295|P>>>21),P=D+(N^v^w)+x[11]+1839030562&4294967295,D=N+(P<<16&4294967295|P>>>16),P=w+(D^N^v)+x[14]+4259657740&4294967295,w=D+(P<<23&4294967295|P>>>9),P=v+(w^D^N)+x[1]+2763975236&4294967295,v=w+(P<<4&4294967295|P>>>28),P=N+(v^w^D)+x[4]+1272893353&4294967295,N=v+(P<<11&4294967295|P>>>21),P=D+(N^v^w)+x[7]+4139469664&4294967295,D=N+(P<<16&4294967295|P>>>16),P=w+(D^N^v)+x[10]+3200236656&4294967295,w=D+(P<<23&4294967295|P>>>9),P=v+(w^D^N)+x[13]+681279174&4294967295,v=w+(P<<4&4294967295|P>>>28),P=N+(v^w^D)+x[0]+3936430074&4294967295,N=v+(P<<11&4294967295|P>>>21),P=D+(N^v^w)+x[3]+3572445317&4294967295,D=N+(P<<16&4294967295|P>>>16),P=w+(D^N^v)+x[6]+76029189&4294967295,w=D+(P<<23&4294967295|P>>>9),P=v+(w^D^N)+x[9]+3654602809&4294967295,v=w+(P<<4&4294967295|P>>>28),P=N+(v^w^D)+x[12]+3873151461&4294967295,N=v+(P<<11&4294967295|P>>>21),P=D+(N^v^w)+x[15]+530742520&4294967295,D=N+(P<<16&4294967295|P>>>16),P=w+(D^N^v)+x[2]+3299628645&4294967295,w=D+(P<<23&4294967295|P>>>9),P=v+(D^(w|~N))+x[0]+4096336452&4294967295,v=w+(P<<6&4294967295|P>>>26),P=N+(w^(v|~D))+x[7]+1126891415&4294967295,N=v+(P<<10&4294967295|P>>>22),P=D+(v^(N|~w))+x[14]+2878612391&4294967295,D=N+(P<<15&4294967295|P>>>17),P=w+(N^(D|~v))+x[5]+4237533241&4294967295,w=D+(P<<21&4294967295|P>>>11),P=v+(D^(w|~N))+x[12]+1700485571&4294967295,v=w+(P<<6&4294967295|P>>>26),P=N+(w^(v|~D))+x[3]+2399980690&4294967295,N=v+(P<<10&4294967295|P>>>22),P=D+(v^(N|~w))+x[10]+4293915773&4294967295,D=N+(P<<15&4294967295|P>>>17),P=w+(N^(D|~v))+x[1]+2240044497&4294967295,w=D+(P<<21&4294967295|P>>>11),P=v+(D^(w|~N))+x[8]+1873313359&4294967295,v=w+(P<<6&4294967295|P>>>26),P=N+(w^(v|~D))+x[15]+4264355552&4294967295,N=v+(P<<10&4294967295|P>>>22),P=D+(v^(N|~w))+x[6]+2734768916&4294967295,D=N+(P<<15&4294967295|P>>>17),P=w+(N^(D|~v))+x[13]+1309151649&4294967295,w=D+(P<<21&4294967295|P>>>11),P=v+(D^(w|~N))+x[4]+4149444226&4294967295,v=w+(P<<6&4294967295|P>>>26),P=N+(w^(v|~D))+x[11]+3174756917&4294967295,N=v+(P<<10&4294967295|P>>>22),P=D+(v^(N|~w))+x[2]+718787259&4294967295,D=N+(P<<15&4294967295|P>>>17),P=w+(N^(D|~v))+x[9]+3951481745&4294967295,A.g[0]=A.g[0]+v&4294967295,A.g[1]=A.g[1]+(D+(P<<21&4294967295|P>>>11))&4294967295,A.g[2]=A.g[2]+D&4294967295,A.g[3]=A.g[3]+N&4294967295}r.prototype.u=function(A,v){v===void 0&&(v=A.length);for(var w=v-this.blockSize,x=this.B,D=this.h,N=0;N<v;){if(D==0)for(;N<=w;)i(this,A,N),N+=this.blockSize;if(typeof A=="string"){for(;N<v;)if(x[D++]=A.charCodeAt(N++),D==this.blockSize){i(this,x),D=0;break}}else for(;N<v;)if(x[D++]=A[N++],D==this.blockSize){i(this,x),D=0;break}}this.h=D,this.o+=v},r.prototype.v=function(){var A=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);A[0]=128;for(var v=1;v<A.length-8;++v)A[v]=0;var w=8*this.o;for(v=A.length-8;v<A.length;++v)A[v]=w&255,w/=256;for(this.u(A),A=Array(16),v=w=0;4>v;++v)for(var x=0;32>x;x+=8)A[w++]=this.g[v]>>>x&255;return A};function o(A,v){var w=u;return Object.prototype.hasOwnProperty.call(w,A)?w[A]:w[A]=v(A)}function s(A,v){this.h=v;for(var w=[],x=!0,D=A.length-1;0<=D;D--){var N=A[D]|0;x&&N==v||(w[D]=N,x=!1)}this.g=w}var u={};function c(A){return-128<=A&&128>A?o(A,function(v){return new s([v|0],0>v?-1:0)}):new s([A|0],0>A?-1:0)}function d(A){if(isNaN(A)||!isFinite(A))return p;if(0>A)return M(d(-A));for(var v=[],w=1,x=0;A>=w;x++)v[x]=A/w|0,w*=4294967296;return new s(v,0)}function h(A,v){if(A.length==0)throw Error("number format error: empty string");if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(A.charAt(0)=="-")return M(h(A.substring(1),v));if(0<=A.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=d(Math.pow(v,8)),x=p,D=0;D<A.length;D+=8){var N=Math.min(8,A.length-D),P=parseInt(A.substring(D,D+N),v);8>N?(N=d(Math.pow(v,N)),x=x.j(N).add(d(P))):(x=x.j(w),x=x.add(d(P)))}return x}var p=c(0),m=c(1),_=c(16777216);t=s.prototype,t.m=function(){if(R(this))return-M(this).m();for(var A=0,v=1,w=0;w<this.g.length;w++){var x=this.i(w);A+=(0<=x?x:4294967296+x)*v,v*=4294967296}return A},t.toString=function(A){if(A=A||10,2>A||36<A)throw Error("radix out of range: "+A);if(S(this))return"0";if(R(this))return"-"+M(this).toString(A);for(var v=d(Math.pow(A,6)),w=this,x="";;){var D=k(w,v).g;w=I(w,D.j(v));var N=((0<w.g.length?w.g[0]:w.h)>>>0).toString(A);if(w=D,S(w))return N+x;for(;6>N.length;)N="0"+N;x=N+x}},t.i=function(A){return 0>A?0:A<this.g.length?this.g[A]:this.h};function S(A){if(A.h!=0)return!1;for(var v=0;v<A.g.length;v++)if(A.g[v]!=0)return!1;return!0}function R(A){return A.h==-1}t.l=function(A){return A=I(this,A),R(A)?-1:S(A)?0:1};function M(A){for(var v=A.g.length,w=[],x=0;x<v;x++)w[x]=~A.g[x];return new s(w,~A.h).add(m)}t.abs=function(){return R(this)?M(this):this},t.add=function(A){for(var v=Math.max(this.g.length,A.g.length),w=[],x=0,D=0;D<=v;D++){var N=x+(this.i(D)&65535)+(A.i(D)&65535),P=(N>>>16)+(this.i(D)>>>16)+(A.i(D)>>>16);x=P>>>16,N&=65535,P&=65535,w[D]=P<<16|N}return new s(w,w[w.length-1]&-2147483648?-1:0)};function I(A,v){return A.add(M(v))}t.j=function(A){if(S(this)||S(A))return p;if(R(this))return R(A)?M(this).j(M(A)):M(M(this).j(A));if(R(A))return M(this.j(M(A)));if(0>this.l(_)&&0>A.l(_))return d(this.m()*A.m());for(var v=this.g.length+A.g.length,w=[],x=0;x<2*v;x++)w[x]=0;for(x=0;x<this.g.length;x++)for(var D=0;D<A.g.length;D++){var N=this.i(x)>>>16,P=this.i(x)&65535,Ae=A.i(D)>>>16,Ye=A.i(D)&65535;w[2*x+2*D]+=P*Ye,T(w,2*x+2*D),w[2*x+2*D+1]+=N*Ye,T(w,2*x+2*D+1),w[2*x+2*D+1]+=P*Ae,T(w,2*x+2*D+1),w[2*x+2*D+2]+=N*Ae,T(w,2*x+2*D+2)}for(x=0;x<v;x++)w[x]=w[2*x+1]<<16|w[2*x];for(x=v;x<2*v;x++)w[x]=0;return new s(w,0)};function T(A,v){for(;(A[v]&65535)!=A[v];)A[v+1]+=A[v]>>>16,A[v]&=65535,v++}function C(A,v){this.g=A,this.h=v}function k(A,v){if(S(v))throw Error("division by zero");if(S(A))return new C(p,p);if(R(A))return v=k(M(A),v),new C(M(v.g),M(v.h));if(R(v))return v=k(A,M(v)),new C(M(v.g),v.h);if(30<A.g.length){if(R(A)||R(v))throw Error("slowDivide_ only works with positive integers.");for(var w=m,x=v;0>=x.l(A);)w=F(w),x=F(x);var D=b(w,1),N=b(x,1);for(x=b(x,2),w=b(w,2);!S(x);){var P=N.add(x);0>=P.l(A)&&(D=D.add(w),N=P),x=b(x,1),w=b(w,1)}return v=I(A,D.j(v)),new C(D,v)}for(D=p;0<=A.l(v);){for(w=Math.max(1,Math.floor(A.m()/v.m())),x=Math.ceil(Math.log(w)/Math.LN2),x=48>=x?1:Math.pow(2,x-48),N=d(w),P=N.j(v);R(P)||0<P.l(A);)w-=x,N=d(w),P=N.j(v);S(N)&&(N=m),D=D.add(N),A=I(A,P)}return new C(D,A)}t.A=function(A){return k(this,A).h},t.and=function(A){for(var v=Math.max(this.g.length,A.g.length),w=[],x=0;x<v;x++)w[x]=this.i(x)&A.i(x);return new s(w,this.h&A.h)},t.or=function(A){for(var v=Math.max(this.g.length,A.g.length),w=[],x=0;x<v;x++)w[x]=this.i(x)|A.i(x);return new s(w,this.h|A.h)},t.xor=function(A){for(var v=Math.max(this.g.length,A.g.length),w=[],x=0;x<v;x++)w[x]=this.i(x)^A.i(x);return new s(w,this.h^A.h)};function F(A){for(var v=A.g.length+1,w=[],x=0;x<v;x++)w[x]=A.i(x)<<1|A.i(x-1)>>>31;return new s(w,A.h)}function b(A,v){var w=v>>5;v%=32;for(var x=A.g.length-w,D=[],N=0;N<x;N++)D[N]=0<v?A.i(N+w)>>>v|A.i(N+w+1)<<32-v:A.i(N+w);return new s(D,A.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,iC=r,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.A,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=d,s.fromString=h,Hr=s}).apply(typeof V_<"u"?V_:typeof self<"u"?self:typeof window<"u"?window:{});var da=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var oC,fs,sC,Na,Pf,lC,aC,uC;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(f,g,y){return f==Array.prototype||f==Object.prototype||(f[g]=y.value),f};function n(f){f=[typeof globalThis=="object"&&globalThis,f,typeof window=="object"&&window,typeof self=="object"&&self,typeof da=="object"&&da];for(var g=0;g<f.length;++g){var y=f[g];if(y&&y.Math==Math)return y}throw Error("Cannot find global object")}var r=n(this);function i(f,g){if(g)e:{var y=r;f=f.split(".");for(var E=0;E<f.length-1;E++){var V=f[E];if(!(V in y))break e;y=y[V]}f=f[f.length-1],E=y[f],g=g(E),g!=E&&g!=null&&e(y,f,{configurable:!0,writable:!0,value:g})}}function o(f,g){f instanceof String&&(f+="");var y=0,E=!1,V={next:function(){if(!E&&y<f.length){var U=y++;return{value:g(U,f[U]),done:!1}}return E=!0,{done:!0,value:void 0}}};return V[Symbol.iterator]=function(){return V},V}i("Array.prototype.values",function(f){return f||function(){return o(this,function(g,y){return y})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var s=s||{},u=this||self;function c(f){var g=typeof f;return g=g!="object"?g:f?Array.isArray(f)?"array":g:"null",g=="array"||g=="object"&&typeof f.length=="number"}function d(f){var g=typeof f;return g=="object"&&f!=null||g=="function"}function h(f,g,y){return f.call.apply(f.bind,arguments)}function p(f,g,y){if(!f)throw Error();if(2<arguments.length){var E=Array.prototype.slice.call(arguments,2);return function(){var V=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(V,E),f.apply(g,V)}}return function(){return f.apply(g,arguments)}}function m(f,g,y){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:p,m.apply(null,arguments)}function _(f,g){var y=Array.prototype.slice.call(arguments,1);return function(){var E=y.slice();return E.push.apply(E,arguments),f.apply(this,E)}}function S(f,g){function y(){}y.prototype=g.prototype,f.aa=g.prototype,f.prototype=new y,f.prototype.constructor=f,f.Qb=function(E,V,U){for(var z=Array(arguments.length-2),ge=2;ge<arguments.length;ge++)z[ge-2]=arguments[ge];return g.prototype[V].apply(E,z)}}function R(f){const g=f.length;if(0<g){const y=Array(g);for(let E=0;E<g;E++)y[E]=f[E];return y}return[]}function M(f,g){for(let y=1;y<arguments.length;y++){const E=arguments[y];if(c(E)){const V=f.length||0,U=E.length||0;f.length=V+U;for(let z=0;z<U;z++)f[V+z]=E[z]}else f.push(E)}}class I{constructor(g,y){this.i=g,this.j=y,this.h=0,this.g=null}get(){let g;return 0<this.h?(this.h--,g=this.g,this.g=g.next,g.next=null):g=this.i(),g}}function T(f){return/^[\s\xa0]*$/.test(f)}function C(){var f=u.navigator;return f&&(f=f.userAgent)?f:""}function k(f){return k[" "](f),f}k[" "]=function(){};var F=C().indexOf("Gecko")!=-1&&!(C().toLowerCase().indexOf("webkit")!=-1&&C().indexOf("Edge")==-1)&&!(C().indexOf("Trident")!=-1||C().indexOf("MSIE")!=-1)&&C().indexOf("Edge")==-1;function b(f,g,y){for(const E in f)g.call(y,f[E],E,f)}function A(f,g){for(const y in f)g.call(void 0,f[y],y,f)}function v(f){const g={};for(const y in f)g[y]=f[y];return g}const w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function x(f,g){let y,E;for(let V=1;V<arguments.length;V++){E=arguments[V];for(y in E)f[y]=E[y];for(let U=0;U<w.length;U++)y=w[U],Object.prototype.hasOwnProperty.call(E,y)&&(f[y]=E[y])}}function D(f){var g=1;f=f.split(":");const y=[];for(;0<g&&f.length;)y.push(f.shift()),g--;return f.length&&y.push(f.join(":")),y}function N(f){u.setTimeout(()=>{throw f},0)}function P(){var f=j;let g=null;return f.g&&(g=f.g,f.g=f.g.next,f.g||(f.h=null),g.next=null),g}class Ae{constructor(){this.h=this.g=null}add(g,y){const E=Ye.get();E.set(g,y),this.h?this.h.next=E:this.g=E,this.h=E}}var Ye=new I(()=>new gn,f=>f.reset());class gn{constructor(){this.next=this.g=this.h=null}set(g,y){this.h=g,this.g=y,this.next=null}reset(){this.next=this.g=this.h=null}}let yn,K=!1,j=new Ae,te=()=>{const f=u.Promise.resolve(void 0);yn=()=>{f.then(Re)}};var Re=()=>{for(var f;f=P();){try{f.h.call(f.g)}catch(y){N(y)}var g=Ye;g.j(f),100>g.h&&(g.h++,f.next=g.g,g.g=f)}K=!1};function me(){this.s=this.s,this.C=this.C}me.prototype.s=!1,me.prototype.ma=function(){this.s||(this.s=!0,this.N())},me.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ue(f,g){this.type=f,this.g=this.target=g,this.defaultPrevented=!1}Ue.prototype.h=function(){this.defaultPrevented=!0};var _n=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var f=!1,g=Object.defineProperty({},"passive",{get:function(){f=!0}});try{const y=()=>{};u.addEventListener("test",y,g),u.removeEventListener("test",y,g)}catch{}return f}();function vn(f,g){if(Ue.call(this,f?f.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,f){var y=this.type=f.type,E=f.changedTouches&&f.changedTouches.length?f.changedTouches[0]:null;if(this.target=f.target||f.srcElement,this.g=g,g=f.relatedTarget){if(F){e:{try{k(g.nodeName);var V=!0;break e}catch{}V=!1}V||(g=null)}}else y=="mouseover"?g=f.fromElement:y=="mouseout"&&(g=f.toElement);this.relatedTarget=g,E?(this.clientX=E.clientX!==void 0?E.clientX:E.pageX,this.clientY=E.clientY!==void 0?E.clientY:E.pageY,this.screenX=E.screenX||0,this.screenY=E.screenY||0):(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0),this.button=f.button,this.key=f.key||"",this.ctrlKey=f.ctrlKey,this.altKey=f.altKey,this.shiftKey=f.shiftKey,this.metaKey=f.metaKey,this.pointerId=f.pointerId||0,this.pointerType=typeof f.pointerType=="string"?f.pointerType:Tn[f.pointerType]||"",this.state=f.state,this.i=f,f.defaultPrevented&&vn.aa.h.call(this)}}S(vn,Ue);var Tn={2:"touch",3:"pen",4:"mouse"};vn.prototype.h=function(){vn.aa.h.call(this);var f=this.i;f.preventDefault?f.preventDefault():f.returnValue=!1};var En="closure_listenable_"+(1e6*Math.random()|0),P0=0;function D0(f,g,y,E,V){this.listener=f,this.proxy=null,this.src=g,this.type=y,this.capture=!!E,this.ha=V,this.key=++P0,this.da=this.fa=!1}function xl(f){f.da=!0,f.listener=null,f.proxy=null,f.src=null,f.ha=null}function Pl(f){this.src=f,this.g={},this.h=0}Pl.prototype.add=function(f,g,y,E,V){var U=f.toString();f=this.g[U],f||(f=this.g[U]=[],this.h++);var z=fc(f,g,E,V);return-1<z?(g=f[z],y||(g.fa=!1)):(g=new D0(g,this.src,U,!!E,V),g.fa=y,f.push(g)),g};function dc(f,g){var y=g.type;if(y in f.g){var E=f.g[y],V=Array.prototype.indexOf.call(E,g,void 0),U;(U=0<=V)&&Array.prototype.splice.call(E,V,1),U&&(xl(g),f.g[y].length==0&&(delete f.g[y],f.h--))}}function fc(f,g,y,E){for(var V=0;V<f.length;++V){var U=f[V];if(!U.da&&U.listener==g&&U.capture==!!y&&U.ha==E)return V}return-1}var hc="closure_lm_"+(1e6*Math.random()|0),pc={};function Qp(f,g,y,E,V){if(Array.isArray(g)){for(var U=0;U<g.length;U++)Qp(f,g[U],y,E,V);return null}return y=Zp(y),f&&f[En]?f.K(g,y,d(E)?!!E.capture:!1,V):M0(f,g,y,!1,E,V)}function M0(f,g,y,E,V,U){if(!g)throw Error("Invalid event type");var z=d(V)?!!V.capture:!!V,ge=gc(f);if(ge||(f[hc]=ge=new Pl(f)),y=ge.add(g,y,E,z,U),y.proxy)return y;if(E=k0(),y.proxy=E,E.src=f,E.listener=y,f.addEventListener)_n||(V=z),V===void 0&&(V=!1),f.addEventListener(g.toString(),E,V);else if(f.attachEvent)f.attachEvent(Xp(g.toString()),E);else if(f.addListener&&f.removeListener)f.addListener(E);else throw Error("addEventListener and attachEvent are unavailable.");return y}function k0(){function f(y){return g.call(f.src,f.listener,y)}const g=N0;return f}function Yp(f,g,y,E,V){if(Array.isArray(g))for(var U=0;U<g.length;U++)Yp(f,g[U],y,E,V);else E=d(E)?!!E.capture:!!E,y=Zp(y),f&&f[En]?(f=f.i,g=String(g).toString(),g in f.g&&(U=f.g[g],y=fc(U,y,E,V),-1<y&&(xl(U[y]),Array.prototype.splice.call(U,y,1),U.length==0&&(delete f.g[g],f.h--)))):f&&(f=gc(f))&&(g=f.g[g.toString()],f=-1,g&&(f=fc(g,y,E,V)),(y=-1<f?g[f]:null)&&mc(y))}function mc(f){if(typeof f!="number"&&f&&!f.da){var g=f.src;if(g&&g[En])dc(g.i,f);else{var y=f.type,E=f.proxy;g.removeEventListener?g.removeEventListener(y,E,f.capture):g.detachEvent?g.detachEvent(Xp(y),E):g.addListener&&g.removeListener&&g.removeListener(E),(y=gc(g))?(dc(y,f),y.h==0&&(y.src=null,g[hc]=null)):xl(f)}}}function Xp(f){return f in pc?pc[f]:pc[f]="on"+f}function N0(f,g){if(f.da)f=!0;else{g=new vn(g,this);var y=f.listener,E=f.ha||f.src;f.fa&&mc(f),f=y.call(E,g)}return f}function gc(f){return f=f[hc],f instanceof Pl?f:null}var yc="__closure_events_fn_"+(1e9*Math.random()>>>0);function Zp(f){return typeof f=="function"?f:(f[yc]||(f[yc]=function(g){return f.handleEvent(g)}),f[yc])}function it(){me.call(this),this.i=new Pl(this),this.M=this,this.F=null}S(it,me),it.prototype[En]=!0,it.prototype.removeEventListener=function(f,g,y,E){Yp(this,f,g,y,E)};function pt(f,g){var y,E=f.F;if(E)for(y=[];E;E=E.F)y.push(E);if(f=f.M,E=g.type||g,typeof g=="string")g=new Ue(g,f);else if(g instanceof Ue)g.target=g.target||f;else{var V=g;g=new Ue(E,f),x(g,V)}if(V=!0,y)for(var U=y.length-1;0<=U;U--){var z=g.g=y[U];V=Dl(z,E,!0,g)&&V}if(z=g.g=f,V=Dl(z,E,!0,g)&&V,V=Dl(z,E,!1,g)&&V,y)for(U=0;U<y.length;U++)z=g.g=y[U],V=Dl(z,E,!1,g)&&V}it.prototype.N=function(){if(it.aa.N.call(this),this.i){var f=this.i,g;for(g in f.g){for(var y=f.g[g],E=0;E<y.length;E++)xl(y[E]);delete f.g[g],f.h--}}this.F=null},it.prototype.K=function(f,g,y,E){return this.i.add(String(f),g,!1,y,E)},it.prototype.L=function(f,g,y,E){return this.i.add(String(f),g,!0,y,E)};function Dl(f,g,y,E){if(g=f.i.g[String(g)],!g)return!0;g=g.concat();for(var V=!0,U=0;U<g.length;++U){var z=g[U];if(z&&!z.da&&z.capture==y){var ge=z.listener,Xe=z.ha||z.src;z.fa&&dc(f.i,z),V=ge.call(Xe,E)!==!1&&V}}return V&&!E.defaultPrevented}function jp(f,g,y){if(typeof f=="function")y&&(f=m(f,y));else if(f&&typeof f.handleEvent=="function")f=m(f.handleEvent,f);else throw Error("Invalid listener argument");return 2147483647<Number(g)?-1:u.setTimeout(f,g||0)}function em(f){f.g=jp(()=>{f.g=null,f.i&&(f.i=!1,em(f))},f.l);const g=f.h;f.h=null,f.m.apply(null,g)}class V0 extends me{constructor(g,y){super(),this.m=g,this.l=y,this.h=null,this.i=!1,this.g=null}j(g){this.h=arguments,this.g?this.i=!0:em(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function No(f){me.call(this),this.h=f,this.g={}}S(No,me);var tm=[];function nm(f){b(f.g,function(g,y){this.g.hasOwnProperty(y)&&mc(g)},f),f.g={}}No.prototype.N=function(){No.aa.N.call(this),nm(this)},No.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var _c=u.JSON.stringify,L0=u.JSON.parse,F0=class{stringify(f){return u.JSON.stringify(f,void 0)}parse(f){return u.JSON.parse(f,void 0)}};function vc(){}vc.prototype.h=null;function rm(f){return f.h||(f.h=f.i())}function im(){}var Vo={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Tc(){Ue.call(this,"d")}S(Tc,Ue);function Ec(){Ue.call(this,"c")}S(Ec,Ue);var Rr={},om=null;function Ml(){return om=om||new it}Rr.La="serverreachability";function sm(f){Ue.call(this,Rr.La,f)}S(sm,Ue);function Lo(f){const g=Ml();pt(g,new sm(g))}Rr.STAT_EVENT="statevent";function lm(f,g){Ue.call(this,Rr.STAT_EVENT,f),this.stat=g}S(lm,Ue);function mt(f){const g=Ml();pt(g,new lm(g,f))}Rr.Ma="timingevent";function am(f,g){Ue.call(this,Rr.Ma,f),this.size=g}S(am,Ue);function Fo(f,g){if(typeof f!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){f()},g)}function Uo(){this.g=!0}Uo.prototype.xa=function(){this.g=!1};function U0(f,g,y,E,V,U){f.info(function(){if(f.g)if(U)for(var z="",ge=U.split("&"),Xe=0;Xe<ge.length;Xe++){var ue=ge[Xe].split("=");if(1<ue.length){var ot=ue[0];ue=ue[1];var st=ot.split("_");z=2<=st.length&&st[1]=="type"?z+(ot+"="+ue+"&"):z+(ot+"=redacted&")}}else z=null;else z=U;return"XMLHTTP REQ ("+E+") [attempt "+V+"]: "+g+`
`+y+`
`+z})}function b0(f,g,y,E,V,U,z){f.info(function(){return"XMLHTTP RESP ("+E+") [ attempt "+V+"]: "+g+`
`+y+`
`+U+" "+z})}function Ti(f,g,y,E){f.info(function(){return"XMLHTTP TEXT ("+g+"): "+O0(f,y)+(E?" "+E:"")})}function B0(f,g){f.info(function(){return"TIMEOUT: "+g})}Uo.prototype.info=function(){};function O0(f,g){if(!f.g)return g;if(!g)return null;try{var y=JSON.parse(g);if(y){for(f=0;f<y.length;f++)if(Array.isArray(y[f])){var E=y[f];if(!(2>E.length)){var V=E[1];if(Array.isArray(V)&&!(1>V.length)){var U=V[0];if(U!="noop"&&U!="stop"&&U!="close")for(var z=1;z<V.length;z++)V[z]=""}}}}return _c(y)}catch{return g}}var kl={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},um={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ic;function Nl(){}S(Nl,vc),Nl.prototype.g=function(){return new XMLHttpRequest},Nl.prototype.i=function(){return{}},Ic=new Nl;function qn(f,g,y,E){this.j=f,this.i=g,this.l=y,this.R=E||1,this.U=new No(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new cm}function cm(){this.i=null,this.g="",this.h=!1}var dm={},Cc={};function wc(f,g,y){f.L=1,f.v=Ul(In(g)),f.m=y,f.P=!0,fm(f,null)}function fm(f,g){f.F=Date.now(),Vl(f),f.A=In(f.v);var y=f.A,E=f.R;Array.isArray(E)||(E=[String(E)]),Am(y.i,"t",E),f.C=0,y=f.j.J,f.h=new cm,f.g=zm(f.j,y?g:null,!f.m),0<f.O&&(f.M=new V0(m(f.Y,f,f.g),f.O)),g=f.U,y=f.g,E=f.ca;var V="readystatechange";Array.isArray(V)||(V&&(tm[0]=V.toString()),V=tm);for(var U=0;U<V.length;U++){var z=Qp(y,V[U],E||g.handleEvent,!1,g.h||g);if(!z)break;g.g[z.key]=z}g=f.H?v(f.H):{},f.m?(f.u||(f.u="POST"),g["Content-Type"]="application/x-www-form-urlencoded",f.g.ea(f.A,f.u,f.m,g)):(f.u="GET",f.g.ea(f.A,f.u,null,g)),Lo(),U0(f.i,f.u,f.A,f.l,f.R,f.m)}qn.prototype.ca=function(f){f=f.target;const g=this.M;g&&Cn(f)==3?g.j():this.Y(f)},qn.prototype.Y=function(f){try{if(f==this.g)e:{const st=Cn(this.g);var g=this.g.Ba();const Ci=this.g.Z();if(!(3>st)&&(st!=3||this.g&&(this.h.h||this.g.oa()||Nm(this.g)))){this.J||st!=4||g==7||(g==8||0>=Ci?Lo(3):Lo(2)),Sc(this);var y=this.g.Z();this.X=y;t:if(hm(this)){var E=Nm(this.g);f="";var V=E.length,U=Cn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){xr(this),bo(this);var z="";break t}this.h.i=new u.TextDecoder}for(g=0;g<V;g++)this.h.h=!0,f+=this.h.i.decode(E[g],{stream:!(U&&g==V-1)});E.length=0,this.h.g+=f,this.C=0,z=this.h.g}else z=this.g.oa();if(this.o=y==200,b0(this.i,this.u,this.A,this.l,this.R,st,y),this.o){if(this.T&&!this.K){t:{if(this.g){var ge,Xe=this.g;if((ge=Xe.g?Xe.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!T(ge)){var ue=ge;break t}}ue=null}if(y=ue)Ti(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ac(this,y);else{this.o=!1,this.s=3,mt(12),xr(this),bo(this);break e}}if(this.P){y=!0;let Yt;for(;!this.J&&this.C<z.length;)if(Yt=q0(this,z),Yt==Cc){st==4&&(this.s=4,mt(14),y=!1),Ti(this.i,this.l,null,"[Incomplete Response]");break}else if(Yt==dm){this.s=4,mt(15),Ti(this.i,this.l,z,"[Invalid Chunk]"),y=!1;break}else Ti(this.i,this.l,Yt,null),Ac(this,Yt);if(hm(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),st!=4||z.length!=0||this.h.h||(this.s=1,mt(16),y=!1),this.o=this.o&&y,!y)Ti(this.i,this.l,z,"[Invalid Chunked Response]"),xr(this),bo(this);else if(0<z.length&&!this.W){this.W=!0;var ot=this.j;ot.g==this&&ot.ba&&!ot.M&&(ot.j.info("Great, no buffering proxy detected. Bytes received: "+z.length),kc(ot),ot.M=!0,mt(11))}}else Ti(this.i,this.l,z,null),Ac(this,z);st==4&&xr(this),this.o&&!this.J&&(st==4?Om(this.j,this):(this.o=!1,Vl(this)))}else iS(this.g),y==400&&0<z.indexOf("Unknown SID")?(this.s=3,mt(12)):(this.s=0,mt(13)),xr(this),bo(this)}}}catch{}finally{}};function hm(f){return f.g?f.u=="GET"&&f.L!=2&&f.j.Ca:!1}function q0(f,g){var y=f.C,E=g.indexOf(`
`,y);return E==-1?Cc:(y=Number(g.substring(y,E)),isNaN(y)?dm:(E+=1,E+y>g.length?Cc:(g=g.slice(E,E+y),f.C=E+y,g)))}qn.prototype.cancel=function(){this.J=!0,xr(this)};function Vl(f){f.S=Date.now()+f.I,pm(f,f.I)}function pm(f,g){if(f.B!=null)throw Error("WatchDog timer not null");f.B=Fo(m(f.ba,f),g)}function Sc(f){f.B&&(u.clearTimeout(f.B),f.B=null)}qn.prototype.ba=function(){this.B=null;const f=Date.now();0<=f-this.S?(B0(this.i,this.A),this.L!=2&&(Lo(),mt(17)),xr(this),this.s=2,bo(this)):pm(this,this.S-f)};function bo(f){f.j.G==0||f.J||Om(f.j,f)}function xr(f){Sc(f);var g=f.M;g&&typeof g.ma=="function"&&g.ma(),f.M=null,nm(f.U),f.g&&(g=f.g,f.g=null,g.abort(),g.ma())}function Ac(f,g){try{var y=f.j;if(y.G!=0&&(y.g==f||Rc(y.h,f))){if(!f.K&&Rc(y.h,f)&&y.G==3){try{var E=y.Da.g.parse(g)}catch{E=null}if(Array.isArray(E)&&E.length==3){var V=E;if(V[0]==0){e:if(!y.u){if(y.g)if(y.g.F+3e3<f.F)$l(y),ql(y);else break e;Mc(y),mt(18)}}else y.za=V[1],0<y.za-y.T&&37500>V[2]&&y.F&&y.v==0&&!y.C&&(y.C=Fo(m(y.Za,y),6e3));if(1>=ym(y.h)&&y.ca){try{y.ca()}catch{}y.ca=void 0}}else Dr(y,11)}else if((f.K||y.g==f)&&$l(y),!T(g))for(V=y.Da.g.parse(g),g=0;g<V.length;g++){let ue=V[g];if(y.T=ue[0],ue=ue[1],y.G==2)if(ue[0]=="c"){y.K=ue[1],y.ia=ue[2];const ot=ue[3];ot!=null&&(y.la=ot,y.j.info("VER="+y.la));const st=ue[4];st!=null&&(y.Aa=st,y.j.info("SVER="+y.Aa));const Ci=ue[5];Ci!=null&&typeof Ci=="number"&&0<Ci&&(E=1.5*Ci,y.L=E,y.j.info("backChannelRequestTimeoutMs_="+E)),E=y;const Yt=f.g;if(Yt){const Hl=Yt.g?Yt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Hl){var U=E.h;U.g||Hl.indexOf("spdy")==-1&&Hl.indexOf("quic")==-1&&Hl.indexOf("h2")==-1||(U.j=U.l,U.g=new Set,U.h&&(xc(U,U.h),U.h=null))}if(E.D){const Nc=Yt.g?Yt.g.getResponseHeader("X-HTTP-Session-Id"):null;Nc&&(E.ya=Nc,_e(E.I,E.D,Nc))}}y.G=3,y.l&&y.l.ua(),y.ba&&(y.R=Date.now()-f.F,y.j.info("Handshake RTT: "+y.R+"ms")),E=y;var z=f;if(E.qa=$m(E,E.J?E.ia:null,E.W),z.K){_m(E.h,z);var ge=z,Xe=E.L;Xe&&(ge.I=Xe),ge.B&&(Sc(ge),Vl(ge)),E.g=z}else bm(E);0<y.i.length&&Gl(y)}else ue[0]!="stop"&&ue[0]!="close"||Dr(y,7);else y.G==3&&(ue[0]=="stop"||ue[0]=="close"?ue[0]=="stop"?Dr(y,7):Dc(y):ue[0]!="noop"&&y.l&&y.l.ta(ue),y.v=0)}}Lo(4)}catch{}}var G0=class{constructor(f,g){this.g=f,this.map=g}};function mm(f){this.l=f||10,u.PerformanceNavigationTiming?(f=u.performance.getEntriesByType("navigation"),f=0<f.length&&(f[0].nextHopProtocol=="hq"||f[0].nextHopProtocol=="h2")):f=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=f?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function gm(f){return f.h?!0:f.g?f.g.size>=f.j:!1}function ym(f){return f.h?1:f.g?f.g.size:0}function Rc(f,g){return f.h?f.h==g:f.g?f.g.has(g):!1}function xc(f,g){f.g?f.g.add(g):f.h=g}function _m(f,g){f.h&&f.h==g?f.h=null:f.g&&f.g.has(g)&&f.g.delete(g)}mm.prototype.cancel=function(){if(this.i=vm(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const f of this.g.values())f.cancel();this.g.clear()}};function vm(f){if(f.h!=null)return f.i.concat(f.h.D);if(f.g!=null&&f.g.size!==0){let g=f.i;for(const y of f.g.values())g=g.concat(y.D);return g}return R(f.i)}function $0(f){if(f.V&&typeof f.V=="function")return f.V();if(typeof Map<"u"&&f instanceof Map||typeof Set<"u"&&f instanceof Set)return Array.from(f.values());if(typeof f=="string")return f.split("");if(c(f)){for(var g=[],y=f.length,E=0;E<y;E++)g.push(f[E]);return g}g=[],y=0;for(E in f)g[y++]=f[E];return g}function z0(f){if(f.na&&typeof f.na=="function")return f.na();if(!f.V||typeof f.V!="function"){if(typeof Map<"u"&&f instanceof Map)return Array.from(f.keys());if(!(typeof Set<"u"&&f instanceof Set)){if(c(f)||typeof f=="string"){var g=[];f=f.length;for(var y=0;y<f;y++)g.push(y);return g}g=[],y=0;for(const E in f)g[y++]=E;return g}}}function Tm(f,g){if(f.forEach&&typeof f.forEach=="function")f.forEach(g,void 0);else if(c(f)||typeof f=="string")Array.prototype.forEach.call(f,g,void 0);else for(var y=z0(f),E=$0(f),V=E.length,U=0;U<V;U++)g.call(void 0,E[U],y&&y[U],f)}var Em=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function H0(f,g){if(f){f=f.split("&");for(var y=0;y<f.length;y++){var E=f[y].indexOf("="),V=null;if(0<=E){var U=f[y].substring(0,E);V=f[y].substring(E+1)}else U=f[y];g(U,V?decodeURIComponent(V.replace(/\+/g," ")):"")}}}function Pr(f){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,f instanceof Pr){this.h=f.h,Ll(this,f.j),this.o=f.o,this.g=f.g,Fl(this,f.s),this.l=f.l;var g=f.i,y=new qo;y.i=g.i,g.g&&(y.g=new Map(g.g),y.h=g.h),Im(this,y),this.m=f.m}else f&&(g=String(f).match(Em))?(this.h=!1,Ll(this,g[1]||"",!0),this.o=Bo(g[2]||""),this.g=Bo(g[3]||"",!0),Fl(this,g[4]),this.l=Bo(g[5]||"",!0),Im(this,g[6]||"",!0),this.m=Bo(g[7]||"")):(this.h=!1,this.i=new qo(null,this.h))}Pr.prototype.toString=function(){var f=[],g=this.j;g&&f.push(Oo(g,Cm,!0),":");var y=this.g;return(y||g=="file")&&(f.push("//"),(g=this.o)&&f.push(Oo(g,Cm,!0),"@"),f.push(encodeURIComponent(String(y)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y=this.s,y!=null&&f.push(":",String(y))),(y=this.l)&&(this.g&&y.charAt(0)!="/"&&f.push("/"),f.push(Oo(y,y.charAt(0)=="/"?J0:W0,!0))),(y=this.i.toString())&&f.push("?",y),(y=this.m)&&f.push("#",Oo(y,Y0)),f.join("")};function In(f){return new Pr(f)}function Ll(f,g,y){f.j=y?Bo(g,!0):g,f.j&&(f.j=f.j.replace(/:$/,""))}function Fl(f,g){if(g){if(g=Number(g),isNaN(g)||0>g)throw Error("Bad port number "+g);f.s=g}else f.s=null}function Im(f,g,y){g instanceof qo?(f.i=g,X0(f.i,f.h)):(y||(g=Oo(g,Q0)),f.i=new qo(g,f.h))}function _e(f,g,y){f.i.set(g,y)}function Ul(f){return _e(f,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),f}function Bo(f,g){return f?g?decodeURI(f.replace(/%25/g,"%2525")):decodeURIComponent(f):""}function Oo(f,g,y){return typeof f=="string"?(f=encodeURI(f).replace(g,K0),y&&(f=f.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f):null}function K0(f){return f=f.charCodeAt(0),"%"+(f>>4&15).toString(16)+(f&15).toString(16)}var Cm=/[#\/\?@]/g,W0=/[#\?:]/g,J0=/[#\?]/g,Q0=/[#\?@]/g,Y0=/#/g;function qo(f,g){this.h=this.g=null,this.i=f||null,this.j=!!g}function Gn(f){f.g||(f.g=new Map,f.h=0,f.i&&H0(f.i,function(g,y){f.add(decodeURIComponent(g.replace(/\+/g," ")),y)}))}t=qo.prototype,t.add=function(f,g){Gn(this),this.i=null,f=Ei(this,f);var y=this.g.get(f);return y||this.g.set(f,y=[]),y.push(g),this.h+=1,this};function wm(f,g){Gn(f),g=Ei(f,g),f.g.has(g)&&(f.i=null,f.h-=f.g.get(g).length,f.g.delete(g))}function Sm(f,g){return Gn(f),g=Ei(f,g),f.g.has(g)}t.forEach=function(f,g){Gn(this),this.g.forEach(function(y,E){y.forEach(function(V){f.call(g,V,E,this)},this)},this)},t.na=function(){Gn(this);const f=Array.from(this.g.values()),g=Array.from(this.g.keys()),y=[];for(let E=0;E<g.length;E++){const V=f[E];for(let U=0;U<V.length;U++)y.push(g[E])}return y},t.V=function(f){Gn(this);let g=[];if(typeof f=="string")Sm(this,f)&&(g=g.concat(this.g.get(Ei(this,f))));else{f=Array.from(this.g.values());for(let y=0;y<f.length;y++)g=g.concat(f[y])}return g},t.set=function(f,g){return Gn(this),this.i=null,f=Ei(this,f),Sm(this,f)&&(this.h-=this.g.get(f).length),this.g.set(f,[g]),this.h+=1,this},t.get=function(f,g){return f?(f=this.V(f),0<f.length?String(f[0]):g):g};function Am(f,g,y){wm(f,g),0<y.length&&(f.i=null,f.g.set(Ei(f,g),R(y)),f.h+=y.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const f=[],g=Array.from(this.g.keys());for(var y=0;y<g.length;y++){var E=g[y];const U=encodeURIComponent(String(E)),z=this.V(E);for(E=0;E<z.length;E++){var V=U;z[E]!==""&&(V+="="+encodeURIComponent(String(z[E]))),f.push(V)}}return this.i=f.join("&")};function Ei(f,g){return g=String(g),f.j&&(g=g.toLowerCase()),g}function X0(f,g){g&&!f.j&&(Gn(f),f.i=null,f.g.forEach(function(y,E){var V=E.toLowerCase();E!=V&&(wm(this,E),Am(this,V,y))},f)),f.j=g}function Z0(f,g){const y=new Uo;if(u.Image){const E=new Image;E.onload=_($n,y,"TestLoadImage: loaded",!0,g,E),E.onerror=_($n,y,"TestLoadImage: error",!1,g,E),E.onabort=_($n,y,"TestLoadImage: abort",!1,g,E),E.ontimeout=_($n,y,"TestLoadImage: timeout",!1,g,E),u.setTimeout(function(){E.ontimeout&&E.ontimeout()},1e4),E.src=f}else g(!1)}function j0(f,g){const y=new Uo,E=new AbortController,V=setTimeout(()=>{E.abort(),$n(y,"TestPingServer: timeout",!1,g)},1e4);fetch(f,{signal:E.signal}).then(U=>{clearTimeout(V),U.ok?$n(y,"TestPingServer: ok",!0,g):$n(y,"TestPingServer: server error",!1,g)}).catch(()=>{clearTimeout(V),$n(y,"TestPingServer: error",!1,g)})}function $n(f,g,y,E,V){try{V&&(V.onload=null,V.onerror=null,V.onabort=null,V.ontimeout=null),E(y)}catch{}}function eS(){this.g=new F0}function tS(f,g,y){const E=y||"";try{Tm(f,function(V,U){let z=V;d(V)&&(z=_c(V)),g.push(E+U+"="+encodeURIComponent(z))})}catch(V){throw g.push(E+"type="+encodeURIComponent("_badmap")),V}}function bl(f){this.l=f.Ub||null,this.j=f.eb||!1}S(bl,vc),bl.prototype.g=function(){return new Bl(this.l,this.j)},bl.prototype.i=function(f){return function(){return f}}({});function Bl(f,g){it.call(this),this.D=f,this.o=g,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}S(Bl,it),t=Bl.prototype,t.open=function(f,g){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=f,this.A=g,this.readyState=1,$o(this)},t.send=function(f){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const g={headers:this.u,method:this.B,credentials:this.m,cache:void 0};f&&(g.body=f),(this.D||u).fetch(new Request(this.A,g)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Go(this)),this.readyState=0},t.Sa=function(f){if(this.g&&(this.l=f,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=f.headers,this.readyState=2,$o(this)),this.g&&(this.readyState=3,$o(this),this.g)))if(this.responseType==="arraybuffer")f.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in f){if(this.j=f.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Rm(this)}else f.text().then(this.Ra.bind(this),this.ga.bind(this))};function Rm(f){f.j.read().then(f.Pa.bind(f)).catch(f.ga.bind(f))}t.Pa=function(f){if(this.g){if(this.o&&f.value)this.response.push(f.value);else if(!this.o){var g=f.value?f.value:new Uint8Array(0);(g=this.v.decode(g,{stream:!f.done}))&&(this.response=this.responseText+=g)}f.done?Go(this):$o(this),this.readyState==3&&Rm(this)}},t.Ra=function(f){this.g&&(this.response=this.responseText=f,Go(this))},t.Qa=function(f){this.g&&(this.response=f,Go(this))},t.ga=function(){this.g&&Go(this)};function Go(f){f.readyState=4,f.l=null,f.j=null,f.v=null,$o(f)}t.setRequestHeader=function(f,g){this.u.append(f,g)},t.getResponseHeader=function(f){return this.h&&this.h.get(f.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const f=[],g=this.h.entries();for(var y=g.next();!y.done;)y=y.value,f.push(y[0]+": "+y[1]),y=g.next();return f.join(`\r
`)};function $o(f){f.onreadystatechange&&f.onreadystatechange.call(f)}Object.defineProperty(Bl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(f){this.m=f?"include":"same-origin"}});function xm(f){let g="";return b(f,function(y,E){g+=E,g+=":",g+=y,g+=`\r
`}),g}function Pc(f,g,y){e:{for(E in y){var E=!1;break e}E=!0}E||(y=xm(y),typeof f=="string"?y!=null&&encodeURIComponent(String(y)):_e(f,g,y))}function Ne(f){it.call(this),this.headers=new Map,this.o=f||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}S(Ne,it);var nS=/^https?$/i,rS=["POST","PUT"];t=Ne.prototype,t.Ha=function(f){this.J=f},t.ea=function(f,g,y,E){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+f);g=g?g.toUpperCase():"GET",this.D=f,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ic.g(),this.v=this.o?rm(this.o):rm(Ic),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(g,String(f),!0),this.B=!1}catch(U){Pm(this,U);return}if(f=y||"",y=new Map(this.headers),E)if(Object.getPrototypeOf(E)===Object.prototype)for(var V in E)y.set(V,E[V]);else if(typeof E.keys=="function"&&typeof E.get=="function")for(const U of E.keys())y.set(U,E.get(U));else throw Error("Unknown input type for opt_headers: "+String(E));E=Array.from(y.keys()).find(U=>U.toLowerCase()=="content-type"),V=u.FormData&&f instanceof u.FormData,!(0<=Array.prototype.indexOf.call(rS,g,void 0))||E||V||y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[U,z]of y)this.g.setRequestHeader(U,z);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{km(this),this.u=!0,this.g.send(f),this.u=!1}catch(U){Pm(this,U)}};function Pm(f,g){f.h=!1,f.g&&(f.j=!0,f.g.abort(),f.j=!1),f.l=g,f.m=5,Dm(f),Ol(f)}function Dm(f){f.A||(f.A=!0,pt(f,"complete"),pt(f,"error"))}t.abort=function(f){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=f||7,pt(this,"complete"),pt(this,"abort"),Ol(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ol(this,!0)),Ne.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Mm(this):this.bb())},t.bb=function(){Mm(this)};function Mm(f){if(f.h&&typeof s<"u"&&(!f.v[1]||Cn(f)!=4||f.Z()!=2)){if(f.u&&Cn(f)==4)jp(f.Ea,0,f);else if(pt(f,"readystatechange"),Cn(f)==4){f.h=!1;try{const z=f.Z();e:switch(z){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var g=!0;break e;default:g=!1}var y;if(!(y=g)){var E;if(E=z===0){var V=String(f.D).match(Em)[1]||null;!V&&u.self&&u.self.location&&(V=u.self.location.protocol.slice(0,-1)),E=!nS.test(V?V.toLowerCase():"")}y=E}if(y)pt(f,"complete"),pt(f,"success");else{f.m=6;try{var U=2<Cn(f)?f.g.statusText:""}catch{U=""}f.l=U+" ["+f.Z()+"]",Dm(f)}}finally{Ol(f)}}}}function Ol(f,g){if(f.g){km(f);const y=f.g,E=f.v[0]?()=>{}:null;f.g=null,f.v=null,g||pt(f,"ready");try{y.onreadystatechange=E}catch{}}}function km(f){f.I&&(u.clearTimeout(f.I),f.I=null)}t.isActive=function(){return!!this.g};function Cn(f){return f.g?f.g.readyState:0}t.Z=function(){try{return 2<Cn(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(f){if(this.g){var g=this.g.responseText;return f&&g.indexOf(f)==0&&(g=g.substring(f.length)),L0(g)}};function Nm(f){try{if(!f.g)return null;if("response"in f.g)return f.g.response;switch(f.H){case"":case"text":return f.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in f.g)return f.g.mozResponseArrayBuffer}return null}catch{return null}}function iS(f){const g={};f=(f.g&&2<=Cn(f)&&f.g.getAllResponseHeaders()||"").split(`\r
`);for(let E=0;E<f.length;E++){if(T(f[E]))continue;var y=D(f[E]);const V=y[0];if(y=y[1],typeof y!="string")continue;y=y.trim();const U=g[V]||[];g[V]=U,U.push(y)}A(g,function(E){return E.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function zo(f,g,y){return y&&y.internalChannelParams&&y.internalChannelParams[f]||g}function Vm(f){this.Aa=0,this.i=[],this.j=new Uo,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=zo("failFast",!1,f),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=zo("baseRetryDelayMs",5e3,f),this.cb=zo("retryDelaySeedMs",1e4,f),this.Wa=zo("forwardChannelMaxRetries",2,f),this.wa=zo("forwardChannelRequestTimeoutMs",2e4,f),this.pa=f&&f.xmlHttpFactory||void 0,this.Xa=f&&f.Tb||void 0,this.Ca=f&&f.useFetchStreams||!1,this.L=void 0,this.J=f&&f.supportsCrossDomainXhr||!1,this.K="",this.h=new mm(f&&f.concurrentRequestLimit),this.Da=new eS,this.P=f&&f.fastHandshake||!1,this.O=f&&f.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=f&&f.Rb||!1,f&&f.xa&&this.j.xa(),f&&f.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&f&&f.detectBufferingProxy||!1,this.ja=void 0,f&&f.longPollingTimeout&&0<f.longPollingTimeout&&(this.ja=f.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=Vm.prototype,t.la=8,t.G=1,t.connect=function(f,g,y,E){mt(0),this.W=f,this.H=g||{},y&&E!==void 0&&(this.H.OSID=y,this.H.OAID=E),this.F=this.X,this.I=$m(this,null,this.W),Gl(this)};function Dc(f){if(Lm(f),f.G==3){var g=f.U++,y=In(f.I);if(_e(y,"SID",f.K),_e(y,"RID",g),_e(y,"TYPE","terminate"),Ho(f,y),g=new qn(f,f.j,g),g.L=2,g.v=Ul(In(y)),y=!1,u.navigator&&u.navigator.sendBeacon)try{y=u.navigator.sendBeacon(g.v.toString(),"")}catch{}!y&&u.Image&&(new Image().src=g.v,y=!0),y||(g.g=zm(g.j,null),g.g.ea(g.v)),g.F=Date.now(),Vl(g)}Gm(f)}function ql(f){f.g&&(kc(f),f.g.cancel(),f.g=null)}function Lm(f){ql(f),f.u&&(u.clearTimeout(f.u),f.u=null),$l(f),f.h.cancel(),f.s&&(typeof f.s=="number"&&u.clearTimeout(f.s),f.s=null)}function Gl(f){if(!gm(f.h)&&!f.s){f.s=!0;var g=f.Ga;yn||te(),K||(yn(),K=!0),j.add(g,f),f.B=0}}function oS(f,g){return ym(f.h)>=f.h.j-(f.s?1:0)?!1:f.s?(f.i=g.D.concat(f.i),!0):f.G==1||f.G==2||f.B>=(f.Va?0:f.Wa)?!1:(f.s=Fo(m(f.Ga,f,g),qm(f,f.B)),f.B++,!0)}t.Ga=function(f){if(this.s)if(this.s=null,this.G==1){if(!f){this.U=Math.floor(1e5*Math.random()),f=this.U++;const V=new qn(this,this.j,f);let U=this.o;if(this.S&&(U?(U=v(U),x(U,this.S)):U=this.S),this.m!==null||this.O||(V.H=U,U=null),this.P)e:{for(var g=0,y=0;y<this.i.length;y++){t:{var E=this.i[y];if("__data__"in E.map&&(E=E.map.__data__,typeof E=="string")){E=E.length;break t}E=void 0}if(E===void 0)break;if(g+=E,4096<g){g=y;break e}if(g===4096||y===this.i.length-1){g=y+1;break e}}g=1e3}else g=1e3;g=Um(this,V,g),y=In(this.I),_e(y,"RID",f),_e(y,"CVER",22),this.D&&_e(y,"X-HTTP-Session-Id",this.D),Ho(this,y),U&&(this.O?g="headers="+encodeURIComponent(String(xm(U)))+"&"+g:this.m&&Pc(y,this.m,U)),xc(this.h,V),this.Ua&&_e(y,"TYPE","init"),this.P?(_e(y,"$req",g),_e(y,"SID","null"),V.T=!0,wc(V,y,null)):wc(V,y,g),this.G=2}}else this.G==3&&(f?Fm(this,f):this.i.length==0||gm(this.h)||Fm(this))};function Fm(f,g){var y;g?y=g.l:y=f.U++;const E=In(f.I);_e(E,"SID",f.K),_e(E,"RID",y),_e(E,"AID",f.T),Ho(f,E),f.m&&f.o&&Pc(E,f.m,f.o),y=new qn(f,f.j,y,f.B+1),f.m===null&&(y.H=f.o),g&&(f.i=g.D.concat(f.i)),g=Um(f,y,1e3),y.I=Math.round(.5*f.wa)+Math.round(.5*f.wa*Math.random()),xc(f.h,y),wc(y,E,g)}function Ho(f,g){f.H&&b(f.H,function(y,E){_e(g,E,y)}),f.l&&Tm({},function(y,E){_e(g,E,y)})}function Um(f,g,y){y=Math.min(f.i.length,y);var E=f.l?m(f.l.Na,f.l,f):null;e:{var V=f.i;let U=-1;for(;;){const z=["count="+y];U==-1?0<y?(U=V[0].g,z.push("ofs="+U)):U=0:z.push("ofs="+U);let ge=!0;for(let Xe=0;Xe<y;Xe++){let ue=V[Xe].g;const ot=V[Xe].map;if(ue-=U,0>ue)U=Math.max(0,V[Xe].g-100),ge=!1;else try{tS(ot,z,"req"+ue+"_")}catch{E&&E(ot)}}if(ge){E=z.join("&");break e}}}return f=f.i.splice(0,y),g.D=f,E}function bm(f){if(!f.g&&!f.u){f.Y=1;var g=f.Fa;yn||te(),K||(yn(),K=!0),j.add(g,f),f.v=0}}function Mc(f){return f.g||f.u||3<=f.v?!1:(f.Y++,f.u=Fo(m(f.Fa,f),qm(f,f.v)),f.v++,!0)}t.Fa=function(){if(this.u=null,Bm(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var f=2*this.R;this.j.info("BP detection timer enabled: "+f),this.A=Fo(m(this.ab,this),f)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,mt(10),ql(this),Bm(this))};function kc(f){f.A!=null&&(u.clearTimeout(f.A),f.A=null)}function Bm(f){f.g=new qn(f,f.j,"rpc",f.Y),f.m===null&&(f.g.H=f.o),f.g.O=0;var g=In(f.qa);_e(g,"RID","rpc"),_e(g,"SID",f.K),_e(g,"AID",f.T),_e(g,"CI",f.F?"0":"1"),!f.F&&f.ja&&_e(g,"TO",f.ja),_e(g,"TYPE","xmlhttp"),Ho(f,g),f.m&&f.o&&Pc(g,f.m,f.o),f.L&&(f.g.I=f.L);var y=f.g;f=f.ia,y.L=1,y.v=Ul(In(g)),y.m=null,y.P=!0,fm(y,f)}t.Za=function(){this.C!=null&&(this.C=null,ql(this),Mc(this),mt(19))};function $l(f){f.C!=null&&(u.clearTimeout(f.C),f.C=null)}function Om(f,g){var y=null;if(f.g==g){$l(f),kc(f),f.g=null;var E=2}else if(Rc(f.h,g))y=g.D,_m(f.h,g),E=1;else return;if(f.G!=0){if(g.o)if(E==1){y=g.m?g.m.length:0,g=Date.now()-g.F;var V=f.B;E=Ml(),pt(E,new am(E,y)),Gl(f)}else bm(f);else if(V=g.s,V==3||V==0&&0<g.X||!(E==1&&oS(f,g)||E==2&&Mc(f)))switch(y&&0<y.length&&(g=f.h,g.i=g.i.concat(y)),V){case 1:Dr(f,5);break;case 4:Dr(f,10);break;case 3:Dr(f,6);break;default:Dr(f,2)}}}function qm(f,g){let y=f.Ta+Math.floor(Math.random()*f.cb);return f.isActive()||(y*=2),y*g}function Dr(f,g){if(f.j.info("Error code "+g),g==2){var y=m(f.fb,f),E=f.Xa;const V=!E;E=new Pr(E||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||Ll(E,"https"),Ul(E),V?Z0(E.toString(),y):j0(E.toString(),y)}else mt(2);f.G=0,f.l&&f.l.sa(g),Gm(f),Lm(f)}t.fb=function(f){f?(this.j.info("Successfully pinged google.com"),mt(2)):(this.j.info("Failed to ping google.com"),mt(1))};function Gm(f){if(f.G=0,f.ka=[],f.l){const g=vm(f.h);(g.length!=0||f.i.length!=0)&&(M(f.ka,g),M(f.ka,f.i),f.h.i.length=0,R(f.i),f.i.length=0),f.l.ra()}}function $m(f,g,y){var E=y instanceof Pr?In(y):new Pr(y);if(E.g!="")g&&(E.g=g+"."+E.g),Fl(E,E.s);else{var V=u.location;E=V.protocol,g=g?g+"."+V.hostname:V.hostname,V=+V.port;var U=new Pr(null);E&&Ll(U,E),g&&(U.g=g),V&&Fl(U,V),y&&(U.l=y),E=U}return y=f.D,g=f.ya,y&&g&&_e(E,y,g),_e(E,"VER",f.la),Ho(f,E),E}function zm(f,g,y){if(g&&!f.J)throw Error("Can't create secondary domain capable XhrIo object.");return g=f.Ca&&!f.pa?new Ne(new bl({eb:y})):new Ne(f.pa),g.Ha(f.J),g}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Hm(){}t=Hm.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function zl(){}zl.prototype.g=function(f,g){return new Mt(f,g)};function Mt(f,g){it.call(this),this.g=new Vm(g),this.l=f,this.h=g&&g.messageUrlParams||null,f=g&&g.messageHeaders||null,g&&g.clientProtocolHeaderRequired&&(f?f["X-Client-Protocol"]="webchannel":f={"X-Client-Protocol":"webchannel"}),this.g.o=f,f=g&&g.initMessageHeaders||null,g&&g.messageContentType&&(f?f["X-WebChannel-Content-Type"]=g.messageContentType:f={"X-WebChannel-Content-Type":g.messageContentType}),g&&g.va&&(f?f["X-WebChannel-Client-Profile"]=g.va:f={"X-WebChannel-Client-Profile":g.va}),this.g.S=f,(f=g&&g.Sb)&&!T(f)&&(this.g.m=f),this.v=g&&g.supportsCrossDomainXhr||!1,this.u=g&&g.sendRawJson||!1,(g=g&&g.httpSessionIdParam)&&!T(g)&&(this.g.D=g,f=this.h,f!==null&&g in f&&(f=this.h,g in f&&delete f[g])),this.j=new Ii(this)}S(Mt,it),Mt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Mt.prototype.close=function(){Dc(this.g)},Mt.prototype.o=function(f){var g=this.g;if(typeof f=="string"){var y={};y.__data__=f,f=y}else this.u&&(y={},y.__data__=_c(f),f=y);g.i.push(new G0(g.Ya++,f)),g.G==3&&Gl(g)},Mt.prototype.N=function(){this.g.l=null,delete this.j,Dc(this.g),delete this.g,Mt.aa.N.call(this)};function Km(f){Tc.call(this),f.__headers__&&(this.headers=f.__headers__,this.statusCode=f.__status__,delete f.__headers__,delete f.__status__);var g=f.__sm__;if(g){e:{for(const y in g){f=y;break e}f=void 0}(this.i=f)&&(f=this.i,g=g!==null&&f in g?g[f]:void 0),this.data=g}else this.data=f}S(Km,Tc);function Wm(){Ec.call(this),this.status=1}S(Wm,Ec);function Ii(f){this.g=f}S(Ii,Hm),Ii.prototype.ua=function(){pt(this.g,"a")},Ii.prototype.ta=function(f){pt(this.g,new Km(f))},Ii.prototype.sa=function(f){pt(this.g,new Wm)},Ii.prototype.ra=function(){pt(this.g,"b")},zl.prototype.createWebChannel=zl.prototype.g,Mt.prototype.send=Mt.prototype.o,Mt.prototype.open=Mt.prototype.m,Mt.prototype.close=Mt.prototype.close,uC=function(){return new zl},aC=function(){return Ml()},lC=Rr,Pf={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},kl.NO_ERROR=0,kl.TIMEOUT=8,kl.HTTP_ERROR=6,Na=kl,um.COMPLETE="complete",sC=um,im.EventType=Vo,Vo.OPEN="a",Vo.CLOSE="b",Vo.ERROR="c",Vo.MESSAGE="d",it.prototype.listen=it.prototype.K,fs=im,Ne.prototype.listenOnce=Ne.prototype.L,Ne.prototype.getLastError=Ne.prototype.Ka,Ne.prototype.getLastErrorCode=Ne.prototype.Ba,Ne.prototype.getStatus=Ne.prototype.Z,Ne.prototype.getResponseJson=Ne.prototype.Oa,Ne.prototype.getResponseText=Ne.prototype.oa,Ne.prototype.send=Ne.prototype.ea,Ne.prototype.setWithCredentials=Ne.prototype.Ha,oC=Ne}).apply(typeof da<"u"?da:typeof self<"u"?self:typeof window<"u"?window:{});const L_="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class je{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}je.UNAUTHENTICATED=new je(null),je.GOOGLE_CREDENTIALS=new je("google-credentials-uid"),je.FIRST_PARTY=new je("first-party-uid"),je.MOCK_USER=new je("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Po="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jr=new QI("@firebase/firestore");function Di(){return jr.logLevel}function q(t,...e){if(jr.logLevel<=le.DEBUG){const n=e.map(ep);jr.debug(`Firestore (${Po}): ${t}`,...n)}}function _t(t,...e){if(jr.logLevel<=le.ERROR){const n=e.map(ep);jr.error(`Firestore (${Po}): ${t}`,...n)}}function ei(t,...e){if(jr.logLevel<=le.WARN){const n=e.map(ep);jr.warn(`Firestore (${Po}): ${t}`,...n)}}function ep(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q(t="Unexpected state"){const e=`FIRESTORE (${Po}) INTERNAL ASSERTION FAILED: `+t;throw _t(e),new Error(e)}function Y(t,e){t||Q()}function Z(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class $ extends pi{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cC{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class eU{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(je.UNAUTHENTICATED))}shutdown(){}}class tU{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class nU{constructor(e){this.t=e,this.currentUser=je.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Y(this.o===void 0);let r=this.i;const i=c=>this.i!==r?(r=this.i,n(c)):Promise.resolve();let o=new pn;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new pn,e.enqueueRetryable(()=>i(this.currentUser))};const s=()=>{const c=o;e.enqueueRetryable(async()=>{await c.promise,await i(this.currentUser)})},u=c=>{q("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(q("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new pn)}},0),s()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(q("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Y(typeof r.accessToken=="string"),new cC(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Y(e===null||typeof e=="string"),new je(e)}}class rU{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=je.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class iU{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new rU(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(je.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class oU{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class sU{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){Y(this.o===void 0);const r=o=>{o.error!=null&&q("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const s=o.token!==this.R;return this.R=o.token,q("FirebaseAppCheckTokenProvider",`Received ${s?"new":"existing"} token.`),s?n(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};const i=o=>{q("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){const o=this.A.getImmediate({optional:!0});o?i(o):q("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Y(typeof n.token=="string"),this.R=n.token,new oU(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lU(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dC{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=lU(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<n&&(r+=e.charAt(i[o]%e.length))}return r}}function ee(t,e){return t<e?-1:t>e?1:0}function ho(t,e,n){return t.length===e.length&&t.every((r,i)=>n(r,e[i]))}function fC(t){return t+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Me{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new $(O.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new $(O.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new $(O.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new $(O.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Me.fromMillis(Date.now())}static fromDate(e){return Me.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new Me(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ee(this.nanoseconds,e.nanoseconds):ee(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X{constructor(e){this.timestamp=e}static fromTimestamp(e){return new X(e)}static min(){return new X(new Me(0,0))}static max(){return new X(new Me(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class js{constructor(e,n,r){n===void 0?n=0:n>e.length&&Q(),r===void 0?r=e.length-n:r>e.length-n&&Q(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return js.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof js?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const o=e.get(i),s=n.get(i);if(o<s)return-1;if(o>s)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class ce extends js{construct(e,n,r){return new ce(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new $(O.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(i=>i.length>0))}return new ce(n)}static emptyPath(){return new ce([])}}const aU=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Pe extends js{construct(e,n,r){return new Pe(e,n,r)}static isValidIdentifier(e){return aU.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Pe.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Pe(["__name__"])}static fromServerFormat(e){const n=[];let r="",i=0;const o=()=>{if(r.length===0)throw new $(O.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let s=!1;for(;i<e.length;){const u=e[i];if(u==="\\"){if(i+1===e.length)throw new $(O.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new $(O.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,i+=2}else u==="`"?(s=!s,i++):u!=="."||s?(r+=u,i++):(o(),i++)}if(o(),s)throw new $(O.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Pe(n)}static emptyPath(){return new Pe([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H{constructor(e){this.path=e}static fromPath(e){return new H(ce.fromString(e))}static fromName(e){return new H(ce.fromString(e).popFirst(5))}static empty(){return new H(ce.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ce.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return ce.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new H(new ce(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _u{constructor(e,n,r,i){this.indexId=e,this.collectionGroup=n,this.fields=r,this.indexState=i}}function Df(t){return t.fields.find(e=>e.kind===2)}function Lr(t){return t.fields.filter(e=>e.kind!==2)}_u.UNKNOWN_ID=-1;class Va{constructor(e,n){this.fieldPath=e,this.kind=n}}class el{constructor(e,n){this.sequenceNumber=e,this.offset=n}static empty(){return new el(0,bt.min())}}function uU(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=X.fromTimestamp(r===1e9?new Me(n+1,0):new Me(n,r));return new bt(i,H.empty(),e)}function hC(t){return new bt(t.readTime,t.key,-1)}class bt{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new bt(X.min(),H.empty(),-1)}static max(){return new bt(X.max(),H.empty(),-1)}}function tp(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=H.comparator(t.documentKey,e.documentKey),n!==0?n:ee(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pC="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class mC{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mi(t){if(t.code!==O.FAILED_PRECONDITION||t.message!==pC)throw t;q("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Q(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new L((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(n,o).next(r,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof L?n:L.resolve(n)}catch(n){return L.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):L.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):L.reject(n)}static resolve(e){return new L((n,r)=>{n(e)})}static reject(e){return new L((n,r)=>{r(e)})}static waitFor(e){return new L((n,r)=>{let i=0,o=0,s=!1;e.forEach(u=>{++i,u.next(()=>{++o,s&&o===i&&n()},c=>r(c))}),s=!0,o===i&&n()})}static or(e){let n=L.resolve(!1);for(const r of e)n=n.next(i=>i?L.resolve(i):r());return n}static forEach(e,n){const r=[];return e.forEach((i,o)=>{r.push(n.call(this,i,o))}),this.waitFor(r)}static mapArray(e,n){return new L((r,i)=>{const o=e.length,s=new Array(o);let u=0;for(let c=0;c<o;c++){const d=c;n(e[d]).next(h=>{s[d]=h,++u,u===o&&r(s)},h=>i(h))}})}static doWhile(e,n){return new L((r,i)=>{const o=()=>{e()===!0?n().next(()=>{o()},i):r()};o()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wu{constructor(e,n){this.action=e,this.transaction=n,this.aborted=!1,this.V=new pn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{n.error?this.V.reject(new Rs(e,n.error)):this.V.resolve()},this.transaction.onerror=r=>{const i=np(r.target.error);this.V.reject(new Rs(e,i))}}static open(e,n,r,i){try{return new Wu(n,e.transaction(i,r))}catch(o){throw new Rs(n,o)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(q("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const n=this.transaction.objectStore(e);return new dU(n)}}class pr{constructor(e,n,r){this.name=e,this.version=n,this.p=r,pr.S(gu())===12.2&&_t("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return q("SimpleDb","Removing database:",e),Fr(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!WI())return!1;if(pr.v())return!0;const e=gu(),n=pr.S(e),r=0<n&&n<10,i=gC(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,n){return e.store(n)}static S(e){const n=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(q("SimpleDb","Opening database:",this.name),this.db=await new Promise((n,r)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=o=>{const s=o.target.result;n(s)},i.onblocked=()=>{r(new Rs(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=o=>{const s=o.target.error;s.name==="VersionError"?r(new $(O.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):s.name==="InvalidStateError"?r(new $(O.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+s)):r(new Rs(e,s))},i.onupgradeneeded=o=>{q("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',o.oldVersion);const s=o.target.result;this.p.O(s,i.transaction,o.oldVersion,this.version).next(()=>{q("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=n=>this.N(n)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=n=>e(n))}async runTransaction(e,n,r,i){const o=n==="readonly";let s=0;for(;;){++s;try{this.db=await this.M(e);const u=Wu.open(this.db,e,o?"readonly":"readwrite",r),c=i(u).next(d=>(u.g(),d)).catch(d=>(u.abort(d),L.reject(d))).toPromise();return c.catch(()=>{}),await u.m,c}catch(u){const c=u,d=c.name!=="FirebaseError"&&s<3;if(q("SimpleDb","Transaction failed with error:",c.message,"Retrying:",d),this.close(),!d)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}function gC(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class cU{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Fr(this.B.delete())}}class Rs extends ${constructor(e,n){super(O.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${n}`),this.name="IndexedDbTransactionError"}}function Sr(t){return t.name==="IndexedDbTransactionError"}class dU{constructor(e){this.store=e}put(e,n){let r;return n!==void 0?(q("SimpleDb","PUT",this.store.name,e,n),r=this.store.put(n,e)):(q("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Fr(r)}add(e){return q("SimpleDb","ADD",this.store.name,e,e),Fr(this.store.add(e))}get(e){return Fr(this.store.get(e)).next(n=>(n===void 0&&(n=null),q("SimpleDb","GET",this.store.name,e,n),n))}delete(e){return q("SimpleDb","DELETE",this.store.name,e),Fr(this.store.delete(e))}count(){return q("SimpleDb","COUNT",this.store.name),Fr(this.store.count())}U(e,n){const r=this.options(e,n),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){const o=i.getAll(r.range);return new L((s,u)=>{o.onerror=c=>{u(c.target.error)},o.onsuccess=c=>{s(c.target.result)}})}{const o=this.cursor(r),s=[];return this.W(o,(u,c)=>{s.push(c)}).next(()=>s)}}G(e,n){const r=this.store.getAll(e,n===null?void 0:n);return new L((i,o)=>{r.onerror=s=>{o(s.target.error)},r.onsuccess=s=>{i(s.target.result)}})}j(e,n){q("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,n);r.H=!1;const i=this.cursor(r);return this.W(i,(o,s,u)=>u.delete())}J(e,n){let r;n?r=e:(r={},n=e);const i=this.cursor(r);return this.W(i,n)}Y(e){const n=this.cursor({});return new L((r,i)=>{n.onerror=o=>{const s=np(o.target.error);i(s)},n.onsuccess=o=>{const s=o.target.result;s?e(s.primaryKey,s.value).next(u=>{u?s.continue():r()}):r()}})}W(e,n){const r=[];return new L((i,o)=>{e.onerror=s=>{o(s.target.error)},e.onsuccess=s=>{const u=s.target.result;if(!u)return void i();const c=new cU(u),d=n(u.primaryKey,u.value,c);if(d instanceof L){const h=d.catch(p=>(c.done(),L.reject(p)));r.push(h)}c.isDone?i():c.K===null?u.continue():u.continue(c.K)}}).next(()=>L.waitFor(r))}options(e,n){let r;return e!==void 0&&(typeof e=="string"?r=e:n=e),{index:r,range:n}}cursor(e){let n="next";if(e.reverse&&(n="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,n):r.openCursor(e.range,n)}return this.store.openCursor(e.range,n)}}function Fr(t){return new L((e,n)=>{t.onsuccess=r=>{const i=r.target.result;e(i)},t.onerror=r=>{const i=np(r.target.error);n(i)}})}let F_=!1;function np(t){const e=pr.S(gu());if(e>=12.2&&e<13){const n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){const r=new $("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return F_||(F_=!0,setTimeout(()=>{throw r},0)),r}}return t}class fU{constructor(e,n){this.asyncQueue=e,this.Z=n,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){q("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{q("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(n){Sr(n)?q("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",n):await mi(n)}await this.X(6e4)})}}class hU{constructor(e,n){this.localStore=e,this.persistence=n}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>this.te(n,e))}te(e,n){const r=new Set;let i=n,o=!0;return L.doWhile(()=>o===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(s=>{if(s!==null&&!r.has(s))return q("IndexBackfiller",`Processing collection: ${s}`),this.ne(e,s,i).next(u=>{i-=u,r.add(s)});o=!1})).next(()=>n-i)}ne(e,n,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,n).next(i=>this.localStore.localDocuments.getNextDocuments(e,n,i,r).next(o=>{const s=o.changes;return this.localStore.indexManager.updateIndexEntries(e,s).next(()=>this.re(i,o)).next(u=>(q("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,n,u))).next(()=>s.size)}))}re(e,n){let r=e;return n.changes.forEach((i,o)=>{const s=hC(o);tp(s,r)>0&&(r=s)}),new bt(r.readTime,r.documentKey,Math.max(n.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zt{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ie(r),this.se=r=>n.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}zt.oe=-1;function _l(t){return t==null}function tl(t){return t===0&&1/t==-1/0}function pU(t){return typeof t=="number"&&Number.isInteger(t)&&!tl(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tt(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=U_(e)),e=mU(t.get(n),e);return U_(e)}function mU(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function U_(t){return t+""}function un(t){const e=t.length;if(Y(e>=2),e===2)return Y(t.charAt(0)===""&&t.charAt(1)===""),ce.emptyPath();const n=e-2,r=[];let i="";for(let o=0;o<e;){const s=t.indexOf("",o);switch((s<0||s>n)&&Q(),t.charAt(s+1)){case"":const u=t.substring(o,s);let c;i.length===0?c=u:(i+=u,c=i,i=""),r.push(c);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Q()}o=s+2}return new ce(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b_=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function La(t,e){return[t,Tt(e)]}function yC(t,e,n){return[t,Tt(e),n]}const gU={},yU=["prefixPath","collectionGroup","readTime","documentId"],_U=["prefixPath","collectionGroup","documentId"],vU=["collectionGroup","readTime","prefixPath","documentId"],TU=["canonicalId","targetId"],EU=["targetId","path"],IU=["path","targetId"],CU=["collectionId","parent"],wU=["indexId","uid"],SU=["uid","sequenceNumber"],AU=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],RU=["indexId","uid","orderedDocumentKey"],xU=["userId","collectionPath","documentId"],PU=["userId","collectionPath","largestBatchId"],DU=["userId","collectionGroup","largestBatchId"],_C=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],MU=[..._C,"documentOverlays"],vC=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],TC=vC,rp=[...TC,"indexConfiguration","indexState","indexEntries"],kU=rp,NU=[...rp,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mf extends mC{constructor(e,n){super(),this._e=e,this.currentSequenceNumber=n}}function He(t,e){const n=Z(t);return pr.F(n._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B_(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function gi(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function EC(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Se{constructor(e,n){this.comparator=e,this.root=n||et.EMPTY}insert(e,n){return new Se(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,et.BLACK,null,null))}remove(e){return new Se(this.comparator,this.root.remove(e,this.comparator).copy(null,null,et.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new fa(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new fa(this.root,e,this.comparator,!1)}getReverseIterator(){return new fa(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new fa(this.root,e,this.comparator,!0)}}class fa{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=n?r(e.key,n):1,n&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class et{constructor(e,n,r,i,o){this.key=e,this.value=n,this.color=r??et.RED,this.left=i??et.EMPTY,this.right=o??et.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,o){return new et(e??this.key,n??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,n,r),null):o===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return et.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return et.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,et.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,et.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Q();const e=this.left.check();if(e!==this.right.check())throw Q();return e+(this.isRed()?0:1)}}et.EMPTY=null,et.RED=!0,et.BLACK=!1;et.EMPTY=new class{constructor(){this.size=0}get key(){throw Q()}get value(){throw Q()}get color(){throw Q()}get left(){throw Q()}get right(){throw Q()}copy(e,n,r,i,o){return this}insert(e,n,r){return new et(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pe{constructor(e){this.comparator=e,this.data=new Se(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new O_(this.data.getIterator())}getIteratorFrom(e){return new O_(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof pe)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new pe(this.comparator);return n.data=e,n}}class O_{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Si(t){return t.hasNext()?t.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class At{constructor(e){this.fields=e,e.sort(Pe.comparator)}static empty(){return new At([])}unionWith(e){let n=new pe(Pe.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new At(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return ho(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IC extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ge{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new IC("Invalid base64 string: "+o):o}}(e);return new Ge(n)}static fromUint8Array(e){const n=function(i){let o="";for(let s=0;s<i.length;++s)o+=String.fromCharCode(i[s]);return o}(e);return new Ge(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ee(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ge.EMPTY_BYTE_STRING=new Ge("");const VU=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Fn(t){if(Y(!!t),typeof t=="string"){let e=0;const n=VU.exec(t);if(Y(!!n),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ie(t.seconds),nanos:Ie(t.nanos)}}function Ie(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function _r(t){return typeof t=="string"?Ge.fromBase64String(t):Ge.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ip(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function op(t){const e=t.mapValue.fields.__previous_value__;return ip(e)?op(e):e}function nl(t){const e=Fn(t.mapValue.fields.__local_write_time__.timestampValue);return new Me(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LU{constructor(e,n,r,i,o,s,u,c,d){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=s,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=d}}class ti{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new ti("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof ti&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nr={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Fa={nullValue:"NULL_VALUE"};function ni(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ip(t)?4:CC(t)?9007199254740991:Ju(t)?10:11:Q()}function mn(t,e){if(t===e)return!0;const n=ni(t);if(n!==ni(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return nl(t).isEqual(nl(e));case 3:return function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const s=Fn(i.timestampValue),u=Fn(o.timestampValue);return s.seconds===u.seconds&&s.nanos===u.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(i,o){return _r(i.bytesValue).isEqual(_r(o.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(i,o){return Ie(i.geoPointValue.latitude)===Ie(o.geoPointValue.latitude)&&Ie(i.geoPointValue.longitude)===Ie(o.geoPointValue.longitude)}(t,e);case 2:return function(i,o){if("integerValue"in i&&"integerValue"in o)return Ie(i.integerValue)===Ie(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const s=Ie(i.doubleValue),u=Ie(o.doubleValue);return s===u?tl(s)===tl(u):isNaN(s)&&isNaN(u)}return!1}(t,e);case 9:return ho(t.arrayValue.values||[],e.arrayValue.values||[],mn);case 10:case 11:return function(i,o){const s=i.mapValue.fields||{},u=o.mapValue.fields||{};if(B_(s)!==B_(u))return!1;for(const c in s)if(s.hasOwnProperty(c)&&(u[c]===void 0||!mn(s[c],u[c])))return!1;return!0}(t,e);default:return Q()}}function rl(t,e){return(t.values||[]).find(n=>mn(n,e))!==void 0}function vr(t,e){if(t===e)return 0;const n=ni(t),r=ni(e);if(n!==r)return ee(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ee(t.booleanValue,e.booleanValue);case 2:return function(o,s){const u=Ie(o.integerValue||o.doubleValue),c=Ie(s.integerValue||s.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(t,e);case 3:return q_(t.timestampValue,e.timestampValue);case 4:return q_(nl(t),nl(e));case 5:return ee(t.stringValue,e.stringValue);case 6:return function(o,s){const u=_r(o),c=_r(s);return u.compareTo(c)}(t.bytesValue,e.bytesValue);case 7:return function(o,s){const u=o.split("/"),c=s.split("/");for(let d=0;d<u.length&&d<c.length;d++){const h=ee(u[d],c[d]);if(h!==0)return h}return ee(u.length,c.length)}(t.referenceValue,e.referenceValue);case 8:return function(o,s){const u=ee(Ie(o.latitude),Ie(s.latitude));return u!==0?u:ee(Ie(o.longitude),Ie(s.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return G_(t.arrayValue,e.arrayValue);case 10:return function(o,s){var u,c,d,h;const p=o.fields||{},m=s.fields||{},_=(u=p.value)===null||u===void 0?void 0:u.arrayValue,S=(c=m.value)===null||c===void 0?void 0:c.arrayValue,R=ee(((d=_==null?void 0:_.values)===null||d===void 0?void 0:d.length)||0,((h=S==null?void 0:S.values)===null||h===void 0?void 0:h.length)||0);return R!==0?R:G_(_,S)}(t.mapValue,e.mapValue);case 11:return function(o,s){if(o===nr.mapValue&&s===nr.mapValue)return 0;if(o===nr.mapValue)return 1;if(s===nr.mapValue)return-1;const u=o.fields||{},c=Object.keys(u),d=s.fields||{},h=Object.keys(d);c.sort(),h.sort();for(let p=0;p<c.length&&p<h.length;++p){const m=ee(c[p],h[p]);if(m!==0)return m;const _=vr(u[c[p]],d[h[p]]);if(_!==0)return _}return ee(c.length,h.length)}(t.mapValue,e.mapValue);default:throw Q()}}function q_(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return ee(t,e);const n=Fn(t),r=Fn(e),i=ee(n.seconds,r.seconds);return i!==0?i:ee(n.nanos,r.nanos)}function G_(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const o=vr(n[i],r[i]);if(o)return o}return ee(n.length,r.length)}function po(t){return kf(t)}function kf(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=Fn(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return _r(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return H.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",i=!0;for(const o of n.values||[])i?i=!1:r+=",",r+=kf(o);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let i="{",o=!0;for(const s of r)o?o=!1:i+=",",i+=`${s}:${kf(n.fields[s])}`;return i+"}"}(t.mapValue):Q()}function il(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Nf(t){return!!t&&"integerValue"in t}function ol(t){return!!t&&"arrayValue"in t}function $_(t){return!!t&&"nullValue"in t}function z_(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ua(t){return!!t&&"mapValue"in t}function Ju(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="__vector__"}function xs(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return gi(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=xs(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=xs(t.arrayValue.values[n]);return e}return Object.assign({},t)}function CC(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const wC={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function FU(t){return"nullValue"in t?Fa:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?il(ti.empty(),H.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?Ju(t)?wC:{mapValue:{}}:Q()}function UU(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?il(ti.empty(),H.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?wC:"mapValue"in t?Ju(t)?{mapValue:{}}:nr:Q()}function H_(t,e){const n=vr(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function K_(t,e){const n=vr(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tt{constructor(e){this.value=e}static empty(){return new tt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Ua(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=xs(n)}setAll(e){let n=Pe.emptyPath(),r={},i=[];e.forEach((s,u)=>{if(!n.isImmediateParentOf(u)){const c=this.getFieldsMap(n);this.applyChanges(c,r,i),r={},i=[],n=u.popLast()}s?r[u.lastSegment()]=xs(s):i.push(u.lastSegment())});const o=this.getFieldsMap(n);this.applyChanges(o,r,i)}delete(e){const n=this.field(e.popLast());Ua(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return mn(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];Ua(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){gi(n,(i,o)=>e[i]=o);for(const i of r)delete e[i]}clone(){return new tt(xs(this.value))}}function SC(t){const e=[];return gi(t.fields,(n,r)=>{const i=new Pe([n]);if(Ua(r)){const o=SC(r.mapValue).fields;if(o.length===0)e.push(i);else for(const s of o)e.push(i.child(s))}else e.push(i)}),new At(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class we{constructor(e,n,r,i,o,s,u){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=o,this.data=s,this.documentState=u}static newInvalidDocument(e){return new we(e,0,X.min(),X.min(),X.min(),tt.empty(),0)}static newFoundDocument(e,n,r,i){return new we(e,1,n,X.min(),r,i,0)}static newNoDocument(e,n){return new we(e,2,n,X.min(),X.min(),tt.empty(),0)}static newUnknownDocument(e,n){return new we(e,3,n,X.min(),X.min(),tt.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(X.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=tt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=tt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=X.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof we&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new we(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mo{constructor(e,n){this.position=e,this.inclusive=n}}function W_(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const o=e[i],s=t.position[i];if(o.field.isKeyField()?r=H.comparator(H.fromName(s.referenceValue),n.key):r=vr(s,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function J_(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!mn(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sl{constructor(e,n="asc"){this.field=e,this.dir=n}}function bU(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AC{}class ie extends AC{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new BU(e,n,r):n==="array-contains"?new GU(e,r):n==="in"?new kC(e,r):n==="not-in"?new $U(e,r):n==="array-contains-any"?new zU(e,r):new ie(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new OU(e,r):new qU(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(vr(n,this.value)):n!==null&&ni(this.value)===ni(n)&&this.matchesComparison(vr(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Q()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class fe extends AC{constructor(e,n){super(),this.filters=e,this.op=n,this.ae=null}static create(e,n){return new fe(e,n)}matches(e){return go(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function go(t){return t.op==="and"}function Vf(t){return t.op==="or"}function sp(t){return RC(t)&&go(t)}function RC(t){for(const e of t.filters)if(e instanceof fe)return!1;return!0}function Lf(t){if(t instanceof ie)return t.field.canonicalString()+t.op.toString()+po(t.value);if(sp(t))return t.filters.map(e=>Lf(e)).join(",");{const e=t.filters.map(n=>Lf(n)).join(",");return`${t.op}(${e})`}}function xC(t,e){return t instanceof ie?function(r,i){return i instanceof ie&&r.op===i.op&&r.field.isEqual(i.field)&&mn(r.value,i.value)}(t,e):t instanceof fe?function(r,i){return i instanceof fe&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((o,s,u)=>o&&xC(s,i.filters[u]),!0):!1}(t,e):void Q()}function PC(t,e){const n=t.filters.concat(e);return fe.create(n,t.op)}function DC(t){return t instanceof ie?function(n){return`${n.field.canonicalString()} ${n.op} ${po(n.value)}`}(t):t instanceof fe?function(n){return n.op.toString()+" {"+n.getFilters().map(DC).join(" ,")+"}"}(t):"Filter"}class BU extends ie{constructor(e,n,r){super(e,n,r),this.key=H.fromName(r.referenceValue)}matches(e){const n=H.comparator(e.key,this.key);return this.matchesComparison(n)}}class OU extends ie{constructor(e,n){super(e,"in",n),this.keys=MC("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class qU extends ie{constructor(e,n){super(e,"not-in",n),this.keys=MC("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function MC(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>H.fromName(r.referenceValue))}class GU extends ie{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return ol(n)&&rl(n.arrayValue,this.value)}}class kC extends ie{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&rl(this.value.arrayValue,n)}}class $U extends ie{constructor(e,n){super(e,"not-in",n)}matches(e){if(rl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!rl(this.value.arrayValue,n)}}class zU extends ie{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!ol(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>rl(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HU{constructor(e,n=null,r=[],i=[],o=null,s=null,u=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=s,this.endAt=u,this.ue=null}}function Ff(t,e=null,n=[],r=[],i=null,o=null,s=null){return new HU(t,e,n,r,i,o,s)}function ri(t){const e=Z(t);if(e.ue===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>Lf(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),_l(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>po(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>po(r)).join(",")),e.ue=n}return e.ue}function vl(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!bU(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!xC(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!J_(t.startAt,e.startAt)&&J_(t.endAt,e.endAt)}function vu(t){return H.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}function Tu(t,e){return t.filters.filter(n=>n instanceof ie&&n.field.isEqual(e))}function Q_(t,e,n){let r=Fa,i=!0;for(const o of Tu(t,e)){let s=Fa,u=!0;switch(o.op){case"<":case"<=":s=FU(o.value);break;case"==":case"in":case">=":s=o.value;break;case">":s=o.value,u=!1;break;case"!=":case"not-in":s=Fa}H_({value:r,inclusive:i},{value:s,inclusive:u})<0&&(r=s,i=u)}if(n!==null){for(let o=0;o<t.orderBy.length;++o)if(t.orderBy[o].field.isEqual(e)){const s=n.position[o];H_({value:r,inclusive:i},{value:s,inclusive:n.inclusive})<0&&(r=s,i=n.inclusive);break}}return{value:r,inclusive:i}}function Y_(t,e,n){let r=nr,i=!0;for(const o of Tu(t,e)){let s=nr,u=!0;switch(o.op){case">=":case">":s=UU(o.value),u=!1;break;case"==":case"in":case"<=":s=o.value;break;case"<":s=o.value,u=!1;break;case"!=":case"not-in":s=nr}K_({value:r,inclusive:i},{value:s,inclusive:u})>0&&(r=s,i=u)}if(n!==null){for(let o=0;o<t.orderBy.length;++o)if(t.orderBy[o].field.isEqual(e)){const s=n.position[o];K_({value:r,inclusive:i},{value:s,inclusive:n.inclusive})>0&&(r=s,i=n.inclusive);break}}return{value:r,inclusive:i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Do{constructor(e,n=null,r=[],i=[],o=null,s="F",u=null,c=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=s,this.startAt=u,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function KU(t,e,n,r,i,o,s,u){return new Do(t,e,n,r,i,o,s,u)}function lp(t){return new Do(t)}function X_(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function NC(t){return t.collectionGroup!==null}function Ps(t){const e=Z(t);if(e.ce===null){e.ce=[];const n=new Set;for(const o of e.explicitOrderBy)e.ce.push(o),n.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(s){let u=new pe(Pe.comparator);return s.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(e).forEach(o=>{n.has(o.canonicalString())||o.isKeyField()||e.ce.push(new sl(o,r))}),n.has(Pe.keyField().canonicalString())||e.ce.push(new sl(Pe.keyField(),r))}return e.ce}function Wt(t){const e=Z(t);return e.le||(e.le=WU(e,Ps(t))),e.le}function WU(t,e){if(t.limitType==="F")return Ff(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(i=>{const o=i.dir==="desc"?"asc":"desc";return new sl(i.field,o)});const n=t.endAt?new mo(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new mo(t.startAt.position,t.startAt.inclusive):null;return Ff(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function Uf(t,e){const n=t.filters.concat([e]);return new Do(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function bf(t,e,n){return new Do(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Qu(t,e){return vl(Wt(t),Wt(e))&&t.limitType===e.limitType}function VC(t){return`${ri(Wt(t))}|lt:${t.limitType}`}function Mi(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(i=>DC(i)).join(", ")}]`),_l(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(i=>function(s){return`${s.field.canonicalString()} (${s.dir})`}(i)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(i=>po(i)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(i=>po(i)).join(",")),`Target(${r})`}(Wt(t))}; limitType=${t.limitType})`}function Tl(t,e){return e.isFoundDocument()&&function(r,i){const o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):H.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(t,e)&&function(r,i){for(const o of Ps(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0}(t,e)&&function(r,i){for(const o of r.filters)if(!o.matches(i))return!1;return!0}(t,e)&&function(r,i){return!(r.startAt&&!function(s,u,c){const d=W_(s,u,c);return s.inclusive?d<=0:d<0}(r.startAt,Ps(r),i)||r.endAt&&!function(s,u,c){const d=W_(s,u,c);return s.inclusive?d>=0:d>0}(r.endAt,Ps(r),i))}(t,e)}function JU(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function LC(t){return(e,n)=>{let r=!1;for(const i of Ps(t)){const o=QU(i,e,n);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function QU(t,e,n){const r=t.field.isKeyField()?H.comparator(e.key,n.key):function(o,s,u){const c=s.data.field(o),d=u.data.field(o);return c!==null&&d!==null?vr(c,d):Q()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Q()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){gi(this.inner,(n,r)=>{for(const[i,o]of r)e(i,o)})}isEmpty(){return EC(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YU=new Se(H.comparator);function Vt(){return YU}const FC=new Se(H.comparator);function hs(...t){let e=FC;for(const n of t)e=e.insert(n.key,n);return e}function UC(t){let e=FC;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function cn(){return Ds()}function bC(){return Ds()}function Ds(){return new Ar(t=>t.toString(),(t,e)=>t.isEqual(e))}const XU=new Se(H.comparator),ZU=new pe(H.comparator);function ne(...t){let e=ZU;for(const n of t)e=e.add(n);return e}const jU=new pe(ee);function eb(){return jU}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ap(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:tl(e)?"-0":e}}function BC(t){return{integerValue:""+t}}function tb(t,e){return pU(e)?BC(e):ap(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yu{constructor(){this._=void 0}}function nb(t,e,n){return t instanceof yo?function(i,o){const s={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&ip(o)&&(o=op(o)),o&&(s.fields.__previous_value__=o),{mapValue:s}}(n,e):t instanceof _o?qC(t,e):t instanceof vo?GC(t,e):function(i,o){const s=OC(i,o),u=Z_(s)+Z_(i.Pe);return Nf(s)&&Nf(i.Pe)?BC(u):ap(i.serializer,u)}(t,e)}function rb(t,e,n){return t instanceof _o?qC(t,e):t instanceof vo?GC(t,e):n}function OC(t,e){return t instanceof ll?function(r){return Nf(r)||function(o){return!!o&&"doubleValue"in o}(r)}(e)?e:{integerValue:0}:null}class yo extends Yu{}class _o extends Yu{constructor(e){super(),this.elements=e}}function qC(t,e){const n=$C(e);for(const r of t.elements)n.some(i=>mn(i,r))||n.push(r);return{arrayValue:{values:n}}}class vo extends Yu{constructor(e){super(),this.elements=e}}function GC(t,e){let n=$C(e);for(const r of t.elements)n=n.filter(i=>!mn(i,r));return{arrayValue:{values:n}}}class ll extends Yu{constructor(e,n){super(),this.serializer=e,this.Pe=n}}function Z_(t){return Ie(t.integerValue||t.doubleValue)}function $C(t){return ol(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zC{constructor(e,n){this.field=e,this.transform=n}}function ib(t,e){return t.field.isEqual(e.field)&&function(r,i){return r instanceof _o&&i instanceof _o||r instanceof vo&&i instanceof vo?ho(r.elements,i.elements,mn):r instanceof ll&&i instanceof ll?mn(r.Pe,i.Pe):r instanceof yo&&i instanceof yo}(t.transform,e.transform)}class ob{constructor(e,n){this.version=e,this.transformResults=n}}class qe{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new qe}static exists(e){return new qe(void 0,e)}static updateTime(e){return new qe(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ba(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Xu{}function HC(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new El(t.key,qe.none()):new Mo(t.key,t.data,qe.none());{const n=t.data,r=tt.empty();let i=new pe(Pe.comparator);for(let o of e.fields)if(!i.has(o)){let s=n.field(o);s===null&&o.length>1&&(o=o.popLast(),s=n.field(o)),s===null?r.delete(o):r.set(o,s),i=i.add(o)}return new On(t.key,r,new At(i.toArray()),qe.none())}}function sb(t,e,n){t instanceof Mo?function(i,o,s){const u=i.value.clone(),c=ev(i.fieldTransforms,o,s.transformResults);u.setAll(c),o.convertToFoundDocument(s.version,u).setHasCommittedMutations()}(t,e,n):t instanceof On?function(i,o,s){if(!ba(i.precondition,o))return void o.convertToUnknownDocument(s.version);const u=ev(i.fieldTransforms,o,s.transformResults),c=o.data;c.setAll(KC(i)),c.setAll(u),o.convertToFoundDocument(s.version,c).setHasCommittedMutations()}(t,e,n):function(i,o,s){o.convertToNoDocument(s.version).setHasCommittedMutations()}(0,e,n)}function Ms(t,e,n,r){return t instanceof Mo?function(o,s,u,c){if(!ba(o.precondition,s))return u;const d=o.value.clone(),h=tv(o.fieldTransforms,c,s);return d.setAll(h),s.convertToFoundDocument(s.version,d).setHasLocalMutations(),null}(t,e,n,r):t instanceof On?function(o,s,u,c){if(!ba(o.precondition,s))return u;const d=tv(o.fieldTransforms,c,s),h=s.data;return h.setAll(KC(o)),h.setAll(d),s.convertToFoundDocument(s.version,h).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(p=>p.field))}(t,e,n,r):function(o,s,u){return ba(o.precondition,s)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):u}(t,e,n)}function lb(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),o=OC(r.transform,i||null);o!=null&&(n===null&&(n=tt.empty()),n.set(r.field,o))}return n||null}function j_(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&ho(r,i,(o,s)=>ib(o,s))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Mo extends Xu{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class On extends Xu{constructor(e,n,r,i,o=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function KC(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function ev(t,e,n){const r=new Map;Y(t.length===n.length);for(let i=0;i<n.length;i++){const o=t[i],s=o.transform,u=e.data.field(o.field);r.set(o.field,rb(s,u,n[i]))}return r}function tv(t,e,n){const r=new Map;for(const i of t){const o=i.transform,s=n.data.field(i.field);r.set(i.field,nb(o,s,e))}return r}class El extends Xu{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class up extends Xu{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cp{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&sb(o,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Ms(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Ms(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=bC();return this.mutations.forEach(i=>{const o=e.get(i.key),s=o.overlayedDocument;let u=this.applyToLocalView(s,o.mutatedFields);u=n.has(i.key)?null:u;const c=HC(s,u);c!==null&&r.set(i.key,c),s.isValidDocument()||s.convertToNoDocument(X.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),ne())}isEqual(e){return this.batchId===e.batchId&&ho(this.mutations,e.mutations,(n,r)=>j_(n,r))&&ho(this.baseMutations,e.baseMutations,(n,r)=>j_(n,r))}}class dp{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){Y(e.mutations.length===r.length);let i=function(){return XU}();const o=e.mutations;for(let s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new dp(e,n,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fp{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ab{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Be,se;function WC(t){switch(t){default:return Q();case O.CANCELLED:case O.UNKNOWN:case O.DEADLINE_EXCEEDED:case O.RESOURCE_EXHAUSTED:case O.INTERNAL:case O.UNAVAILABLE:case O.UNAUTHENTICATED:return!1;case O.INVALID_ARGUMENT:case O.NOT_FOUND:case O.ALREADY_EXISTS:case O.PERMISSION_DENIED:case O.FAILED_PRECONDITION:case O.ABORTED:case O.OUT_OF_RANGE:case O.UNIMPLEMENTED:case O.DATA_LOSS:return!0}}function JC(t){if(t===void 0)return _t("GRPC error has no .code"),O.UNKNOWN;switch(t){case Be.OK:return O.OK;case Be.CANCELLED:return O.CANCELLED;case Be.UNKNOWN:return O.UNKNOWN;case Be.DEADLINE_EXCEEDED:return O.DEADLINE_EXCEEDED;case Be.RESOURCE_EXHAUSTED:return O.RESOURCE_EXHAUSTED;case Be.INTERNAL:return O.INTERNAL;case Be.UNAVAILABLE:return O.UNAVAILABLE;case Be.UNAUTHENTICATED:return O.UNAUTHENTICATED;case Be.INVALID_ARGUMENT:return O.INVALID_ARGUMENT;case Be.NOT_FOUND:return O.NOT_FOUND;case Be.ALREADY_EXISTS:return O.ALREADY_EXISTS;case Be.PERMISSION_DENIED:return O.PERMISSION_DENIED;case Be.FAILED_PRECONDITION:return O.FAILED_PRECONDITION;case Be.ABORTED:return O.ABORTED;case Be.OUT_OF_RANGE:return O.OUT_OF_RANGE;case Be.UNIMPLEMENTED:return O.UNIMPLEMENTED;case Be.DATA_LOSS:return O.DATA_LOSS;default:return Q()}}(se=Be||(Be={}))[se.OK=0]="OK",se[se.CANCELLED=1]="CANCELLED",se[se.UNKNOWN=2]="UNKNOWN",se[se.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",se[se.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",se[se.NOT_FOUND=5]="NOT_FOUND",se[se.ALREADY_EXISTS=6]="ALREADY_EXISTS",se[se.PERMISSION_DENIED=7]="PERMISSION_DENIED",se[se.UNAUTHENTICATED=16]="UNAUTHENTICATED",se[se.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",se[se.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",se[se.ABORTED=10]="ABORTED",se[se.OUT_OF_RANGE=11]="OUT_OF_RANGE",se[se.UNIMPLEMENTED=12]="UNIMPLEMENTED",se[se.INTERNAL=13]="INTERNAL",se[se.UNAVAILABLE=14]="UNAVAILABLE",se[se.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ub(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cb=new Hr([4294967295,4294967295],0);function nv(t){const e=ub().encode(t),n=new iC;return n.update(e),new Uint8Array(n.digest())}function rv(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new Hr([n,r],0),new Hr([i,o],0)]}class hp{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new ps(`Invalid padding: ${n}`);if(r<0)throw new ps(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ps(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new ps(`Invalid padding when bitmap length is 0: ${n}`);this.Ie=8*e.length-n,this.Te=Hr.fromNumber(this.Ie)}Ee(e,n,r){let i=e.add(n.multiply(Hr.fromNumber(r)));return i.compare(cb)===1&&(i=new Hr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const n=nv(e),[r,i]=rv(n);for(let o=0;o<this.hashCount;o++){const s=this.Ee(r,i,o);if(!this.de(s))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),s=new hp(o,i,n);return r.forEach(u=>s.insert(u)),s}insert(e){if(this.Ie===0)return;const n=nv(e),[r,i]=rv(n);for(let o=0;o<this.hashCount;o++){const s=this.Ee(r,i,o);this.Ae(s)}}Ae(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class ps extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zu{constructor(e,n,r,i,o){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,Il.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new Zu(X.min(),i,new Se(ee),Vt(),ne())}}class Il{constructor(e,n,r,i,o){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new Il(r,n,ne(),ne(),ne())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ba{constructor(e,n,r,i){this.Re=e,this.removedTargetIds=n,this.key=r,this.Ve=i}}class QC{constructor(e,n){this.targetId=e,this.me=n}}class YC{constructor(e,n,r=Ge.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class iv{constructor(){this.fe=0,this.ge=sv(),this.pe=Ge.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ne(),n=ne(),r=ne();return this.ge.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:Q()}}),new Il(this.pe,this.ye,e,n,r)}Ce(){this.we=!1,this.ge=sv()}Fe(e,n){this.we=!0,this.ge=this.ge.insert(e,n)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Y(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class db{constructor(e){this.Le=e,this.Be=new Map,this.ke=Vt(),this.qe=ov(),this.Qe=new Se(ee)}Ke(e){for(const n of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(n,e.Ve):this.Ue(n,e.key,e.Ve);for(const n of e.removedTargetIds)this.Ue(n,e.key,e.Ve)}We(e){this.forEachTarget(e,n=>{const r=this.Ge(n);switch(e.state){case 0:this.ze(n)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(n);break;case 3:this.ze(n)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(n)&&(this.je(n),r.De(e.resumeToken));break;default:Q()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Be.forEach((r,i)=>{this.ze(i)&&n(i)})}He(e){const n=e.targetId,r=e.me.count,i=this.Je(n);if(i){const o=i.target;if(vu(o))if(r===0){const s=new H(o.path);this.Ue(n,s,we.newNoDocument(s,X.min()))}else Y(r===1);else{const s=this.Ye(n);if(s!==r){const u=this.Ze(e),c=u?this.Xe(u,e,s):1;if(c!==0){this.je(n);const d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(n,d)}}}}}Ze(e){const n=e.me.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=n;let s,u;try{s=_r(r).toUint8Array()}catch(c){if(c instanceof IC)return ei("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new hp(s,i,o)}catch(c){return ei(c instanceof ps?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return u.Ie===0?null:u}Xe(e,n,r){return n.me.count===r-this.nt(e,n.targetId)?0:2}nt(e,n){const r=this.Le.getRemoteKeysForTarget(n);let i=0;return r.forEach(o=>{const s=this.Le.tt(),u=`projects/${s.projectId}/databases/${s.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.Ue(n,o,null),i++)}),i}rt(e){const n=new Map;this.Be.forEach((o,s)=>{const u=this.Je(s);if(u){if(o.current&&vu(u.target)){const c=new H(u.target.path);this.ke.get(c)!==null||this.it(s,c)||this.Ue(s,c,we.newNoDocument(c,e))}o.be&&(n.set(s,o.ve()),o.Ce())}});let r=ne();this.qe.forEach((o,s)=>{let u=!0;s.forEachWhile(c=>{const d=this.Je(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(r=r.add(o))}),this.ke.forEach((o,s)=>s.setReadTime(e));const i=new Zu(e,n,this.Qe,this.ke,r);return this.ke=Vt(),this.qe=ov(),this.Qe=new Se(ee),i}$e(e,n){if(!this.ze(e))return;const r=this.it(e,n.key)?2:0;this.Ge(e).Fe(n.key,r),this.ke=this.ke.insert(n.key,n),this.qe=this.qe.insert(n.key,this.st(n.key).add(e))}Ue(e,n,r){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,n)?i.Fe(n,1):i.Me(n),this.qe=this.qe.insert(n,this.st(n).delete(e)),r&&(this.ke=this.ke.insert(n,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const n=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let n=this.Be.get(e);return n||(n=new iv,this.Be.set(e,n)),n}st(e){let n=this.qe.get(e);return n||(n=new pe(ee),this.qe=this.qe.insert(e,n)),n}ze(e){const n=this.Je(e)!==null;return n||q("WatchChangeAggregator","Detected inactive target",e),n}Je(e){const n=this.Be.get(e);return n&&n.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new iv),this.Le.getRemoteKeysForTarget(e).forEach(n=>{this.Ue(e,n,null)})}it(e,n){return this.Le.getRemoteKeysForTarget(e).has(n)}}function ov(){return new Se(H.comparator)}function sv(){return new Se(H.comparator)}const fb={asc:"ASCENDING",desc:"DESCENDING"},hb={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},pb={and:"AND",or:"OR"};class mb{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Bf(t,e){return t.useProto3Json||_l(e)?e:{value:e}}function To(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function XC(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function gb(t,e){return To(t,e.toTimestamp())}function Qe(t){return Y(!!t),X.fromTimestamp(function(n){const r=Fn(n);return new Me(r.seconds,r.nanos)}(t))}function pp(t,e){return Of(t,e).canonicalString()}function Of(t,e){const n=function(i){return new ce(["projects",i.projectId,"databases",i.database])}(t).child("documents");return e===void 0?n:n.child(e)}function ZC(t){const e=ce.fromString(t);return Y(lw(e)),e}function al(t,e){return pp(t.databaseId,e.path)}function Dn(t,e){const n=ZC(e);if(n.get(1)!==t.databaseId.projectId)throw new $(O.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new $(O.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new H(tw(n))}function jC(t,e){return pp(t.databaseId,e)}function ew(t){const e=ZC(t);return e.length===4?ce.emptyPath():tw(e)}function qf(t){return new ce(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function tw(t){return Y(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function lv(t,e,n){return{name:al(t,e),fields:n.value.mapValue.fields}}function yb(t,e,n){const r=Dn(t,e.name),i=Qe(e.updateTime),o=e.createTime?Qe(e.createTime):X.min(),s=new tt({mapValue:{fields:e.fields}}),u=we.newFoundDocument(r,i,o,s);return n&&u.setHasCommittedMutations(),n?u.setHasCommittedMutations():u}function _b(t,e){return"found"in e?function(r,i){Y(!!i.found),i.found.name,i.found.updateTime;const o=Dn(r,i.found.name),s=Qe(i.found.updateTime),u=i.found.createTime?Qe(i.found.createTime):X.min(),c=new tt({mapValue:{fields:i.found.fields}});return we.newFoundDocument(o,s,u,c)}(t,e):"missing"in e?function(r,i){Y(!!i.missing),Y(!!i.readTime);const o=Dn(r,i.missing),s=Qe(i.readTime);return we.newNoDocument(o,s)}(t,e):Q()}function vb(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:Q()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(d,h){return d.useProto3Json?(Y(h===void 0||typeof h=="string"),Ge.fromBase64String(h||"")):(Y(h===void 0||h instanceof Buffer||h instanceof Uint8Array),Ge.fromUint8Array(h||new Uint8Array))}(t,e.targetChange.resumeToken),s=e.targetChange.cause,u=s&&function(d){const h=d.code===void 0?O.UNKNOWN:JC(d.code);return new $(h,d.message||"")}(s);n=new YC(r,i,o,u||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Dn(t,r.document.name),o=Qe(r.document.updateTime),s=r.document.createTime?Qe(r.document.createTime):X.min(),u=new tt({mapValue:{fields:r.document.fields}}),c=we.newFoundDocument(i,o,s,u),d=r.targetIds||[],h=r.removedTargetIds||[];n=new Ba(d,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Dn(t,r.document),o=r.readTime?Qe(r.readTime):X.min(),s=we.newNoDocument(i,o),u=r.removedTargetIds||[];n=new Ba([],u,s.key,s)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Dn(t,r.document),o=r.removedTargetIds||[];n=new Ba([],o,i,null)}else{if(!("filter"in e))return Q();{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:o}=r,s=new ab(i,o),u=r.targetId;n=new QC(u,s)}}return n}function ul(t,e){let n;if(e instanceof Mo)n={update:lv(t,e.key,e.value)};else if(e instanceof El)n={delete:al(t,e.key)};else if(e instanceof On)n={update:lv(t,e.key,e.data),updateMask:Sb(e.fieldMask)};else{if(!(e instanceof up))return Q();n={verify:al(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(o,s){const u=s.transform;if(u instanceof yo)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof _o)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof vo)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof ll)return{fieldPath:s.field.canonicalString(),increment:u.Pe};throw Q()}(0,r))),e.precondition.isNone||(n.currentDocument=function(i,o){return o.updateTime!==void 0?{updateTime:gb(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Q()}(t,e.precondition)),n}function Gf(t,e){const n=e.currentDocument?function(o){return o.updateTime!==void 0?qe.updateTime(Qe(o.updateTime)):o.exists!==void 0?qe.exists(o.exists):qe.none()}(e.currentDocument):qe.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(s,u){let c=null;if("setToServerValue"in u)Y(u.setToServerValue==="REQUEST_TIME"),c=new yo;else if("appendMissingElements"in u){const h=u.appendMissingElements.values||[];c=new _o(h)}else if("removeAllFromArray"in u){const h=u.removeAllFromArray.values||[];c=new vo(h)}else"increment"in u?c=new ll(s,u.increment):Q();const d=Pe.fromServerFormat(u.fieldPath);return new zC(d,c)}(t,i)):[];if(e.update){e.update.name;const i=Dn(t,e.update.name),o=new tt({mapValue:{fields:e.update.fields}});if(e.updateMask){const s=function(c){const d=c.fieldPaths||[];return new At(d.map(h=>Pe.fromServerFormat(h)))}(e.updateMask);return new On(i,o,s,n,r)}return new Mo(i,o,n,r)}if(e.delete){const i=Dn(t,e.delete);return new El(i,n)}if(e.verify){const i=Dn(t,e.verify);return new up(i,n)}return Q()}function Tb(t,e){return t&&t.length>0?(Y(e!==void 0),t.map(n=>function(i,o){let s=i.updateTime?Qe(i.updateTime):Qe(o);return s.isEqual(X.min())&&(s=Qe(o)),new ob(s,i.transformResults||[])}(n,e))):[]}function nw(t,e){return{documents:[jC(t,e.path)]}}function rw(t,e){const n={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=jC(t,i);const o=function(d){if(d.length!==0)return sw(fe.create(d,"and"))}(e.filters);o&&(n.structuredQuery.where=o);const s=function(d){if(d.length!==0)return d.map(h=>function(m){return{field:ki(m.field),direction:Ib(m.dir)}}(h))}(e.orderBy);s&&(n.structuredQuery.orderBy=s);const u=Bf(t,e.limit);return u!==null&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:n,parent:i}}function iw(t){let e=ew(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Y(r===1);const h=n.from[0];h.allDescendants?i=h.collectionId:e=e.child(h.collectionId)}let o=[];n.where&&(o=function(p){const m=ow(p);return m instanceof fe&&sp(m)?m.getFilters():[m]}(n.where));let s=[];n.orderBy&&(s=function(p){return p.map(m=>function(S){return new sl(Ni(S.field),function(M){switch(M){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(S.direction))}(m))}(n.orderBy));let u=null;n.limit&&(u=function(p){let m;return m=typeof p=="object"?p.value:p,_l(m)?null:m}(n.limit));let c=null;n.startAt&&(c=function(p){const m=!!p.before,_=p.values||[];return new mo(_,m)}(n.startAt));let d=null;return n.endAt&&(d=function(p){const m=!p.before,_=p.values||[];return new mo(_,m)}(n.endAt)),KU(e,i,s,o,u,"F",c,d)}function Eb(t,e){const n=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Q()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function ow(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Ni(n.unaryFilter.field);return ie.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Ni(n.unaryFilter.field);return ie.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Ni(n.unaryFilter.field);return ie.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Ni(n.unaryFilter.field);return ie.create(s,"!=",{nullValue:"NULL_VALUE"});default:return Q()}}(t):t.fieldFilter!==void 0?function(n){return ie.create(Ni(n.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Q()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return fe.create(n.compositeFilter.filters.map(r=>ow(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Q()}}(n.compositeFilter.op))}(t):Q()}function Ib(t){return fb[t]}function Cb(t){return hb[t]}function wb(t){return pb[t]}function ki(t){return{fieldPath:t.canonicalString()}}function Ni(t){return Pe.fromServerFormat(t.fieldPath)}function sw(t){return t instanceof ie?function(n){if(n.op==="=="){if(z_(n.value))return{unaryFilter:{field:ki(n.field),op:"IS_NAN"}};if($_(n.value))return{unaryFilter:{field:ki(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(z_(n.value))return{unaryFilter:{field:ki(n.field),op:"IS_NOT_NAN"}};if($_(n.value))return{unaryFilter:{field:ki(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ki(n.field),op:Cb(n.op),value:n.value}}}(t):t instanceof fe?function(n){const r=n.getFilters().map(i=>sw(i));return r.length===1?r[0]:{compositeFilter:{op:wb(n.op),filters:r}}}(t):Q()}function Sb(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function lw(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xn{constructor(e,n,r,i,o=X.min(),s=X.min(),u=Ge.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new xn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new xn(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new xn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new xn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aw{constructor(e){this.ct=e}}function Ab(t,e){let n;if(e.document)n=yb(t.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=H.fromSegments(e.noDocument.path),i=oi(e.noDocument.readTime);n=we.newNoDocument(r,i),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return Q();{const r=H.fromSegments(e.unknownDocument.path),i=oi(e.unknownDocument.version);n=we.newUnknownDocument(r,i)}}return e.readTime&&n.setReadTime(function(i){const o=new Me(i[0],i[1]);return X.fromTimestamp(o)}(e.readTime)),n}function av(t,e){const n=e.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Eu(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(o,s){return{name:al(o,s.key),fields:s.data.value.mapValue.fields,updateTime:To(o,s.version.toTimestamp()),createTime:To(o,s.createTime.toTimestamp())}}(t.ct,e);else if(e.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:ii(e.version)};else{if(!e.isUnknownDocument())return Q();r.unknownDocument={path:n.path.toArray(),version:ii(e.version)}}return r}function Eu(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function ii(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function oi(t){const e=new Me(t.seconds,t.nanoseconds);return X.fromTimestamp(e)}function Ur(t,e){const n=(e.baseMutations||[]).map(o=>Gf(t.ct,o));for(let o=0;o<e.mutations.length-1;++o){const s=e.mutations[o];if(o+1<e.mutations.length&&e.mutations[o+1].transform!==void 0){const u=e.mutations[o+1];s.updateTransforms=u.transform.fieldTransforms,e.mutations.splice(o+1,1),++o}}const r=e.mutations.map(o=>Gf(t.ct,o)),i=Me.fromMillis(e.localWriteTimeMs);return new cp(e.batchId,i,n,r)}function ms(t){const e=oi(t.readTime),n=t.lastLimboFreeSnapshotVersion!==void 0?oi(t.lastLimboFreeSnapshotVersion):X.min();let r;return r=function(o){return o.documents!==void 0}(t.query)?function(o){return Y(o.documents.length===1),Wt(lp(ew(o.documents[0])))}(t.query):function(o){return Wt(iw(o))}(t.query),new xn(r,t.targetId,"TargetPurposeListen",t.lastListenSequenceNumber,e,n,Ge.fromBase64String(t.resumeToken))}function uw(t,e){const n=ii(e.snapshotVersion),r=ii(e.lastLimboFreeSnapshotVersion);let i;i=vu(e.target)?nw(t.ct,e.target):rw(t.ct,e.target)._t;const o=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ri(e.target),readTime:n,resumeToken:o,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function cw(t){const e=iw({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?bf(e,e.limit,"L"):e}function hd(t,e){return new fp(e.largestBatchId,Gf(t.ct,e.overlayMutation))}function uv(t,e){const n=e.path.lastSegment();return[t,Tt(e.path.popLast()),n]}function cv(t,e,n,r){return{indexId:t,uid:e,sequenceNumber:n,readTime:ii(r.readTime),documentKey:Tt(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rb{getBundleMetadata(e,n){return dv(e).get(n).next(r=>{if(r)return function(o){return{id:o.bundleId,createTime:oi(o.createTime),version:o.version}}(r)})}saveBundleMetadata(e,n){return dv(e).put(function(i){return{bundleId:i.id,createTime:ii(Qe(i.createTime)),version:i.version}}(n))}getNamedQuery(e,n){return fv(e).get(n).next(r=>{if(r)return function(o){return{name:o.name,query:cw(o.bundledQuery),readTime:oi(o.readTime)}}(r)})}saveNamedQuery(e,n){return fv(e).put(function(i){return{name:i.name,readTime:ii(Qe(i.readTime)),bundledQuery:i.bundledQuery}}(n))}}function dv(t){return He(t,"bundles")}function fv(t){return He(t,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ju{constructor(e,n){this.serializer=e,this.userId=n}static lt(e,n){const r=n.uid||"";return new ju(e,r)}getOverlay(e,n){return ts(e).get(uv(this.userId,n)).next(r=>r?hd(this.serializer,r):null)}getOverlays(e,n){const r=cn();return L.forEach(n,i=>this.getOverlay(e,i).next(o=>{o!==null&&r.set(i,o)})).next(()=>r)}saveOverlays(e,n,r){const i=[];return r.forEach((o,s)=>{const u=new fp(n,s);i.push(this.ht(e,u))}),L.waitFor(i)}removeOverlaysForBatchId(e,n,r){const i=new Set;n.forEach(s=>i.add(Tt(s.getCollectionPath())));const o=[];return i.forEach(s=>{const u=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,r+1],!1,!0);o.push(ts(e).j("collectionPathOverlayIndex",u))}),L.waitFor(o)}getOverlaysForCollection(e,n,r){const i=cn(),o=Tt(n),s=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,Number.POSITIVE_INFINITY],!0);return ts(e).U("collectionPathOverlayIndex",s).next(u=>{for(const c of u){const d=hd(this.serializer,c);i.set(d.getKey(),d)}return i})}getOverlaysForCollectionGroup(e,n,r,i){const o=cn();let s;const u=IDBKeyRange.bound([this.userId,n,r],[this.userId,n,Number.POSITIVE_INFINITY],!0);return ts(e).J({index:"collectionGroupOverlayIndex",range:u},(c,d,h)=>{const p=hd(this.serializer,d);o.size()<i||p.largestBatchId===s?(o.set(p.getKey(),p),s=p.largestBatchId):h.done()}).next(()=>o)}ht(e,n){return ts(e).put(function(i,o,s){const[u,c,d]=uv(o,s.mutation.key);return{userId:o,collectionPath:c,documentId:d,collectionGroup:s.mutation.key.getCollectionGroup(),largestBatchId:s.largestBatchId,overlayMutation:ul(i.ct,s.mutation)}}(this.serializer,this.userId,n))}}function ts(t){return He(t,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xb{Pt(e){return He(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(n=>{const r=n==null?void 0:n.value;return r?Ge.fromUint8Array(r):Ge.EMPTY_BYTE_STRING})}setSessionToken(e,n){return this.Pt(e).put({name:"sessionToken",value:n.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class br{constructor(){}It(e,n){this.Tt(e,n),n.Et()}Tt(e,n){if("nullValue"in e)this.dt(n,5);else if("booleanValue"in e)this.dt(n,10),n.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(n,15),n.At(Ie(e.integerValue));else if("doubleValue"in e){const r=Ie(e.doubleValue);isNaN(r)?this.dt(n,13):(this.dt(n,15),tl(r)?n.At(0):n.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(n,20),typeof r=="string"&&(r=Fn(r)),n.Rt(`${r.seconds||""}`),n.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,n),this.ft(n);else if("bytesValue"in e)this.dt(n,30),n.gt(_r(e.bytesValue)),this.ft(n);else if("referenceValue"in e)this.yt(e.referenceValue,n);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(n,45),n.At(r.latitude||0),n.At(r.longitude||0)}else"mapValue"in e?CC(e)?this.dt(n,Number.MAX_SAFE_INTEGER):Ju(e)?this.wt(e.mapValue,n):(this.St(e.mapValue,n),this.ft(n)):"arrayValue"in e?(this.bt(e.arrayValue,n),this.ft(n)):Q()}Vt(e,n){this.dt(n,25),this.Dt(e,n)}Dt(e,n){n.Rt(e)}St(e,n){const r=e.fields||{};this.dt(n,55);for(const i of Object.keys(r))this.Vt(i,n),this.Tt(r[i],n)}wt(e,n){var r,i;const o=e.fields||{};this.dt(n,53);const s="value",u=((i=(r=o[s].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.dt(n,15),n.At(Ie(u)),this.Vt(s,n),this.Tt(o[s],n)}bt(e,n){const r=e.values||[];this.dt(n,50);for(const i of r)this.Tt(i,n)}yt(e,n){this.dt(n,37),H.fromName(e).path.forEach(r=>{this.dt(n,60),this.Dt(r,n)})}dt(e,n){e.At(n)}ft(e){e.At(2)}}br.vt=new br;function Pb(t){if(t===0)return 8;let e=0;return!(t>>4)&&(e+=4,t<<=4),!(t>>6)&&(e+=2,t<<=2),!(t>>7)&&(e+=1),e}function hv(t){const e=64-function(r){let i=0;for(let o=0;o<8;++o){const s=Pb(255&r[o]);if(i+=s,s!==8)break}return i}(t);return Math.ceil(e/8)}class Db{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Ft(r.value),r=n.next();this.Mt()}xt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Ot(r.value),r=n.next();this.Nt()}Lt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const i=n.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const i=n.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(e){const n=this.qt(e),r=hv(n);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let i=n.length-r;i<n.length;++i)this.buffer[this.position++]=255&n[i]}Kt(e){const n=this.qt(e),r=hv(n);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let i=n.length-r;i<n.length;++i)this.buffer[this.position++]=~(255&n[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const n=function(o){const s=new DataView(new ArrayBuffer(8));return s.setFloat64(0,o,!1),new Uint8Array(s.buffer)}(e),r=(128&n[0])!=0;n[0]^=r?255:128;for(let i=1;i<n.length;++i)n[i]^=r?255:0;return n}Ft(e){const n=255&e;n===0?(this.Ut(0),this.Ut(255)):n===255?(this.Ut(255),this.Ut(0)):this.Ut(n)}Ot(e){const n=255&e;n===0?(this.Gt(0),this.Gt(255)):n===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const n=e+this.position;if(n<=this.buffer.length)return;let r=2*this.buffer.length;r<n&&(r=n);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class Mb{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class kb{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class ns{constructor(){this.jt=new Db,this.Ht=new Mb(this.jt),this.Jt=new kb(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Br{constructor(e,n,r,i){this.indexId=e,this.documentKey=n,this.arrayValue=r,this.directionalValue=i}Zt(){const e=this.directionalValue.length,n=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(n);return r.set(this.directionalValue,0),n!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Br(this.indexId,this.documentKey,this.arrayValue,r)}}function Hn(t,e){let n=t.indexId-e.indexId;return n!==0?n:(n=pv(t.arrayValue,e.arrayValue),n!==0?n:(n=pv(t.directionalValue,e.directionalValue),n!==0?n:H.comparator(t.documentKey,e.documentKey)))}function pv(t,e){for(let n=0;n<t.length&&n<e.length;++n){const r=t[n]-e[n];if(r!==0)return r}return t.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mv{constructor(e){this.Xt=new pe((n,r)=>Pe.comparator(n.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const n of e.filters){const r=n;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Y(e.collectionGroup===this.collectionId),this.nn)return!1;const n=Df(e);if(n!==void 0&&!this.sn(n))return!1;const r=Lr(e);let i=new Set,o=0,s=0;for(;o<r.length&&this.sn(r[o]);++o)i=i.add(r[o].fieldPath.canonicalString());if(o===r.length)return!0;if(this.Xt.size>0){const u=this.Xt.getIterator().getNext();if(!i.has(u.field.canonicalString())){const c=r[o];if(!this.on(u,c)||!this._n(this.en[s++],c))return!1}++o}for(;o<r.length;++o){const u=r[o];if(s>=this.en.length||!this._n(this.en[s++],u))return!1}return!0}an(){if(this.nn)return null;let e=new pe(Pe.comparator);const n=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")n.push(new Va(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),n.push(new Va(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),n.push(new Va(r.field,r.dir==="asc"?0:1)));return new _u(_u.UNKNOWN_ID,this.collectionId,n,el.empty())}sn(e){for(const n of this.tn)if(this.on(n,e))return!0;return!1}on(e,n){if(e===void 0||!e.field.isEqual(n.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return n.kind===2===r}_n(e,n){return!!e.field.isEqual(n.fieldPath)&&(n.kind===0&&e.dir==="asc"||n.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dw(t){var e,n;if(Y(t instanceof ie||t instanceof fe),t instanceof ie){if(t instanceof kC){const i=((n=(e=t.value.arrayValue)===null||e===void 0?void 0:e.values)===null||n===void 0?void 0:n.map(o=>ie.create(t.field,"==",o)))||[];return fe.create(i,"or")}return t}const r=t.filters.map(i=>dw(i));return fe.create(r,t.op)}function Nb(t){if(t.getFilters().length===0)return[];const e=Hf(dw(t));return Y(fw(e)),$f(e)||zf(e)?[e]:e.getFilters()}function $f(t){return t instanceof ie}function zf(t){return t instanceof fe&&sp(t)}function fw(t){return $f(t)||zf(t)||function(n){if(n instanceof fe&&Vf(n)){for(const r of n.getFilters())if(!$f(r)&&!zf(r))return!1;return!0}return!1}(t)}function Hf(t){if(Y(t instanceof ie||t instanceof fe),t instanceof ie)return t;if(t.filters.length===1)return Hf(t.filters[0]);const e=t.filters.map(r=>Hf(r));let n=fe.create(e,t.op);return n=Iu(n),fw(n)?n:(Y(n instanceof fe),Y(go(n)),Y(n.filters.length>1),n.filters.reduce((r,i)=>mp(r,i)))}function mp(t,e){let n;return Y(t instanceof ie||t instanceof fe),Y(e instanceof ie||e instanceof fe),n=t instanceof ie?e instanceof ie?function(i,o){return fe.create([i,o],"and")}(t,e):gv(t,e):e instanceof ie?gv(e,t):function(i,o){if(Y(i.filters.length>0&&o.filters.length>0),go(i)&&go(o))return PC(i,o.getFilters());const s=Vf(i)?i:o,u=Vf(i)?o:i,c=s.filters.map(d=>mp(d,u));return fe.create(c,"or")}(t,e),Iu(n)}function gv(t,e){if(go(e))return PC(e,t.getFilters());{const n=e.filters.map(r=>mp(t,r));return fe.create(n,"or")}}function Iu(t){if(Y(t instanceof ie||t instanceof fe),t instanceof ie)return t;const e=t.getFilters();if(e.length===1)return Iu(e[0]);if(RC(t))return t;const n=e.map(i=>Iu(i)),r=[];return n.forEach(i=>{i instanceof ie?r.push(i):i instanceof fe&&(i.op===t.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:fe.create(r,t.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vb{constructor(){this.un=new gp}addToCollectionParentIndex(e,n){return this.un.add(n),L.resolve()}getCollectionParents(e,n){return L.resolve(this.un.getEntries(n))}addFieldIndex(e,n){return L.resolve()}deleteFieldIndex(e,n){return L.resolve()}deleteAllFieldIndexes(e){return L.resolve()}createTargetIndexes(e,n){return L.resolve()}getDocumentsMatchingTarget(e,n){return L.resolve(null)}getIndexType(e,n){return L.resolve(0)}getFieldIndexes(e,n){return L.resolve([])}getNextCollectionGroupToUpdate(e){return L.resolve(null)}getMinOffset(e,n){return L.resolve(bt.min())}getMinOffsetFromCollectionGroup(e,n){return L.resolve(bt.min())}updateCollectionGroup(e,n,r){return L.resolve()}updateIndexEntries(e,n){return L.resolve()}}class gp{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new pe(ce.comparator),o=!i.has(r);return this.index[n]=i.add(r),o}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new pe(ce.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ha=new Uint8Array(0);class Lb{constructor(e,n){this.databaseId=n,this.cn=new gp,this.ln=new Ar(r=>ri(r),(r,i)=>vl(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,n){if(!this.cn.has(n)){const r=n.lastSegment(),i=n.popLast();e.addOnCommittedListener(()=>{this.cn.add(n)});const o={collectionId:r,parent:Tt(i)};return yv(e).put(o)}return L.resolve()}getCollectionParents(e,n){const r=[],i=IDBKeyRange.bound([n,""],[fC(n),""],!1,!0);return yv(e).U(i).next(o=>{for(const s of o){if(s.collectionId!==n)break;r.push(un(s.parent))}return r})}addFieldIndex(e,n){const r=rs(e),i=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(n);delete i.indexId;const o=r.add(i);if(n.indexState){const s=Ri(e);return o.next(u=>{s.put(cv(u,this.uid,n.indexState.sequenceNumber,n.indexState.offset))})}return o.next()}deleteFieldIndex(e,n){const r=rs(e),i=Ri(e),o=Ai(e);return r.delete(n.indexId).next(()=>i.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0))).next(()=>o.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const n=rs(e),r=Ai(e),i=Ri(e);return n.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,n){return L.forEach(this.hn(n),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){const o=new mv(r).an();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,n){const r=Ai(e);let i=!0;const o=new Map;return L.forEach(this.hn(n),s=>this.Pn(e,s).next(u=>{i&&(i=!!u),o.set(s,u)})).next(()=>{if(i){let s=ne();const u=[];return L.forEach(o,(c,d)=>{q("IndexedDbIndexManager",`Using index ${function(C){return`id=${C.indexId}|cg=${C.collectionGroup}|f=${C.fields.map(k=>`${k.fieldPath}:${k.kind}`).join(",")}`}(c)} to execute ${ri(n)}`);const h=function(C,k){const F=Df(k);if(F===void 0)return null;for(const b of Tu(C,F.fieldPath))switch(b.op){case"array-contains-any":return b.value.arrayValue.values||[];case"array-contains":return[b.value]}return null}(d,c),p=function(C,k){const F=new Map;for(const b of Lr(k))for(const A of Tu(C,b.fieldPath))switch(A.op){case"==":case"in":F.set(b.fieldPath.canonicalString(),A.value);break;case"not-in":case"!=":return F.set(b.fieldPath.canonicalString(),A.value),Array.from(F.values())}return null}(d,c),m=function(C,k){const F=[];let b=!0;for(const A of Lr(k)){const v=A.kind===0?Q_(C,A.fieldPath,C.startAt):Y_(C,A.fieldPath,C.startAt);F.push(v.value),b&&(b=v.inclusive)}return new mo(F,b)}(d,c),_=function(C,k){const F=[];let b=!0;for(const A of Lr(k)){const v=A.kind===0?Y_(C,A.fieldPath,C.endAt):Q_(C,A.fieldPath,C.endAt);F.push(v.value),b&&(b=v.inclusive)}return new mo(F,b)}(d,c),S=this.In(c,d,m),R=this.In(c,d,_),M=this.Tn(c,d,p),I=this.En(c.indexId,h,S,m.inclusive,R,_.inclusive,M);return L.forEach(I,T=>r.G(T,n.limit).next(C=>{C.forEach(k=>{const F=H.fromSegments(k.documentKey);s.has(F)||(s=s.add(F),u.push(F))})}))}).next(()=>u)}return L.resolve(null)})}hn(e){let n=this.ln.get(e);return n||(e.filters.length===0?n=[e]:n=Nb(fe.create(e.filters,"and")).map(r=>Ff(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,n),n)}En(e,n,r,i,o,s,u){const c=(n!=null?n.length:1)*Math.max(r.length,o.length),d=c/(n!=null?n.length:1),h=[];for(let p=0;p<c;++p){const m=n?this.dn(n[p/d]):ha,_=this.An(e,m,r[p%d],i),S=this.Rn(e,m,o[p%d],s),R=u.map(M=>this.An(e,m,M,!0));h.push(...this.createRange(_,S,R))}return h}An(e,n,r,i){const o=new Br(e,H.empty(),n,r);return i?o:o.Zt()}Rn(e,n,r,i){const o=new Br(e,H.empty(),n,r);return i?o.Zt():o}Pn(e,n){const r=new mv(n),i=n.collectionGroup!=null?n.collectionGroup:n.path.lastSegment();return this.getFieldIndexes(e,i).next(o=>{let s=null;for(const u of o)r.rn(u)&&(!s||u.fields.length>s.fields.length)&&(s=u);return s})}getIndexType(e,n){let r=2;const i=this.hn(n);return L.forEach(i,o=>this.Pn(e,o).next(s=>{s?r!==0&&s.fields.length<function(c){let d=new pe(Pe.comparator),h=!1;for(const p of c.filters)for(const m of p.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?h=!0:d=d.add(m.field));for(const p of c.orderBy)p.field.isKeyField()||(d=d.add(p.field));return d.size+(h?1:0)}(o)&&(r=1):r=0})).next(()=>function(s){return s.limit!==null}(n)&&i.length>1&&r===2?1:r)}Vn(e,n){const r=new ns;for(const i of Lr(e)){const o=n.data.field(i.fieldPath);if(o==null)return null;const s=r.Yt(i.kind);br.vt.It(o,s)}return r.zt()}dn(e){const n=new ns;return br.vt.It(e,n.Yt(0)),n.zt()}mn(e,n){const r=new ns;return br.vt.It(il(this.databaseId,n),r.Yt(function(o){const s=Lr(o);return s.length===0?0:s[s.length-1].kind}(e))),r.zt()}Tn(e,n,r){if(r===null)return[];let i=[];i.push(new ns);let o=0;for(const s of Lr(e)){const u=r[o++];for(const c of i)if(this.fn(n,s.fieldPath)&&ol(u))i=this.gn(i,s,u);else{const d=c.Yt(s.kind);br.vt.It(u,d)}}return this.pn(i)}In(e,n,r){return this.Tn(e,n,r.position)}pn(e){const n=[];for(let r=0;r<e.length;++r)n[r]=e[r].zt();return n}gn(e,n,r){const i=[...e],o=[];for(const s of r.arrayValue.values||[])for(const u of i){const c=new ns;c.seed(u.zt()),br.vt.It(s,c.Yt(n.kind)),o.push(c)}return o}fn(e,n){return!!e.filters.find(r=>r instanceof ie&&r.field.isEqual(n)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,n){const r=rs(e),i=Ri(e);return(n?r.U("collectionGroupIndex",IDBKeyRange.bound(n,n)):r.U()).next(o=>{const s=[];return L.forEach(o,u=>i.get([u.indexId,this.uid]).next(c=>{s.push(function(h,p){const m=p?new el(p.sequenceNumber,new bt(oi(p.readTime),new H(un(p.documentKey)),p.largestBatchId)):el.empty(),_=h.fields.map(([S,R])=>new Va(Pe.fromServerFormat(S),R));return new _u(h.indexId,h.collectionGroup,_,m)}(u,c))})).next(()=>s)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(n=>n.length===0?null:(n.sort((r,i)=>{const o=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return o!==0?o:ee(r.collectionGroup,i.collectionGroup)}),n[0].collectionGroup))}updateCollectionGroup(e,n,r){const i=rs(e),o=Ri(e);return this.yn(e).next(s=>i.U("collectionGroupIndex",IDBKeyRange.bound(n,n)).next(u=>L.forEach(u,c=>o.put(cv(c.indexId,this.uid,s,r)))))}updateIndexEntries(e,n){const r=new Map;return L.forEach(n,(i,o)=>{const s=r.get(i.collectionGroup);return(s?L.resolve(s):this.getFieldIndexes(e,i.collectionGroup)).next(u=>(r.set(i.collectionGroup,u),L.forEach(u,c=>this.wn(e,i,c).next(d=>{const h=this.Sn(o,c);return d.isEqual(h)?L.resolve():this.bn(e,o,c,d,h)}))))})}Dn(e,n,r,i){return Ai(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(r,n.key),documentKey:n.key.path.toArray()})}vn(e,n,r,i){return Ai(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(r,n.key),n.key.path.toArray()])}wn(e,n,r){const i=Ai(e);let o=new pe(Hn);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,n)])},(s,u)=>{o=o.add(new Br(r.indexId,n,u.arrayValue,u.directionalValue))}).next(()=>o)}Sn(e,n){let r=new pe(Hn);const i=this.Vn(n,e);if(i==null)return r;const o=Df(n);if(o!=null){const s=e.data.field(o.fieldPath);if(ol(s))for(const u of s.arrayValue.values||[])r=r.add(new Br(n.indexId,e.key,this.dn(u),i))}else r=r.add(new Br(n.indexId,e.key,ha,i));return r}bn(e,n,r,i,o){q("IndexedDbIndexManager","Updating index entries for document '%s'",n.key);const s=[];return function(c,d,h,p,m){const _=c.getIterator(),S=d.getIterator();let R=Si(_),M=Si(S);for(;R||M;){let I=!1,T=!1;if(R&&M){const C=h(R,M);C<0?T=!0:C>0&&(I=!0)}else R!=null?T=!0:I=!0;I?(p(M),M=Si(S)):T?(m(R),R=Si(_)):(R=Si(_),M=Si(S))}}(i,o,Hn,u=>{s.push(this.Dn(e,n,r,u))},u=>{s.push(this.vn(e,n,r,u))}),L.waitFor(s)}yn(e){let n=1;return Ri(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,o)=>{o.done(),n=i.sequenceNumber+1}).next(()=>n)}createRange(e,n,r){r=r.sort((s,u)=>Hn(s,u)).filter((s,u,c)=>!u||Hn(s,c[u-1])!==0);const i=[];i.push(e);for(const s of r){const u=Hn(s,e),c=Hn(s,n);if(u===0)i[0]=e.Zt();else if(u>0&&c<0)i.push(s),i.push(s.Zt());else if(c>0)break}i.push(n);const o=[];for(let s=0;s<i.length;s+=2){if(this.Cn(i[s],i[s+1]))return[];const u=[i[s].indexId,this.uid,i[s].arrayValue,i[s].directionalValue,ha,[]],c=[i[s+1].indexId,this.uid,i[s+1].arrayValue,i[s+1].directionalValue,ha,[]];o.push(IDBKeyRange.bound(u,c))}return o}Cn(e,n){return Hn(e,n)>0}getMinOffsetFromCollectionGroup(e,n){return this.getFieldIndexes(e,n).next(_v)}getMinOffset(e,n){return L.mapArray(this.hn(n),r=>this.Pn(e,r).next(i=>i||Q())).next(_v)}}function yv(t){return He(t,"collectionParents")}function Ai(t){return He(t,"indexEntries")}function rs(t){return He(t,"indexConfiguration")}function Ri(t){return He(t,"indexState")}function _v(t){Y(t.length!==0);let e=t[0].indexState.offset,n=e.largestBatchId;for(let r=1;r<t.length;r++){const i=t[r].indexState.offset;tp(i,e)<0&&(e=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new bt(e.readTime,e.documentKey,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vv={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ct{constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Ct(e,Ct.DEFAULT_COLLECTION_PERCENTILE,Ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hw(t,e,n){const r=t.store("mutations"),i=t.store("documentMutations"),o=[],s=IDBKeyRange.only(n.batchId);let u=0;const c=r.J({range:s},(h,p,m)=>(u++,m.delete()));o.push(c.next(()=>{Y(u===1)}));const d=[];for(const h of n.mutations){const p=yC(e,h.key.path,n.batchId);o.push(i.delete(p)),d.push(h.key)}return L.waitFor(o).next(()=>d)}function Cu(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Q();e=t.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ct.DEFAULT_COLLECTION_PERCENTILE=10,Ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ct.DEFAULT=new Ct(41943040,Ct.DEFAULT_COLLECTION_PERCENTILE,Ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ct.DISABLED=new Ct(-1,0,0);class ec{constructor(e,n,r,i){this.userId=e,this.serializer=n,this.indexManager=r,this.referenceDelegate=i,this.Fn={}}static lt(e,n,r,i){Y(e.uid!=="");const o=e.isAuthenticated()?e.uid:"";return new ec(o,n,r,i)}checkEmpty(e){let n=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Kn(e).J({index:"userMutationsIndex",range:r},(i,o,s)=>{n=!1,s.done()}).next(()=>n)}addMutationBatch(e,n,r,i){const o=Vi(e),s=Kn(e);return s.add({}).next(u=>{Y(typeof u=="number");const c=new cp(u,n,r,i),d=function(_,S,R){const M=R.baseMutations.map(T=>ul(_.ct,T)),I=R.mutations.map(T=>ul(_.ct,T));return{userId:S,batchId:R.batchId,localWriteTimeMs:R.localWriteTime.toMillis(),baseMutations:M,mutations:I}}(this.serializer,this.userId,c),h=[];let p=new pe((m,_)=>ee(m.canonicalString(),_.canonicalString()));for(const m of i){const _=yC(this.userId,m.key.path,u);p=p.add(m.key.path.popLast()),h.push(s.put(d)),h.push(o.put(_,gU))}return p.forEach(m=>{h.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Fn[u]=c.keys()}),L.waitFor(h).next(()=>c)})}lookupMutationBatch(e,n){return Kn(e).get(n).next(r=>r?(Y(r.userId===this.userId),Ur(this.serializer,r)):null)}Mn(e,n){return this.Fn[n]?L.resolve(this.Fn[n]):this.lookupMutationBatch(e,n).next(r=>{if(r){const i=r.keys();return this.Fn[n]=i,i}return null})}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=IDBKeyRange.lowerBound([this.userId,r]);let o=null;return Kn(e).J({index:"userMutationsIndex",range:i},(s,u,c)=>{u.userId===this.userId&&(Y(u.batchId>=r),o=Ur(this.serializer,u)),c.done()}).next(()=>o)}getHighestUnacknowledgedBatchId(e){const n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Kn(e).J({index:"userMutationsIndex",range:n,reverse:!0},(i,o,s)=>{r=o.batchId,s.done()}).next(()=>r)}getAllMutationBatches(e){const n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Kn(e).U("userMutationsIndex",n).next(r=>r.map(i=>Ur(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,n){const r=La(this.userId,n.path),i=IDBKeyRange.lowerBound(r),o=[];return Vi(e).J({range:i},(s,u,c)=>{const[d,h,p]=s,m=un(h);if(d===this.userId&&n.path.isEqual(m))return Kn(e).get(p).next(_=>{if(!_)throw Q();Y(_.userId===this.userId),o.push(Ur(this.serializer,_))});c.done()}).next(()=>o)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new pe(ee);const i=[];return n.forEach(o=>{const s=La(this.userId,o.path),u=IDBKeyRange.lowerBound(s),c=Vi(e).J({range:u},(d,h,p)=>{const[m,_,S]=d,R=un(_);m===this.userId&&o.path.isEqual(R)?r=r.add(S):p.done()});i.push(c)}),L.waitFor(i).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1,o=La(this.userId,r),s=IDBKeyRange.lowerBound(o);let u=new pe(ee);return Vi(e).J({range:s},(c,d,h)=>{const[p,m,_]=c,S=un(m);p===this.userId&&r.isPrefixOf(S)?S.length===i&&(u=u.add(_)):h.done()}).next(()=>this.xn(e,u))}xn(e,n){const r=[],i=[];return n.forEach(o=>{i.push(Kn(e).get(o).next(s=>{if(s===null)throw Q();Y(s.userId===this.userId),r.push(Ur(this.serializer,s))}))}),L.waitFor(i).next(()=>r)}removeMutationBatch(e,n){return hw(e._e,this.userId,n).next(r=>(e.addOnCommittedListener(()=>{this.On(n.batchId)}),L.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(n=>{if(!n)return L.resolve();const r=IDBKeyRange.lowerBound(function(s){return[s]}(this.userId)),i=[];return Vi(e).J({range:r},(o,s,u)=>{if(o[0]===this.userId){const c=un(o[1]);i.push(c)}else u.done()}).next(()=>{Y(i.length===0)})})}containsKey(e,n){return pw(e,this.userId,n)}Nn(e){return mw(e).get(this.userId).next(n=>n||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function pw(t,e,n){const r=La(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r);let s=!1;return Vi(t).J({range:o,H:!0},(u,c,d)=>{const[h,p,m]=u;h===e&&p===i&&(s=!0),d.done()}).next(()=>s)}function Kn(t){return He(t,"mutations")}function Vi(t){return He(t,"documentMutations")}function mw(t){return He(t,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class si{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new si(0)}static kn(){return new si(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fb{constructor(e,n){this.referenceDelegate=e,this.serializer=n}allocateTargetId(e){return this.qn(e).next(n=>{const r=new si(n.highestTargetId);return n.highestTargetId=r.next(),this.Qn(e,n).next(()=>n.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(n=>X.fromTimestamp(new Me(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(n=>n.highestListenSequenceNumber)}setTargetsMetadata(e,n,r){return this.qn(e).next(i=>(i.highestListenSequenceNumber=n,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),n>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=n),this.Qn(e,i)))}addTargetData(e,n){return this.Kn(e,n).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(n,r),this.Qn(e,r))))}updateTargetData(e,n){return this.Kn(e,n)}removeTargetData(e,n){return this.removeMatchingKeysForTargetId(e,n.targetId).next(()=>xi(e).delete(n.targetId)).next(()=>this.qn(e)).next(r=>(Y(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,n,r){let i=0;const o=[];return xi(e).J((s,u)=>{const c=ms(u);c.sequenceNumber<=n&&r.get(c.targetId)===null&&(i++,o.push(this.removeTargetData(e,c)))}).next(()=>L.waitFor(o)).next(()=>i)}forEachTarget(e,n){return xi(e).J((r,i)=>{const o=ms(i);n(o)})}qn(e){return Tv(e).get("targetGlobalKey").next(n=>(Y(n!==null),n))}Qn(e,n){return Tv(e).put("targetGlobalKey",n)}Kn(e,n){return xi(e).put(uw(this.serializer,n))}$n(e,n){let r=!1;return e.targetId>n.highestTargetId&&(n.highestTargetId=e.targetId,r=!0),e.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(n=>n.targetCount)}getTargetData(e,n){const r=ri(n),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let o=null;return xi(e).J({range:i,index:"queryTargetsIndex"},(s,u,c)=>{const d=ms(u);vl(n,d.target)&&(o=d,c.done())}).next(()=>o)}addMatchingKeys(e,n,r){const i=[],o=Xn(e);return n.forEach(s=>{const u=Tt(s.path);i.push(o.put({targetId:r,path:u})),i.push(this.referenceDelegate.addReference(e,r,s))}),L.waitFor(i)}removeMatchingKeys(e,n,r){const i=Xn(e);return L.forEach(n,o=>{const s=Tt(o.path);return L.waitFor([i.delete([r,s]),this.referenceDelegate.removeReference(e,r,o)])})}removeMatchingKeysForTargetId(e,n){const r=Xn(e),i=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,n){const r=IDBKeyRange.bound([n],[n+1],!1,!0),i=Xn(e);let o=ne();return i.J({range:r,H:!0},(s,u,c)=>{const d=un(s[1]),h=new H(d);o=o.add(h)}).next(()=>o)}containsKey(e,n){const r=Tt(n.path),i=IDBKeyRange.bound([r],[fC(r)],!1,!0);let o=0;return Xn(e).J({index:"documentTargetsIndex",H:!0,range:i},([s,u],c,d)=>{s!==0&&(o++,d.done())}).next(()=>o>0)}ot(e,n){return xi(e).get(n).next(r=>r?ms(r):null)}}function xi(t){return He(t,"targets")}function Tv(t){return He(t,"targetGlobal")}function Xn(t){return He(t,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ev([t,e],[n,r]){const i=ee(t,n);return i===0?ee(e,r):i}class Ub{constructor(e){this.Un=e,this.buffer=new pe(Ev),this.Wn=0}Gn(){return++this.Wn}zn(e){const n=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();Ev(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class bb{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){q("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){Sr(n)?q("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):await mi(n)}await this.Hn(3e5)})}}class Bb{constructor(e,n){this.Jn=e,this.params=n}calculateTargetCount(e,n){return this.Jn.Yn(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return L.resolve(zt.oe);const r=new Ub(n);return this.Jn.forEachTarget(e,i=>r.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(e,i=>r.zn(i))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.Jn.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.Jn.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(q("LruGarbageCollector","Garbage collection skipped; disabled"),L.resolve(vv)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(q("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),vv):this.Xn(e,n))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,n){let r,i,o,s,u,c,d;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(q("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,s=Date.now(),this.nthSequenceNumber(e,i))).next(p=>(r=p,u=Date.now(),this.removeTargets(e,r,n))).next(p=>(o=p,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(p=>(d=Date.now(),Di()<=le.DEBUG&&q("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-h}ms
	Determined least recently used ${i} in `+(u-s)+`ms
	Removed ${o} targets in `+(c-u)+`ms
	Removed ${p} documents in `+(d-c)+`ms
Total Duration: ${d-h}ms`),L.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:p})))}}function Ob(t,e){return new Bb(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qb{constructor(e,n){this.db=e,this.garbageCollector=Ob(this,n)}Yn(e){const n=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>n.next(i=>r+i))}er(e){let n=0;return this.Zn(e,r=>{n++}).next(()=>n)}forEachTarget(e,n){return this.db.getTargetCache().forEachTarget(e,n)}Zn(e,n){return this.tr(e,(r,i)=>n(i))}addReference(e,n,r){return pa(e,r)}removeReference(e,n,r){return pa(e,r)}removeTargets(e,n,r){return this.db.getTargetCache().removeTargets(e,n,r)}markPotentiallyOrphaned(e,n){return pa(e,n)}nr(e,n){return function(i,o){let s=!1;return mw(i).Y(u=>pw(i,u,o).next(c=>(c&&(s=!0),L.resolve(!c)))).next(()=>s)}(e,n)}removeOrphanedDocuments(e,n){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let o=0;return this.tr(e,(s,u)=>{if(u<=n){const c=this.nr(e,s).next(d=>{if(!d)return o++,r.getEntry(e,s).next(()=>(r.removeEntry(s,X.min()),Xn(e).delete(function(p){return[0,Tt(p.path)]}(s))))});i.push(c)}}).next(()=>L.waitFor(i)).next(()=>r.apply(e)).next(()=>o)}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,n){return pa(e,n)}tr(e,n){const r=Xn(e);let i,o=zt.oe;return r.J({index:"documentTargetsIndex"},([s,u],{path:c,sequenceNumber:d})=>{s===0?(o!==zt.oe&&n(new H(un(i)),o),o=d,i=c):o=zt.oe}).next(()=>{o!==zt.oe&&n(new H(un(i)),o)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function pa(t,e){return Xn(t).put(function(r,i){return{targetId:0,path:Tt(r.path),sequenceNumber:i}}(e,t.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gw{constructor(){this.changes=new Ar(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,we.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?L.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gb{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,n,r){return Mr(e).put(r)}removeEntry(e,n,r){return Mr(e).delete(function(o,s){const u=o.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Eu(s),u[u.length-1]]}(n,r))}updateMetadata(e,n){return this.getMetadata(e).next(r=>(r.byteSize+=n,this.rr(e,r)))}getEntry(e,n){let r=we.newInvalidDocument(n);return Mr(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(is(n))},(i,o)=>{r=this.ir(n,o)}).next(()=>r)}sr(e,n){let r={size:0,document:we.newInvalidDocument(n)};return Mr(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(is(n))},(i,o)=>{r={document:this.ir(n,o),size:Cu(o)}}).next(()=>r)}getEntries(e,n){let r=Vt();return this._r(e,n,(i,o)=>{const s=this.ir(i,o);r=r.insert(i,s)}).next(()=>r)}ar(e,n){let r=Vt(),i=new Se(H.comparator);return this._r(e,n,(o,s)=>{const u=this.ir(o,s);r=r.insert(o,u),i=i.insert(o,Cu(s))}).next(()=>({documents:r,ur:i}))}_r(e,n,r){if(n.isEmpty())return L.resolve();let i=new pe(wv);n.forEach(c=>i=i.add(c));const o=IDBKeyRange.bound(is(i.first()),is(i.last())),s=i.getIterator();let u=s.getNext();return Mr(e).J({index:"documentKeyIndex",range:o},(c,d,h)=>{const p=H.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;u&&wv(u,p)<0;)r(u,null),u=s.getNext();u&&u.isEqual(p)&&(r(u,d),u=s.hasNext()?s.getNext():null),u?h.$(is(u)):h.done()}).next(()=>{for(;u;)r(u,null),u=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,n,r,i,o){const s=n.path,u=[s.popLast().toArray(),s.lastSegment(),Eu(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Mr(e).U(IDBKeyRange.bound(u,c,!0)).next(d=>{o==null||o.incrementDocumentReadCount(d.length);let h=Vt();for(const p of d){const m=this.ir(H.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);m.isFoundDocument()&&(Tl(n,m)||i.has(m.key))&&(h=h.insert(m.key,m))}return h})}getAllFromCollectionGroup(e,n,r,i){let o=Vt();const s=Cv(n,r),u=Cv(n,bt.max());return Mr(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,u,!0)},(c,d,h)=>{const p=this.ir(H.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);o=o.insert(p.key,p),o.size===i&&h.done()}).next(()=>o)}newChangeBuffer(e){return new $b(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(n=>n.byteSize)}getMetadata(e){return Iv(e).get("remoteDocumentGlobalKey").next(n=>(Y(!!n),n))}rr(e,n){return Iv(e).put("remoteDocumentGlobalKey",n)}ir(e,n){if(n){const r=Ab(this.serializer,n);if(!(r.isNoDocument()&&r.version.isEqual(X.min())))return r}return we.newInvalidDocument(e)}}function yw(t){return new Gb(t)}class $b extends gw{constructor(e,n){super(),this.cr=e,this.trackRemovals=n,this.lr=new Ar(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const n=[];let r=0,i=new pe((o,s)=>ee(o.canonicalString(),s.canonicalString()));return this.changes.forEach((o,s)=>{const u=this.lr.get(o);if(n.push(this.cr.removeEntry(e,o,u.readTime)),s.isValidDocument()){const c=av(this.cr.serializer,s);i=i.add(o.path.popLast());const d=Cu(c);r+=d-u.size,n.push(this.cr.addEntry(e,o,c))}else if(r-=u.size,this.trackRemovals){const c=av(this.cr.serializer,s.convertToNoDocument(X.min()));n.push(this.cr.addEntry(e,o,c))}}),i.forEach(o=>{n.push(this.cr.indexManager.addToCollectionParentIndex(e,o))}),n.push(this.cr.updateMetadata(e,r)),L.waitFor(n)}getFromCache(e,n){return this.cr.sr(e,n).next(r=>(this.lr.set(n,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,n){return this.cr.ar(e,n).next(({documents:r,ur:i})=>(i.forEach((o,s)=>{this.lr.set(o,{size:s,readTime:r.get(o).readTime})}),r))}}function Iv(t){return He(t,"remoteDocumentGlobal")}function Mr(t){return He(t,"remoteDocumentsV14")}function is(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Cv(t,e){const n=e.documentKey.path.toArray();return[t,Eu(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function wv(t,e){const n=t.path.toArray(),r=e.path.toArray();let i=0;for(let o=0;o<n.length-2&&o<r.length-2;++o)if(i=ee(n[o],r[o]),i)return i;return i=ee(n.length,r.length),i||(i=ee(n[n.length-2],r[r.length-2]),i||ee(n[n.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zb{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _w{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,n))).next(i=>(r!==null&&Ms(r.mutation,i,At.empty(),Me.now()),i))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,ne()).next(()=>r))}getLocalViewOfDocuments(e,n,r=ne()){const i=cn();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,r).next(o=>{let s=hs();return o.forEach((u,c)=>{s=s.insert(u,c.overlayedDocument)}),s}))}getOverlayedDocuments(e,n){const r=cn();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,ne()))}populateOverlays(e,n,r){const i=[];return r.forEach(o=>{n.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((s,u)=>{n.set(s,u)})})}computeViews(e,n,r,i){let o=Vt();const s=Ds(),u=function(){return Ds()}();return n.forEach((c,d)=>{const h=r.get(d.key);i.has(d.key)&&(h===void 0||h.mutation instanceof On)?o=o.insert(d.key,d):h!==void 0?(s.set(d.key,h.mutation.getFieldMask()),Ms(h.mutation,d,h.mutation.getFieldMask(),Me.now())):s.set(d.key,At.empty())}),this.recalculateAndSaveOverlays(e,o).next(c=>(c.forEach((d,h)=>s.set(d,h)),n.forEach((d,h)=>{var p;return u.set(d,new zb(h,(p=s.get(d))!==null&&p!==void 0?p:null))}),u))}recalculateAndSaveOverlays(e,n){const r=Ds();let i=new Se((s,u)=>s-u),o=ne();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(s=>{for(const u of s)u.keys().forEach(c=>{const d=n.get(c);if(d===null)return;let h=r.get(c)||At.empty();h=u.applyToLocalView(d,h),r.set(c,h);const p=(i.get(u.batchId)||ne()).add(c);i=i.insert(u.batchId,p)})}).next(()=>{const s=[],u=i.getReverseIterator();for(;u.hasNext();){const c=u.getNext(),d=c.key,h=c.value,p=bC();h.forEach(m=>{if(!o.has(m)){const _=HC(n.get(m),r.get(m));_!==null&&p.set(m,_),o=o.add(m)}}),s.push(this.documentOverlayCache.saveOverlays(e,d,p))}return L.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,i){return function(s){return H.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):NC(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next(o=>{const s=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-o.size):L.resolve(cn());let u=-1,c=o;return s.next(d=>L.forEach(d,(h,p)=>(u<p.largestBatchId&&(u=p.largestBatchId),o.get(h)?L.resolve():this.remoteDocumentCache.getEntry(e,h).next(m=>{c=c.insert(h,m)}))).next(()=>this.populateOverlays(e,d,o)).next(()=>this.computeViews(e,c,d,ne())).next(h=>({batchId:u,changes:UC(h)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new H(n)).next(r=>{let i=hs();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const o=n.collectionGroup;let s=hs();return this.indexManager.getCollectionParents(e,o).next(u=>L.forEach(u,c=>{const d=function(p,m){return new Do(m,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(n,c.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,r,i).next(h=>{h.forEach((p,m)=>{s=s.insert(p,m)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,n,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(s=>(o=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,o,i))).next(s=>{o.forEach((c,d)=>{const h=d.getKey();s.get(h)===null&&(s=s.insert(h,we.newInvalidDocument(h)))});let u=hs();return s.forEach((c,d)=>{const h=o.get(c);h!==void 0&&Ms(h.mutation,d,At.empty(),Me.now()),Tl(n,d)&&(u=u.insert(c,d))}),u})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hb{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,n){return L.resolve(this.hr.get(n))}saveBundleMetadata(e,n){return this.hr.set(n.id,function(i){return{id:i.id,version:i.version,createTime:Qe(i.createTime)}}(n)),L.resolve()}getNamedQuery(e,n){return L.resolve(this.Pr.get(n))}saveNamedQuery(e,n){return this.Pr.set(n.name,function(i){return{name:i.name,query:cw(i.bundledQuery),readTime:Qe(i.readTime)}}(n)),L.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kb{constructor(){this.overlays=new Se(H.comparator),this.Ir=new Map}getOverlay(e,n){return L.resolve(this.overlays.get(n))}getOverlays(e,n){const r=cn();return L.forEach(n,i=>this.getOverlay(e,i).next(o=>{o!==null&&r.set(i,o)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((i,o)=>{this.ht(e,n,o)}),L.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.Ir.get(r);return i!==void 0&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.Ir.delete(r)),L.resolve()}getOverlaysForCollection(e,n,r){const i=cn(),o=n.length+1,s=new H(n.child("")),u=this.overlays.getIteratorFrom(s);for(;u.hasNext();){const c=u.getNext().value,d=c.getKey();if(!n.isPrefixOf(d.path))break;d.path.length===o&&c.largestBatchId>r&&i.set(c.getKey(),c)}return L.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let o=new Se((d,h)=>d-h);const s=this.overlays.getIterator();for(;s.hasNext();){const d=s.getNext().value;if(d.getKey().getCollectionGroup()===n&&d.largestBatchId>r){let h=o.get(d.largestBatchId);h===null&&(h=cn(),o=o.insert(d.largestBatchId,h)),h.set(d.getKey(),d)}}const u=cn(),c=o.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,h)=>u.set(d,h)),!(u.size()>=i)););return L.resolve(u)}ht(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const s=this.Ir.get(i.largestBatchId).delete(r.key);this.Ir.set(i.largestBatchId,s)}this.overlays=this.overlays.insert(r.key,new fp(n,r));let o=this.Ir.get(n);o===void 0&&(o=ne(),this.Ir.set(n,o)),this.Ir.set(n,o.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wb{constructor(){this.sessionToken=Ge.EMPTY_BYTE_STRING}getSessionToken(e){return L.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,L.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yp{constructor(){this.Tr=new pe(Ke.Er),this.dr=new pe(Ke.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,n){const r=new Ke(e,n);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Vr(new Ke(e,n))}mr(e,n){e.forEach(r=>this.removeReference(r,n))}gr(e){const n=new H(new ce([])),r=new Ke(n,e),i=new Ke(n,e+1),o=[];return this.dr.forEachInRange([r,i],s=>{this.Vr(s),o.push(s.key)}),o}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const n=new H(new ce([])),r=new Ke(n,e),i=new Ke(n,e+1);let o=ne();return this.dr.forEachInRange([r,i],s=>{o=o.add(s.key)}),o}containsKey(e){const n=new Ke(e,0),r=this.Tr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Ke{constructor(e,n){this.key=e,this.wr=n}static Er(e,n){return H.comparator(e.key,n.key)||ee(e.wr,n.wr)}static Ar(e,n){return ee(e.wr,n.wr)||H.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jb{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Sr=1,this.br=new pe(Ke.Er)}checkEmpty(e){return L.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const o=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new cp(o,n,r,i);this.mutationQueue.push(s);for(const u of i)this.br=this.br.add(new Ke(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return L.resolve(s)}lookupMutationBatch(e,n){return L.resolve(this.Dr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.vr(r),o=i<0?0:i;return L.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return L.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return L.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Ke(n,0),i=new Ke(n,Number.POSITIVE_INFINITY),o=[];return this.br.forEachInRange([r,i],s=>{const u=this.Dr(s.wr);o.push(u)}),L.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new pe(ee);return n.forEach(i=>{const o=new Ke(i,0),s=new Ke(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([o,s],u=>{r=r.add(u.wr)})}),L.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let o=r;H.isDocumentKey(o)||(o=o.child(""));const s=new Ke(new H(o),0);let u=new pe(ee);return this.br.forEachWhile(c=>{const d=c.key.path;return!!r.isPrefixOf(d)&&(d.length===i&&(u=u.add(c.wr)),!0)},s),L.resolve(this.Cr(u))}Cr(e){const n=[];return e.forEach(r=>{const i=this.Dr(r);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){Y(this.Fr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return L.forEach(n.mutations,i=>{const o=new Ke(i.key,n.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,n){const r=new Ke(n,0),i=this.br.firstAfterOrEqual(r);return L.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,L.resolve()}Fr(e,n){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const n=this.vr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qb{constructor(e){this.Mr=e,this.docs=function(){return new Se(H.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),o=i?i.size:0,s=this.Mr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:s}),this.size+=s-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return L.resolve(r?r.document.mutableCopy():we.newInvalidDocument(n))}getEntries(e,n){let r=Vt();return n.forEach(i=>{const o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():we.newInvalidDocument(i))}),L.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let o=Vt();const s=n.path,u=new H(s.child("")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){const{key:d,value:{document:h}}=c.getNext();if(!s.isPrefixOf(d.path))break;d.path.length>s.length+1||tp(hC(h),r)<=0||(i.has(h.key)||Tl(n,h))&&(o=o.insert(h.key,h.mutableCopy()))}return L.resolve(o)}getAllFromCollectionGroup(e,n,r,i){Q()}Or(e,n){return L.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new Yb(this)}getSize(e){return L.resolve(this.size)}}class Yb extends gw{constructor(e){super(),this.cr=e}applyChanges(e){const n=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?n.push(this.cr.addEntry(e,i)):this.cr.removeEntry(r)}),L.waitFor(n)}getFromCache(e,n){return this.cr.getEntry(e,n)}getAllFromCache(e,n){return this.cr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xb{constructor(e){this.persistence=e,this.Nr=new Ar(n=>ri(n),vl),this.lastRemoteSnapshotVersion=X.min(),this.highestTargetId=0,this.Lr=0,this.Br=new yp,this.targetCount=0,this.kr=si.Bn()}forEachTarget(e,n){return this.Nr.forEach((r,i)=>n(i)),L.resolve()}getLastRemoteSnapshotVersion(e){return L.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return L.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),L.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Lr&&(this.Lr=n),L.resolve()}Kn(e){this.Nr.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.kr=new si(n),this.highestTargetId=n),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,n){return this.Kn(n),this.targetCount+=1,L.resolve()}updateTargetData(e,n){return this.Kn(n),L.resolve()}removeTargetData(e,n){return this.Nr.delete(n.target),this.Br.gr(n.targetId),this.targetCount-=1,L.resolve()}removeTargets(e,n,r){let i=0;const o=[];return this.Nr.forEach((s,u)=>{u.sequenceNumber<=n&&r.get(u.targetId)===null&&(this.Nr.delete(s),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),L.waitFor(o).next(()=>i)}getTargetCount(e){return L.resolve(this.targetCount)}getTargetData(e,n){const r=this.Nr.get(n)||null;return L.resolve(r)}addMatchingKeys(e,n,r){return this.Br.Rr(n,r),L.resolve()}removeMatchingKeys(e,n,r){this.Br.mr(n,r);const i=this.persistence.referenceDelegate,o=[];return i&&n.forEach(s=>{o.push(i.markPotentiallyOrphaned(e,s))}),L.waitFor(o)}removeMatchingKeysForTargetId(e,n){return this.Br.gr(n),L.resolve()}getMatchingKeysForTargetId(e,n){const r=this.Br.yr(n);return L.resolve(r)}containsKey(e,n){return L.resolve(this.Br.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vw{constructor(e,n){this.qr={},this.overlays={},this.Qr=new zt(0),this.Kr=!1,this.Kr=!0,this.$r=new Wb,this.referenceDelegate=e(this),this.Ur=new Xb(this),this.indexManager=new Vb,this.remoteDocumentCache=function(i){return new Qb(i)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new aw(n),this.Gr=new Hb(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new Kb,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.qr[e.toKey()];return r||(r=new Jb(n,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,n,r){q("MemoryPersistence","Starting transaction:",e);const i=new Zb(this.Qr.next());return this.referenceDelegate.zr(),r(i).next(o=>this.referenceDelegate.jr(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Hr(e,n){return L.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,n)))}}class Zb extends mC{constructor(e){super(),this.currentSequenceNumber=e}}class tc{constructor(e){this.persistence=e,this.Jr=new yp,this.Yr=null}static Zr(e){return new tc(e)}get Xr(){if(this.Yr)return this.Yr;throw Q()}addReference(e,n,r){return this.Jr.addReference(r,n),this.Xr.delete(r.toString()),L.resolve()}removeReference(e,n,r){return this.Jr.removeReference(r,n),this.Xr.add(r.toString()),L.resolve()}markPotentiallyOrphaned(e,n){return this.Xr.add(n.toString()),L.resolve()}removeTarget(e,n){this.Jr.gr(n.targetId).forEach(i=>this.Xr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(o=>this.Xr.add(o.toString()))}).next(()=>r.removeTargetData(e,n))}zr(){this.Yr=new Set}jr(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return L.forEach(this.Xr,r=>{const i=H.fromPath(r);return this.ei(e,i).next(o=>{o||n.removeEntry(i,X.min())})}).next(()=>(this.Yr=null,n.apply(e)))}updateLimboDocument(e,n){return this.ei(e,n).next(r=>{r?this.Xr.delete(n.toString()):this.Xr.add(n.toString())})}Wr(e){return 0}ei(e,n){return L.or([()=>L.resolve(this.Jr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Hr(e,n)])}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jb{constructor(e){this.serializer=e}O(e,n,r,i){const o=new Wu("createOrUpgrade",n);r<1&&i>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",b_,{unique:!0}),c.createObjectStore("documentMutations")}(e),Sv(e),function(c){c.createObjectStore("remoteDocuments")}(e));let s=L.resolve();return r<3&&i>=3&&(r!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),Sv(e)),s=s.next(()=>function(c){const d=c.store("targetGlobal"),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:X.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",h)}(o))),r<4&&i>=4&&(r!==0&&(s=s.next(()=>function(c,d){return d.store("mutations").U().next(h=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",b_,{unique:!0});const p=d.store("mutations"),m=h.map(_=>p.put(_));return L.waitFor(m)})}(e,o))),s=s.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(s=s.next(()=>this.ni(o))),r<6&&i>=6&&(s=s.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ri(o)))),r<7&&i>=7&&(s=s.next(()=>this.ii(o))),r<8&&i>=8&&(s=s.next(()=>this.si(e,o))),r<9&&i>=9&&(s=s.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(s=s.next(()=>this.oi(o))),r<11&&i>=11&&(s=s.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(s=s.next(()=>{(function(c){const d=c.createObjectStore("documentOverlays",{keyPath:xU});d.createIndex("collectionPathOverlayIndex",PU,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",DU,{unique:!1})})(e)})),r<13&&i>=13&&(s=s.next(()=>function(c){const d=c.createObjectStore("remoteDocumentsV14",{keyPath:yU});d.createIndex("documentKeyIndex",_U),d.createIndex("collectionGroupIndex",vU)}(e)).next(()=>this._i(e,o)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(s=s.next(()=>this.ai(e,o))),r<15&&i>=15&&(s=s.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:wU}).createIndex("sequenceNumberIndex",SU,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:AU}).createIndex("documentKeyIndex",RU,{unique:!1})}(e))),r<16&&i>=16&&(s=s.next(()=>{n.objectStore("indexState").clear()}).next(()=>{n.objectStore("indexEntries").clear()})),r<17&&i>=17&&(s=s.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(e)})),s}ri(e){let n=0;return e.store("remoteDocuments").J((r,i)=>{n+=Cu(i)}).next(()=>{const r={byteSize:n};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const n=e.store("mutationQueues"),r=e.store("mutations");return n.U().next(i=>L.forEach(i,o=>{const s=IDBKeyRange.bound([o.userId,-1],[o.userId,o.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",s).next(u=>L.forEach(u,c=>{Y(c.userId===o.userId);const d=Ur(this.serializer,c);return hw(e,o.userId,d).next(()=>{})}))}))}ii(e){const n=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const o=[];return r.J((s,u)=>{const c=new ce(s),d=function(p){return[0,Tt(p)]}(c);o.push(n.get(d).next(h=>h?L.resolve():(p=>n.put({targetId:0,path:Tt(p),sequenceNumber:i.highestListenSequenceNumber}))(c)))}).next(()=>L.waitFor(o))})}si(e,n){e.createObjectStore("collectionParents",{keyPath:CU});const r=n.store("collectionParents"),i=new gp,o=s=>{if(i.add(s)){const u=s.lastSegment(),c=s.popLast();return r.put({collectionId:u,parent:Tt(c)})}};return n.store("remoteDocuments").J({H:!0},(s,u)=>{const c=new ce(s);return o(c.popLast())}).next(()=>n.store("documentMutations").J({H:!0},([s,u,c],d)=>{const h=un(u);return o(h.popLast())}))}oi(e){const n=e.store("targets");return n.J((r,i)=>{const o=ms(i),s=uw(this.serializer,o);return n.put(s)})}_i(e,n){const r=n.store("remoteDocuments"),i=[];return r.J((o,s)=>{const u=n.store("remoteDocumentsV14"),c=function(p){return p.document?new H(ce.fromString(p.document.name).popFirst(5)):p.noDocument?H.fromSegments(p.noDocument.path):p.unknownDocument?H.fromSegments(p.unknownDocument.path):Q()}(s).path.toArray(),d={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:s.readTime||[0,0],unknownDocument:s.unknownDocument,noDocument:s.noDocument,document:s.document,hasCommittedMutations:!!s.hasCommittedMutations};i.push(u.put(d))}).next(()=>L.waitFor(i))}ai(e,n){const r=n.store("mutations"),i=yw(this.serializer),o=new vw(tc.Zr,this.serializer.ct);return r.U().next(s=>{const u=new Map;return s.forEach(c=>{var d;let h=(d=u.get(c.userId))!==null&&d!==void 0?d:ne();Ur(this.serializer,c).keys().forEach(p=>h=h.add(p)),u.set(c.userId,h)}),L.forEach(u,(c,d)=>{const h=new je(d),p=ju.lt(this.serializer,h),m=o.getIndexManager(h),_=ec.lt(h,this.serializer,m,o.referenceDelegate);return new _w(i,_,p,m).recalculateAndSaveOverlaysForDocumentKeys(new Mf(n,zt.oe),c).next()})})}}function Sv(t){t.createObjectStore("targetDocuments",{keyPath:EU}).createIndex("documentTargetsIndex",IU,{unique:!0}),t.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",TU,{unique:!0}),t.createObjectStore("targetGlobal")}const pd="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class _p{constructor(e,n,r,i,o,s,u,c,d,h,p=17){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.ui=o,this.window=s,this.document=u,this.ci=d,this.li=h,this.hi=p,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=m=>Promise.resolve(),!_p.D())throw new $(O.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new qb(this,i),this.Ai=n+"main",this.serializer=new aw(c),this.Ri=new pr(this.Ai,this.hi,new jb(this.serializer)),this.$r=new xb,this.Ur=new Fb(this.referenceDelegate,this.serializer),this.remoteDocumentCache=yw(this.serializer),this.Gr=new Rb,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,h===!1&&_t("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new $(O.FAILED_PRECONDITION,pd);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new zt(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async n=>{if(this.started)return e(n)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async n=>{n.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ma(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(n=>{n||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(n=>this.isPrimary&&!n?this.bi(e).next(()=>!1):!!n&&this.Di(e).next(()=>!0))).catch(e=>{if(Sr(e))return q("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return q("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return os(e).get("owner").next(n=>L.resolve(this.vi(n)))}Ci(e){return ma(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const r=He(n,"clientMetadata");return r.U().next(i=>{const o=this.xi(i,18e5),s=i.filter(u=>o.indexOf(u)===-1);return L.forEach(s,u=>r.delete(u.clientId)).next(()=>s)})}).catch(()=>[]);if(this.Vi)for(const n of e)this.Vi.removeItem(this.Oi(n.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?L.resolve(!0):os(e).get("owner").next(n=>{if(n!==null&&this.Mi(n.leaseTimestampMs,5e3)&&!this.Ni(n.ownerId)){if(this.vi(n)&&this.networkEnabled)return!0;if(!this.vi(n)){if(!n.allowTabSynchronization)throw new $(O.FAILED_PRECONDITION,pd);return!1}}return!(!this.networkEnabled||!this.inForeground)||ma(e).U().next(r=>this.xi(r,5e3).find(i=>{if(this.clientId!==i.clientId){const o=!this.networkEnabled&&i.networkEnabled,s=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(o||s&&u)return!0}return!1})===void 0)}).next(n=>(this.isPrimary!==n&&q("IndexedDbPersistence",`Client ${n?"is":"is not"} eligible for a primary lease.`),n))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const n=new Mf(e,zt.oe);return this.bi(n).next(()=>this.Ci(n))}),this.Ri.close(),this.qi()}xi(e,n){return e.filter(r=>this.Mi(r.updateTimeMs,n)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>ma(e).U().next(n=>this.xi(n,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,n){return ec.lt(e,this.serializer,n,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Lb(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return ju.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,n,r){q("IndexedDbPersistence","Starting transaction:",e);const i=n==="readonly"?"readonly":"readwrite",o=function(c){return c===17?NU:c===16?kU:c===15?rp:c===14?TC:c===13?vC:c===12?MU:c===11?_C:void Q()}(this.hi);let s;return this.Ri.runTransaction(e,i,o,u=>(s=new Mf(u,this.Qr?this.Qr.next():zt.oe),n==="readwrite-primary"?this.wi(s).next(c=>!!c||this.Si(s)).next(c=>{if(!c)throw _t(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new $(O.FAILED_PRECONDITION,pC);return r(s)}).next(c=>this.Di(s).next(()=>c)):this.Ki(s).next(()=>r(s)))).then(u=>(s.raiseOnCommittedEvent(),u))}Ki(e){return os(e).get("owner").next(n=>{if(n!==null&&this.Mi(n.leaseTimestampMs,5e3)&&!this.Ni(n.ownerId)&&!this.vi(n)&&!(this.li||this.allowTabSynchronization&&n.allowTabSynchronization))throw new $(O.FAILED_PRECONDITION,pd)})}Di(e){const n={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return os(e).put("owner",n)}static D(){return pr.D()}bi(e){const n=os(e);return n.get("owner").next(r=>this.vi(r)?(q("IndexedDbPersistence","Releasing primary lease."),n.delete("owner")):L.resolve())}Mi(e,n){const r=Date.now();return!(e<r-n)&&(!(e>r)||(_t(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const n=/(?:Version|Mobile)\/1[456]/;KI()&&(navigator.appVersion.match(n)||navigator.userAgent.match(n))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var n;try{const r=((n=this.Vi)===null||n===void 0?void 0:n.getItem(this.Oi(e)))!==null;return q("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return _t("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){_t("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function os(t){return He(t,"owner")}function ma(t){return He(t,"clientMetadata")}function e4(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vp{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.$i=r,this.Ui=i}static Wi(e,n){let r=ne(),i=ne();for(const o of n.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new vp(e,n.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t4{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tw{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return KI()?8:gC(gu())>0?6:4}()}initialize(e,n){this.Ji=e,this.indexManager=n,this.Gi=!0}getDocumentsMatchingQuery(e,n,r,i){const o={result:null};return this.Yi(e,n).next(s=>{o.result=s}).next(()=>{if(!o.result)return this.Zi(e,n,i,r).next(s=>{o.result=s})}).next(()=>{if(o.result)return;const s=new t4;return this.Xi(e,n,s).next(u=>{if(o.result=u,this.zi)return this.es(e,n,s,u.size)})}).next(()=>o.result)}es(e,n,r,i){return r.documentReadCount<this.ji?(Di()<=le.DEBUG&&q("QueryEngine","SDK will not create cache indexes for query:",Mi(n),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),L.resolve()):(Di()<=le.DEBUG&&q("QueryEngine","Query:",Mi(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Hi*i?(Di()<=le.DEBUG&&q("QueryEngine","The SDK decides to create cache indexes for query:",Mi(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Wt(n))):L.resolve())}Yi(e,n){if(X_(n))return L.resolve(null);let r=Wt(n);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=bf(n,null,"F"),r=Wt(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{const s=ne(...o);return this.Ji.getDocuments(e,s).next(u=>this.indexManager.getMinOffset(e,r).next(c=>{const d=this.ts(n,u);return this.ns(n,d,s,c.readTime)?this.Yi(e,bf(n,null,"F")):this.rs(e,d,n,c)}))})))}Zi(e,n,r,i){return X_(n)||i.isEqual(X.min())?L.resolve(null):this.Ji.getDocuments(e,r).next(o=>{const s=this.ts(n,o);return this.ns(n,s,r,i)?L.resolve(null):(Di()<=le.DEBUG&&q("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Mi(n)),this.rs(e,s,n,uU(i,-1)).next(u=>u))})}ts(e,n){let r=new pe(LC(e));return n.forEach((i,o)=>{Tl(e,o)&&(r=r.add(o))}),r}ns(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const o=e.limitType==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Xi(e,n,r){return Di()<=le.DEBUG&&q("QueryEngine","Using full collection scan to execute query:",Mi(n)),this.Ji.getDocumentsMatchingQuery(e,n,bt.min(),r)}rs(e,n,r,i){return this.Ji.getDocumentsMatchingQuery(e,r,i).next(o=>(n.forEach(s=>{o=o.insert(s.key,s)}),o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n4{constructor(e,n,r,i){this.persistence=e,this.ss=n,this.serializer=i,this.os=new Se(ee),this._s=new Ar(o=>ri(o),vl),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new _w(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.os))}}function Ew(t,e,n,r){return new n4(t,e,n,r)}async function Iw(t,e){const n=Z(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next(o=>(i=o,n.ls(e),n.mutationQueue.getAllMutationBatches(r))).next(o=>{const s=[],u=[];let c=ne();for(const d of i){s.push(d.batchId);for(const h of d.mutations)c=c.add(h.key)}for(const d of o){u.push(d.batchId);for(const h of d.mutations)c=c.add(h.key)}return n.localDocuments.getDocuments(r,c).next(d=>({hs:d,removedBatchIds:s,addedBatchIds:u}))})})}function r4(t,e){const n=Z(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),o=n.cs.newChangeBuffer({trackRemovals:!0});return function(u,c,d,h){const p=d.batch,m=p.keys();let _=L.resolve();return m.forEach(S=>{_=_.next(()=>h.getEntry(c,S)).next(R=>{const M=d.docVersions.get(S);Y(M!==null),R.version.compareTo(M)<0&&(p.applyToRemoteDocument(R,d),R.isValidDocument()&&(R.setReadTime(d.commitVersion),h.addEntry(R)))})}),_.next(()=>u.mutationQueue.removeMutationBatch(c,p))}(n,r,e,o).next(()=>o.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(u){let c=ne();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(c=c.add(u.batch.mutations[d].key));return c}(e))).next(()=>n.localDocuments.getDocuments(r,i))})}function Cw(t){const e=Z(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Ur.getLastRemoteSnapshotVersion(n))}function i4(t,e){const n=Z(t),r=e.snapshotVersion;let i=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const s=n.cs.newChangeBuffer({trackRemovals:!0});i=n.os;const u=[];e.targetChanges.forEach((h,p)=>{const m=i.get(p);if(!m)return;u.push(n.Ur.removeMatchingKeys(o,h.removedDocuments,p).next(()=>n.Ur.addMatchingKeys(o,h.addedDocuments,p)));let _=m.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(p)!==null?_=_.withResumeToken(Ge.EMPTY_BYTE_STRING,X.min()).withLastLimboFreeSnapshotVersion(X.min()):h.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(h.resumeToken,r)),i=i.insert(p,_),function(R,M,I){return R.resumeToken.approximateByteSize()===0||M.snapshotVersion.toMicroseconds()-R.snapshotVersion.toMicroseconds()>=3e8?!0:I.addedDocuments.size+I.modifiedDocuments.size+I.removedDocuments.size>0}(m,_,h)&&u.push(n.Ur.updateTargetData(o,_))});let c=Vt(),d=ne();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&u.push(n.persistence.referenceDelegate.updateLimboDocument(o,h))}),u.push(o4(o,s,e.documentUpdates).next(h=>{c=h.Ps,d=h.Is})),!r.isEqual(X.min())){const h=n.Ur.getLastRemoteSnapshotVersion(o).next(p=>n.Ur.setTargetsMetadata(o,o.currentSequenceNumber,r));u.push(h)}return L.waitFor(u).next(()=>s.apply(o)).next(()=>n.localDocuments.getLocalViewOfDocuments(o,c,d)).next(()=>c)}).then(o=>(n.os=i,o))}function o4(t,e,n){let r=ne(),i=ne();return n.forEach(o=>r=r.add(o)),e.getEntries(t,r).next(o=>{let s=Vt();return n.forEach((u,c)=>{const d=o.get(u);c.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(X.min())?(e.removeEntry(u,c.readTime),s=s.insert(u,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(c),s=s.insert(u,c)):q("LocalStore","Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",c.version)}),{Ps:s,Is:i}})}function s4(t,e){const n=Z(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function l4(t,e){const n=Z(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return n.Ur.getTargetData(r,e).next(o=>o?(i=o,L.resolve(i)):n.Ur.allocateTargetId(r).next(s=>(i=new xn(e,s,"TargetPurposeListen",r.currentSequenceNumber),n.Ur.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=n.os.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.os=n.os.insert(r.targetId,r),n._s.set(e,r.targetId)),r})}async function Kf(t,e,n){const r=Z(t),i=r.os.get(e),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,s=>r.persistence.referenceDelegate.removeTarget(s,i))}catch(s){if(!Sr(s))throw s;q("LocalStore",`Failed to update sequence numbers for target ${e}: ${s}`)}r.os=r.os.remove(e),r._s.delete(i.target)}function Av(t,e,n){const r=Z(t);let i=X.min(),o=ne();return r.persistence.runTransaction("Execute query","readwrite",s=>function(c,d,h){const p=Z(c),m=p._s.get(h);return m!==void 0?L.resolve(p.os.get(m)):p.Ur.getTargetData(d,h)}(r,s,Wt(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(s,u.targetId).next(c=>{o=c})}).next(()=>r.ss.getDocumentsMatchingQuery(s,e,n?i:X.min(),n?o:ne())).next(u=>(a4(r,JU(e),u),{documents:u,Ts:o})))}function a4(t,e,n){let r=t.us.get(e)||X.min();n.forEach((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),t.us.set(e,r)}class Rv{constructor(){this.activeTargetIds=eb()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ww{constructor(){this.so=new Rv,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,n,r){this.oo[e]=n}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Rv,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u4{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xv{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){q("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){q("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ga=null;function md(){return ga===null?ga=function(){return 268435456+Math.round(2147483648*Math.random())}():ga++,"0x"+ga.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c4={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d4{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ut="WebChannelConnection";class f4 extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const r=n.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),o=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+n.host,this.vo=`projects/${i}/databases/${o}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${o}`}get Fo(){return!1}Mo(n,r,i,o,s){const u=md(),c=this.xo(n,r.toUriEncodedString());q("RestConnection",`Sending RPC '${n}' ${u}:`,c,i);const d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,o,s),this.No(n,c,d,i).then(h=>(q("RestConnection",`Received RPC '${n}' ${u}: `,h),h),h=>{throw ei("RestConnection",`RPC '${n}' ${u} failed with error: `,h,"url: ",c,"request:",i),h})}Lo(n,r,i,o,s,u){return this.Mo(n,r,i,o,s)}Oo(n,r,i){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Po}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((o,s)=>n[s]=o),i&&i.headers.forEach((o,s)=>n[s]=o)}xo(n,r){const i=c4[n];return`${this.Do}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,n,r,i){const o=md();return new Promise((s,u)=>{const c=new oC;c.setWithCredentials(!0),c.listenOnce(sC.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Na.NO_ERROR:const h=c.getResponseJson();q(ut,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(h)),s(h);break;case Na.TIMEOUT:q(ut,`RPC '${e}' ${o} timed out`),u(new $(O.DEADLINE_EXCEEDED,"Request time out"));break;case Na.HTTP_ERROR:const p=c.getStatus();if(q(ut,`RPC '${e}' ${o} failed with status:`,p,"response text:",c.getResponseText()),p>0){let m=c.getResponseJson();Array.isArray(m)&&(m=m[0]);const _=m==null?void 0:m.error;if(_&&_.status&&_.message){const S=function(M){const I=M.toLowerCase().replace(/_/g,"-");return Object.values(O).indexOf(I)>=0?I:O.UNKNOWN}(_.status);u(new $(S,_.message))}else u(new $(O.UNKNOWN,"Server responded with status "+c.getStatus()))}else u(new $(O.UNAVAILABLE,"Connection failed."));break;default:Q()}}finally{q(ut,`RPC '${e}' ${o} completed.`)}});const d=JSON.stringify(i);q(ut,`RPC '${e}' ${o} sending request:`,i),c.send(n,"POST",d,r,15)})}Bo(e,n,r){const i=md(),o=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=uC(),u=aC(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Oo(c.initMessageHeaders,n,r),c.encodeInitMessageHeaders=!0;const h=o.join("");q(ut,`Creating RPC '${e}' stream ${i}: ${h}`,c);const p=s.createWebChannel(h,c);let m=!1,_=!1;const S=new d4({Io:M=>{_?q(ut,`Not sending because RPC '${e}' stream ${i} is closed:`,M):(m||(q(ut,`Opening RPC '${e}' stream ${i} transport.`),p.open(),m=!0),q(ut,`RPC '${e}' stream ${i} sending:`,M),p.send(M))},To:()=>p.close()}),R=(M,I,T)=>{M.listen(I,C=>{try{T(C)}catch(k){setTimeout(()=>{throw k},0)}})};return R(p,fs.EventType.OPEN,()=>{_||(q(ut,`RPC '${e}' stream ${i} transport opened.`),S.yo())}),R(p,fs.EventType.CLOSE,()=>{_||(_=!0,q(ut,`RPC '${e}' stream ${i} transport closed`),S.So())}),R(p,fs.EventType.ERROR,M=>{_||(_=!0,ei(ut,`RPC '${e}' stream ${i} transport errored:`,M),S.So(new $(O.UNAVAILABLE,"The operation could not be completed")))}),R(p,fs.EventType.MESSAGE,M=>{var I;if(!_){const T=M.data[0];Y(!!T);const C=T,k=C.error||((I=C[0])===null||I===void 0?void 0:I.error);if(k){q(ut,`RPC '${e}' stream ${i} received error:`,k);const F=k.status;let b=function(w){const x=Be[w];if(x!==void 0)return JC(x)}(F),A=k.message;b===void 0&&(b=O.INTERNAL,A="Unknown error status: "+F+" with message "+k.message),_=!0,S.So(new $(b,A)),p.close()}else q(ut,`RPC '${e}' stream ${i} received:`,T),S.bo(T)}}),R(u,lC.STAT_EVENT,M=>{M.stat===Pf.PROXY?q(ut,`RPC '${e}' stream ${i} detected buffering proxy`):M.stat===Pf.NOPROXY&&q(ut,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{S.wo()},0),S}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h4(){return typeof window<"u"?window:null}function Oa(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nc(t){return new mb(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tp{constructor(e,n,r=1e3,i=1.5,o=6e4){this.ui=e,this.timerId=n,this.ko=r,this.qo=i,this.Qo=o,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const n=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),i=Math.max(0,n-r);i>0&&q("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sw{constructor(e,n,r,i,o,s,u,c){this.ui=e,this.Ho=r,this.Jo=i,this.connection=o,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Tp(e,n)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,n){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():n&&n.code===O.RESOURCE_EXHAUSTED?(_t(n.toString()),_t("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):n&&n.code===O.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(n)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),n=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Yo===n&&this.P_(r,i)},r=>{e(()=>{const i=new $(O.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(i)})})}P_(e,n){const r=this.h_(this.Yo);this.stream=this.T_(e,n),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{r(()=>this.I_(i))}),this.stream.onMessage(i=>{r(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return q("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return n=>{this.ui.enqueueAndForget(()=>this.Yo===e?n():(q("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class p4 extends Sw{constructor(e,n,r,i,o,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,s),this.serializer=o}T_(e,n){return this.connection.Bo("Listen",e,n)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const n=vb(this.serializer,e),r=function(o){if(!("targetChange"in o))return X.min();const s=o.targetChange;return s.targetIds&&s.targetIds.length?X.min():s.readTime?Qe(s.readTime):X.min()}(e);return this.listener.d_(n,r)}A_(e){const n={};n.database=qf(this.serializer),n.addTarget=function(o,s){let u;const c=s.target;if(u=vu(c)?{documents:nw(o,c)}:{query:rw(o,c)._t},u.targetId=s.targetId,s.resumeToken.approximateByteSize()>0){u.resumeToken=XC(o,s.resumeToken);const d=Bf(o,s.expectedCount);d!==null&&(u.expectedCount=d)}else if(s.snapshotVersion.compareTo(X.min())>0){u.readTime=To(o,s.snapshotVersion.toTimestamp());const d=Bf(o,s.expectedCount);d!==null&&(u.expectedCount=d)}return u}(this.serializer,e);const r=Eb(this.serializer,e);r&&(n.labels=r),this.a_(n)}R_(e){const n={};n.database=qf(this.serializer),n.removeTarget=e,this.a_(n)}}class m4 extends Sw{constructor(e,n,r,i,o,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,s),this.serializer=o}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,n){return this.connection.Bo("Write",e,n)}E_(e){return Y(!!e.streamToken),this.lastStreamToken=e.streamToken,Y(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Y(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const n=Tb(e.writeResults,e.commitTime),r=Qe(e.commitTime);return this.listener.g_(r,n)}p_(){const e={};e.database=qf(this.serializer),this.a_(e)}m_(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>ul(this.serializer,r))};this.a_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g4 extends class{}{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new $(O.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,n,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,s])=>this.connection.Mo(e,Of(n,r),i,o,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===O.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new $(O.UNKNOWN,o.toString())})}Lo(e,n,r,i,o){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,u])=>this.connection.Lo(e,Of(n,r),i,s,u,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===O.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new $(O.UNKNOWN,s.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class y4{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(_t(n),this.D_=!1):q("OnlineStateTracker",n)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _4{constructor(e,n,r,i,o){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=o,this.k_._o(s=>{r.enqueueAndForget(async()=>{yi(this)&&(q("RemoteStore","Restarting streams for network reachability change."),await async function(c){const d=Z(c);d.L_.add(4),await Cl(d),d.q_.set("Unknown"),d.L_.delete(4),await rc(d)}(this))})}),this.q_=new y4(r,i)}}async function rc(t){if(yi(t))for(const e of t.B_)await e(!0)}async function Cl(t){for(const e of t.B_)await e(!1)}function Aw(t,e){const n=Z(t);n.N_.has(e.targetId)||(n.N_.set(e.targetId,e),wp(n)?Cp(n):ko(n).r_()&&Ip(n,e))}function Ep(t,e){const n=Z(t),r=ko(n);n.N_.delete(e),r.r_()&&Rw(n,e),n.N_.size===0&&(r.r_()?r.o_():yi(n)&&n.q_.set("Unknown"))}function Ip(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(X.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}ko(t).A_(e)}function Rw(t,e){t.Q_.xe(e),ko(t).R_(e)}function Cp(t){t.Q_=new db({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),ko(t).start(),t.q_.v_()}function wp(t){return yi(t)&&!ko(t).n_()&&t.N_.size>0}function yi(t){return Z(t).L_.size===0}function xw(t){t.Q_=void 0}async function v4(t){t.q_.set("Online")}async function T4(t){t.N_.forEach((e,n)=>{Ip(t,e)})}async function E4(t,e){xw(t),wp(t)?(t.q_.M_(e),Cp(t)):t.q_.set("Unknown")}async function I4(t,e,n){if(t.q_.set("Online"),e instanceof YC&&e.state===2&&e.cause)try{await async function(i,o){const s=o.cause;for(const u of o.targetIds)i.N_.has(u)&&(await i.remoteSyncer.rejectListen(u,s),i.N_.delete(u),i.Q_.removeTarget(u))}(t,e)}catch(r){q("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await wu(t,r)}else if(e instanceof Ba?t.Q_.Ke(e):e instanceof QC?t.Q_.He(e):t.Q_.We(e),!n.isEqual(X.min()))try{const r=await Cw(t.localStore);n.compareTo(r)>=0&&await function(o,s){const u=o.Q_.rt(s);return u.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){const h=o.N_.get(d);h&&o.N_.set(d,h.withResumeToken(c.resumeToken,s))}}),u.targetMismatches.forEach((c,d)=>{const h=o.N_.get(c);if(!h)return;o.N_.set(c,h.withResumeToken(Ge.EMPTY_BYTE_STRING,h.snapshotVersion)),Rw(o,c);const p=new xn(h.target,c,d,h.sequenceNumber);Ip(o,p)}),o.remoteSyncer.applyRemoteEvent(u)}(t,n)}catch(r){q("RemoteStore","Failed to raise snapshot:",r),await wu(t,r)}}async function wu(t,e,n){if(!Sr(e))throw e;t.L_.add(1),await Cl(t),t.q_.set("Offline"),n||(n=()=>Cw(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{q("RemoteStore","Retrying IndexedDB access"),await n(),t.L_.delete(1),await rc(t)})}function Pw(t,e){return e().catch(n=>wu(t,n,e))}async function wl(t){const e=Z(t),n=Tr(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;C4(e);)try{const i=await s4(e.localStore,r);if(i===null){e.O_.length===0&&n.o_();break}r=i.batchId,w4(e,i)}catch(i){await wu(e,i)}Dw(e)&&Mw(e)}function C4(t){return yi(t)&&t.O_.length<10}function w4(t,e){t.O_.push(e);const n=Tr(t);n.r_()&&n.V_&&n.m_(e.mutations)}function Dw(t){return yi(t)&&!Tr(t).n_()&&t.O_.length>0}function Mw(t){Tr(t).start()}async function S4(t){Tr(t).p_()}async function A4(t){const e=Tr(t);for(const n of t.O_)e.m_(n.mutations)}async function R4(t,e,n){const r=t.O_.shift(),i=dp.from(r,e,n);await Pw(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),await wl(t)}async function x4(t,e){e&&Tr(t).V_&&await async function(r,i){if(function(s){return WC(s)&&s!==O.ABORTED}(i.code)){const o=r.O_.shift();Tr(r).s_(),await Pw(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i)),await wl(r)}}(t,e),Dw(t)&&Mw(t)}async function Pv(t,e){const n=Z(t);n.asyncQueue.verifyOperationInProgress(),q("RemoteStore","RemoteStore received new credentials");const r=yi(n);n.L_.add(3),await Cl(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.L_.delete(3),await rc(n)}async function P4(t,e){const n=Z(t);e?(n.L_.delete(2),await rc(n)):e||(n.L_.add(2),await Cl(n),n.q_.set("Unknown"))}function ko(t){return t.K_||(t.K_=function(n,r,i){const o=Z(n);return o.w_(),new p4(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(t.datastore,t.asyncQueue,{Eo:v4.bind(null,t),Ro:T4.bind(null,t),mo:E4.bind(null,t),d_:I4.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),wp(t)?Cp(t):t.q_.set("Unknown")):(await t.K_.stop(),xw(t))})),t.K_}function Tr(t){return t.U_||(t.U_=function(n,r,i){const o=Z(n);return o.w_(),new m4(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:S4.bind(null,t),mo:x4.bind(null,t),f_:A4.bind(null,t),g_:R4.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await wl(t)):(await t.U_.stop(),t.O_.length>0&&(q("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sp{constructor(e,n,r,i,o){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new pn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(s=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,o){const s=Date.now()+r,u=new Sp(e,n,s,i,o);return u.start(r),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new $(O.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ap(t,e){if(_t("AsyncQueue",`${e}: ${t}`),Sr(t))return new $(O.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ro{constructor(e){this.comparator=e?(n,r)=>e(n,r)||H.comparator(n.key,r.key):(n,r)=>H.comparator(n.key,r.key),this.keyedMap=hs(),this.sortedSet=new Se(this.comparator)}static emptySet(e){return new ro(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof ro)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new ro;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dv{constructor(){this.W_=new Se(H.comparator)}track(e){const n=e.doc.key,r=this.W_.get(n);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(n,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(n):e.type===1&&r.type===2?this.W_=this.W_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):Q():this.W_=this.W_.insert(n,e)}G_(){const e=[];return this.W_.inorderTraversal((n,r)=>{e.push(r)}),e}}class Eo{constructor(e,n,r,i,o,s,u,c,d){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=s,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(e,n,r,i,o){const s=[];return n.forEach(u=>{s.push({type:0,doc:u})}),new Eo(e,n,ro.emptySet(n),s,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Qu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D4{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class M4{constructor(){this.queries=Mv(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(n,r){const i=Z(n),o=i.queries;i.queries=Mv(),o.forEach((s,u)=>{for(const c of u.j_)c.onError(r)})})(this,new $(O.ABORTED,"Firestore shutting down"))}}function Mv(){return new Ar(t=>VC(t),Qu)}async function k4(t,e){const n=Z(t);let r=3;const i=e.query;let o=n.queries.get(i);o?!o.H_()&&e.J_()&&(r=2):(o=new D4,r=e.J_()?0:1);try{switch(r){case 0:o.z_=await n.onListen(i,!0);break;case 1:o.z_=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(s){const u=Ap(s,`Initialization of query '${Mi(e.query)}' failed`);return void e.onError(u)}n.queries.set(i,o),o.j_.push(e),e.Z_(n.onlineState),o.z_&&e.X_(o.z_)&&Rp(n)}async function N4(t,e){const n=Z(t),r=e.query;let i=3;const o=n.queries.get(r);if(o){const s=o.j_.indexOf(e);s>=0&&(o.j_.splice(s,1),o.j_.length===0?i=e.J_()?0:1:!o.H_()&&e.J_()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function V4(t,e){const n=Z(t);let r=!1;for(const i of e){const o=i.query,s=n.queries.get(o);if(s){for(const u of s.j_)u.X_(i)&&(r=!0);s.z_=i}}r&&Rp(n)}function L4(t,e,n){const r=Z(t),i=r.queries.get(e);if(i)for(const o of i.j_)o.onError(n);r.queries.delete(e)}function Rp(t){t.Y_.forEach(e=>{e.next()})}var Wf,kv;(kv=Wf||(Wf={})).ea="default",kv.Cache="cache";class F4{constructor(e,n,r){this.query=e,this.ta=n,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new Eo(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.na?this.ia(e)&&(this.ta.next(e),n=!0):this.sa(e,this.onlineState)&&(this.oa(e),n=!0),this.ra=e,n}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let n=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),n=!0),n}sa(e,n){if(!e.fromCache||!this.J_())return!0;const r=n!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const n=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}oa(e){e=Eo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Wf.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kw{constructor(e){this.key=e}}class Nw{constructor(e){this.key=e}}class U4{constructor(e,n){this.query=e,this.Ta=n,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ne(),this.mutatedKeys=ne(),this.Aa=LC(e),this.Ra=new ro(this.Aa)}get Va(){return this.Ta}ma(e,n){const r=n?n.fa:new Dv,i=n?n.Ra:this.Ra;let o=n?n.mutatedKeys:this.mutatedKeys,s=i,u=!1;const c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((h,p)=>{const m=i.get(h),_=Tl(this.query,p)?p:null,S=!!m&&this.mutatedKeys.has(m.key),R=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let M=!1;m&&_?m.data.isEqual(_.data)?S!==R&&(r.track({type:3,doc:_}),M=!0):this.ga(m,_)||(r.track({type:2,doc:_}),M=!0,(c&&this.Aa(_,c)>0||d&&this.Aa(_,d)<0)&&(u=!0)):!m&&_?(r.track({type:0,doc:_}),M=!0):m&&!_&&(r.track({type:1,doc:m}),M=!0,(c||d)&&(u=!0)),M&&(_?(s=s.add(_),o=R?o.add(h):o.delete(h)):(s=s.delete(h),o=o.delete(h)))}),this.query.limit!==null)for(;s.size>this.query.limit;){const h=this.query.limitType==="F"?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{Ra:s,fa:r,ns:u,mutatedKeys:o}}ga(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const o=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const s=e.fa.G_();s.sort((h,p)=>function(_,S){const R=M=>{switch(M){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Q()}};return R(_)-R(S)}(h.type,p.type)||this.Aa(h.doc,p.doc)),this.pa(r),i=i!=null&&i;const u=n&&!i?this.ya():[],c=this.da.size===0&&this.current&&!i?1:0,d=c!==this.Ea;return this.Ea=c,s.length!==0||d?{snapshot:new Eo(this.query,e.Ra,o,s,e.mutatedKeys,c===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:u}:{wa:u}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Dv,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(n=>this.Ta=this.Ta.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ta=this.Ta.delete(n)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=ne(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const n=[];return e.forEach(r=>{this.da.has(r)||n.push(new Nw(r))}),this.da.forEach(r=>{e.has(r)||n.push(new kw(r))}),n}ba(e){this.Ta=e.Ts,this.da=ne();const n=this.ma(e.documents);return this.applyChanges(n,!0)}Da(){return Eo.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class b4{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class B4{constructor(e){this.key=e,this.va=!1}}class O4{constructor(e,n,r,i,o,s){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=s,this.Ca={},this.Fa=new Ar(u=>VC(u),Qu),this.Ma=new Map,this.xa=new Set,this.Oa=new Se(H.comparator),this.Na=new Map,this.La=new yp,this.Ba={},this.ka=new Map,this.qa=si.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function q4(t,e,n=!0){const r=Bw(t);let i;const o=r.Fa.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.Da()):i=await Vw(r,e,n,!0),i}async function G4(t,e){const n=Bw(t);await Vw(n,e,!0,!1)}async function Vw(t,e,n,r){const i=await l4(t.localStore,Wt(e)),o=i.targetId,s=t.sharedClientState.addLocalQueryTarget(o,n);let u;return r&&(u=await $4(t,e,o,s==="current",i.resumeToken)),t.isPrimaryClient&&n&&Aw(t.remoteStore,i),u}async function $4(t,e,n,r,i){t.Ka=(p,m,_)=>async function(R,M,I,T){let C=M.view.ma(I);C.ns&&(C=await Av(R.localStore,M.query,!1).then(({documents:A})=>M.view.ma(A,C)));const k=T&&T.targetChanges.get(M.targetId),F=T&&T.targetMismatches.get(M.targetId)!=null,b=M.view.applyChanges(C,R.isPrimaryClient,k,F);return Vv(R,M.targetId,b.wa),b.snapshot}(t,p,m,_);const o=await Av(t.localStore,e,!0),s=new U4(e,o.Ts),u=s.ma(o.documents),c=Il.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),d=s.applyChanges(u,t.isPrimaryClient,c);Vv(t,n,d.wa);const h=new b4(e,n,s);return t.Fa.set(e,h),t.Ma.has(n)?t.Ma.get(n).push(e):t.Ma.set(n,[e]),d.snapshot}async function z4(t,e,n){const r=Z(t),i=r.Fa.get(e),o=r.Ma.get(i.targetId);if(o.length>1)return r.Ma.set(i.targetId,o.filter(s=>!Qu(s,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Kf(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Ep(r.remoteStore,i.targetId),Jf(r,i.targetId)}).catch(mi)):(Jf(r,i.targetId),await Kf(r.localStore,i.targetId,!0))}async function H4(t,e){const n=Z(t),r=n.Fa.get(e),i=n.Ma.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Ep(n.remoteStore,r.targetId))}async function K4(t,e,n){const r=Ow(t);try{const i=await function(s,u){const c=Z(s),d=Me.now(),h=u.reduce((_,S)=>_.add(S.key),ne());let p,m;return c.persistence.runTransaction("Locally write mutations","readwrite",_=>{let S=Vt(),R=ne();return c.cs.getEntries(_,h).next(M=>{S=M,S.forEach((I,T)=>{T.isValidDocument()||(R=R.add(I))})}).next(()=>c.localDocuments.getOverlayedDocuments(_,S)).next(M=>{p=M;const I=[];for(const T of u){const C=lb(T,p.get(T.key).overlayedDocument);C!=null&&I.push(new On(T.key,C,SC(C.value.mapValue),qe.exists(!0)))}return c.mutationQueue.addMutationBatch(_,d,I,u)}).next(M=>{m=M;const I=M.applyToLocalDocumentSet(p,R);return c.documentOverlayCache.saveOverlays(_,M.batchId,I)})}).then(()=>({batchId:m.batchId,changes:UC(p)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(s,u,c){let d=s.Ba[s.currentUser.toKey()];d||(d=new Se(ee)),d=d.insert(u,c),s.Ba[s.currentUser.toKey()]=d}(r,i.batchId,n),await Sl(r,i.changes),await wl(r.remoteStore)}catch(i){const o=Ap(i,"Failed to persist write");n.reject(o)}}async function Lw(t,e){const n=Z(t);try{const r=await i4(n.localStore,e);e.targetChanges.forEach((i,o)=>{const s=n.Na.get(o);s&&(Y(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?s.va=!0:i.modifiedDocuments.size>0?Y(s.va):i.removedDocuments.size>0&&(Y(s.va),s.va=!1))}),await Sl(n,r,e)}catch(r){await mi(r)}}function Nv(t,e,n){const r=Z(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.Fa.forEach((o,s)=>{const u=s.view.Z_(e);u.snapshot&&i.push(u.snapshot)}),function(s,u){const c=Z(s);c.onlineState=u;let d=!1;c.queries.forEach((h,p)=>{for(const m of p.j_)m.Z_(u)&&(d=!0)}),d&&Rp(c)}(r.eventManager,e),i.length&&r.Ca.d_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function W4(t,e,n){const r=Z(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Na.get(e),o=i&&i.key;if(o){let s=new Se(H.comparator);s=s.insert(o,we.newNoDocument(o,X.min()));const u=ne().add(o),c=new Zu(X.min(),new Map,new Se(ee),s,u);await Lw(r,c),r.Oa=r.Oa.remove(o),r.Na.delete(e),xp(r)}else await Kf(r.localStore,e,!1).then(()=>Jf(r,e,n)).catch(mi)}async function J4(t,e){const n=Z(t),r=e.batch.batchId;try{const i=await r4(n.localStore,e);Uw(n,r,null),Fw(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Sl(n,i)}catch(i){await mi(i)}}async function Q4(t,e,n){const r=Z(t);try{const i=await function(s,u){const c=Z(s);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let h;return c.mutationQueue.lookupMutationBatch(d,u).next(p=>(Y(p!==null),h=p.keys(),c.mutationQueue.removeMutationBatch(d,p))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,h,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,h)).next(()=>c.localDocuments.getDocuments(d,h))})}(r.localStore,e);Uw(r,e,n),Fw(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Sl(r,i)}catch(i){await mi(i)}}function Fw(t,e){(t.ka.get(e)||[]).forEach(n=>{n.resolve()}),t.ka.delete(e)}function Uw(t,e,n){const r=Z(t);let i=r.Ba[r.currentUser.toKey()];if(i){const o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Ba[r.currentUser.toKey()]=i}}function Jf(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Ma.get(e))t.Fa.delete(r),n&&t.Ca.$a(r,n);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(r=>{t.La.containsKey(r)||bw(t,r)})}function bw(t,e){t.xa.delete(e.path.canonicalString());const n=t.Oa.get(e);n!==null&&(Ep(t.remoteStore,n),t.Oa=t.Oa.remove(e),t.Na.delete(n),xp(t))}function Vv(t,e,n){for(const r of n)r instanceof kw?(t.La.addReference(r.key,e),Y4(t,r)):r instanceof Nw?(q("SyncEngine","Document no longer in limbo: "+r.key),t.La.removeReference(r.key,e),t.La.containsKey(r.key)||bw(t,r.key)):Q()}function Y4(t,e){const n=e.key,r=n.path.canonicalString();t.Oa.get(n)||t.xa.has(r)||(q("SyncEngine","New document in limbo: "+n),t.xa.add(r),xp(t))}function xp(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const n=new H(ce.fromString(e)),r=t.qa.next();t.Na.set(r,new B4(n)),t.Oa=t.Oa.insert(n,r),Aw(t.remoteStore,new xn(Wt(lp(n.path)),r,"TargetPurposeLimboResolution",zt.oe))}}async function Sl(t,e,n){const r=Z(t),i=[],o=[],s=[];r.Fa.isEmpty()||(r.Fa.forEach((u,c)=>{s.push(r.Ka(c,e,n).then(d=>{var h;if((d||n)&&r.isPrimaryClient){const p=d?!d.fromCache:(h=n==null?void 0:n.targetChanges.get(c.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(c.targetId,p?"current":"not-current")}if(d){i.push(d);const p=vp.Wi(c.targetId,d);o.push(p)}}))}),await Promise.all(s),r.Ca.d_(i),await async function(c,d){const h=Z(c);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>L.forEach(d,m=>L.forEach(m.$i,_=>h.persistence.referenceDelegate.addReference(p,m.targetId,_)).next(()=>L.forEach(m.Ui,_=>h.persistence.referenceDelegate.removeReference(p,m.targetId,_)))))}catch(p){if(!Sr(p))throw p;q("LocalStore","Failed to update sequence numbers: "+p)}for(const p of d){const m=p.targetId;if(!p.fromCache){const _=h.os.get(m),S=_.snapshotVersion,R=_.withLastLimboFreeSnapshotVersion(S);h.os=h.os.insert(m,R)}}}(r.localStore,o))}async function X4(t,e){const n=Z(t);if(!n.currentUser.isEqual(e)){q("SyncEngine","User change. New user:",e.toKey());const r=await Iw(n.localStore,e);n.currentUser=e,function(o,s){o.ka.forEach(u=>{u.forEach(c=>{c.reject(new $(O.CANCELLED,s))})}),o.ka.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Sl(n,r.hs)}}function Z4(t,e){const n=Z(t),r=n.Na.get(e);if(r&&r.va)return ne().add(r.key);{let i=ne();const o=n.Ma.get(e);if(!o)return i;for(const s of o){const u=n.Fa.get(s);i=i.unionWith(u.view.Va)}return i}}function Bw(t){const e=Z(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Lw.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Z4.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=W4.bind(null,e),e.Ca.d_=V4.bind(null,e.eventManager),e.Ca.$a=L4.bind(null,e.eventManager),e}function Ow(t){const e=Z(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=J4.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Q4.bind(null,e),e}class cl{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=nc(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,n){return null}Ha(e,n){return null}za(e){return Ew(this.persistence,new Tw,e.initialUser,this.serializer)}Ga(e){return new vw(tc.Zr,this.serializer)}Wa(e){return new ww}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}cl.provider={build:()=>new cl};class j4 extends cl{constructor(e,n,r){super(),this.Ja=e,this.cacheSizeBytes=n,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await Ow(this.Ja.syncEngine),await wl(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return Ew(this.persistence,new Tw,e.initialUser,this.serializer)}ja(e,n){const r=this.persistence.referenceDelegate.garbageCollector;return new bb(r,e.asyncQueue,n)}Ha(e,n){const r=new hU(n,this.persistence);return new fU(e.asyncQueue,r)}Ga(e){const n=e4(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Ct.withCacheSize(this.cacheSizeBytes):Ct.DEFAULT;return new _p(this.synchronizeTabs,n,e.clientId,r,e.asyncQueue,h4(),Oa(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new ww}}class Su{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Nv(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=X4.bind(null,this.syncEngine),await P4(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new M4}()}createDatastore(e){const n=nc(e.databaseInfo.databaseId),r=function(o){return new f4(o)}(e.databaseInfo);return function(o,s,u,c){return new g4(o,s,u,c)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,i,o,s,u){return new _4(r,i,o,s,u)}(this.localStore,this.datastore,e.asyncQueue,n=>Nv(this.syncEngine,n,0),function(){return xv.D()?new xv:new u4}())}createSyncEngine(e,n){return function(i,o,s,u,c,d,h){const p=new O4(i,o,s,u,c,d);return h&&(p.Qa=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(i){const o=Z(i);q("RemoteStore","RemoteStore shutting down."),o.L_.add(5),await Cl(o),o.k_.shutdown(),o.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}Su.provider={build:()=>new Su};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eB{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):_t("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tB{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new $(O.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const n=await async function(i,o){const s=Z(i),u={documents:o.map(p=>al(s.serializer,p))},c=await s.Lo("BatchGetDocuments",s.serializer.databaseId,ce.emptyPath(),u,o.length),d=new Map;c.forEach(p=>{const m=_b(s.serializer,p);d.set(m.key.toString(),m)});const h=[];return o.forEach(p=>{const m=d.get(p.toString());Y(!!m),h.push(m)}),h}(this.datastore,e);return n.forEach(r=>this.recordVersion(r)),n}set(e,n){this.write(n.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,n){try{this.write(n.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new El(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(n=>{e.delete(n.key.toString())}),e.forEach((n,r)=>{const i=H.fromPath(r);this.mutations.push(new up(i,this.precondition(i)))}),await async function(r,i){const o=Z(r),s={writes:i.map(u=>ul(o.serializer,u))};await o.Mo("Commit",o.serializer.databaseId,ce.emptyPath(),s)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let n;if(e.isFoundDocument())n=e.version;else{if(!e.isNoDocument())throw Q();n=X.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!n.isEqual(r))throw new $(O.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),n)}precondition(e){const n=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&n?n.isEqual(X.min())?qe.exists(!1):qe.updateTime(n):qe.none()}preconditionForUpdate(e){const n=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&n){if(n.isEqual(X.min()))throw new $(O.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return qe.updateTime(n)}return qe.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nB{constructor(e,n,r,i,o){this.asyncQueue=e,this.datastore=n,this.options=r,this.updateFunction=i,this.deferred=o,this._u=r.maxAttempts,this.t_=new Tp(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new tB(this.datastore),n=this.cu(e);n&&n.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.lu(i)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const n=this.updateFunction(e);return!_l(n)&&n.catch&&n.then?n:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(n){return this.deferred.reject(n),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const n=e.code;return n==="aborted"||n==="failed-precondition"||n==="already-exists"||!WC(n)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rB{constructor(e,n,r,i,o){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=je.UNAUTHENTICATED,this.clientId=dC.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,async s=>{q("FirestoreClient","Received user=",s.uid),await this.authCredentialListener(s),this.user=s}),this.appCheckCredentials.start(r,s=>(q("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new pn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=Ap(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function gd(t,e){t.asyncQueue.verifyOperationInProgress(),q("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async i=>{r.isEqual(i)||(await Iw(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function Lv(t,e){t.asyncQueue.verifyOperationInProgress();const n=await iB(t);q("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>Pv(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,i)=>Pv(e.remoteStore,i)),t._onlineComponents=e}async function iB(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){q("FirestoreClient","Using user provided OfflineComponentProvider");try{await gd(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(i){return i.name==="FirebaseError"?i.code===O.FAILED_PRECONDITION||i.code===O.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(n))throw n;ei("Error using user provided cache. Falling back to memory cache: "+n),await gd(t,new cl)}}else q("FirestoreClient","Using default OfflineComponentProvider"),await gd(t,new cl);return t._offlineComponents}async function Pp(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(q("FirestoreClient","Using user provided OnlineComponentProvider"),await Lv(t,t._uninitializedComponentsProvider._online)):(q("FirestoreClient","Using default OnlineComponentProvider"),await Lv(t,new Su))),t._onlineComponents}function oB(t){return Pp(t).then(e=>e.syncEngine)}function sB(t){return Pp(t).then(e=>e.datastore)}async function lB(t){const e=await Pp(t),n=e.eventManager;return n.onListen=q4.bind(null,e.syncEngine),n.onUnlisten=z4.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=G4.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=H4.bind(null,e.syncEngine),n}function aB(t,e,n={}){const r=new pn;return t.asyncQueue.enqueueAndForget(async()=>function(o,s,u,c,d){const h=new eB({next:m=>{h.Za(),s.enqueueAndForget(()=>N4(o,p)),m.fromCache&&c.source==="server"?d.reject(new $(O.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(m)},error:m=>d.reject(m)}),p=new F4(u,h,{includeMetadataChanges:!0,_a:!0});return k4(o,p)}(await lB(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qw(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fv=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gw(t,e,n){if(!n)throw new $(O.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function uB(t,e,n,r){if(e===!0&&r===!0)throw new $(O.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Uv(t){if(!H.isDocumentKey(t))throw new $(O.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function bv(t){if(H.isDocumentKey(t))throw new $(O.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function ic(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Q()}function Un(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new $(O.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ic(t);throw new $(O.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bv{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new $(O.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new $(O.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}uB("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=qw((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new $(O.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new $(O.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new $(O.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class oc{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Bv({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new $(O.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new $(O.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Bv(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new eU;switch(r.type){case"firstParty":return new iU(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new $(O.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=Fv.get(n);r&&(q("ComponentProvider","Removing Datastore"),Fv.delete(n),r.terminate())}(this),Promise.resolve()}}function cB(t,e,n,r={}){var i;const o=(t=Un(t,oc))._getSettings(),s=`${e}:${n}`;if(o.host!=="firestore.googleapis.com"&&o.host!==s&&ei("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},o),{host:s,ssl:!1})),r.mockUserToken){let u,c;if(typeof r.mockUserToken=="string")u=r.mockUserToken,c=je.MOCK_USER;else{u=HI(r.mockUserToken,(i=t._app)===null||i===void 0?void 0:i.options.projectId);const d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new $(O.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new je(d)}t._authCredentials=new tU(new cC(u,c))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new _i(this.firestore,e,this._query)}}class Dt{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new mr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Dt(this.firestore,e,this._key)}}class mr extends _i{constructor(e,n,r){super(e,n,lp(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Dt(this.firestore,null,new H(e))}withConverter(e){return new mr(this.firestore,e,this._path)}}function sc(t,e,...n){if(t=ht(t),Gw("collection","path",e),t instanceof oc){const r=ce.fromString(e,...n);return bv(r),new mr(t,null,r)}{if(!(t instanceof Dt||t instanceof mr))throw new $(O.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ce.fromString(e,...n));return bv(r),new mr(t.firestore,null,r)}}function dl(t,e,...n){if(t=ht(t),arguments.length===1&&(e=dC.newId()),Gw("doc","path",e),t instanceof oc){const r=ce.fromString(e,...n);return Uv(r),new Dt(t,null,new H(r))}{if(!(t instanceof Dt||t instanceof mr))throw new $(O.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ce.fromString(e,...n));return Uv(r),new Dt(t.firestore,t instanceof mr?t.converter:null,new H(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ov{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Tp(this,"async_queue_retry"),this.Vu=()=>{const r=Oa();r&&q("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const n=Oa();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const n=Oa();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const n=new pn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Sr(e))throw e;q("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const n=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const i=function(s){let u=s.message||"";return s.stack&&(u=s.stack.includes(s.message)?s.stack:s.message+`
`+s.stack),u}(r);throw _t("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.du=!1,r))));return this.mu=n,n}enqueueAfterDelay(e,n,r){this.fu(),this.Ru.indexOf(e)>-1&&(n=0);const i=Sp.createAndSchedule(this,e,n,r,o=>this.yu(o));return this.Tu.push(i),i}fu(){this.Eu&&Q()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const n of this.Tu)if(n.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.Tu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const n=this.Tu.indexOf(e);this.Tu.splice(n,1)}}class vi extends oc{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new Ov,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Ov(e),this._firestoreClient=void 0,await e}}}function dB(t,e){const n=typeof t=="object"?t:tC(),r=typeof t=="string"?t:"(default)",i=ZI(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const o=$I("firestore");o&&cB(i,...o)}return i}function Dp(t){if(t._terminated)throw new $(O.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||$w(t),t._firestoreClient}function $w(t){var e,n,r;const i=t._freezeSettings(),o=function(u,c,d,h){return new LU(u,c,d,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,qw(h.experimentalLongPollingOptions),h.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,i);t._componentsProvider||!((n=i.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),t._firestoreClient=new rB(t._authCredentials,t._appCheckCredentials,t._queue,o,t._componentsProvider&&function(u){const c=u==null?void 0:u._online.build();return{_offline:u==null?void 0:u._offline.build(c),_online:c}}(t._componentsProvider))}function fB(t,e){ei("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=t._freezeSettings();return hB(t,Su.provider,{build:r=>new j4(r,n.cacheSizeBytes,void 0)}),Promise.resolve()}function hB(t,e,n){if((t=Un(t,vi))._firestoreClient||t._terminated)throw new $(O.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(t._componentsProvider||t._getSettings().localCache)throw new $(O.FAILED_PRECONDITION,"SDK cache is already specified.");t._componentsProvider={_online:e,_offline:n},$w(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class li{constructor(e){this._byteString=e}static fromBase64String(e){try{return new li(Ge.fromBase64String(e))}catch(n){throw new $(O.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new li(Ge.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Al{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new $(O.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Pe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lc{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mp{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new $(O.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new $(O.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ee(this._lat,e._lat)||ee(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kp{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pB=/^__.*__$/;class mB{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new On(e,this.data,this.fieldMask,n,this.fieldTransforms):new Mo(e,this.data,n,this.fieldTransforms)}}class zw{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new On(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function Hw(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Q()}}class Np{constructor(e,n,r,i,o,s){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.vu(),this.fieldTransforms=o||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Np(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.Fu({path:r,xu:!1});return i.Ou(e),i}Nu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.Fu({path:r,xu:!1});return i.vu(),i}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Au(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Hw(this.Cu)&&pB.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class gB{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||nc(e)}Qu(e,n,r,i=!1){return new Np({Cu:e,methodName:n,qu:r,path:Pe.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ac(t){const e=t._freezeSettings(),n=nc(t._databaseId);return new gB(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Kw(t,e,n,r,i,o={}){const s=t.Qu(o.merge||o.mergeFields?2:0,e,n,i);Lp("Data must be an object, but it was:",s,r);const u=Qw(r,s);let c,d;if(o.merge)c=new At(s.fieldMask),d=s.fieldTransforms;else if(o.mergeFields){const h=[];for(const p of o.mergeFields){const m=Qf(e,p,n);if(!s.contains(m))throw new $(O.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);Xw(h,m)||h.push(m)}c=new At(h),d=s.fieldTransforms.filter(p=>c.covers(p.field))}else c=null,d=s.fieldTransforms;return new mB(new tt(u),c,d)}class uc extends lc{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof uc}}class Vp extends lc{_toFieldTransform(e){return new zC(e.path,new yo)}isEqual(e){return e instanceof Vp}}function Ww(t,e,n,r){const i=t.Qu(1,e,n);Lp("Data must be an object, but it was:",i,r);const o=[],s=tt.empty();gi(r,(c,d)=>{const h=Fp(e,c,n);d=ht(d);const p=i.Nu(h);if(d instanceof uc)o.push(h);else{const m=Rl(d,p);m!=null&&(o.push(h),s.set(h,m))}});const u=new At(o);return new zw(s,u,i.fieldTransforms)}function Jw(t,e,n,r,i,o){const s=t.Qu(1,e,n),u=[Qf(e,r,n)],c=[i];if(o.length%2!=0)throw new $(O.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<o.length;m+=2)u.push(Qf(e,o[m])),c.push(o[m+1]);const d=[],h=tt.empty();for(let m=u.length-1;m>=0;--m)if(!Xw(d,u[m])){const _=u[m];let S=c[m];S=ht(S);const R=s.Nu(_);if(S instanceof uc)d.push(_);else{const M=Rl(S,R);M!=null&&(d.push(_),h.set(_,M))}}const p=new At(d);return new zw(h,p,s.fieldTransforms)}function yB(t,e,n,r=!1){return Rl(n,t.Qu(r?4:3,e))}function Rl(t,e){if(Yw(t=ht(t)))return Lp("Unsupported field value:",e,t),Qw(t,e);if(t instanceof lc)return function(r,i){if(!Hw(i.Cu))throw i.Bu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Bu(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,i){const o=[];let s=0;for(const u of r){let c=Rl(u,i.Lu(s));c==null&&(c={nullValue:"NULL_VALUE"}),o.push(c),s++}return{arrayValue:{values:o}}}(t,e)}return function(r,i){if((r=ht(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return tb(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Me.fromDate(r);return{timestampValue:To(i.serializer,o)}}if(r instanceof Me){const o=new Me(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:To(i.serializer,o)}}if(r instanceof Mp)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof li)return{bytesValue:XC(i.serializer,r._byteString)};if(r instanceof Dt){const o=i.databaseId,s=r.firestore._databaseId;if(!s.isEqual(o))throw i.Bu(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:pp(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof kp)return function(s,u){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:s.toArray().map(c=>{if(typeof c!="number")throw u.Bu("VectorValues must only contain numeric values.");return ap(u.serializer,c)})}}}}}}(r,i);throw i.Bu(`Unsupported field value: ${ic(r)}`)}(t,e)}function Qw(t,e){const n={};return EC(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):gi(t,(r,i)=>{const o=Rl(i,e.Mu(r));o!=null&&(n[r]=o)}),{mapValue:{fields:n}}}function Yw(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Me||t instanceof Mp||t instanceof li||t instanceof Dt||t instanceof lc||t instanceof kp)}function Lp(t,e,n){if(!Yw(n)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(n)){const r=ic(n);throw r==="an object"?e.Bu(t+" a custom object"):e.Bu(t+" "+r)}}function Qf(t,e,n){if((e=ht(e))instanceof Al)return e._internalPath;if(typeof e=="string")return Fp(t,e);throw Au("Field path arguments must be of type string or ",t,!1,void 0,n)}const _B=new RegExp("[~\\*/\\[\\]]");function Fp(t,e,n){if(e.search(_B)>=0)throw Au(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Al(...e.split("."))._internalPath}catch{throw Au(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Au(t,e,n,r,i){const o=r&&!r.isEmpty(),s=i!==void 0;let u=`Function ${e}() called with invalid data`;n&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(o||s)&&(c+=" (found",o&&(c+=` in field ${r}`),s&&(c+=` in document ${i}`),c+=")"),new $(O.INVALID_ARGUMENT,u+t+c)}function Xw(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ru{constructor(e,n,r,i,o){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Dt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new vB(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Up("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class vB extends Ru{data(){return super.data()}}function Up(t,e){return typeof e=="string"?Fp(t,e):e instanceof Al?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TB(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new $(O.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class bp{}class Zw extends bp{}function jw(t,e,...n){let r=[];e instanceof bp&&r.push(e),r=r.concat(n),function(o){const s=o.filter(c=>c instanceof Op).length,u=o.filter(c=>c instanceof Bp).length;if(s>1||s>0&&u>0)throw new $(O.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)t=i._apply(t);return t}class Bp extends Zw{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new Bp(e,n,r)}_apply(e){const n=this._parse(e);return t0(e._query,n),new _i(e.firestore,e.converter,Uf(e._query,n))}_parse(e){const n=ac(e.firestore);return function(o,s,u,c,d,h,p){let m;if(d.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new $(O.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){Gv(p,h);const _=[];for(const S of p)_.push(qv(c,o,S));m={arrayValue:{values:_}}}else m=qv(c,o,p)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||Gv(p,h),m=yB(u,s,p,h==="in"||h==="not-in");return ie.create(d,h,m)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}class Op extends bp{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new Op(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:fe.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(i,o){let s=i;const u=o.getFlattenedFilters();for(const c of u)t0(s,c),s=Uf(s,c)}(e._query,n),new _i(e.firestore,e.converter,Uf(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class qp extends Zw{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new qp(e,n)}_apply(e){const n=function(i,o,s){if(i.startAt!==null)throw new $(O.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new $(O.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new sl(o,s)}(e._query,this._field,this._direction);return new _i(e.firestore,e.converter,function(i,o){const s=i.explicitOrderBy.concat([o]);return new Do(i.path,i.collectionGroup,s,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,n))}}function e0(t,e="asc"){const n=e,r=Up("orderBy",t);return qp._create(r,n)}function qv(t,e,n){if(typeof(n=ht(n))=="string"){if(n==="")throw new $(O.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!NC(e)&&n.indexOf("/")!==-1)throw new $(O.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(ce.fromString(n));if(!H.isDocumentKey(r))throw new $(O.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return il(t,new H(r))}if(n instanceof Dt)return il(t,n._key);throw new $(O.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ic(n)}.`)}function Gv(t,e){if(!Array.isArray(t)||t.length===0)throw new $(O.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function t0(t,e){const n=function(i,o){for(const s of i)for(const u of s.getFlattenedFilters())if(o.indexOf(u.op)>=0)return u.op;return null}(t.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new $(O.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new $(O.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class n0{convertValue(e,n="none"){switch(ni(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ie(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(_r(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Q()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return gi(e,(i,o)=>{r[i]=this.convertValue(o,n)}),r}convertVectorValue(e){var n,r,i;const o=(i=(r=(n=e.fields)===null||n===void 0?void 0:n.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(s=>Ie(s.doubleValue));return new kp(o)}convertGeoPoint(e){return new Mp(Ie(e.latitude),Ie(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=op(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(nl(e));default:return null}}convertTimestamp(e){const n=Fn(e);return new Me(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=ce.fromString(e);Y(lw(r));const i=new ti(r.get(1),r.get(3)),o=new H(r.popFirst(5));return i.isEqual(n)||_t(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r0(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class EB extends n0{constructor(e){super(),this.firestore=e}convertBytes(e){return new li(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Dt(this.firestore,null,n)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class i0 extends Ru{constructor(e,n,r,i,o,s){super(e,n,r,i,s),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new qa(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Up("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class qa extends i0{data(e={}){return super.data(e)}}class IB{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new gs(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new qa(this._firestore,this._userDataWriter,r.key,r,new gs(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new $(O.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(i,o){if(i._snapshot.oldDocs.isEmpty()){let s=0;return i._snapshot.docChanges.map(u=>{const c=new qa(i._firestore,i._userDataWriter,u.doc.key,u.doc,new gs(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:c,oldIndex:-1,newIndex:s++}})}{let s=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>o||u.type!==3).map(u=>{const c=new qa(i._firestore,i._userDataWriter,u.doc.key,u.doc,new gs(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let d=-1,h=-1;return u.type!==0&&(d=s.indexOf(u.doc.key),s=s.delete(u.doc.key)),u.type!==1&&(s=s.add(u.doc),h=s.indexOf(u.doc.key)),{type:CB(u.type),doc:c,oldIndex:d,newIndex:h}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function CB(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Q()}}class o0 extends n0{constructor(e){super(),this.firestore=e}convertBytes(e){return new li(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Dt(this.firestore,null,n)}}function s0(t){t=Un(t,_i);const e=Un(t.firestore,vi),n=Dp(e),r=new o0(e);return TB(t._query),aB(n,t._query).then(i=>new IB(e,r,t,i))}function wB(t,e,n,...r){t=Un(t,Dt);const i=Un(t.firestore,vi),o=ac(i);let s;return s=typeof(e=ht(e))=="string"||e instanceof Al?Jw(o,"updateDoc",t._key,e,n,r):Ww(o,"updateDoc",t._key,e),Gp(i,[s.toMutation(t._key,qe.exists(!0))])}function SB(t){return Gp(Un(t.firestore,vi),[new El(t._key,qe.none())])}function AB(t,e){const n=Un(t.firestore,vi),r=dl(t),i=r0(t.converter,e);return Gp(n,[Kw(ac(t.firestore),"addDoc",r._key,i,t.converter!==null,{}).toMutation(r._key,qe.exists(!1))]).then(()=>r)}function Gp(t,e){return function(r,i){const o=new pn;return r.asyncQueue.enqueueAndForget(async()=>K4(await oB(r),i,o)),o.promise}(Dp(t),e)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RB={maxAttempts:5};function ss(t,e){if((t=ht(t)).firestore!==e)throw new $(O.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xB extends class{constructor(n,r){this._firestore=n,this._transaction=r,this._dataReader=ac(n)}get(n){const r=ss(n,this._firestore),i=new EB(this._firestore);return this._transaction.lookup([r._key]).then(o=>{if(!o||o.length!==1)return Q();const s=o[0];if(s.isFoundDocument())return new Ru(this._firestore,i,s.key,s,r.converter);if(s.isNoDocument())return new Ru(this._firestore,i,r._key,null,r.converter);throw Q()})}set(n,r,i){const o=ss(n,this._firestore),s=r0(o.converter,r,i),u=Kw(this._dataReader,"Transaction.set",o._key,s,o.converter!==null,i);return this._transaction.set(o._key,u),this}update(n,r,i,...o){const s=ss(n,this._firestore);let u;return u=typeof(r=ht(r))=="string"||r instanceof Al?Jw(this._dataReader,"Transaction.update",s._key,r,i,o):Ww(this._dataReader,"Transaction.update",s._key,r),this._transaction.update(s._key,u),this}delete(n){const r=ss(n,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,n){super(e,n),this._firestore=e}get(e){const n=ss(e,this._firestore),r=new o0(this._firestore);return super.get(e).then(i=>new i0(this._firestore,r,n._key,i._document,new gs(!1,!1),n.converter))}}function PB(t,e,n){t=Un(t,vi);const r=Object.assign(Object.assign({},RB),n);return function(o){if(o.maxAttempts<1)throw new $(O.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(o,s,u){const c=new pn;return o.asyncQueue.enqueueAndForget(async()=>{const d=await sB(o);new nB(o.asyncQueue,d,u,s,c).au()}),c.promise}(Dp(t),i=>e(new xB(t,i)),r)}function l0(){return new Vp("serverTimestamp")}(function(e,n=!0){(function(i){Po=i})(jI),Xs(new fo("firestore",(r,{instanceIdentifier:i,options:o})=>{const s=r.getProvider("app").getImmediate(),u=new vi(new nU(r.getProvider("auth-internal")),new sU(r.getProvider("app-check-internal")),function(d,h){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new $(O.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ti(d.options.projectId,h)}(s,i),s);return o=Object.assign({useFetchStreams:n},o),u._setSettings(o),u},"PUBLIC").setMultipleInstances(!0)),hr(L_,"4.7.3",e),hr(L_,"4.7.3","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a0="firebasestorage.googleapis.com",u0="storageBucket",DB=2*60*1e3,MB=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fe extends pi{constructor(e,n,r=0){super(yd(e),`Firebase Storage: ${n} (${yd(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Fe.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return yd(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Le;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Le||(Le={}));function yd(t){return"storage/"+t}function $p(){const t="An unknown error occurred, please check the error payload for server response.";return new Fe(Le.UNKNOWN,t)}function kB(t){return new Fe(Le.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function NB(t){return new Fe(Le.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function VB(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Fe(Le.UNAUTHENTICATED,t)}function LB(){return new Fe(Le.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function FB(t){return new Fe(Le.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function UB(){return new Fe(Le.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function bB(){return new Fe(Le.CANCELED,"User canceled the upload/download.")}function BB(t){return new Fe(Le.INVALID_URL,"Invalid URL '"+t+"'.")}function OB(t){return new Fe(Le.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function qB(){return new Fe(Le.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+u0+"' property when initializing the app?")}function GB(){return new Fe(Le.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function $B(){return new Fe(Le.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function zB(t){return new Fe(Le.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Yf(t){return new Fe(Le.INVALID_ARGUMENT,t)}function c0(){return new Fe(Le.APP_DELETED,"The Firebase app was deleted.")}function HB(t){return new Fe(Le.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function ks(t,e){return new Fe(Le.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function ls(t){throw new Fe(Le.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lt{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let r;try{r=Lt.makeFromUrl(e,n)}catch{return new Lt(e,"")}if(r.path==="")return r;throw OB(e)}static makeFromUrl(e,n){let r=null;const i="([A-Za-z0-9.\\-_]+)";function o(k){k.path.charAt(k.path.length-1)==="/"&&(k.path_=k.path_.slice(0,-1))}const s="(/(.*))?$",u=new RegExp("^gs://"+i+s,"i"),c={bucket:1,path:3};function d(k){k.path_=decodeURIComponent(k.path)}const h="v[A-Za-z0-9_]+",p=n.replace(/[.]/g,"\\."),m="(/([^?#]*).*)?$",_=new RegExp(`^https?://${p}/${h}/b/${i}/o${m}`,"i"),S={bucket:1,path:3},R=n===a0?"(?:storage.googleapis.com|storage.cloud.google.com)":n,M="([^?#]*)",I=new RegExp(`^https?://${R}/${i}/${M}`,"i"),C=[{regex:u,indices:c,postModify:o},{regex:_,indices:S,postModify:d},{regex:I,indices:{bucket:1,path:2},postModify:d}];for(let k=0;k<C.length;k++){const F=C[k],b=F.regex.exec(e);if(b){const A=b[F.indices.bucket];let v=b[F.indices.path];v||(v=""),r=new Lt(A,v),F.postModify(r);break}}if(r==null)throw BB(e);return r}}class KB{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WB(t,e,n){let r=1,i=null,o=null,s=!1,u=0;function c(){return u===2}let d=!1;function h(...M){d||(d=!0,e.apply(null,M))}function p(M){i=setTimeout(()=>{i=null,t(_,c())},M)}function m(){o&&clearTimeout(o)}function _(M,...I){if(d){m();return}if(M){m(),h.call(null,M,...I);return}if(c()||s){m(),h.call(null,M,...I);return}r<64&&(r*=2);let C;u===1?(u=2,C=0):C=(r+Math.random())*1e3,p(C)}let S=!1;function R(M){S||(S=!0,m(),!d&&(i!==null?(M||(u=2),clearTimeout(i),p(0)):M||(u=1)))}return p(0),o=setTimeout(()=>{s=!0,R(!0)},n),R}function JB(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QB(t){return t!==void 0}function YB(t){return typeof t=="object"&&!Array.isArray(t)}function zp(t){return typeof t=="string"||t instanceof String}function $v(t){return Hp()&&t instanceof Blob}function Hp(){return typeof Blob<"u"}function zv(t,e,n,r){if(r<e)throw Yf(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw Yf(`Invalid value for '${t}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cc(t,e,n){let r=e;return n==null&&(r=`https://${e}`),`${n}://${r}/v0${t}`}function d0(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){const i=e(r)+"="+e(t[r]);n=n+i+"&"}return n=n.slice(0,-1),n}var Kr;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(Kr||(Kr={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XB(t,e){const n=t>=500&&t<600,i=[408,429].indexOf(t)!==-1,o=e.indexOf(t)!==-1;return n||i||o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZB{constructor(e,n,r,i,o,s,u,c,d,h,p,m=!0){this.url_=e,this.method_=n,this.headers_=r,this.body_=i,this.successCodes_=o,this.additionalRetryCodes_=s,this.callback_=u,this.errorCallback_=c,this.timeout_=d,this.progressCallback_=h,this.connectionFactory_=p,this.retry=m,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((_,S)=>{this.resolve_=_,this.reject_=S,this.start_()})}start_(){const e=(r,i)=>{if(i){r(!1,new ya(!1,null,!0));return}const o=this.connectionFactory_();this.pendingConnection_=o;const s=u=>{const c=u.loaded,d=u.lengthComputable?u.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,d)};this.progressCallback_!==null&&o.addUploadProgressListener(s),o.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&o.removeUploadProgressListener(s),this.pendingConnection_=null;const u=o.getErrorCode()===Kr.NO_ERROR,c=o.getStatus();if(!u||XB(c,this.additionalRetryCodes_)&&this.retry){const h=o.getErrorCode()===Kr.ABORT;r(!1,new ya(!1,null,h));return}const d=this.successCodes_.indexOf(c)!==-1;r(!0,new ya(d,o))})},n=(r,i)=>{const o=this.resolve_,s=this.reject_,u=i.connection;if(i.wasSuccessCode)try{const c=this.callback_(u,u.getResponse());QB(c)?o(c):o()}catch(c){s(c)}else if(u!==null){const c=$p();c.serverResponse=u.getErrorText(),this.errorCallback_?s(this.errorCallback_(u,c)):s(c)}else if(i.canceled){const c=this.appDelete_?c0():bB();s(c)}else{const c=UB();s(c)}};this.canceled_?n(!1,new ya(!1,null,!0)):this.backoffId_=WB(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&JB(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class ya{constructor(e,n,r){this.wasSuccessCode=e,this.connection=n,this.canceled=!!r}}function jB(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function eO(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function tO(t,e){e&&(t["X-Firebase-GMPID"]=e)}function nO(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function rO(t,e,n,r,i,o,s=!0){const u=d0(t.urlParams),c=t.url+u,d=Object.assign({},t.headers);return tO(d,e),jB(d,n),eO(d,o),nO(d,r),new ZB(c,t.method,d,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iO(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function oO(...t){const e=iO();if(e!==void 0){const n=new e;for(let r=0;r<t.length;r++)n.append(t[r]);return n.getBlob()}else{if(Hp())return new Blob(t);throw new Fe(Le.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function sO(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lO(t){if(typeof atob>"u")throw zB("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dn={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class _d{constructor(e,n){this.data=e,this.contentType=n||null}}function aO(t,e){switch(t){case dn.RAW:return new _d(f0(e));case dn.BASE64:case dn.BASE64URL:return new _d(h0(t,e));case dn.DATA_URL:return new _d(cO(e),dO(e))}throw $p()}function f0(t){const e=[];for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(n<t.length-1&&(t.charCodeAt(n+1)&64512)===56320))e.push(239,191,189);else{const o=r,s=t.charCodeAt(++n);r=65536|(o&1023)<<10|s&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function uO(t){let e;try{e=decodeURIComponent(t)}catch{throw ks(dn.DATA_URL,"Malformed data URL.")}return f0(e)}function h0(t,e){switch(t){case dn.BASE64:{const i=e.indexOf("-")!==-1,o=e.indexOf("_")!==-1;if(i||o)throw ks(t,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case dn.BASE64URL:{const i=e.indexOf("+")!==-1,o=e.indexOf("/")!==-1;if(i||o)throw ks(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=lO(e)}catch(i){throw i.message.includes("polyfill")?i:ks(t,"Invalid character found")}const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}class p0{constructor(e){this.base64=!1,this.contentType=null;const n=e.match(/^data:([^,]+)?,/);if(n===null)throw ks(dn.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;r!=null&&(this.base64=fO(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function cO(t){const e=new p0(t);return e.base64?h0(dn.BASE64,e.rest):uO(e.rest)}function dO(t){return new p0(t).contentType}function fO(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zn{constructor(e,n){let r=0,i="";$v(e)?(this.data_=e,r=e.size,i=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,n){if($v(this.data_)){const r=this.data_,i=sO(r,e,n);return i===null?null:new Zn(i)}else{const r=new Uint8Array(this.data_.buffer,e,n-e);return new Zn(r,!0)}}static getBlob(...e){if(Hp()){const n=e.map(r=>r instanceof Zn?r.data_:r);return new Zn(oO.apply(null,n))}else{const n=e.map(s=>zp(s)?aO(dn.RAW,s).data:s.data_);let r=0;n.forEach(s=>{r+=s.byteLength});const i=new Uint8Array(r);let o=0;return n.forEach(s=>{for(let u=0;u<s.length;u++)i[o++]=s[u]}),new Zn(i,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m0(t){let e;try{e=JSON.parse(t)}catch{return null}return YB(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hO(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function pO(t,e){const n=e.split("/").filter(r=>r.length>0).join("/");return t.length===0?n:t+"/"+n}function g0(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mO(t,e){return e}class gt{constructor(e,n,r,i){this.server=e,this.local=n||e,this.writable=!!r,this.xform=i||mO}}let _a=null;function gO(t){return!zp(t)||t.length<2?t:g0(t)}function y0(){if(_a)return _a;const t=[];t.push(new gt("bucket")),t.push(new gt("generation")),t.push(new gt("metageneration")),t.push(new gt("name","fullPath",!0));function e(o,s){return gO(s)}const n=new gt("name");n.xform=e,t.push(n);function r(o,s){return s!==void 0?Number(s):s}const i=new gt("size");return i.xform=r,t.push(i),t.push(new gt("timeCreated")),t.push(new gt("updated")),t.push(new gt("md5Hash",null,!0)),t.push(new gt("cacheControl",null,!0)),t.push(new gt("contentDisposition",null,!0)),t.push(new gt("contentEncoding",null,!0)),t.push(new gt("contentLanguage",null,!0)),t.push(new gt("contentType",null,!0)),t.push(new gt("metadata","customMetadata",!0)),_a=t,_a}function yO(t,e){function n(){const r=t.bucket,i=t.fullPath,o=new Lt(r,i);return e._makeStorageReference(o)}Object.defineProperty(t,"ref",{get:n})}function _O(t,e,n){const r={};r.type="file";const i=n.length;for(let o=0;o<i;o++){const s=n[o];r[s.local]=s.xform(r,e[s.server])}return yO(r,t),r}function _0(t,e,n){const r=m0(e);return r===null?null:_O(t,r,n)}function vO(t,e,n,r){const i=m0(e);if(i===null||!zp(i.downloadTokens))return null;const o=i.downloadTokens;if(o.length===0)return null;const s=encodeURIComponent;return o.split(",").map(d=>{const h=t.bucket,p=t.fullPath,m="/b/"+s(h)+"/o/"+s(p),_=cc(m,n,r),S=d0({alt:"media",token:d});return _+S})[0]}function TO(t,e){const n={},r=e.length;for(let i=0;i<r;i++){const o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}class Kp{constructor(e,n,r,i){this.url=e,this.method=n,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v0(t){if(!t)throw $p()}function EO(t,e){function n(r,i){const o=_0(t,i,e);return v0(o!==null),o}return n}function IO(t,e){function n(r,i){const o=_0(t,i,e);return v0(o!==null),vO(o,i,t.host,t._protocol)}return n}function T0(t){function e(n,r){let i;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?i=LB():i=VB():n.getStatus()===402?i=NB(t.bucket):n.getStatus()===403?i=FB(t.path):i=r,i.status=n.getStatus(),i.serverResponse=r.serverResponse,i}return e}function E0(t){const e=T0(t);function n(r,i){let o=e(r,i);return r.getStatus()===404&&(o=kB(t.path)),o.serverResponse=i.serverResponse,o}return n}function CO(t,e,n){const r=e.fullServerUrl(),i=cc(r,t.host,t._protocol),o="GET",s=t.maxOperationRetryTime,u=new Kp(i,o,IO(t,n),s);return u.errorHandler=E0(e),u}function wO(t,e){const n=e.fullServerUrl(),r=cc(n,t.host,t._protocol),i="DELETE",o=t.maxOperationRetryTime;function s(c,d){}const u=new Kp(r,i,s,o);return u.successCodes=[200,204],u.errorHandler=E0(e),u}function SO(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function AO(t,e,n){const r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=SO(null,e)),r}function RO(t,e,n,r,i){const o=e.bucketOnlyServerUrl(),s={"X-Goog-Upload-Protocol":"multipart"};function u(){let C="";for(let k=0;k<2;k++)C=C+Math.random().toString().slice(2);return C}const c=u();s["Content-Type"]="multipart/related; boundary="+c;const d=AO(e,r,i),h=TO(d,n),p="--"+c+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+c+`\r
Content-Type: `+d.contentType+`\r
\r
`,m=`\r
--`+c+"--",_=Zn.getBlob(p,r,m);if(_===null)throw GB();const S={name:d.fullPath},R=cc(o,t.host,t._protocol),M="POST",I=t.maxUploadRetryTime,T=new Kp(R,M,EO(t,n),I);return T.urlParams=S,T.headers=s,T.body=_.uploadData(),T.errorHandler=T0(e),T}class xO{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Kr.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Kr.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Kr.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,r,i){if(this.sent_)throw ls("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(n,e,!0),i!==void 0)for(const o in i)i.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,i[o].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw ls("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw ls("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw ls("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw ls("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class PO extends xO{initXhr(){this.xhr_.responseType="text"}}function Wp(){return new PO}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai{constructor(e,n){this._service=e,n instanceof Lt?this._location=n:this._location=Lt.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new ai(e,n)}get root(){const e=new Lt(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return g0(this._location.path)}get storage(){return this._service}get parent(){const e=hO(this._location.path);if(e===null)return null;const n=new Lt(this._location.bucket,e);return new ai(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw HB(e)}}function DO(t,e,n){t._throwIfRoot("uploadBytes");const r=RO(t.storage,t._location,y0(),new Zn(e,!0),n);return t.storage.makeRequestWithTokens(r,Wp).then(i=>({metadata:i,ref:t}))}function MO(t){t._throwIfRoot("getDownloadURL");const e=CO(t.storage,t._location,y0());return t.storage.makeRequestWithTokens(e,Wp).then(n=>{if(n===null)throw $B();return n})}function kO(t){t._throwIfRoot("deleteObject");const e=wO(t.storage,t._location);return t.storage.makeRequestWithTokens(e,Wp)}function NO(t,e){const n=pO(t._location.path,e),r=new Lt(t._location.bucket,n);return new ai(t.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VO(t){return/^[A-Za-z]+:\/\//.test(t)}function LO(t,e){return new ai(t,e)}function I0(t,e){if(t instanceof Jp){const n=t;if(n._bucket==null)throw qB();const r=new ai(n,n._bucket);return e!=null?I0(r,e):r}else return e!==void 0?NO(t,e):t}function FO(t,e){if(e&&VO(e)){if(t instanceof Jp)return LO(t,e);throw Yf("To use ref(service, url), the first argument must be a Storage instance.")}else return I0(t,e)}function Hv(t,e){const n=e==null?void 0:e[u0];return n==null?null:Lt.makeFromBucketSpec(n,t)}function UO(t,e,n,r={}){t.host=`${e}:${n}`,t._protocol="http";const{mockUserToken:i}=r;i&&(t._overrideAuthToken=typeof i=="string"?i:HI(i,t.app.options.projectId))}class Jp{constructor(e,n,r,i,o){this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=i,this._firebaseVersion=o,this._bucket=null,this._host=a0,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=DB,this._maxUploadRetryTime=MB,this._requests=new Set,i!=null?this._bucket=Lt.makeFromBucketSpec(i,this._host):this._bucket=Hv(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Lt.makeFromBucketSpec(this._url,e):this._bucket=Hv(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){zv("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){zv("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ai(this,e)}_makeRequest(e,n,r,i,o=!0){if(this._deleted)return new KB(c0());{const s=rO(e,this._appId,r,i,n,this._firebaseVersion,o);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}async makeRequestWithTokens(e,n){const[r,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,r,i).getPromise()}}const Kv="@firebase/storage",Wv="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C0="storage";function bO(t,e,n){return t=ht(t),DO(t,e,n)}function BO(t){return t=ht(t),MO(t)}function OO(t){return t=ht(t),kO(t)}function w0(t,e){return t=ht(t),FO(t,e)}function qO(t=tC(),e){t=ht(t);const r=ZI(t,C0).getImmediate({identifier:e}),i=$I("storage");return i&&GO(r,...i),r}function GO(t,e,n,r={}){UO(t,e,n,r)}function $O(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),i=t.getProvider("app-check-internal");return new Jp(n,r,i,e,jI)}function zO(){Xs(new fo(C0,$O,"PUBLIC").setMultipleInstances(!0)),hr(Kv,Wv,""),hr(Kv,Wv,"esm2017")}zO();var HO="firebase",KO="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */hr(HO,KO,"app");const WO={apiKey:"AIzaSyCVT2YuAJQoHE2m5nznwhhK0_jgMBQJzk0",authDomain:"math-fest-display.firebaseapp.com",databaseURL:"https://math-fest-display-default-rtdb.firebaseio.com",projectId:"math-fest-display",storageBucket:"math-fest-display.firebasestorage.app",messagingSenderId:"252365377355",appId:"1:252365377355:web:83772c179137b3de94e2ce"},S0=eC(WO),Er=dB(S0),A0=qO(S0);fB(Er).catch(t=>{t.code=="failed-precondition"?console.warn("Firestore persistence failed: Multiple tabs open."):t.code=="unimplemented"&&console.warn("Firestore persistence is not available in this browser.")});const ui="photos",R0="comments",JO=async()=>{const t=sc(Er,ui),e=jw(t,e0("createdAt","desc"));return(await s0(e)).docs.map(r=>({id:r.id,...r.data(),isFavorite:r.data().isFavorite||!1}))},QO=async(t,e,n)=>{if(!t)throw new Error("No file provided for upload.");const r=`${Date.now()}.${t.name.split(".").pop()}`,i=w0(A0,`${ui}/${r}`);await bO(i,t);const o=await BO(i);await AB(sc(Er,ui),{imageUrl:o,description:e,tags:n,isFavorite:!1,commentCount:0,createdAt:l0()})},YO=async(t,e)=>{const n=dl(Er,ui,t);await wB(n,{isFavorite:e})},XO=async t=>{if(!t||!t.id)throw new Error("Invalid photo data.");const e=dl(Er,ui,t.id);await SB(e);const n=w0(A0,t.imageUrl);await OO(n)},ZO=async t=>{const e=sc(Er,ui,t,R0),n=jw(e,e0("createdAt","asc"));return(await s0(n)).docs.map(i=>i.data())},jO=async(t,e,n)=>{const r=dl(Er,ui,t),i=sc(r,R0);await PB(Er,async o=>{const s=await o.get(r);if(!s.exists())throw"Photo does not exist!";const u=(s.data().commentCount||0)+1;o.update(r,{commentCount:u}),o.set(dl(i),{text:e,username:n,createdAt:l0()})})};var eq={};const tq=t=>new Promise((e,n)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(r.result.split(",")[1]),r.onerror=i=>n(i)}),nq=({onClose:t,onUploadSuccess:e})=>{const[n,r]=oe.useState(null),[i,o]=oe.useState(null),[s,u]=oe.useState(""),[c,d]=oe.useState([]),[h,p]=oe.useState(""),[m,_]=oe.useState(!1),[S,R]=oe.useState(!1),[M,I]=oe.useState(null),T=v=>{var x;const w=(x=v.target.files)==null?void 0:x[0];if(w){if(w.size>10*1024*1024){I("File is too large. Maximum size is 10MB.");return}r(w),d([]),I(null);const D=new FileReader;D.onloadend=()=>{o(D.result)},D.readAsDataURL(w)}},C=oe.useCallback(async()=>{if(!n){I("Please select a photo first to generate tags.");return}R(!0),I(null);try{const v=new OI({apiKey:eq.API_KEY}),x={inlineData:{data:await tq(n),mimeType:n.type}},D={text:"Analyze this image and generate 3 to 5 relevant, single-word, lowercase tags that describe the main subjects, setting, or mood. Separate the tags with commas. For example: 'nature, sunset, beach, ocean, serene'."},P=(await v.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[x,D]}})).text.split(",").map(Ae=>Ae.trim().toLowerCase().replace(/[^a-z0-9\s-]/gi,"")).filter(Ae=>Ae&&Ae.length>1&&Ae.length<20);d(Ae=>[...new Set([...Ae,...P])])}catch(v){console.error("Error generating tags with Gemini:",v),I("Failed to generate tags. Please check your API key or add tags manually.")}finally{R(!1)}},[n]),k=v=>{p(v.target.value)},F=v=>{if((v.key==="Enter"||v.key===",")&&h.trim()!==""){v.preventDefault();const w=h.split(",").map(x=>x.trim().toLowerCase()).filter(x=>x&&x.length>1);d([...new Set([...c,...w])]),p("")}},b=v=>{d(c.filter(w=>w!==v))},A=oe.useCallback(async()=>{if(!n){I("Please select a photo to upload.");return}if(!s.trim()){I("Please add a description for your memory.");return}_(!0),I(null);try{await QO(n,s,c),e(),t()}catch(v){console.error("Upload error:",v),I("Upload failed. Please check the console and try again.")}finally{_(!1)}},[n,s,c,t,e]);return B.jsx("div",{className:"fixed inset-0 bg-primary-bg/80 backdrop-blur-lg flex justify-center items-center z-50 p-4 animate-fade-in-up",style:{animationDuration:"0.3s"},onClick:t,children:B.jsxs("div",{className:"bg-secondary-bg rounded-xl shadow-gentle-lg w-full max-w-lg text-primary-text p-6 sm:p-8 border border-accent-soft/50 max-h-[90vh] overflow-y-auto",onClick:v=>v.stopPropagation(),children:[B.jsx("h2",{className:"text-2xl font-semibold text-transparent bg-clip-text bg-gradient-to-r from-accent to-pink-400 mb-6",children:"Add a New Memory"}),B.jsxs("div",{className:"space-y-6",children:[B.jsxs("div",{children:[B.jsx("label",{htmlFor:"file-upload",className:"block text-sm font-medium text-secondary-text mb-2",children:"Photo"}),B.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-accent-soft/60 border-dashed rounded-md bg-primary-bg",children:B.jsxs("div",{className:"space-y-2 text-center",children:[i?B.jsx("img",{src:i,alt:"Preview",className:"mx-auto h-40 w-auto rounded-md object-contain"}):B.jsx("svg",{className:"mx-auto h-12 w-12 text-accent-soft",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48","aria-hidden":"true",children:B.jsx("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 4v.01M28 8L20 16m0 0h8m-8 0V8m12 12v12a4 4 0 01-4 4H12a4 4 0 01-4-4V12a4 4 0 014-4h8",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round"})}),B.jsxs("div",{className:"flex text-sm text-secondary-text justify-center",children:[B.jsxs("label",{htmlFor:"file-upload",className:"relative cursor-pointer bg-transparent rounded-md font-medium text-accent hover:text-accent-hover focus-within:outline-none",children:[B.jsx("span",{children:n?"Change file":"Upload a file"}),B.jsx("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",accept:"image/*",onChange:T})]}),B.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),B.jsx("p",{className:"text-xs text-secondary-text/70",children:"PNG, JPG, GIF up to 10MB"})]})})]}),B.jsxs("div",{children:[B.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-secondary-text",children:"Description"}),B.jsx("textarea",{id:"description",rows:3,value:s,onChange:v=>u(v.target.value),className:"mt-1 block w-full bg-primary-bg border border-accent-soft/60 rounded-md shadow-sm focus:ring-accent focus:border-accent sm:text-sm p-2 text-primary-text placeholder-secondary-text/70 transition-colors",placeholder:"What's this memory about?"})]}),B.jsxs("div",{children:[B.jsx("label",{htmlFor:"tags",className:"block text-sm font-medium text-secondary-text mb-1",children:"Tags"}),B.jsxs("div",{className:"flex gap-2 items-start",children:[B.jsxs("div",{className:"flex-grow",children:[B.jsx("input",{id:"tags",type:"text",value:h,onChange:k,onKeyDown:F,disabled:S,className:"block w-full bg-primary-bg border border-accent-soft/60 rounded-md shadow-sm focus:ring-accent focus:border-accent sm:text-sm p-2 text-primary-text placeholder-secondary-text/70 transition-colors",placeholder:"Add tags (e.g., vacation, family)"}),B.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:c.map(v=>B.jsxs("span",{className:"flex items-center bg-accent/20 text-accent text-xs font-medium px-2.5 py-1 rounded-full",children:[v,B.jsx("button",{onClick:()=>b(v),className:"ml-1.5 text-accent/70 hover:text-accent",children:B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:B.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]},v))})]}),B.jsxs("button",{type:"button",onClick:C,disabled:!n||S||m,className:"px-3 py-2 text-sm font-medium text-white bg-accent/80 rounded-md hover:bg-accent-hover disabled:bg-secondary-bg disabled:text-secondary-text disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center h-9 shadow-md disabled:shadow-none shrink-0",children:[S?B.jsx(Ys,{}):B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:B.jsx("path",{fillRule:"evenodd",d:"M9.628 2.034a1 1 0 011.228.665l.876 3.722 3.723.876a1 1 0 01.665 1.228l-2.43 5.67a1 1 0 01-1.22.665l-3.723-.876-3.722-.876a1 1 0 01-.665-1.228l2.43-5.67zM10 18a8 8 0 100-16 8 8 0 000 16z",clipRule:"evenodd"})}),S?"":"AI Tags"]})]})]}),M&&B.jsx("p",{className:"text-sm text-red-400 bg-red-900/40 p-2 rounded-md",children:M})]}),B.jsxs("div",{className:"mt-8 flex justify-end items-center space-x-4",children:[B.jsx("button",{type:"button",onClick:t,disabled:m,className:"px-4 py-2 text-sm font-medium text-secondary-text rounded-md hover:bg-accent-soft/20 disabled:opacity-50 transition-colors",children:"Cancel"}),B.jsx("button",{type:"button",onClick:A,disabled:m||!n||S,className:"px-6 py-2 text-sm font-medium text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-secondary-bg disabled:text-secondary-text disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center min-w-[100px] h-9 shadow-lg shadow-accent/30",children:m?B.jsx(Ys,{}):"Upload"})]})]})})};var rq={};const iq=t=>new Promise((e,n)=>{if(typeof t=="string")fetch(t).then(r=>r.blob()).then(r=>{const i=new FileReader;i.readAsDataURL(r),i.onload=()=>e(i.result.split(",")[1]),i.onerror=o=>n(o)}).catch(r=>n(r));else{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(r.result.split(",")[1]),r.onerror=i=>n(i)}}),oq=({photo:t})=>{const[e,n]=oe.useState([]),[r,i]=oe.useState(""),[o,s]=oe.useState(!0),[u,c]=oe.useState(null),[d,h]=oe.useState(!1),[p,m]=oe.useState(!1);oe.useEffect(()=>{(async()=>{try{s(!0);const M=await ZO(t.id);n(M)}catch(M){c("Could not load comments."),console.error(M)}finally{s(!1)}})()},[t.id]);const _=async R=>{if(R.preventDefault(),!(!r.trim()||d)){h(!0);try{const M="You";await jO(t.id,r,M),n(I=>[...I,{text:r,username:M,createdAt:new Date}]),i("")}catch{c("Failed to post comment.")}finally{h(!1)}}},S=oe.useCallback(async()=>{m(!0),c(null);try{const R=new OI({apiKey:rq.API_KEY}),I={inlineData:{data:await iq(t.imageUrl),mimeType:"image/jpeg"}},T={text:"You are a friendly and enthusiastic social media user. Look at this photo and write a short, positive, and complimentary comment, like you would on Instagram. Keep it under 15 words and include an emoji. For example: 'Wow, what a beautiful shot! ' or 'This looks like so much fun! '."},C=await R.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[T,I]}});i(C.text)}catch(R){console.error("Error generating comment with Gemini:",R),c("AI failed to generate a comment.")}finally{m(!1)}},[t.imageUrl]);return B.jsxs("div",{className:"w-full max-w-lg mx-auto mt-4 pt-4 border-t border-accent-soft/50",children:[B.jsx("h3",{className:"text-lg font-semibold text-primary-text mb-4",children:"Comments"}),B.jsxs("div",{className:"space-y-4 max-h-48 overflow-y-auto pr-2",children:[o&&B.jsx(Ys,{}),u&&B.jsx("p",{className:"text-sm text-red-500",children:u}),!o&&e.length===0&&B.jsx("p",{className:"text-sm text-secondary-text",children:"Be the first to comment!"}),e.map((R,M)=>B.jsxs("div",{className:"flex items-start gap-3",children:[B.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-soft flex items-center justify-center text-accent font-bold text-sm shrink-0",children:R.username.charAt(0)}),B.jsxs("div",{children:[B.jsx("p",{className:"font-semibold text-primary-text text-sm",children:R.username}),B.jsx("p",{className:"text-secondary-text text-sm",children:R.text})]})]},M))]}),B.jsxs("form",{onSubmit:_,className:"mt-4 flex gap-2 items-start",children:[B.jsx("input",{type:"text",value:r,onChange:R=>i(R.target.value),placeholder:"Add a comment...",className:"flex-grow bg-primary-bg border border-accent-soft/60 rounded-full shadow-sm focus:ring-accent focus:border-accent text-sm p-2 px-4 text-primary-text placeholder-secondary-text/70 transition-colors",disabled:d||p}),B.jsx("button",{type:"button",onClick:S,disabled:p||d,className:"w-10 h-10 rounded-full flex items-center justify-center transition-colors duration-300 group bg-accent/20 hover:bg-accent/30 shrink-0","aria-label":"Generate AI comment",children:p?B.jsx(Ys,{}):B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-accent",viewBox:"0 0 20 20",fill:"currentColor",children:B.jsx("path",{fillRule:"evenodd",d:"M9.628 2.034a1 1 0 011.228.665l.876 3.722 3.723.876a1 1 0 01.665 1.228l-2.43 5.67a1 1 0 01-1.22.665l-3.723-.876-3.722-.876a1 1 0 01-.665-1.228l2.43-5.67zM10 18a8 8 0 100-16 8 8 0 000 16z",clipRule:"evenodd"})})}),B.jsx("button",{type:"submit",disabled:!r.trim()||d||p,className:"w-10 h-10 bg-accent hover:bg-accent-hover text-white font-bold rounded-full flex items-center justify-center transition-all duration-300 shadow-lg shadow-accent/30 disabled:bg-secondary-bg disabled:text-secondary-text shrink-0",children:B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:B.jsx("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})})})]})]})},sq=({photo:t,onClose:e})=>{const n=r=>r!=null&&r.toDate?new Intl.DateTimeFormat("en-US",{dateStyle:"full",timeStyle:"short"}).format(r.toDate()):"Just now";return B.jsx("div",{className:"fixed inset-0 bg-primary-bg/80 backdrop-blur-lg flex justify-center items-center z-50 p-4 animate-fade-in-up",style:{animationDuration:"0.3s"},onClick:e,children:B.jsxs("div",{className:"relative bg-white rounded-xl shadow-gentle-lg w-full max-w-4xl max-h-[90vh] flex flex-col md:flex-row overflow-hidden",onClick:r=>r.stopPropagation(),children:[B.jsx("button",{onClick:e,"aria-label":"Close lightbox",className:"absolute top-3 right-3 p-2 bg-white/50 backdrop-blur-sm rounded-full text-primary-text hover:text-accent focus:outline-none transition-all duration-200 z-20",children:B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:B.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),B.jsx("div",{className:"w-full md:w-2/3 bg-primary-bg flex items-center justify-center p-2",children:B.jsx("img",{src:t.imageUrl,alt:t.description||"Photo diary entry",className:"max-w-full max-h-[80vh] object-contain rounded-lg"})}),B.jsxs("div",{className:"w-full md:w-1/3 p-6 flex flex-col justify-between overflow-y-auto",children:[B.jsxs("div",{children:[B.jsx("p",{className:"text-lg font-semibold text-primary-text",children:t.description}),B.jsx("p",{className:"text-sm text-secondary-text mt-1",children:n(t.createdAt)}),t.tags&&t.tags.length>0&&B.jsx("div",{className:"flex flex-wrap gap-2 mt-4",children:t.tags.map(r=>B.jsx("span",{className:"text-xs bg-accent/20 text-accent font-medium px-2.5 py-1 rounded-full",children:r},r))})]}),B.jsx(oq,{photo:t})]})]})})},lq=()=>{const[t,e]=oe.useState([]),[n,r]=oe.useState(!0),[i,o]=oe.useState(null),s=oe.useCallback(async()=>{try{r(!0),o(null);const h=await JO();e(h)}catch(h){console.error("Detailed error fetching photos:",h),o("Failed to load photos. This could be due to network issues or incorrect Firebase permissions. Check the console for more details.")}finally{r(!1)}},[]);oe.useEffect(()=>{s()},[]);const u=oe.useCallback((h,p)=>{e(m=>m.map(_=>_.id===h?{..._,...p}:_))},[]),c=oe.useCallback(async h=>{const p=!h.isFavorite;u(h.id,{isFavorite:p});try{await YO(h.id,p)}catch(m){console.error("Error updating favorite status:",m),u(h.id,{isFavorite:h.isFavorite}),alert("Failed to update favorite status. Please try again.")}},[u]),d=oe.useCallback(async h=>{try{await XO(h),e(p=>p.filter(m=>m.id!==h.id))}catch(p){console.error("Error deleting photo:",p),alert("Failed to delete photo. Please check your Firebase rules and try again.")}},[]);return{photos:t,loading:n,error:i,refetchPhotos:s,removePhoto:d,toggleFavorite:c}},aq=t=>{if(!t||!t.toDate)return"";const e=t.toDate();return new Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e)},uq=()=>{const[t,e]=oe.useState(!1),{photos:n,loading:r,error:i,refetchPhotos:o,removePhoto:s,toggleFavorite:u}=lq(),[c,d]=oe.useState(""),[h,p]=oe.useState(null),[m,_]=oe.useState(!1),S=oe.useCallback(()=>{o()},[o]),R=oe.useMemo(()=>{let M=n;if(m&&(M=M.filter(T=>T.isFavorite)),!c.trim())return M;const I=c.toLowerCase();return M.filter(T=>{var b;const C=T.description.toLowerCase().includes(I),k=aq(T.createdAt).toLowerCase().includes(I),F=(b=T.tags)==null?void 0:b.some(A=>A.toLowerCase().includes(I));return C||k||F})},[n,c,m]);return B.jsxs("div",{className:"min-h-screen",children:[B.jsx(VR,{onAddPhotoClick:()=>e(!0),searchTerm:c,onSearchChange:d,isGridEmpty:n.length===0&&!r,onToggleFavorites:()=>_(!m),showFavorites:m}),B.jsx("main",{className:"container mx-auto p-4 md:p-8",children:B.jsx(UR,{photos:R,loading:r,error:i,onDeletePhoto:s,onFavoritePhoto:u,onPhotoClick:p})}),t&&B.jsx(nq,{onClose:()=>e(!1),onUploadSuccess:S}),h&&B.jsx(sq,{photo:h,onClose:()=>p(null)})]})},x0=document.getElementById("root");if(!x0)throw new Error("Could not find root element to mount to");const cq=vd.createRoot(x0);cq.render(B.jsx(IS.StrictMode,{children:B.jsx(uq,{})}));
